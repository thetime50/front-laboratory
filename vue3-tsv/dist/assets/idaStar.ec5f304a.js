var E=Object.defineProperty;var F=(a,t,e)=>t in a?E(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var d=(a,t,e)=>(F(a,typeof t!="symbol"?t+"":t,e),e);import{l as x}from"./shared/chartGraph/idaStar.9fc57de2.js";var C=(a=>(a[a.u=0]="u",a[a.r=1]="r",a[a.d=2]="d",a[a.l=3]="l",a))(C||{});function M(a){return a.map(t=>C[t]).join(",")}class O{constructor(t={widthCnt:4,heightCnt:4,emptyIndex:-1,emptyNum:-1}){d(this,"list",[]);d(this,"checkStr","");d(this,"finishStr","");d(this,"finishMap",{});d(this,"canAction",[]);d(this,"reverseDir",{[0]:2,[1]:3,[2]:0,[3]:1});d(this,"actoins2Str",M);this.cfg=t,this.cfg=t,this.initList(),this.initCanAction()}get widthCnt(){return this.cfg.widthCnt}set widthCnt(t){this.cfg.widthCnt=t}get heightCnt(){return this.cfg.heightCnt}set heightCnt(t){this.cfg.heightCnt=t}get emptyIndex(){return this.cfg.emptyIndex}set emptyIndex(t){this.cfg.emptyIndex=t}get emptyNum(){return this.cfg.emptyNum}get listStr(){return this.list.join(",")}set listStr(t){this.setList(t)}initList(){this.list=Array.from({length:this.widthCnt*this.heightCnt},(t,e)=>e),this.checkStr=this.list.sort((t,e)=>t-e).join(","),this.setFinishtList(this.list),this.emptyIndex=this.list.length-1,this.cfg.emptyNum=this.emptyIndex}checkFinish(){return this.listStr==this.finishStr}initCanAction(){const t=[!0,!0,!0,!0],e=[!1,!0,!0,!0],r=[!0,!0,!1,!0],i=[!0,!0,!0,!1],n=[!0,!1,!0,!0],s=this.widthCnt*this.heightCnt;this.canAction=Array.from({length:s}).fill(t);const o=(this.heightCnt-1)*this.widthCnt;for(let u=0;u<this.widthCnt;u++)this.canAction[u]=e,this.canAction[u+o]=r;for(let u=0;u<s;u+=this.widthCnt)this.canAction[u]=i,this.canAction[u+this.widthCnt-1]=n;this.canAction[0]=[!1,!0,!0,!1],this.canAction[this.widthCnt-1]=[!1,!1,!0,!0],this.canAction[o]=[!0,!0,!1,!1],this.canAction[s-1]=[!0,!1,!1,!0]}setSize(t,e){const r=this.widthCnt!=t||this.heightCnt!=e;this.widthCnt=Number(t),this.heightCnt=Number(e),this.initList(),r&&this.initCanAction()}reset(){this.initList()}setList(t,e=!0,r=!1){const i=typeof t=="string"?t.split(/[,\s]+/).map(n=>Number(n)):t;if(i.length!==this.list.length)throw new Error(`\u66F4\u65B0\u4F4D\u7F6E\u957F\u5EA6\u9519\u8BEF${i.length},\u5E94\u4E3A${this.list.length}`);if(e&&i.concat().sort((n,s)=>n-s).join(",")!==this.checkStr)throw console.log("\u6570\u7EC4\u5185\u5BB9\u9519\u8BEF",i),new Error("\u6570\u7EC4\u5185\u5BB9\u9519\u8BEF");r?this.list.forEach((n,s)=>{this.list[s]=i[s]}):this.list=i.concat(),this.emptyIndex=i.findIndex(n=>n==this.cfg.emptyNum)}getCanActoinDir(t,e){const r=[...this.canAction[t]];return typeof e=="number"&&(r[this.reverseDir[e]]=!1),r.reduce((i,n,s,o)=>(n&&i.push(s),i),[])}getSwitchOtherCell(t,e){if(e==0){if(t<this.widthCnt)throw new Error(`index:${t} dir:${C[e]}\u8D85\u51FA\u8303\u56F4`);return t-this.widthCnt}if(e==1){if(t%this.widthCnt==this.widthCnt-1)throw new Error(`index:${t} dir:${C[e]}\u8D85\u51FA\u8303\u56F4`);return t+1}if(e==2){if(t+this.widthCnt>=this.widthCnt*this.heightCnt)throw new Error(`index:${t} dir:${C[e]}\u8D85\u51FA\u8303\u56F4`);return t+this.widthCnt}if(e==3){if(t%this.widthCnt==0)throw new Error(`index:${t} dir:${C[e]}\u8D85\u51FA\u8303\u56F4`);return t-1}throw new Error(`dir:${e} \u9519\u8BEF\u7684dir`)}getRandomActions(t){let e=this.emptyIndex;const r=[];r.push(x.exports.sample(this.getCanActoinDir(e))),e=this.getSwitchOtherCell(e,r[0]);for(let i=1;i<t;i++){const n=x.exports.sample(this.getCanActoinDir(e,r[i-1]));r.push(n),e=this.getSwitchOtherCell(e,n)}return r}actionsToString(t){return t.map(e=>C[e])}doAction(t,e=!0){const r=this.getSwitchOtherCell(this.emptyIndex,t);let i=this.list;e||(i=i.concat());const n=i[this.emptyIndex];return i[this.emptyIndex]=i[r],i[r]=n,e&&(this.emptyIndex=r),i}doActions(t){t.forEach(e=>{this.doAction(e)})}manhattan(t,e){const r=this.widthCnt,i=Math.abs(Math.floor(t/r)-Math.floor(e/r)),n=Math.abs(t%r-e%r);return i+n}getManhattan(t){return(t||this.list).map((r,i)=>this.manhattan(this.finishMap[i],r))}updateManhattan(t,e,r,i){const n=t.concat(),s=this.widthCnt,o=this.manhattan(this.finishMap[r],e[r]);let u=r;i==2?u+=s:i==0?u-=s:i==3?u-=1:i==1&&(u+=1);const h=this.manhattan(this.finishMap[u],e[u]);return n[r]=o,n[u]=h,n}setFinishtList(t,e=!0){const r=typeof t=="string"?t.split(/[,\s]+/).map(i=>Number(i)):t;if(r.length!==this.list.length)throw new Error(`\u66F4\u65B0\u4F4D\u7F6E\u957F\u5EA6\u9519\u8BEF${r.length},\u5E94\u4E3A${this.list.length}`);if(e&&r.concat().sort((i,n)=>i-n).join(",")!==this.checkStr)throw console.log("\u6570\u7EC4\u5185\u5BB9\u9519\u8BEF",r),new Error("\u6570\u7EC4\u5185\u5BB9\u9519\u8BEF");this.finishMap=this.list.reduce((i,n,s,o)=>(i[n]=s,i),{}),this.finishStr=r.join(",")}}class k extends O{constructor(t={widthCnt:4,heightCnt:4,emptyIndex:-1,emptyNum:-1,itemWidth:30,gep:4}){super(t),this.cfg=t}}class D{constructor(t,e,r,i,n){d(this,"cost");this.list=t,this.action=e,this.beforeState=r,this.gcost=i,this.hcost=n,this.cost=this.gcost+this.hcost.reduce((s,o)=>s+o,0)}}class I extends D{constructor(t,e,r,i,n,s){super(t,e,r,i,n),this.list=t,this.action=e,this.beforeState=r,this.gcost=i,this.hcost=n,this.childCnt=s}}var c=function(a,t,e,r){function i(n){return n instanceof e?n:new e(function(s){s(n)})}return new(e||(e=Promise))(function(n,s){function o(p){try{h(r.next(p))}catch(f){s(f)}}function u(p){try{h(r.throw(p))}catch(f){s(f)}}function h(p){p.done?n(p.value):i(p.value).then(o,u)}h((r=r.apply(a,t||[])).next())})},l=function(a,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},r,i,n,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function o(h){return function(p){return u([h,p])}}function u(h){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,h[0]&&(e=0)),e;)try{if(r=1,i&&(n=h[0]&2?i.return:h[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,h[1])).done)return n;switch(i=0,n&&(h=[h[0]&2,n.value]),h[0]){case 0:case 1:n=h;break;case 4:return e.label++,{value:h[1],done:!1};case 5:e.label++,i=h[1],h=[0];continue;case 7:h=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(h[0]===6||h[0]===2)){e=0;continue}if(h[0]===3&&(!n||h[1]>n[0]&&h[1]<n[3])){e.label=h[1];break}if(h[0]===6&&e.label<n[1]){e.label=n[1],n=h;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(h);break}n[2]&&e.ops.pop(),e.trys.pop();continue}h=t.call(a,e)}catch(p){h=[6,p],i=0}finally{r=n=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}},m=function(a,t){var e=typeof Symbol=="function"&&a[Symbol.iterator];if(!e)return a;var r=e.call(a),i,n=[],s;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)n.push(i.value)}catch(o){s={error:o}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(s)throw s.error}}return n},A=function(a,t,e){if(e||arguments.length===2)for(var r=0,i=t.length,n;r<i;r++)(n||!(r in t))&&(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return a.concat(n||Array.prototype.slice.call(t))},_=function(a){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&a[t],r=0;if(e)return e.call(a);if(a&&typeof a.length=="number")return{next:function(){return a&&r>=a.length&&(a=void 0),{value:a&&a[r++],done:!a}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};(function(){function a(t){t===void 0&&(t=a.minComparator);var e=this;this.compare=t,this.heapArray=[],this._limit=0,this.offer=this.add,this.element=this.peek,this.poll=this.pop,this._invertedCompare=function(r,i){return e.compare(r,i).then(function(n){return-1*n})}}return a.getChildrenIndexOf=function(t){return[t*2+1,t*2+2]},a.getParentIndexOf=function(t){if(t<=0)return-1;var e=t%2?1:2;return Math.floor((t-e)/2)},a.getSiblingIndexOf=function(t){if(t<=0)return-1;var e=t%2?1:-1;return t+e},a.minComparator=function(t,e){return c(this,void 0,void 0,function(){return l(this,function(r){return t>e?[2,1]:t<e?[2,-1]:[2,0]})})},a.maxComparator=function(t,e){return c(this,void 0,void 0,function(){return l(this,function(r){return e>t?[2,1]:e<t?[2,-1]:[2,0]})})},a.minComparatorNumber=function(t,e){return c(this,void 0,void 0,function(){return l(this,function(r){return[2,t-e]})})},a.maxComparatorNumber=function(t,e){return c(this,void 0,void 0,function(){return l(this,function(r){return[2,e-t]})})},a.defaultIsEqual=function(t,e){return c(this,void 0,void 0,function(){return l(this,function(r){return[2,t===e]})})},a.print=function(t){function e(p){var f=a.getParentIndexOf(p);return Math.floor(Math.log2(f+1))}function r(p,f){for(var g="";f>0;--f)g+=p;return g}for(var i=0,n=[],s=e(t.length-1)+2,o=0;i<t.length;){var u=e(i)+1;i===0&&(u=0);var h=String(t.get(i));h.length>o&&(o=h.length),n[u]=n[u]||[],n[u].push(h),i+=1}return n.map(function(p,f){var g=Math.pow(2,s-f)-1;return r(" ",Math.floor(g/2)*o)+p.map(function(w){var b=(o-w.length)/2;return r(" ",Math.ceil(b))+w+r(" ",Math.floor(b))}).join(r(" ",g*o))}).join(`
`)},a.heapify=function(t,e){return c(this,void 0,void 0,function(){var r;return l(this,function(i){switch(i.label){case 0:return r=new a(e),r.heapArray=t,[4,r.init()];case 1:return i.sent(),[2,r]}})})},a.heappop=function(t,e){var r=new a(e);return r.heapArray=t,r.pop()},a.heappush=function(t,e,r){return c(this,void 0,void 0,function(){var i;return l(this,function(n){switch(n.label){case 0:return i=new a(r),i.heapArray=t,[4,i.push(e)];case 1:return n.sent(),[2]}})})},a.heappushpop=function(t,e,r){var i=new a(r);return i.heapArray=t,i.pushpop(e)},a.heapreplace=function(t,e,r){var i=new a(r);return i.heapArray=t,i.replace(e)},a.heaptop=function(t,e,r){e===void 0&&(e=1);var i=new a(r);return i.heapArray=t,i.top(e)},a.heapbottom=function(t,e,r){e===void 0&&(e=1);var i=new a(r);return i.heapArray=t,i.bottom(e)},a.nlargest=function(t,e,r){return c(this,void 0,void 0,function(){var i;return l(this,function(n){switch(n.label){case 0:return i=new a(r),i.heapArray=A([],m(e),!1),[4,i.init()];case 1:return n.sent(),[2,i.top(t)]}})})},a.nsmallest=function(t,e,r){return c(this,void 0,void 0,function(){var i;return l(this,function(n){switch(n.label){case 0:return i=new a(r),i.heapArray=A([],m(e),!1),[4,i.init()];case 1:return n.sent(),[2,i.bottom(t)]}})})},a.prototype.add=function(t){return c(this,void 0,void 0,function(){return l(this,function(e){switch(e.label){case 0:return[4,this._sortNodeUp(this.heapArray.push(t)-1)];case 1:return e.sent(),this._applyLimit(),[2,!0]}})})},a.prototype.addAll=function(t){return c(this,void 0,void 0,function(){var e,r,i;return l(this,function(n){switch(n.label){case 0:e=this.length,(i=this.heapArray).push.apply(i,A([],m(t),!1)),r=this.length,n.label=1;case 1:return e<r?[4,this._sortNodeUp(e)]:[3,4];case 2:n.sent(),n.label=3;case 3:return++e,[3,1];case 4:return this._applyLimit(),[2,!0]}})})},a.prototype.bottom=function(){return c(this,arguments,void 0,function(t){return t===void 0&&(t=1),l(this,function(e){return this.heapArray.length===0||t<=0?[2,[]]:this.heapArray.length===1?[2,[this.heapArray[0]]]:t>=this.heapArray.length?[2,A([],m(this.heapArray),!1)]:[2,this._bottomN_push(~~t)]})})},a.prototype.check=function(){return c(this,void 0,void 0,function(){var t,e,r,i,n,s,o,u,h;return l(this,function(p){switch(p.label){case 0:t=0,p.label=1;case 1:if(!(t<this.heapArray.length))return[3,10];e=this.heapArray[t],r=this.getChildrenOf(t),p.label=2;case 2:p.trys.push([2,7,8,9]),i=(u=void 0,_(r)),n=i.next(),p.label=3;case 3:return n.done?[3,6]:(s=n.value,[4,this.compare(e,s)]);case 4:if(p.sent()>0)return[2,e];p.label=5;case 5:return n=i.next(),[3,3];case 6:return[3,9];case 7:return o=p.sent(),u={error:o},[3,9];case 8:try{n&&!n.done&&(h=i.return)&&h.call(i)}finally{if(u)throw u.error}return[7];case 9:return++t,[3,1];case 10:return[2]}})})},a.prototype.clear=function(){this.heapArray=[]},a.prototype.clone=function(){var t=new a(this.comparator());return t.heapArray=this.toArray(),t._limit=this._limit,t},a.prototype.comparator=function(){return this.compare},a.prototype.contains=function(t){return c(this,arguments,void 0,function(e,r){var i,n,s,o,u,h;return r===void 0&&(r=a.defaultIsEqual),l(this,function(p){switch(p.label){case 0:p.trys.push([0,5,6,7]),i=_(this.heapArray),n=i.next(),p.label=1;case 1:return n.done?[3,4]:(s=n.value,[4,r(s,e)]);case 2:if(p.sent())return[2,!0];p.label=3;case 3:return n=i.next(),[3,1];case 4:return[3,7];case 5:return o=p.sent(),u={error:o},[3,7];case 6:try{n&&!n.done&&(h=i.return)&&h.call(i)}finally{if(u)throw u.error}return[7];case 7:return[2,!1]}})})},a.prototype.init=function(t){return c(this,void 0,void 0,function(){var e;return l(this,function(r){switch(r.label){case 0:t&&(this.heapArray=A([],m(t),!1)),e=Math.floor(this.heapArray.length),r.label=1;case 1:return e>=0?[4,this._sortNodeDown(e)]:[3,4];case 2:r.sent(),r.label=3;case 3:return--e,[3,1];case 4:return this._applyLimit(),[2]}})})},a.prototype.isEmpty=function(){return this.length===0},a.prototype.leafs=function(){if(this.heapArray.length===0)return[];var t=a.getParentIndexOf(this.heapArray.length-1);return this.heapArray.slice(t+1)},Object.defineProperty(a.prototype,"length",{get:function(){return this.heapArray.length},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"limit",{get:function(){return this._limit},set:function(t){this._limit=~~t,this._applyLimit()},enumerable:!1,configurable:!0}),a.prototype.peek=function(){return this.heapArray[0]},a.prototype.pop=function(){return c(this,void 0,void 0,function(){var t;return l(this,function(e){return t=this.heapArray.pop(),this.length>0&&t!==void 0?[2,this.replace(t)]:[2,t]})})},a.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return c(this,void 0,void 0,function(){return l(this,function(r){return t.length<1?[2,!1]:t.length===1?[2,this.add(t[0])]:[2,this.addAll(t)]})})},a.prototype.pushpop=function(t){return c(this,void 0,void 0,function(){var e;return l(this,function(r){switch(r.label){case 0:return[4,this.compare(this.heapArray[0],t)];case 1:return r.sent()<0?(e=m([this.heapArray[0],t],2),t=e[0],this.heapArray[0]=e[1],[4,this._sortNodeDown(0)]):[3,3];case 2:r.sent(),r.label=3;case 3:return[2,t]}})})},a.prototype.remove=function(t){return c(this,arguments,void 0,function(e,r){var i,n,s,o=this;return r===void 0&&(r=a.defaultIsEqual),l(this,function(u){switch(u.label){case 0:return this.heapArray.length?e!==void 0?[3,2]:[4,this.pop()]:[2,!1];case 1:return u.sent(),[2,!0];case 2:i=[0],u.label=3;case 3:return i.length?(n=i.shift(),[4,r(this.heapArray[n],e)]):[3,13];case 4:return u.sent()?n!==0?[3,6]:[4,this.pop()]:[3,11];case 5:return u.sent(),[3,10];case 6:return n!==this.heapArray.length-1?[3,7]:(this.heapArray.pop(),[3,10]);case 7:return this.heapArray.splice(n,1,this.heapArray.pop()),[4,this._sortNodeUp(n)];case 8:return u.sent(),[4,this._sortNodeDown(n)];case 9:u.sent(),u.label=10;case 10:return[2,!0];case 11:s=a.getChildrenIndexOf(n).filter(function(h){return h<o.heapArray.length}),i.push.apply(i,A([],m(s),!1)),u.label=12;case 12:return[3,3];case 13:return[2,!1]}})})},a.prototype.replace=function(t){return c(this,void 0,void 0,function(){var e;return l(this,function(r){switch(r.label){case 0:return e=this.heapArray[0],this.heapArray[0]=t,[4,this._sortNodeDown(0)];case 1:return r.sent(),[2,e]}})})},a.prototype.size=function(){return this.length},a.prototype.top=function(){return c(this,arguments,void 0,function(t){return t===void 0&&(t=1),l(this,function(e){return this.heapArray.length===0||t<=0?[2,[]]:this.heapArray.length===1||t===1?[2,[this.heapArray[0]]]:t>=this.heapArray.length?[2,A([],m(this.heapArray),!1)]:[2,this._topN_push(~~t)]})})},a.prototype.toArray=function(){return A([],m(this.heapArray),!1)},a.prototype.toString=function(){return this.heapArray.toString()},a.prototype.get=function(t){return this.heapArray[t]},a.prototype.getChildrenOf=function(t){var e=this;return a.getChildrenIndexOf(t).map(function(r){return e.heapArray[r]}).filter(function(r){return r!==void 0})},a.prototype.getParentOf=function(t){var e=a.getParentIndexOf(t);return this.heapArray[e]},a.prototype[Symbol.iterator]=function(){return l(this,function(t){switch(t.label){case 0:return this.length?[4,this.pop()]:[3,2];case 1:return t.sent(),[3,0];case 2:return[2]}})},a.prototype.iterator=function(){return this},a.prototype._applyLimit=function(){if(this._limit&&this._limit<this.heapArray.length)for(var t=this.heapArray.length-this._limit;t;)this.heapArray.pop(),--t},a.prototype._bottomN_push=function(t){return c(this,void 0,void 0,function(){var e,r,i,n,o,s,o;return l(this,function(u){switch(u.label){case 0:return e=new a(this.compare),e.limit=t,e.heapArray=this.heapArray.slice(-t),[4,e.init()];case 1:for(u.sent(),r=this.heapArray.length-1-t,i=a.getParentIndexOf(r),n=[],o=r;o>i;--o)n.push(o);s=this.heapArray,u.label=2;case 2:return n.length?(o=n.shift(),[4,this.compare(s[o],e.peek())]):[3,6];case 3:return u.sent()>0?[4,e.replace(s[o])]:[3,5];case 4:u.sent(),o%2&&n.push(a.getParentIndexOf(o)),u.label=5;case 5:return[3,2];case 6:return[2,e.toArray()]}})})},a.prototype._moveNode=function(t,e){var r;r=m([this.heapArray[e],this.heapArray[t]],2),this.heapArray[t]=r[0],this.heapArray[e]=r[1]},a.prototype._sortNodeDown=function(t){return c(this,void 0,void 0,function(){var e,r,i,n,s,o;return l(this,function(u){switch(u.label){case 0:e=this.heapArray.length,u.label=1;case 1:return r=2*t+1,i=r+1,n=t,s=r<e,s?[4,this.compare(this.heapArray[r],this.heapArray[n])]:[3,3];case 2:s=u.sent()<0,u.label=3;case 3:return s&&(n=r),o=i<e,o?[4,this.compare(this.heapArray[i],this.heapArray[n])]:[3,5];case 4:o=u.sent()<0,u.label=5;case 5:if(o&&(n=i),n===t)return[3,7];this._moveNode(t,n),t=n,u.label=6;case 6:return[3,1];case 7:return[2]}})})},a.prototype._sortNodeUp=function(t){return c(this,void 0,void 0,function(){var e;return l(this,function(r){switch(r.label){case 0:return t>0?(e=a.getParentIndexOf(t),[4,this.compare(this.heapArray[t],this.heapArray[e])]):[3,2];case 1:if(r.sent()<0)this._moveNode(t,e),t=e;else return[3,2];return[3,0];case 2:return[2]}})})},a.prototype._topN_push=function(t){return c(this,void 0,void 0,function(){var e,r,i,n;return l(this,function(s){switch(s.label){case 0:e=new a(this._invertedCompare),e.limit=t,r=[0],i=this.heapArray,s.label=1;case 1:return r.length?(n=r.shift(),n<i.length?e.length<t?[4,e.push(i[n])]:[3,3]:[3,6]):[3,7];case 2:return s.sent(),r.push.apply(r,A([],m(a.getChildrenIndexOf(n)),!1)),[3,6];case 3:return[4,this.compare(i[n],e.peek())];case 4:return s.sent()<0?[4,e.replace(i[n])]:[3,6];case 5:s.sent(),r.push.apply(r,A([],m(a.getChildrenIndexOf(n)),!1)),s.label=6;case 6:return[3,1];case 7:return[2,e.toArray()]}})})},a.prototype._topN_fill=function(t){return c(this,void 0,void 0,function(){var e,r,i,n,s,s;return l(this,function(o){switch(o.label){case 0:return e=this.heapArray,r=new a(this._invertedCompare),r.limit=t,r.heapArray=e.slice(0,t),[4,r.init()];case 1:for(o.sent(),i=a.getParentIndexOf(t-1)+1,n=[],s=i;s<t;++s)n.push.apply(n,A([],m(a.getChildrenIndexOf(s).filter(function(u){return u<e.length})),!1));(t-1)%2&&n.push(t),o.label=2;case 2:return n.length?(s=n.shift(),s<e.length?[4,this.compare(e[s],r.peek())]:[3,5]):[3,6];case 3:return o.sent()<0?[4,r.replace(e[s])]:[3,5];case 4:o.sent(),n.push.apply(n,A([],m(a.getChildrenIndexOf(s)),!1)),o.label=5;case 5:return[3,2];case 6:return[2,r.toArray()]}})})},a.prototype._topN_heap=function(t){return c(this,void 0,void 0,function(){var e,r,i,n,s;return l(this,function(o){switch(o.label){case 0:e=this.clone(),r=[],i=0,o.label=1;case 1:return i<t?(s=(n=r).push,[4,e.pop()]):[3,4];case 2:s.apply(n,[o.sent()]),o.label=3;case 3:return++i,[3,1];case 4:return[2,r]}})})},a.prototype._topIdxOf=function(t){return c(this,void 0,void 0,function(){var e,r,i,n;return l(this,function(s){switch(s.label){case 0:if(!t.length)return[2,-1];e=0,r=t[e],i=1,s.label=1;case 1:return i<t.length?[4,this.compare(t[i],r)]:[3,4];case 2:n=s.sent(),n<0&&(e=i,r=t[i]),s.label=3;case 3:return++i,[3,1];case 4:return[2,e]}})})},a.prototype._topOf=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return c(this,void 0,void 0,function(){var r;return l(this,function(i){switch(i.label){case 0:return r=new a(this.compare),[4,r.init(t)];case 1:return i.sent(),[2,r.peek()]}})})},a})();var L=function(a,t){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},r,i,n,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function o(h){return function(p){return u([h,p])}}function u(h){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,h[0]&&(e=0)),e;)try{if(r=1,i&&(n=h[0]&2?i.return:h[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,h[1])).done)return n;switch(i=0,n&&(h=[h[0]&2,n.value]),h[0]){case 0:case 1:n=h;break;case 4:return e.label++,{value:h[1],done:!1};case 5:e.label++,i=h[1],h=[0];continue;case 7:h=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(h[0]===6||h[0]===2)){e=0;continue}if(h[0]===3&&(!n||h[1]>n[0]&&h[1]<n[3])){e.label=h[1];break}if(h[0]===6&&e.label<n[1]){e.label=n[1],n=h;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(h);break}n[2]&&e.ops.pop(),e.trys.pop();continue}h=t.call(a,e)}catch(p){h=[6,p],i=0}finally{r=n=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}},y=function(a,t){var e=typeof Symbol=="function"&&a[Symbol.iterator];if(!e)return a;var r=e.call(a),i,n=[],s;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)n.push(i.value)}catch(o){s={error:o}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(s)throw s.error}}return n},v=function(a,t,e){if(e||arguments.length===2)for(var r=0,i=t.length,n;r<i;r++)(n||!(r in t))&&(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return a.concat(n||Array.prototype.slice.call(t))},B=function(){function a(t){t===void 0&&(t=a.minComparator);var e=this;this.compare=t,this.heapArray=[],this._limit=0,this.offer=this.add,this.element=this.peek,this.poll=this.pop,this.removeAll=this.clear,this._invertedCompare=function(r,i){return-1*e.compare(r,i)}}return a.getChildrenIndexOf=function(t){return[t*2+1,t*2+2]},a.getParentIndexOf=function(t){if(t<=0)return-1;var e=t%2?1:2;return Math.floor((t-e)/2)},a.getSiblingIndexOf=function(t){if(t<=0)return-1;var e=t%2?1:-1;return t+e},a.minComparator=function(t,e){return t>e?1:t<e?-1:0},a.maxComparator=function(t,e){return e>t?1:e<t?-1:0},a.minComparatorNumber=function(t,e){return t-e},a.maxComparatorNumber=function(t,e){return e-t},a.defaultIsEqual=function(t,e){return t===e},a.print=function(t){function e(p){var f=a.getParentIndexOf(p);return Math.floor(Math.log2(f+1))}function r(p,f){for(var g="";f>0;--f)g+=p;return g}for(var i=0,n=[],s=e(t.length-1)+2,o=0;i<t.length;){var u=e(i)+1;i===0&&(u=0);var h=String(t.get(i));h.length>o&&(o=h.length),n[u]=n[u]||[],n[u].push(h),i+=1}return n.map(function(p,f){var g=Math.pow(2,s-f)-1;return r(" ",Math.floor(g/2)*o)+p.map(function(w){var b=(o-w.length)/2;return r(" ",Math.ceil(b))+w+r(" ",Math.floor(b))}).join(r(" ",g*o))}).join(`
`)},a.heapify=function(t,e){var r=new a(e);return r.heapArray=t,r.init(),r},a.heappop=function(t,e){var r=new a(e);return r.heapArray=t,r.pop()},a.heappush=function(t,e,r){var i=new a(r);i.heapArray=t,i.push(e)},a.heappushpop=function(t,e,r){var i=new a(r);return i.heapArray=t,i.pushpop(e)},a.heapreplace=function(t,e,r){var i=new a(r);return i.heapArray=t,i.replace(e)},a.heaptop=function(t,e,r){e===void 0&&(e=1);var i=new a(r);return i.heapArray=t,i.top(e)},a.heapbottom=function(t,e,r){e===void 0&&(e=1);var i=new a(r);return i.heapArray=t,i.bottom(e)},a.nlargest=function(t,e,r){var i=new a(r);return i.heapArray=v([],y(e),!1),i.init(),i.top(t)},a.nsmallest=function(t,e,r){var i=new a(r);return i.heapArray=v([],y(e),!1),i.init(),i.bottom(t)},a.prototype.add=function(t){return this._sortNodeUp(this.heapArray.push(t)-1),this._applyLimit(),!0},a.prototype.addAll=function(t){var e,r=this.length;(e=this.heapArray).push.apply(e,v([],y(t),!1));for(var i=this.length;r<i;++r)this._sortNodeUp(r);return this._applyLimit(),!0},a.prototype.bottom=function(t){return t===void 0&&(t=1),this.heapArray.length===0||t<=0?[]:this.heapArray.length===1?[this.heapArray[0]]:t>=this.heapArray.length?v([],y(this.heapArray),!1):this._bottomN_push(~~t)},a.prototype.check=function(){var t=this;return this.heapArray.find(function(e,r){return!!t.getChildrenOf(r).find(function(i){return t.compare(e,i)>0})})},a.prototype.clear=function(){this.heapArray=[]},a.prototype.clone=function(){var t=new a(this.comparator());return t.heapArray=this.toArray(),t._limit=this._limit,t},a.prototype.comparator=function(){return this.compare},a.prototype.contains=function(t,e){return e===void 0&&(e=a.defaultIsEqual),this.indexOf(t,e)!==-1},a.prototype.init=function(t){t&&(this.heapArray=v([],y(t),!1));for(var e=Math.floor(this.heapArray.length);e>=0;--e)this._sortNodeDown(e);this._applyLimit()},a.prototype.isEmpty=function(){return this.length===0},a.prototype.indexOf=function(t,e){if(e===void 0&&(e=a.defaultIsEqual),this.heapArray.length===0)return-1;for(var r=[],i=0;i<this.heapArray.length;){var n=this.heapArray[i];if(e(n,t))return i;this.compare(n,t)<=0&&r.push.apply(r,v([],y(a.getChildrenIndexOf(i)),!1)),i=r.shift()||this.heapArray.length}return-1},a.prototype.indexOfEvery=function(t,e){if(e===void 0&&(e=a.defaultIsEqual),this.heapArray.length===0)return[];for(var r=[],i=[],n=0;n<this.heapArray.length;){var s=this.heapArray[n];e(s,t)?(i.push(n),r.push.apply(r,v([],y(a.getChildrenIndexOf(n)),!1))):this.compare(s,t)<=0&&r.push.apply(r,v([],y(a.getChildrenIndexOf(n)),!1)),n=r.shift()||this.heapArray.length}return i},a.prototype.leafs=function(){if(this.heapArray.length===0)return[];var t=a.getParentIndexOf(this.heapArray.length-1);return this.heapArray.slice(t+1)},Object.defineProperty(a.prototype,"length",{get:function(){return this.heapArray.length},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"limit",{get:function(){return this._limit},set:function(t){t<0||isNaN(t)?this._limit=0:this._limit=~~t,this._applyLimit()},enumerable:!1,configurable:!0}),a.prototype.setLimit=function(t){return this.limit=t,t<0||isNaN(t)?NaN:this._limit},a.prototype.peek=function(){return this.heapArray[0]},a.prototype.pop=function(){var t=this.heapArray.pop();return this.length>0&&t!==void 0?this.replace(t):t},a.prototype.push=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.length<1?!1:t.length===1?this.add(t[0]):this.addAll(t)},a.prototype.pushpop=function(t){var e;return this.compare(this.heapArray[0],t)<0&&(e=y([this.heapArray[0],t],2),t=e[0],this.heapArray[0]=e[1],this._sortNodeDown(0)),t},a.prototype.remove=function(t,e){var r=this;if(e===void 0&&(e=a.defaultIsEqual),!this.heapArray.length)return!1;if(t===void 0)return this.pop(),!0;for(var i=[0];i.length;){var n=i.shift();if(e(this.heapArray[n],t))return n===0?this.pop():n===this.heapArray.length-1?this.heapArray.pop():(this.heapArray.splice(n,1,this.heapArray.pop()),this._sortNodeUp(n),this._sortNodeDown(n)),!0;if(this.compare(this.heapArray[n],t)<=0){var s=a.getChildrenIndexOf(n).filter(function(o){return o<r.heapArray.length});i.push.apply(i,v([],y(s),!1))}}return!1},a.prototype.replace=function(t){var e=this.heapArray[0];return this.heapArray[0]=t,this._sortNodeDown(0),e},a.prototype.size=function(){return this.length},a.prototype.top=function(t){return t===void 0&&(t=1),this.heapArray.length===0||t<=0?[]:this.heapArray.length===1||t===1?[this.heapArray[0]]:t>=this.heapArray.length?v([],y(this.heapArray),!1):this._topN_push(~~t)},a.prototype.toArray=function(){return v([],y(this.heapArray),!1)},a.prototype.toString=function(){return this.heapArray.toString()},a.prototype.get=function(t){return this.heapArray[t]},a.prototype.getChildrenOf=function(t){var e=this;return a.getChildrenIndexOf(t).map(function(r){return e.heapArray[r]}).filter(function(r){return r!==void 0})},a.prototype.getParentOf=function(t){var e=a.getParentIndexOf(t);return this.heapArray[e]},a.prototype[Symbol.iterator]=function(){return L(this,function(t){switch(t.label){case 0:return this.length?[4,this.pop()]:[3,2];case 1:return t.sent(),[3,0];case 2:return[2]}})},a.prototype.iterator=function(){return this.toArray()},a.prototype._applyLimit=function(){if(this._limit>0&&this._limit<this.heapArray.length)for(var t=this.heapArray.length-this._limit;t;)this.heapArray.pop(),--t},a.prototype._bottomN_push=function(t){var e=new a(this.compare);e.limit=t,e.heapArray=this.heapArray.slice(-t),e.init();for(var r=this.heapArray.length-1-t,i=a.getParentIndexOf(r),n=[],s=r;s>i;--s)n.push(s);for(var o=this.heapArray;n.length;){var s=n.shift();this.compare(o[s],e.peek())>0&&(e.replace(o[s]),s%2&&n.push(a.getParentIndexOf(s)))}return e.toArray()},a.prototype._moveNode=function(t,e){var r;r=y([this.heapArray[e],this.heapArray[t]],2),this.heapArray[t]=r[0],this.heapArray[e]=r[1]},a.prototype._sortNodeDown=function(t){for(var e=this.heapArray.length;;){var r=2*t+1,i=r+1,n=t;if(r<e&&this.compare(this.heapArray[r],this.heapArray[n])<0&&(n=r),i<e&&this.compare(this.heapArray[i],this.heapArray[n])<0&&(n=i),n===t)break;this._moveNode(t,n),t=n}},a.prototype._sortNodeUp=function(t){for(;t>0;){var e=a.getParentIndexOf(t);if(this.compare(this.heapArray[t],this.heapArray[e])<0)this._moveNode(t,e),t=e;else break}},a.prototype._topN_push=function(t){var e=new a(this._invertedCompare);e.limit=t;for(var r=[0],i=this.heapArray;r.length;){var n=r.shift();n<i.length&&(e.length<t?(e.push(i[n]),r.push.apply(r,v([],y(a.getChildrenIndexOf(n)),!1))):this.compare(i[n],e.peek())<0&&(e.replace(i[n]),r.push.apply(r,v([],y(a.getChildrenIndexOf(n)),!1))))}return e.toArray()},a.prototype._topN_fill=function(t){var e=this.heapArray,r=new a(this._invertedCompare);r.limit=t,r.heapArray=e.slice(0,t),r.init();for(var i=a.getParentIndexOf(t-1)+1,n=[],s=i;s<t;++s)n.push.apply(n,v([],y(a.getChildrenIndexOf(s).filter(function(o){return o<e.length})),!1));for((t-1)%2&&n.push(t);n.length;){var s=n.shift();s<e.length&&this.compare(e[s],r.peek())<0&&(r.replace(e[s]),n.push.apply(n,v([],y(a.getChildrenIndexOf(s)),!1)))}return r.toArray()},a.prototype._topN_heap=function(t){for(var e=this.clone(),r=[],i=0;i<t;++i)r.push(e.pop());return r},a.prototype._topIdxOf=function(t){if(!t.length)return-1;for(var e=0,r=t[e],i=1;i<t.length;++i){var n=this.compare(t[i],r);n<0&&(e=i,r=t[i])}return e},a.prototype._topOf=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=new a(this.compare);return r.init(t),r.peek()},a}();class j{constructor(){d(this,"openSet",{});d(this,"closeSet",{});d(this,"openQueue",new B((t,e)=>this.openSet[t].cost-this.openSet[e].cost||this.openSet[e].gcost-this.openSet[t].gcost));d(this,"board",new O);d(this,"removeSet",new Set);d(this,"remoceCnt",0)}setFinishList(t,e=!0){this.board.setFinishtList(t,e)}init(t,e,r){this.clear(),this.board.setSize(t,e),r&&this.board.setList(r)}clear(){this.openSet={},this.closeSet={},this.openQueue.clear(),this.removeSet.clear(),this.remoceCnt=0}openDel(t){this.openQueue.remove(t),delete this.openSet[t]}openAdd(t,e){this.openSet[t]=e,this.openQueue.add(t)}haveState(t){return this.openSet[t]||this.closeSet[t]}*execStep(){for(;this.openQueue.size();){const t=this.openQueue.pop(),e=this.openSet[t];this.closeSet[t]=e,delete this.openSet[t],this.board.setList(e.list,!1);const r=this.board.getCanActoinDir(this.board.emptyIndex,e.beforeState?e.action:void 0);for(const i of r){const n=this.board.doAction(i,!1),s=n.join(","),o=this.board.updateManhattan(e.hcost,n,this.board.emptyIndex,i),u=new I(n,i,t,e.gcost+1,o,0),h=this.closeSet[s];let p=this.openSet[s];h||(p=this.openSet[s],p||(this.openAdd(s,u),e.childCnt+=1,yield s))}e.childCnt<=0&&this.removeSet.add(t)}}execInit(){this.openSet[this.board.listStr]=new I(this.board.list,C.d,"",0,this.board.getManhattan(),0),this.openQueue.add(this.board.listStr)}async exec(t){console.log("exec");const e=Date.now();let r=0,i=e,n=0;const s=[];let o=0,u;if(this.execInit(),this.board.listStr==this.board.finishStr)u=this.board.listStr;else for(const g of this.execStep()){if(g==this.board.finishStr){u=g;break}const w=Date.now();o+=1;const b=w-e;if(w-i>500){i=w;const S=`\u5DF2\u904D\u5386${o/1e6}M,\u8017\u65F6${(b/1e3).toFixed(3)}s,\u5343\u6B21\u8017\u65F6${(b*1e3/o).toFixed(3)}ms...`;console.log(S,this.removeSet.size),t&&t(S),await new Promise(N=>{setTimeout(N,0)})}n+=1,n>1e6&&(this.removeTest(),n=0)}if(!u)throw new Error("\u8FD8\u539F\u5931\u8D25");const h=this.getPath(u);r=Date.now();const p=r-e,f=this.openQueue.size()+Object.keys(this.closeSet).length+this.remoceCnt;return console.log(`Done:\u8FD8\u539F\u8DEF\u5F84${h.length}\u6B65,\u904D\u5386\u72B6\u6001${(f/10**6).toFixed(3)}M,\u6E05\u7406\u5185\u5B58${this.remoceCnt}\u6761,\u8017\u65F6${(p/1e3).toFixed(3)}s,\u5343\u6B21\u8017\u65F6${(p*1e3/f).toFixed(3)}ms`),console.log("tempStemp",s),h}getPath(t){const e=this.closeSet[t]||this.openSet[t],r=[];let i=e;for(;i.beforeState;)r.push(i),i=this.closeSet[i.beforeState];return r.reverse(),console.log("getPath",r),r.map(n=>n.action)}removeTest(){const t=Array.from(this.removeSet);for(let e=0;e<t.length;e++){const r=t[e],n=this.closeSet[r].beforeState;if(!n)continue;const s=this.closeSet[n];s.childCnt-=1,s.childCnt<=0&&(t.push(n),this.removeSet.add(n))}t.forEach(e=>{delete this.closeSet[e]}),console.log(`\u6E05\u7406\u5185\u5B58${t.length}\u6761\u6570\u636E`),this.remoceCnt+=t.length,this.removeSet.clear()}}export{C as A,j as B,O as N,M as a,k as b};
