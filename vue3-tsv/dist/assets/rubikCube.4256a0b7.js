var ot=Object.defineProperty;var at=(a,s,t)=>s in a?ot(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t;var c=(a,s,t)=>(at(a,typeof s!="symbol"?s+"":s,t),t);import{P as rt,W as ct,S as ht,C as tt,a as lt,A as ut,V as l,E as $,F as dt,Q as R,G as mt,b as et,O as st,c as pt,d as g,n as q,e as ft,M as J,s as gt,f as bt,g as wt,h as vt,D as _t,i as xt,R as At,r as K,j as Et,L as St}from"./rubikCube.ca13185d.js";import{_ as yt}from"./about.120ede73.js";import{d as Pt,eP as Dt,eQ as Mt,g as j,A as Lt,z as qt,n as Ot,c as Rt,a as O,$ as Ct,k as v,l as _,q as zt,v as It,r as A,eR as Ft,o as Ht,m as C,t as kt,u as Wt}from"./common.337cf465.js";const jt=()=>{const a=new rt(45,1,.1,100);return a.position.set(0,0,15),a},Tt=()=>new ct({antialias:!0}),Vt=a=>{const s=new ht;return s.background=new tt(a),s},Qt=()=>{const a=new lt(16777215);a.position.set(400,200,300);const s=new ut(8421504);return{pointLight:a,ambientLight:s}},Bt=(a,s)=>{const t=a.clone().dot(s);return Math.acos(t/(a.length()*s.length()))};function Nt(a){const s={[0]:new l(0,1,0),[1]:new l(0,-1,0),[2]:new l(-1,0,0),[3]:new l(1,0,0),[4]:new l(0,0,1),[5]:new l(0,0,-1)};if(s[a])return s[a];throw console.error(a),new Error("directionEnum2Vector3 error")}class Xt{constructor(s=3,t=["#fb3636","#ff9351","#fade70","#9de16f","#51acfa","#da6dfa"]){c(this,"cubeOrder");c(this,"colors");c(this,"elements",[]);c(this,"_orderSnFaceMaps",{});this.cubeOrder=s,this.colors=t,this.initElements()}initElements(s=!0){s&&localStorage&&(this.elements=this.getLocalData()),this.elements.length!==this.cubeOrder**3-(this.cubeOrder-2)**3&&(this.initialFinishData(),this.saveDataToLocal())}getOrderSnFaceMaps(s){if(this._orderSnFaceMaps&&this._orderSnFaceMaps[s])return this._orderSnFaceMaps[s];const t=[];for(let n=0;n<s;n++)for(let e=0;e<s;e++)for(let i=0;i<s;){const o=[];i==0&&o.push(2),n==0&&o.push(5),e==0&&o.push(1),e==s-1&&o.push(0),i==s-1&&o.push(3),n==s-1&&o.push(4),t.push(o),e!==0&&e!==this.cubeOrder-1&&n!==0&&n!==this.cubeOrder-1&&i==0?i+=this.cubeOrder-1:i+=1}return this._orderSnFaceMaps[s]=t,t}getFaces(s,t,n){return this.getOrderSnFaceMaps(t)[s].map(i=>({dir:Nt(i),color:n[Number(i)]}))}initialFinishData(){this.elements=[];const s=[];if(this.cubeOrder%2){const t=this.cubeOrder-1,n=(this.cubeOrder-1)/2,e=(this.cubeOrder-1)/2;s.push([n,e,t].join(","))}else{const t=this.cubeOrder-1,n=this.cubeOrder/2,e=this.cubeOrder/2;s.push([n,e,t].join(",")),s.push([n-1,e,t].join(",")),s.push([n,e-1,t].join(",")),s.push([n-1,e-1,t].join(","))}for(let t=0;t<this.cubeOrder;t++)for(let n=0;n<this.cubeOrder;n++)for(let e=0;e<this.cubeOrder;){const i=this.elements.length,o=s.includes([e,n,t].join(","));this.elements.push({sn:i,origin:new l(e,n,t),position:new l(e,n,t),rotation:new $(0,0,0),face:this.getFaces(i,this.cubeOrder,this.colors),withLogo:o}),n!==0&&n!==this.cubeOrder-1&&t!==0&&t!==this.cubeOrder-1&&e==0?e+=this.cubeOrder-1:e+=1}}saveDataToLocal(){const s=JSON.stringify(this.elements.map(t=>({sn:t.sn,origin:t.origin,position:t.position,rotation:t.rotation,withLogo:t.withLogo})));localStorage&&localStorage.setItem(`${this.cubeOrder}-xRubik`,s)}getLocalData(){try{if(localStorage){const s=localStorage.getItem(`${this.cubeOrder}-xRubik`);if(s)return JSON.parse(s).map(e=>({sn:e.sn,origin:new l(e.origin.x,e.origin.y,e.origin.z),position:new l(e.position.x,e.position.y,e.position.z),rotation:new $(e.rotation._x,e.rotation._y,e.rotation._z),face:this.getFaces(e.sn,this.cubeOrder,this.colors),withLogo:e.withLogo}))}}catch(s){console.error(s)}return[]}}class Yt{constructor(s){c(this,"_squares");c(this,"inRotation",!1);c(this,"rotateAnglePI",0);c(this,"activeSquares",[]);c(this,"controlSquare");c(this,"rotateDirection");c(this,"rotateAxisLocal");this._squares=s}setRotating(s,t,n,e){this.inRotation=!0,this.controlSquare=s,this.activeSquares=t,this.rotateDirection=n,this.rotateAxisLocal=e}resetState(){this.inRotation=!1,this.activeSquares=[],this.controlSquare=void 0,this.rotateDirection=void 0,this.rotateAxisLocal=void 0,this.rotateAnglePI=0}validateFinish(){let s=!0;const t={},n=this._squares.reduce((e,i)=>e.concat(i.children.filter(o=>o instanceof dt)),[]);return n.find(e=>{if(!e.face_)return;const i=e.face_,o=i.dir.toArray().join(",");if(!t[o]&&(t[o]={dir:i.dir,wdir:new l(0,0,1).applyQuaternion(e.getWorldQuaternion(new R).invert())},Object.keys(t).length>=6))return!0}),s=n.every(e=>{let i=!0;const r=e.face_.dir.toArray().join(",");return new l(0,0,1).applyQuaternion(e.getWorldQuaternion(new R).invert()).clone().sub(t[r].wdir).length()<.001?i=!0:i=!1,i}),s}}function Ut(a,{width:s=20,height:t=20,color:n="#fff",fontSize:e=18,align:i="center"}={}){const o=document.createElement("canvas");o.width=s,o.height=t;const r=o.getContext("2d");if(r){r.fillStyle=n,r.font=e+'px/1 " bold';let u=0;const h=r.measureText(a),f=e*.8;switch(i){case"left":u=0;break;case"center":u=(s-h.width)/2;break;case"right":u=s-h.width;break}r.fillText(a,u,f)}return o}function T(a,{width:s=.2,height:t=.2,color:n="#fff",fontSize:e=18,align:i="center"}={}){const o={width:s<20?20:s,height:t<20?20:t,color:n,fontSize:e,align:i},r=new bt(o.width,o.height),u=new wt({map:new vt(Ut(a,o)),side:_t}),h=new xt(r,u);return(s<20||t<20)&&h.scale.set(s/o.width,t/o.height,1),new st().add(h)}class Gt extends mt{constructor(t=3,n={}){super();c(this,"data");c(this,"state");c(this,"events");c(this,"haxes");c(this,"_size",1);this.data=new Xt(t),this.events=n,this.createChildrenByData(),this.rotateX(Math.PI*.25),this.rotateY(Math.PI*.25);const e=this.order*.8,i=this.getLabAxes(e);i.rotateX(Math.PI*.25),i.rotateY(Math.PI*.25),this.haxes=i}get squaresBg(){return"#eeeeee"}get squares(){return this.children}get order(){return this.data.cubeOrder}get squareSize(){return this._size}get finish(){return this.state.validateFinish()}getLabAxes(t){const n=new et(t),e=new st,i=T("x"),o=T("y"),r=T("z");return i.position.set(t,0,0),o.position.set(0,t,0),r.position.set(0,0,t),e.add(n),e.add(i),e.add(o),e.add(r),e}createChildrenByData(){this.remove(...this.children);for(let t=0;t<this.data.elements.length;t++){const n=pt(this.order,this.squareSize,this.data.elements[t],new tt(this.squaresBg));this.add(n)}this.state=new Yt(this.squares)}rotateOnePlane(t,n,e,i,o){var V;if(n.distanceTo(t)<5||!this.squares.includes(e.square))return;const r=n.clone().sub(t),u=e.square.getWorldQuaternion(new R),h=this.getWorldQuaternion(new R);function f(d){return d.applyQuaternion(h.clone().invert())}function m(d){return d.applyQuaternion(u.clone().invert())}function w(d){return d.applyQuaternion(u)}if(r.x===0&&r.y===0)return;if(!this.state.inRotation){let d=e.point.clone().sub(e.square.getWorldPosition(new l));m(d);let H=0,Q=0,B=0;const N=[0,0,0];d.toArray().forEach((p,b)=>{Math.abs(p)>Q&&(Q=Math.abs(p),H=b,B=p)}),N[H]=B>0?1:-1,d=new l(...N),d=w(d).normalize();const x=[];d.toArray().forEach((p,b)=>{if(b!==H){const G=[0,0,0];G[b]=1;const L=w(new l(...G)).normalize();let y=this.getSquareScreenVector(e.point,L,i,o);x.push({dir3:L,dir2:new g(y.x,y.y).normalize()}),y=this.getSquareScreenVector(e.point,L.clone().negate(),i,o),x.push({dir3:L.clone().negate(),dir2:new g(y.x,y.y).normalize()})}});const it=e.point.clone(),X=q(it.project(i),o.w,o.h);(V=ft)==null||V.afterDotDom(X.x+o.w/2,o.h/2-X.y);let Y=Math.PI*2,k=x[0];for(let p=0;p<x.length;p++){const b=Math.abs(x[p].dir2.angle()-r.angle());Y>b&&(Y=b,k=x[p])}const U=d.clone().cross(k.dir3).normalize(),W=[];W.push(e.square);for(let p=0;p<this.squares.length;p++)if(e.square!=this.squares[p]){const b=e.square.getWorldPosition(new l).sub(this.squares[p].getWorldPosition(new l));Math.abs(b.dot(U))<.05*this.squareSize&&W.push(this.squares[p])}this.state.setRotating(e.square,W,k,f(U))}const E=this.state.activeSquares,P=this.state.rotateAxisLocal;if(!this.state.rotateDirection)throw new Error("this.state.rotateDirection is empty");if(!P)throw new Error("rotateAxisLocal is empty");const S=Bt(this.state.rotateDirection.dir2,r),z=Math.cos(S)*r.length(),I=this.getCoarseCubeSize(i,o),D=z/I*Math.PI*.5,F=D-this.state.rotateAnglePI;this.state.rotateAnglePI=D;const M=new J;M.makeRotationAxis(P,F);for(let d=0;d<E.length;d++)E[d].applyMatrix4(M),E[d].updateMatrix()}getAfterRotateAnimation(){const t=this.getNeededRotateAngle(),n=Math.PI*.5/500;let e=0,i;return r=>{i||(i=r);const u=r-i;if(i=r,e<Math.abs(t)){let h=u*n;e+h>Math.abs(t)&&(h=Math.abs(t)-e),e+=h,h=t>0?h:-h;const f=new J;if(!this.state.rotateAxisLocal)throw new Error("this.state.rotateAxisLocal is empty");f.makeRotationAxis(this.state.rotateAxisLocal,h);for(let m=0;m<this.state.activeSquares.length;m++)this.state.activeSquares[m].applyMatrix4(f),this.state.activeSquares[m].updateMatrix();return!0}else return this.updateStateAfterRotate(),this.data.saveDataToLocal(),this.emitRotateDone(),!1}}updateStateAfterRotate(){const t=this.getNeededRotateAngle();this.state.rotateAnglePI+=t;const n=this.state.rotateAnglePI%(Math.PI*2);Math.abs(n)>.1&&this.state.activeSquares.forEach(e=>{const i=gt(this.order,this.squareSize,e.position.clone());e.element.position=i,e.element.rotation=e.rotation}),this.state.resetState()}getNeededRotateAngle(){const t=Math.PI*.5,n=Math.abs(this.state.rotateAnglePI)%t;let e=n>t*.2?t-n:-n;return e=this.state.rotateAnglePI>0?e:-e,e}getCoarseCubeSize(t,n){const e=this.order*this.squareSize,i=new l(-e/2,0,0),o=new l(e/2,0,0);i.project(t),o.project(t);const{w:r,h:u}=n,h=q(i,r,u),f=q(o,r,u);return Math.abs(f.x-h.x)}getSquareScreenPos(t,n,e){if(!this.squares.includes(t))return null;const i=t.getWorldPosition(new l);i.project(n);const{w:o,h:r}=e;return q(i,o,r)}getSquareScreenVector(t,n,e,i){const o=t.clone().project(e),r=n.clone().add(t).project(e),{w:u,h}=i;return r.sub(o),new g(r.x*u/2,-r.y*h/2)}restore(){this.data.initialFinishData(),this.data.saveDataToLocal(),this.createChildrenByData(),this.rotation.setFromVector3(new l(0,0,0)),this.rotateX(Math.PI*.25),this.rotateY(Math.PI*.25)}emitRotateDone(){this.events.rotateDone&&this.events.rotateDone({type:"rotateDone",finish:this.finish})}}class nt{constructor(s,t,n,e){c(this,"renderer");c(this,"scene");c(this,"cube");c(this,"camera");c(this,"_squareInfo",null);c(this,"start",!1);c(this,"lastOperateUnfinish",!1);c(this,"startPos",new g);c(this,"raycaster",new At);this.cube=e,this.renderer=n,this.scene=t,this.camera=s}get domElement(){return this.renderer.domElement}getIntersects(s,t){const n=s/this.domElement.clientWidth*2-1,e=-(t/this.domElement.clientHeight)*2+1;this.raycaster.setFromCamera({x:n,y:e},this.camera);const i=[];for(let o=0;o<this.cube.squares.length;o++){const r=this.raycaster.intersectObjects([this.cube.squares[o]]);r.length>0&&i.push({distance:r[0].distance,square:this.cube.squares[o],point:r[0].point})}return i.sort((o,r)=>o.distance-r.distance),i.length>0?i[0]:null}operateStart(s,t){if(this.start)return;this.start=!0,this.startPos=new g;const n=this.getIntersects(s,t);this._squareInfo=null,n&&(this._squareInfo=n,this.startPos=new g(s,t))}operateDrag(s,t,n,e){if(this.start&&this.lastOperateUnfinish===!1){if(this._squareInfo){const i=new g(s,t);this.cube.rotateOnePlane(this.startPos,i,this._squareInfo,this.camera,{w:this.domElement.clientWidth,h:this.domElement.clientHeight})}else{const i=n,o=-e,r=Math.sqrt(i*i+o*o),u=this.cube.getCoarseCubeSize(this.camera,{w:this.domElement.clientWidth,h:this.domElement.clientHeight}),h=Math.PI*r/u,m=new g(i,o).rotateAround(new g(0,0),Math.PI*.5);K(this.cube,new l(m.x,m.y,0),h),K(this.cube.haxes,new l(m.x,m.y,0),h)}this.renderer.render(this.scene,this.camera)}}operateEnd(){if(this.lastOperateUnfinish===!1){if(this._squareInfo){const s=this.cube.getAfterRotateAnimation();this.lastOperateUnfinish=!0;const t=n=>{const e=s(n);this.renderer.render(this.scene,this.camera),e?requestAnimationFrame(t):this.lastOperateUnfinish=!1};requestAnimationFrame(t)}this.start=!1,this._squareInfo=null}}}class $t extends nt{constructor(s,t,n,e){super(s,t,n,e),this.mousedownHandle=this.mousedownHandle.bind(this),this.mouseupHandle=this.mouseupHandle.bind(this),this.mousemoveHandle=this.mousemoveHandle.bind(this),this.mouseoutHandle=this.mouseoutHandle.bind(this),this.init()}mousedownHandle(s){s.preventDefault(),this.operateStart(s.offsetX,s.offsetY)}mouseupHandle(s){s.preventDefault(),console.log("mouseup"),this.operateEnd()}mouseoutHandle(s){s.preventDefault(),this.operateEnd()}mousemoveHandle(s){s.preventDefault(),this.operateDrag(s.offsetX,s.offsetY,s.movementX,s.movementY)}init(){this.domElement.addEventListener("mousedown",this.mousedownHandle),this.domElement.addEventListener("mouseup",this.mouseupHandle),this.domElement.addEventListener("mousemove",this.mousemoveHandle),this.domElement.addEventListener("mouseout",this.mouseoutHandle)}dispose(){this.domElement.removeEventListener("mousedown",this.mousedownHandle),this.domElement.removeEventListener("mouseup",this.mouseupHandle),this.domElement.removeEventListener("mousemove",this.mousemoveHandle),this.domElement.removeEventListener("mouseout",this.mouseoutHandle)}}class Jt extends nt{constructor(t,n,e,i){super(t,n,e,i);c(this,"lastPos");this.touchStart=this.touchStart.bind(this),this.touchMove=this.touchMove.bind(this),this.touchEnd=this.touchEnd.bind(this),this.init()}touchStart(t){t.preventDefault();const n=t.touches;if(n.length===1){const e=n[0];this.lastPos=new g(e.pageX,e.pageY),this.operateStart(e.pageX,e.pageY)}}touchMove(t){t.preventDefault();const n=t.touches;if(n.length===1&&this.lastPos){const e=n[0];this.operateDrag(e.pageX,e.pageY,e.pageX-this.lastPos.x,e.pageY-this.lastPos.y),this.lastPos=new g(e.pageX,e.pageY)}}touchEnd(t){t.preventDefault(),this.lastPos=void 0,this.operateEnd()}init(){this.domElement.addEventListener("touchstart",this.touchStart),this.domElement.addEventListener("touchmove",this.touchMove),this.domElement.addEventListener("touchend",this.touchEnd)}dispose(){this.domElement.removeEventListener("touchstart",this.touchStart),this.domElement.removeEventListener("touchmove",this.touchMove),this.domElement.removeEventListener("touchend",this.touchEnd)}}const Z=(a,s,t)=>{s.aspect=a.clientWidth/a.clientHeight,s.updateProjectionMatrix(),t.setSize(a.clientWidth,a.clientHeight),t.setPixelRatio(window.devicePixelRatio)};class Kt{constructor(s,t={}){c(this,"container");c(this,"camera");c(this,"scene");c(this,"cube");c(this,"renderer");c(this,"pointLight");c(this,"ambientLight");c(this,"_controls",[]);c(this,"events");this.container=s,this.camera=jt(),this.scene=Vt("#ccddcc"),this.renderer=Tt(),this.events=t,Et(this.renderer,this.scene,this.camera);const{pointLight:n,ambientLight:e}=Qt();this.pointLight=n,this.ambientLight=e,s.appendChild(this.renderer.domElement),Z(this.container,this.camera,this.renderer),this.setOrder(3),this.startAnimation()}addWorldAxes(){const s=new et(3),t=new St({vertexColors:!0,toneMapped:!1,color:16776960,linewidth:.6,dashSize:.05,gapSize:.05});s.material=t,s.computeLineDistances(),this.scene.add(s)}setOrder(s){this.scene.remove(...this.scene.children),this.scene.add(this.pointLight),this.scene.add(this.ambientLight),this._controls.length>0&&this._controls.forEach(r=>r.dispose()),this.addWorldAxes();const t=new Gt(s,this.events);this.scene.add(t),this.cube=t,this.render(),t.emitRotateDone();const n=this.renderer.domElement.clientWidth,e=this.renderer.domElement.clientHeight,i=t.getCoarseCubeSize(this.camera,{w:n,h:e}),o=Math.max(2.2/(n/i),2.2/(e/i));this.camera.position.z*=o,this._controls.push(new $t(this.camera,this.scene,this.renderer,t),new Jt(this.camera,this.scene,this.renderer,t)),this.render()}restore(){this.cube?(this.cube.restore(),this.render()):console.error("RESTORE_ERROR: this.cube is undefined.")}render(){this.renderer.render(this.scene,this.camera)}resize(){Z(this.container,this.camera,this.renderer),this.render()}startAnimation(){const s=t=>{if(t/=1e3,this.cube){t<2?this.cube.position.z=0:this.cube.position.z=0;const n=t;this.cube.position.y=Math.sin(n)*.1}this.render(),requestAnimationFrame(s)};requestAnimationFrame(s)}}const Zt=a=>(zt("data-v-54a33afa"),a=a(),It(),a),te={class:"component-rubik-cube flex-layout frow"},ee={class:"left flex-auto"},se=Zt(()=>O("div",{id:"point"},null,-1)),ne={class:"right flex-0"},ie=C(" \u63A7\u5236\u53F0 "),oe=C(" \u72B6\u6001\uFF1A "),ae=C("\u8FD8\u539F"),re=Pt({__name:"rubikCube",props:{},emits:[],setup(a,{emit:s}){Dt(),Mt();const t=j(null);Lt(()=>{});let n=null;const e=j({finish:!1}),i=j({order:3}),o=Array.from({length:10},(m,w)=>({value:w+3,label:w+3+"\u9636"}));function r(){n==null||n.setOrder(i.value.order)}qt(async()=>{await Ot(),t.value&&(n=new Kt(t.value,{rotateDone:u}))});function u(m){e.value.finish=m.finish}function h(){n&&n.resize()}function f(){n==null||n.restore()}return(m,w)=>{const E=A("a-typography-title"),P=A("a-tag"),S=A("a-form-item"),z=A("a-button"),I=A("a-select"),D=A("a-form"),F=Ft("resize");return Ht(),Rt("div",te,[O("div",ee,[Ct(O("div",{class:"three",ref_key:"threeRef",ref:t},null,512),[[F,h,"throttle"]]),se]),O("div",ne,[v(E,{level:3,class:"title"},{default:_(()=>[ie]),_:1}),v(D,null,{default:_(()=>[v(S,{class:"state"},{default:_(()=>[oe,v(P,{color:e.value.finish?"success":"default"},{default:_(()=>[C(kt(e.value.finish?"\u8FD8\u539F":"\u6253\u4E71"),1)]),_:1},8,["color"])]),_:1}),v(S,null,{default:_(()=>[v(z,{type:"primary",onClick:f,size:"mini"},{default:_(()=>[ae]),_:1})]),_:1}),v(S,{label:"\u9636\u6570"},{default:_(()=>[v(I,{value:i.value.order,"onUpdate:value":w[0]||(w[0]=M=>i.value.order=M),options:Wt(o),onChange:r},null,8,["value","options"])]),_:1})]),_:1})])])}}});var de=yt(re,[["__scopeId","data-v-54a33afa"]]);export{de as default};
