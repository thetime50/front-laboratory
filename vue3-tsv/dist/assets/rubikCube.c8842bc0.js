var oe=Object.defineProperty;var re=(r,s,e)=>s in r?oe(r,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[s]=e;var c=(r,s,e)=>(re(r,typeof s!="symbol"?s+"":s,e),e);import{g as ae,W as ce,h as he,C as ee,i as le,A as ue,V as l,E as J,Q as R,G as de,j as te,O as se,b as g,M as $,P as me,k as pe,l as fe,D as ge,d as be,R as we,m as ve}from"./shared/rubikCube/splineView.0d6a40c6.js";import{F as _e,c as xe,n as q,d as Ae,s as Ee,r as K,i as ye}from"./rubikCube.4f2e9009.js";import{_ as Se}from"./about.15042085.js";import{g as De,eR as Me,eS as Pe,q as j,G as Le,E as qe,n as Oe,c as Re,a as O,a4 as Ce,x as v,y as _,A as ze,B as Ie,r as A,eT as Fe,o as He,z as C,v as ke,u as We}from"./common.841047e3.js";import"./chartGraph.19ccca55.js";import"./shared/aStar/chartGraph.9f1ddb05.js";const je=()=>{const r=new ae(45,1,.1,100);return r.position.set(0,0,15),r},Te=()=>new ce({antialias:!0}),Ve=r=>{const s=new he;return s.background=new ee(r),s},Be=()=>{const r=new le(16777215);r.position.set(400,200,300);const s=new ue(8421504);return{pointLight:r,ambientLight:s}},Qe=(r,s)=>{const e=r.clone().dot(s);return Math.acos(e/(r.length()*s.length()))};function Ne(r){const s={[0]:new l(0,1,0),[1]:new l(0,-1,0),[2]:new l(-1,0,0),[3]:new l(1,0,0),[4]:new l(0,0,1),[5]:new l(0,0,-1)};if(s[r])return s[r];throw console.error(r),new Error("directionEnum2Vector3 error")}class Xe{constructor(s=3,e=["#fb3636","#ff9351","#fade70","#9de16f","#51acfa","#da6dfa"]){c(this,"cubeOrder");c(this,"colors");c(this,"elements",[]);c(this,"_orderSnFaceMaps",{});this.cubeOrder=s,this.colors=e,this.initElements()}initElements(s=!0){s&&localStorage&&(this.elements=this.getLocalData()),this.elements.length!==this.cubeOrder**3-(this.cubeOrder-2)**3&&(this.initialFinishData(),this.saveDataToLocal())}getOrderSnFaceMaps(s){if(this._orderSnFaceMaps&&this._orderSnFaceMaps[s])return this._orderSnFaceMaps[s];const e=[];for(let n=0;n<s;n++)for(let t=0;t<s;t++)for(let i=0;i<s;){const o=[];i==0&&o.push(2),n==0&&o.push(5),t==0&&o.push(1),t==s-1&&o.push(0),i==s-1&&o.push(3),n==s-1&&o.push(4),e.push(o),t!==0&&t!==this.cubeOrder-1&&n!==0&&n!==this.cubeOrder-1&&i==0?i+=this.cubeOrder-1:i+=1}return this._orderSnFaceMaps[s]=e,e}getFaces(s,e,n){return this.getOrderSnFaceMaps(e)[s].map(i=>({dir:Ne(i),color:n[Number(i)]}))}initialFinishData(){this.elements=[];const s=[];if(this.cubeOrder%2){const e=this.cubeOrder-1,n=(this.cubeOrder-1)/2,t=(this.cubeOrder-1)/2;s.push([n,t,e].join(","))}else{const e=this.cubeOrder-1,n=this.cubeOrder/2,t=this.cubeOrder/2;s.push([n,t,e].join(",")),s.push([n-1,t,e].join(",")),s.push([n,t-1,e].join(",")),s.push([n-1,t-1,e].join(","))}for(let e=0;e<this.cubeOrder;e++)for(let n=0;n<this.cubeOrder;n++)for(let t=0;t<this.cubeOrder;){const i=this.elements.length,o=s.includes([t,n,e].join(","));this.elements.push({sn:i,origin:new l(t,n,e),position:new l(t,n,e),rotation:new J(0,0,0),face:this.getFaces(i,this.cubeOrder,this.colors),withLogo:o}),n!==0&&n!==this.cubeOrder-1&&e!==0&&e!==this.cubeOrder-1&&t==0?t+=this.cubeOrder-1:t+=1}}saveDataToLocal(){const s=JSON.stringify(this.elements.map(e=>({sn:e.sn,origin:e.origin,position:e.position,rotation:e.rotation,withLogo:e.withLogo})));localStorage&&localStorage.setItem(`${this.cubeOrder}-xRubik`,s)}getLocalData(){try{if(localStorage){const s=localStorage.getItem(`${this.cubeOrder}-xRubik`);if(s)return JSON.parse(s).map(t=>({sn:t.sn,origin:new l(t.origin.x,t.origin.y,t.origin.z),position:new l(t.position.x,t.position.y,t.position.z),rotation:new J(t.rotation._x,t.rotation._y,t.rotation._z),face:this.getFaces(t.sn,this.cubeOrder,this.colors),withLogo:t.withLogo}))}}catch(s){console.error(s)}return[]}}class Ye{constructor(s){c(this,"_squares");c(this,"inRotation",!1);c(this,"rotateAnglePI",0);c(this,"activeSquares",[]);c(this,"controlSquare");c(this,"rotateDirection");c(this,"rotateAxisLocal");this._squares=s}setRotating(s,e,n,t){this.inRotation=!0,this.controlSquare=s,this.activeSquares=e,this.rotateDirection=n,this.rotateAxisLocal=t}resetState(){this.inRotation=!1,this.activeSquares=[],this.controlSquare=void 0,this.rotateDirection=void 0,this.rotateAxisLocal=void 0,this.rotateAnglePI=0}validateFinish(){let s=!0;const e={},n=this._squares.reduce((t,i)=>t.concat(i.children.filter(o=>o instanceof _e)),[]);return n.find(t=>{if(!t.face_)return;const i=t.face_,o=i.dir.toArray().join(",");if(!e[o]&&(e[o]={dir:i.dir,wdir:new l(0,0,1).applyQuaternion(t.getWorldQuaternion(new R).invert())},Object.keys(e).length>=6))return!0}),s=n.every(t=>{let i=!0;const a=t.face_.dir.toArray().join(",");return new l(0,0,1).applyQuaternion(t.getWorldQuaternion(new R).invert()).clone().sub(e[a].wdir).length()<.001?i=!0:i=!1,i}),s}}function Ue(r,{width:s=20,height:e=20,color:n="#fff",fontSize:t=18,align:i="center"}={}){const o=document.createElement("canvas");o.width=s,o.height=e;const a=o.getContext("2d");if(a){a.fillStyle=n,a.font=t+'px/1 " bold';let u=0;const h=a.measureText(r),f=t*.8;switch(i){case"left":u=0;break;case"center":u=(s-h.width)/2;break;case"right":u=s-h.width;break}a.fillText(r,u,f)}return o}function T(r,{width:s=.2,height:e=.2,color:n="#fff",fontSize:t=18,align:i="center"}={}){const o={width:s<20?20:s,height:e<20?20:e,color:n,fontSize:t,align:i},a=new me(o.width,o.height),u=new pe({map:new fe(Ue(r,o)),side:ge}),h=new be(a,u);return(s<20||e<20)&&h.scale.set(s/o.width,e/o.height,1),new se().add(h)}class Ge extends de{constructor(e=3,n={}){super();c(this,"data");c(this,"state");c(this,"events");c(this,"haxes");c(this,"_size",1);this.data=new Xe(e),this.events=n,this.createChildrenByData(),this.rotateX(Math.PI*.25),this.rotateY(Math.PI*.25);const t=this.order*.8,i=this.getLabAxes(t);i.rotateX(Math.PI*.25),i.rotateY(Math.PI*.25),this.haxes=i}get squaresBg(){return"#eeeeee"}get squares(){return this.children}get order(){return this.data.cubeOrder}get squareSize(){return this._size}get finish(){return this.state.validateFinish()}getLabAxes(e){const n=new te(e),t=new se,i=T("x"),o=T("y"),a=T("z");return i.position.set(e,0,0),o.position.set(0,e,0),a.position.set(0,0,e),t.add(n),t.add(i),t.add(o),t.add(a),t}createChildrenByData(){this.remove(...this.children);for(let e=0;e<this.data.elements.length;e++){const n=xe(this.order,this.squareSize,this.data.elements[e],new ee(this.squaresBg));this.add(n)}this.state=new Ye(this.squares)}rotateOnePlane(e,n,t,i,o){var V;if(n.distanceTo(e)<5||!this.squares.includes(t.square))return;const a=n.clone().sub(e),u=t.square.getWorldQuaternion(new R),h=this.getWorldQuaternion(new R);function f(d){return d.applyQuaternion(h.clone().invert())}function m(d){return d.applyQuaternion(u.clone().invert())}function w(d){return d.applyQuaternion(u)}if(a.x===0&&a.y===0)return;if(!this.state.inRotation){let d=t.point.clone().sub(t.square.getWorldPosition(new l));m(d);let H=0,B=0,Q=0;const N=[0,0,0];d.toArray().forEach((p,b)=>{Math.abs(p)>B&&(B=Math.abs(p),H=b,Q=p)}),N[H]=Q>0?1:-1,d=new l(...N),d=w(d).normalize();const x=[];d.toArray().forEach((p,b)=>{if(b!==H){const G=[0,0,0];G[b]=1;const L=w(new l(...G)).normalize();let S=this.getSquareScreenVector(t.point,L,i,o);x.push({dir3:L,dir2:new g(S.x,S.y).normalize()}),S=this.getSquareScreenVector(t.point,L.clone().negate(),i,o),x.push({dir3:L.clone().negate(),dir2:new g(S.x,S.y).normalize()})}});const ie=t.point.clone(),X=q(ie.project(i),o.w,o.h);(V=Ae)==null||V.afterDotDom(X.x+o.w/2,o.h/2-X.y);let Y=Math.PI*2,k=x[0];for(let p=0;p<x.length;p++){const b=Math.abs(x[p].dir2.angle()-a.angle());Y>b&&(Y=b,k=x[p])}const U=d.clone().cross(k.dir3).normalize(),W=[];W.push(t.square);for(let p=0;p<this.squares.length;p++)if(t.square!=this.squares[p]){const b=t.square.getWorldPosition(new l).sub(this.squares[p].getWorldPosition(new l));Math.abs(b.dot(U))<.05*this.squareSize&&W.push(this.squares[p])}this.state.setRotating(t.square,W,k,f(U))}const E=this.state.activeSquares,D=this.state.rotateAxisLocal;if(!this.state.rotateDirection)throw new Error("this.state.rotateDirection is empty");if(!D)throw new Error("rotateAxisLocal is empty");const y=Qe(this.state.rotateDirection.dir2,a),z=Math.cos(y)*a.length(),I=this.getCoarseCubeSize(i,o),M=z/I*Math.PI*.5,F=M-this.state.rotateAnglePI;this.state.rotateAnglePI=M;const P=new $;P.makeRotationAxis(D,F);for(let d=0;d<E.length;d++)E[d].applyMatrix4(P),E[d].updateMatrix()}getAfterRotateAnimation(){const e=this.getNeededRotateAngle(),n=Math.PI*.5/500;let t=0,i;return a=>{i||(i=a);const u=a-i;if(i=a,t<Math.abs(e)){let h=u*n;t+h>Math.abs(e)&&(h=Math.abs(e)-t),t+=h,h=e>0?h:-h;const f=new $;if(!this.state.rotateAxisLocal)throw new Error("this.state.rotateAxisLocal is empty");f.makeRotationAxis(this.state.rotateAxisLocal,h);for(let m=0;m<this.state.activeSquares.length;m++)this.state.activeSquares[m].applyMatrix4(f),this.state.activeSquares[m].updateMatrix();return!0}else return this.updateStateAfterRotate(),this.data.saveDataToLocal(),this.emitRotateDone(),!1}}updateStateAfterRotate(){const e=this.getNeededRotateAngle();this.state.rotateAnglePI+=e;const n=this.state.rotateAnglePI%(Math.PI*2);Math.abs(n)>.1&&this.state.activeSquares.forEach(t=>{const i=Ee(this.order,this.squareSize,t.position.clone());t.element.position=i,t.element.rotation=t.rotation}),this.state.resetState()}getNeededRotateAngle(){const e=Math.PI*.5,n=Math.abs(this.state.rotateAnglePI)%e;let t=n>e*.2?e-n:-n;return t=this.state.rotateAnglePI>0?t:-t,t}getCoarseCubeSize(e,n){const t=this.order*this.squareSize,i=new l(-t/2,0,0),o=new l(t/2,0,0);i.project(e),o.project(e);const{w:a,h:u}=n,h=q(i,a,u),f=q(o,a,u);return Math.abs(f.x-h.x)}getSquareScreenPos(e,n,t){if(!this.squares.includes(e))return null;const i=e.getWorldPosition(new l);i.project(n);const{w:o,h:a}=t;return q(i,o,a)}getSquareScreenVector(e,n,t,i){const o=e.clone().project(t),a=n.clone().add(e).project(t),{w:u,h}=i;return a.sub(o),new g(a.x*u/2,-a.y*h/2)}restore(){this.data.initialFinishData(),this.data.saveDataToLocal(),this.createChildrenByData(),this.rotation.setFromVector3(new l(0,0,0)),this.rotateX(Math.PI*.25),this.rotateY(Math.PI*.25)}emitRotateDone(){this.events.rotateDone&&this.events.rotateDone({type:"rotateDone",finish:this.finish})}}class ne{constructor(s,e,n,t){c(this,"renderer");c(this,"scene");c(this,"cube");c(this,"camera");c(this,"_squareInfo",null);c(this,"start",!1);c(this,"lastOperateUnfinish",!1);c(this,"startPos",new g);c(this,"raycaster",new we);this.cube=t,this.renderer=n,this.scene=e,this.camera=s}get domElement(){return this.renderer.domElement}getIntersects(s,e){const n=s/this.domElement.clientWidth*2-1,t=-(e/this.domElement.clientHeight)*2+1;this.raycaster.setFromCamera({x:n,y:t},this.camera);const i=[];for(let o=0;o<this.cube.squares.length;o++){const a=this.raycaster.intersectObjects([this.cube.squares[o]]);a.length>0&&i.push({distance:a[0].distance,square:this.cube.squares[o],point:a[0].point})}return i.sort((o,a)=>o.distance-a.distance),i.length>0?i[0]:null}operateStart(s,e){if(this.start)return;this.start=!0,this.startPos=new g;const n=this.getIntersects(s,e);this._squareInfo=null,n&&(this._squareInfo=n,this.startPos=new g(s,e))}operateDrag(s,e,n,t){if(this.start&&this.lastOperateUnfinish===!1){if(this._squareInfo){const i=new g(s,e);this.cube.rotateOnePlane(this.startPos,i,this._squareInfo,this.camera,{w:this.domElement.clientWidth,h:this.domElement.clientHeight})}else{const i=n,o=-t,a=Math.sqrt(i*i+o*o),u=this.cube.getCoarseCubeSize(this.camera,{w:this.domElement.clientWidth,h:this.domElement.clientHeight}),h=Math.PI*a/u,m=new g(i,o).rotateAround(new g(0,0),Math.PI*.5);K(this.cube,new l(m.x,m.y,0),h),K(this.cube.haxes,new l(m.x,m.y,0),h)}this.renderer.render(this.scene,this.camera)}}operateEnd(){if(this.lastOperateUnfinish===!1){if(this._squareInfo){const s=this.cube.getAfterRotateAnimation();this.lastOperateUnfinish=!0;const e=n=>{const t=s(n);this.renderer.render(this.scene,this.camera),t?requestAnimationFrame(e):this.lastOperateUnfinish=!1};requestAnimationFrame(e)}this.start=!1,this._squareInfo=null}}}class Je extends ne{constructor(s,e,n,t){super(s,e,n,t),this.mousedownHandle=this.mousedownHandle.bind(this),this.mouseupHandle=this.mouseupHandle.bind(this),this.mousemoveHandle=this.mousemoveHandle.bind(this),this.mouseoutHandle=this.mouseoutHandle.bind(this),this.init()}mousedownHandle(s){s.preventDefault(),this.operateStart(s.offsetX,s.offsetY)}mouseupHandle(s){s.preventDefault(),console.log("mouseup"),this.operateEnd()}mouseoutHandle(s){s.preventDefault(),this.operateEnd()}mousemoveHandle(s){s.preventDefault(),this.operateDrag(s.offsetX,s.offsetY,s.movementX,s.movementY)}init(){this.domElement.addEventListener("mousedown",this.mousedownHandle),this.domElement.addEventListener("mouseup",this.mouseupHandle),this.domElement.addEventListener("mousemove",this.mousemoveHandle),this.domElement.addEventListener("mouseout",this.mouseoutHandle)}dispose(){this.domElement.removeEventListener("mousedown",this.mousedownHandle),this.domElement.removeEventListener("mouseup",this.mouseupHandle),this.domElement.removeEventListener("mousemove",this.mousemoveHandle),this.domElement.removeEventListener("mouseout",this.mouseoutHandle)}}class $e extends ne{constructor(e,n,t,i){super(e,n,t,i);c(this,"lastPos");this.touchStart=this.touchStart.bind(this),this.touchMove=this.touchMove.bind(this),this.touchEnd=this.touchEnd.bind(this),this.init()}touchStart(e){e.preventDefault();const n=e.touches;if(n.length===1){const t=n[0];this.lastPos=new g(t.pageX,t.pageY),this.operateStart(t.pageX,t.pageY)}}touchMove(e){e.preventDefault();const n=e.touches;if(n.length===1&&this.lastPos){const t=n[0];this.operateDrag(t.pageX,t.pageY,t.pageX-this.lastPos.x,t.pageY-this.lastPos.y),this.lastPos=new g(t.pageX,t.pageY)}}touchEnd(e){e.preventDefault(),this.lastPos=void 0,this.operateEnd()}init(){this.domElement.addEventListener("touchstart",this.touchStart),this.domElement.addEventListener("touchmove",this.touchMove),this.domElement.addEventListener("touchend",this.touchEnd)}dispose(){this.domElement.removeEventListener("touchstart",this.touchStart),this.domElement.removeEventListener("touchmove",this.touchMove),this.domElement.removeEventListener("touchend",this.touchEnd)}}const Z=(r,s,e)=>{s.aspect=r.clientWidth/r.clientHeight,s.updateProjectionMatrix(),e.setSize(r.clientWidth,r.clientHeight),e.setPixelRatio(window.devicePixelRatio)};class Ke{constructor(s,e={}){c(this,"container");c(this,"camera");c(this,"scene");c(this,"cube");c(this,"renderer");c(this,"pointLight");c(this,"ambientLight");c(this,"_controls",[]);c(this,"events");this.container=s,this.camera=je(),this.scene=Ve("#ccddcc"),this.renderer=Te(),this.events=e,ye(this.renderer,this.scene,this.camera);const{pointLight:n,ambientLight:t}=Be();this.pointLight=n,this.ambientLight=t,s.appendChild(this.renderer.domElement),Z(this.container,this.camera,this.renderer),this.setOrder(3),this.startAnimation()}addWorldAxes(){const s=new te(3),e=new ve({vertexColors:!0,toneMapped:!1,color:16776960,linewidth:.6,dashSize:.05,gapSize:.05});s.material=e,s.computeLineDistances(),this.scene.add(s)}setOrder(s){this.scene.remove(...this.scene.children),this.scene.add(this.pointLight),this.scene.add(this.ambientLight),this._controls.length>0&&this._controls.forEach(a=>a.dispose()),this.addWorldAxes();const e=new Ge(s,this.events);this.scene.add(e),this.cube=e,this.render(),e.emitRotateDone();const n=this.renderer.domElement.clientWidth,t=this.renderer.domElement.clientHeight,i=e.getCoarseCubeSize(this.camera,{w:n,h:t}),o=Math.max(2.2/(n/i),2.2/(t/i));this.camera.position.z*=o,this._controls.push(new Je(this.camera,this.scene,this.renderer,e),new $e(this.camera,this.scene,this.renderer,e)),this.render()}restore(){this.cube?(this.cube.restore(),this.render()):console.error("RESTORE_ERROR: this.cube is undefined.")}render(){this.renderer.render(this.scene,this.camera)}resize(){Z(this.container,this.camera,this.renderer),this.render()}startAnimation(){const s=e=>{if(e/=1e3,this.cube){e<2?this.cube.position.z=0:this.cube.position.z=0;const n=e;this.cube.position.y=Math.sin(n)*.1}this.render(),requestAnimationFrame(s)};requestAnimationFrame(s)}}const Ze=r=>(ze("data-v-ae6acc1e"),r=r(),Ie(),r),et={class:"component-rubik-cube flex-layout frow"},tt={class:"left flex-auto"},st=Ze(()=>O("div",{id:"point"},null,-1)),nt={class:"right flex-0"},it=C(" \u63A7\u5236\u53F0 "),ot=C(" \u72B6\u6001\uFF1A "),rt=C("\u8FD8\u539F"),at=De({__name:"rubikCube",props:{},emits:[],setup(r,{emit:s}){Me(),Pe();const e=j(null);Le(()=>{});let n=null;const t=j({finish:!1}),i=j({order:3}),o=Array.from({length:10},(m,w)=>({value:w+3,label:w+3+"\u9636"}));function a(){n==null||n.setOrder(i.value.order)}qe(async()=>{await Oe(),e.value&&(n=new Ke(e.value,{rotateDone:u}))});function u(m){t.value.finish=m.finish}function h(){n&&n.resize()}function f(){n==null||n.restore()}return(m,w)=>{const E=A("a-typography-title"),D=A("a-tag"),y=A("a-form-item"),z=A("a-button"),I=A("a-select"),M=A("a-form"),F=Fe("resize");return He(),Re("div",et,[O("div",tt,[Ce(O("div",{class:"three",ref_key:"threeRef",ref:e},null,512),[[F,h,"throttle"]]),st]),O("div",nt,[v(E,{level:3,class:"title"},{default:_(()=>[it]),_:1}),v(M,null,{default:_(()=>[v(y,{class:"state"},{default:_(()=>[ot,v(D,{color:t.value.finish?"success":"default"},{default:_(()=>[C(ke(t.value.finish?"\u8FD8\u539F":"\u6253\u4E71"),1)]),_:1},8,["color"])]),_:1}),v(y,null,{default:_(()=>[v(z,{type:"primary",onClick:f,size:"mini"},{default:_(()=>[rt]),_:1})]),_:1}),v(y,{label:"\u9636\u6570"},{default:_(()=>[v(I,{value:i.value.order,"onUpdate:value":w[0]||(w[0]=P=>i.value.order=P),options:We(o),onChange:a},null,8,["value","options"])]),_:1})]),_:1})])])}}});var ft=Se(at,[["__scopeId","data-v-ae6acc1e"]]);export{ft as default};
