webpackJsonp([2],{"+G5l":function(t,e,i){"use strict";function n(t,e){var i=t.__state.conversionName.toString(),n=Math.round(t.r),r=Math.round(t.g),a=Math.round(t.b),s=t.a,o=Math.round(t.h),l=t.s.toFixed(1),h=t.v.toFixed(1);if(e||"THREE_CHAR_HEX"===i||"SIX_CHAR_HEX"===i){for(var c=t.hex.toString(16);c.length<6;)c="0"+c;return"#"+c}return"CSS_RGB"===i?"rgb("+n+","+r+","+a+")":"CSS_RGBA"===i?"rgba("+n+","+r+","+a+","+s+")":"HEX"===i?"0x"+t.hex.toString(16):"RGB_ARRAY"===i?"["+n+","+r+","+a+"]":"RGBA_ARRAY"===i?"["+n+","+r+","+a+","+s+"]":"RGB_OBJ"===i?"{r:"+n+",g:"+r+",b:"+a+"}":"RGBA_OBJ"===i?"{r:"+n+",g:"+r+",b:"+a+",a:"+s+"}":"HSV_OBJ"===i?"{h:"+o+",s:"+l+",v:"+h+"}":"HSVA_OBJ"===i?"{h:"+o+",s:"+l+",v:"+h+",a:"+s+"}":"unknown format"}Object.defineProperty(e,"__esModule",{value:!0}),i.d(e,"color",function(){return lt}),i.d(e,"controllers",function(){return ht}),i.d(e,"dom",function(){return ct}),i.d(e,"gui",function(){return ut}),i.d(e,"GUI",function(){return dt});var r=Array.prototype.forEach,a=Array.prototype.slice,s={BREAK:{},extend:function(t){return this.each(a.call(arguments,1),function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(i){this.isUndefined(e[i])||(t[i]=e[i])}.bind(this))},this),t},defaults:function(t){return this.each(a.call(arguments,1),function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(i){this.isUndefined(t[i])&&(t[i]=e[i])}.bind(this))},this),t},compose:function(){var t=a.call(arguments);return function(){for(var e=a.call(arguments),i=t.length-1;i>=0;i--)e=[t[i].apply(this,e)];return e[0]}},each:function(t,e,i){if(t)if(r&&t.forEach&&t.forEach===r)t.forEach(e,i);else if(t.length===t.length+0){var n,a=void 0;for(a=0,n=t.length;a<n;a++)if(a in t&&e.call(i,t[a],a)===this.BREAK)return}else for(var s in t)if(e.call(i,t[s],s)===this.BREAK)return},defer:function(t){setTimeout(t,0)},debounce:function(t,e,i){var n=void 0;return function(){var r=this,a=arguments;var s=i||!n;clearTimeout(n),n=setTimeout(function(){n=null,i||t.apply(r,a)},e),s&&t.apply(r,a)}},toArray:function(t){return t.toArray?t.toArray():a.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){return isNaN(t)}),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return!1===t||!0===t},isFunction:function(t){return t instanceof Function}},o=[{litmus:s.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:n},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:n},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:n},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:n}}},{litmus:s.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:s.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:s.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(s.isNumber(t.r)&&s.isNumber(t.g)&&s.isNumber(t.b)&&s.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(s.isNumber(t.r)&&s.isNumber(t.g)&&s.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(s.isNumber(t.h)&&s.isNumber(t.s)&&s.isNumber(t.v)&&s.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(s.isNumber(t.h)&&s.isNumber(t.s)&&s.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],l=void 0,h=void 0,c=function(){h=!1;var t=arguments.length>1?s.toArray(arguments):arguments[0];return s.each(o,function(e){if(e.litmus(t))return s.each(e.conversions,function(e,i){if(l=e.read(t),!1===h&&!1!==l)return h=l,l.conversionName=i,l.conversion=e,s.BREAK}),s.BREAK}),h},u=void 0,d={hsv_to_rgb:function(t,e,i){var n=Math.floor(t/60)%6,r=t/60-Math.floor(t/60),a=i*(1-e),s=i*(1-r*e),o=i*(1-(1-r)*e),l=[[i,o,a],[s,i,a],[a,i,o],[a,s,i],[o,a,i],[i,a,s]][n];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(t,e,i){var n=Math.min(t,e,i),r=Math.max(t,e,i),a=r-n,s=void 0;return 0===r?{h:NaN,s:0,v:0}:(s=t===r?(e-i)/a:e===r?2+(i-t)/a:4+(t-e)/a,(s/=6)<0&&(s+=1),{h:360*s,s:a/r,v:r/255})},rgb_to_hex:function(t,e,i){var n=this.hex_with_component(0,2,t);return n=this.hex_with_component(n,1,e),n=this.hex_with_component(n,0,i)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(t,e,i){return i<<(u=8*e)|t&~(255<<u)}},f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},m=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),g=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,i,n)}if("value"in r)return r.value;var s=r.get;return void 0!==s?s.call(n):void 0},v=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},_=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},y=function(){function t(){if(p(this,t),this.__state=c.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return m(t,[{key:"toString",value:function(){return n(this)}},{key:"toHexString",value:function(){return n(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function b(t,e,i){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space?this.__state[e]:(y.recalculateRGB(this,e,i),this.__state[e])},set:function(t){"RGB"!==this.__state.space&&(y.recalculateRGB(this,e,i),this.__state.space="RGB"),this.__state[e]=t}})}function x(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space?this.__state[e]:(y.recalculateHSV(this),this.__state[e])},set:function(t){"HSV"!==this.__state.space&&(y.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}y.recalculateRGB=function(t,e,i){if("HEX"===t.__state.space)t.__state[e]=d.component_from_hex(t.__state.hex,i);else{if("HSV"!==t.__state.space)throw new Error("Corrupted color state");s.extend(t.__state,d.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}},y.recalculateHSV=function(t){var e=d.rgb_to_hsv(t.r,t.g,t.b);s.extend(t.__state,{s:e.s,v:e.v}),s.isNaN(e.h)?s.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},y.COMPONENTS=["r","g","b","h","s","v","hex","a"],b(y.prototype,"r",2),b(y.prototype,"g",1),b(y.prototype,"b",0),x(y.prototype,"h"),x(y.prototype,"s"),x(y.prototype,"v"),Object.defineProperty(y.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(y.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=d.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var w=function(){function t(e,i){p(this,t),this.initialValue=e[i],this.domElement=document.createElement("div"),this.object=e,this.property=i,this.__onChange=void 0,this.__onFinishChange=void 0}return m(t,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t}(),E={};s.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(t,e){s.each(t,function(t){E[t]=e})});var S=/(\d+(\.\d+)?)px/;function T(t){if("0"===t||s.isUndefined(t))return 0;var e=t.match(S);return s.isNull(e)?0:parseFloat(e[1])}var M={makeSelectable:function(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,i){var n=i,r=e;s.isUndefined(r)&&(r=!0),s.isUndefined(n)&&(n=!0),t.style.position="absolute",r&&(t.style.left=0,t.style.right=0),n&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,i,n){var r=i||{},a=E[e];if(!a)throw new Error("Event type "+e+" not supported.");var o=document.createEvent(a);switch(a){case"MouseEvents":var l=r.x||r.clientX||0,h=r.y||r.clientY||0;o.initMouseEvent(e,r.bubbles||!1,r.cancelable||!0,window,r.clickCount||1,0,0,l,h,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=o.initKeyboardEvent||o.initKeyEvent;s.defaults(r,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(e,r.bubbles||!1,r.cancelable,window,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.keyCode,r.charCode);break;default:o.initEvent(e,r.bubbles||!1,r.cancelable||!0)}s.defaults(o,n),t.dispatchEvent(o)},bind:function(t,e,i,n){var r=n||!1;return t.addEventListener?t.addEventListener(e,i,r):t.attachEvent&&t.attachEvent("on"+e,i),M},unbind:function(t,e,i,n){var r=n||!1;return t.removeEventListener?t.removeEventListener(e,i,r):t.detachEvent&&t.detachEvent("on"+e,i),M},addClass:function(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var i=t.className.split(/ +/);-1===i.indexOf(e)&&(i.push(e),t.className=i.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return M},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var i=t.className.split(/ +/),n=i.indexOf(e);-1!==n&&(i.splice(n,1),t.className=i.join(" "))}else t.className=void 0;return M},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return T(e["border-left-width"])+T(e["border-right-width"])+T(e["padding-left"])+T(e["padding-right"])+T(e.width)},getHeight:function(t){var e=getComputedStyle(t);return T(e["border-top-width"])+T(e["border-bottom-width"])+T(e["padding-top"])+T(e["padding-bottom"])+T(e.height)},getOffset:function(t){var e=t,i={left:0,top:0};if(e.offsetParent)do{i.left+=e.offsetLeft,i.top+=e.offsetTop,e=e.offsetParent}while(e);return i},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},A=function(t){function e(t,i){p(this,e);var n=_(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),r=n;return n.__prev=n.getValue(),n.__checkbox=document.createElement("input"),n.__checkbox.setAttribute("type","checkbox"),M.bind(n.__checkbox,"change",function(){r.setValue(!r.__prev)},!1),n.domElement.appendChild(n.__checkbox),n.updateDisplay(),n}return v(e,w),m(e,[{key:"setValue",value:function(t){var i=g(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),i}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),g(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),I=function(t){function e(t,i,n){p(this,e);var r=_(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),a=n,o=r;if(r.__select=document.createElement("select"),s.isArray(a)){var l={};s.each(a,function(t){l[t]=t}),a=l}return s.each(a,function(t,e){var i=document.createElement("option");i.innerHTML=e,i.setAttribute("value",t),o.__select.appendChild(i)}),r.updateDisplay(),M.bind(r.__select,"change",function(){var t=this.options[this.selectedIndex].value;o.setValue(t)}),r.domElement.appendChild(r.__select),r}return v(e,w),m(e,[{key:"setValue",value:function(t){var i=g(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),i}},{key:"updateDisplay",value:function(){return M.isActive(this.__select)?this:(this.__select.value=this.getValue(),g(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(),C=function(t){function e(t,i){p(this,e);var n=_(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),r=n;function a(){r.setValue(r.__input.value)}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),M.bind(n.__input,"keyup",a),M.bind(n.__input,"change",a),M.bind(n.__input,"blur",function(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}),M.bind(n.__input,"keydown",function(t){13===t.keyCode&&this.blur()}),n.updateDisplay(),n.domElement.appendChild(n.__input),n}return v(e,w),m(e,[{key:"updateDisplay",value:function(){return M.isActive(this.__input)||(this.__input.value=this.getValue()),g(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}();function P(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var R=function(t){function e(t,i,n){p(this,e);var r=_(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),a=n||{};return r.__min=a.min,r.__max=a.max,r.__step=a.step,s.isUndefined(r.__step)?0===r.initialValue?r.__impliedStep=1:r.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(r.initialValue))/Math.LN10))/10:r.__impliedStep=r.__step,r.__precision=P(r.__impliedStep),r}return v(e,w),m(e,[{key:"setValue",value:function(t){var i=t;return void 0!==this.__min&&i<this.__min?i=this.__min:void 0!==this.__max&&i>this.__max&&(i=this.__max),void 0!==this.__step&&i%this.__step!=0&&(i=Math.round(i/this.__step)*this.__step),g(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,i)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=P(t),this}}]),e}();var L=function(t){function e(t,i,n){p(this,e);var r=_(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n));r.__truncationSuspended=!1;var a=r,o=void 0;function l(){a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function h(t){var e=o-t.clientY;a.setValue(a.getValue()+e*a.__impliedStep),o=t.clientY}function c(){M.unbind(window,"mousemove",h),M.unbind(window,"mouseup",c),l()}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),M.bind(r.__input,"change",function(){var t=parseFloat(a.__input.value);s.isNaN(t)||a.setValue(t)}),M.bind(r.__input,"blur",function(){l()}),M.bind(r.__input,"mousedown",function(t){M.bind(window,"mousemove",h),M.bind(window,"mouseup",c),o=t.clientY}),M.bind(r.__input,"keydown",function(t){13===t.keyCode&&(a.__truncationSuspended=!0,this.blur(),a.__truncationSuspended=!1,l())}),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return v(e,R),m(e,[{key:"updateDisplay",value:function(){var t,i,n;return this.__input.value=this.__truncationSuspended?this.getValue():(t=this.getValue(),i=this.__precision,n=Math.pow(10,i),Math.round(t*n)/n),g(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}();function D(t,e,i,n,r){return n+(t-e)/(i-e)*(r-n)}var k=function(t){function e(t,i,n,r,a){p(this,e);var s=_(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,{min:n,max:r,step:a})),o=s;function l(t){t.preventDefault();var e=o.__background.getBoundingClientRect();return o.setValue(D(t.clientX,e.left,e.right,o.__min,o.__max)),!1}function h(){M.unbind(window,"mousemove",l),M.unbind(window,"mouseup",h),o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function c(t){var e=t.touches[0].clientX,i=o.__background.getBoundingClientRect();o.setValue(D(e,i.left,i.right,o.__min,o.__max))}function u(){M.unbind(window,"touchmove",c),M.unbind(window,"touchend",u),o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}return s.__background=document.createElement("div"),s.__foreground=document.createElement("div"),M.bind(s.__background,"mousedown",function(t){document.activeElement.blur(),M.bind(window,"mousemove",l),M.bind(window,"mouseup",h),l(t)}),M.bind(s.__background,"touchstart",function(t){if(1!==t.touches.length)return;M.bind(window,"touchmove",c),M.bind(window,"touchend",u),c(t)}),M.addClass(s.__background,"slider"),M.addClass(s.__foreground,"slider-fg"),s.updateDisplay(),s.__background.appendChild(s.__foreground),s.domElement.appendChild(s.__background),s}return v(e,R),m(e,[{key:"updateDisplay",value:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",g(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),O=function(t){function e(t,i,n){p(this,e);var r=_(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),a=r;return r.__button=document.createElement("div"),r.__button.innerHTML=void 0===n?"Fire":n,M.bind(r.__button,"click",function(t){return t.preventDefault(),a.fire(),!1}),M.addClass(r.__button,"button"),r.domElement.appendChild(r.__button),r}return v(e,w),m(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(),N=function(t){function e(t,i){p(this,e);var n=_(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));n.__color=new y(n.getValue()),n.__temp=new y(0);var r=n;n.domElement=document.createElement("div"),M.makeSelectable(n.domElement,!1),n.__selector=document.createElement("div"),n.__selector.className="selector",n.__saturation_field=document.createElement("div"),n.__saturation_field.className="saturation-field",n.__field_knob=document.createElement("div"),n.__field_knob.className="field-knob",n.__field_knob_border="2px solid ",n.__hue_knob=document.createElement("div"),n.__hue_knob.className="hue-knob",n.__hue_field=document.createElement("div"),n.__hue_field.className="hue-field",n.__input=document.createElement("input"),n.__input.type="text",n.__input_textShadow="0 1px 1px ",M.bind(n.__input,"keydown",function(t){13===t.keyCode&&f.call(this)}),M.bind(n.__input,"blur",f),M.bind(n.__selector,"mousedown",function(){M.addClass(this,"drag").bind(window,"mouseup",function(){M.removeClass(r.__selector,"drag")})}),M.bind(n.__selector,"touchstart",function(){M.addClass(this,"drag").bind(window,"touchend",function(){M.removeClass(r.__selector,"drag")})});var a,o=document.createElement("div");function l(t){g(t),M.bind(window,"mousemove",g),M.bind(window,"touchmove",g),M.bind(window,"mouseup",u),M.bind(window,"touchend",u)}function h(t){v(t),M.bind(window,"mousemove",v),M.bind(window,"touchmove",v),M.bind(window,"mouseup",d),M.bind(window,"touchend",d)}function u(){M.unbind(window,"mousemove",g),M.unbind(window,"touchmove",g),M.unbind(window,"mouseup",u),M.unbind(window,"touchend",u),m()}function d(){M.unbind(window,"mousemove",v),M.unbind(window,"touchmove",v),M.unbind(window,"mouseup",d),M.unbind(window,"touchend",d),m()}function f(){var t=c(this.value);!1!==t?(r.__color.__state=t,r.setValue(r.__color.toOriginal())):this.value=r.__color.toString()}function m(){r.__onFinishChange&&r.__onFinishChange.call(r,r.__color.toOriginal())}function g(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=r.__saturation_field.getBoundingClientRect(),i=t.touches&&t.touches[0]||t,n=i.clientX,a=i.clientY,s=(n-e.left)/(e.right-e.left),o=1-(a-e.top)/(e.bottom-e.top);return o>1?o=1:o<0&&(o=0),s>1?s=1:s<0&&(s=0),r.__color.v=o,r.__color.s=s,r.setValue(r.__color.toOriginal()),!1}function v(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=r.__hue_field.getBoundingClientRect(),i=1-((t.touches&&t.touches[0]||t).clientY-e.top)/(e.bottom-e.top);return i>1?i=1:i<0&&(i=0),r.__color.h=360*i,r.setValue(r.__color.toOriginal()),!1}return s.extend(n.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),s.extend(n.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:n.__field_knob_border+(n.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),s.extend(n.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),s.extend(n.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),s.extend(o.style,{width:"100%",height:"100%",background:"none"}),F(o,"top","rgba(0,0,0,0)","#000"),s.extend(n.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(a=n.__hue_field).style.background="",a.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",a.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",s.extend(n.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:n.__input_textShadow+"rgba(0,0,0,0.7)"}),M.bind(n.__saturation_field,"mousedown",l),M.bind(n.__saturation_field,"touchstart",l),M.bind(n.__field_knob,"mousedown",l),M.bind(n.__field_knob,"touchstart",l),M.bind(n.__hue_field,"mousedown",h),M.bind(n.__hue_field,"touchstart",h),n.__saturation_field.appendChild(o),n.__selector.appendChild(n.__field_knob),n.__selector.appendChild(n.__saturation_field),n.__selector.appendChild(n.__hue_field),n.__hue_field.appendChild(n.__hue_knob),n.domElement.appendChild(n.__input),n.domElement.appendChild(n.__selector),n.updateDisplay(),n}return v(e,w),m(e,[{key:"updateDisplay",value:function(){var t=c(this.getValue());if(!1!==t){var e=!1;s.each(y.COMPONENTS,function(i){if(!s.isUndefined(t[i])&&!s.isUndefined(this.__color.__state[i])&&t[i]!==this.__color.__state[i])return e=!0,{}},this),e&&s.extend(this.__color.__state,t)}s.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var i=this.__color.v<.5||this.__color.s>.5?255:0,n=255-i;s.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+i+","+i+","+i+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,F(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),s.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+i+","+i+","+i+")",textShadow:this.__input_textShadow+"rgba("+n+","+n+","+n+",.7)"})}}]),e}(),U=["-moz-","-o-","-webkit-","-ms-",""];function F(t,e,i,n){t.style.background="",s.each(U,function(r){t.style.cssText+="background: "+r+"linear-gradient("+e+", "+i+" 0%, "+n+" 100%); "})}var B=function(t,e){var i=e||document,n=document.createElement("style");n.type="text/css",n.innerHTML=t;var r=i.getElementsByTagName("head")[0];try{r.appendChild(n)}catch(t){}},z=function(t,e){var i=t[e];return s.isArray(arguments[2])||s.isObject(arguments[2])?new I(t,e,arguments[2]):s.isNumber(i)?s.isNumber(arguments[2])&&s.isNumber(arguments[3])?s.isNumber(arguments[4])?new k(t,e,arguments[2],arguments[3],arguments[4]):new k(t,e,arguments[2],arguments[3]):s.isNumber(arguments[4])?new L(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new L(t,e,{min:arguments[2],max:arguments[3]}):s.isString(i)?new C(t,e):s.isFunction(i)?new O(t,e,""):s.isBoolean(i)?new A(t,e):null};var H=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},G=function(){function t(){p(this,t),this.backgroundElement=document.createElement("div"),s.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),M.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),s.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;M.bind(this.backgroundElement,"click",function(){e.hide()})}return m(t,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),s.defer(function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",M.unbind(t.domElement,"webkitTransitionEnd",e),M.unbind(t.domElement,"transitionend",e),M.unbind(t.domElement,"oTransitionEnd",e)};M.bind(this.domElement,"webkitTransitionEnd",e),M.bind(this.domElement,"transitionend",e),M.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-M.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-M.getHeight(this.domElement)/2+"px"}}]),t}();B(function(t){if(t&&"undefined"!=typeof window){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var j="Default",V=function(){try{return!!window.localStorage}catch(t){return!1}}(),W=void 0,q=!0,X=void 0,Y=!1,Z=[],J=function t(e){var i=this,n=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),M.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],n=s.defaults(n,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),n=s.defaults(n,{resizable:n.autoPlace,hideable:n.autoPlace}),s.isUndefined(n.load)?n.load={preset:j}:n.preset&&(n.load.preset=n.preset),s.isUndefined(n.parent)&&n.hideable&&Z.push(this),n.resizable=s.isUndefined(n.parent)&&n.resizable,n.autoPlace&&s.isUndefined(n.scrollable)&&(n.scrollable=!0);var r,a=V&&"true"===localStorage.getItem(it(this,"isLocal")),o=void 0,l=void 0;if(Object.defineProperties(this,{parent:{get:function(){return n.parent}},scrollable:{get:function(){return n.scrollable}},autoPlace:{get:function(){return n.autoPlace}},closeOnTop:{get:function(){return n.closeOnTop}},preset:{get:function(){return i.parent?i.getRoot().preset:n.load.preset},set:function(t){i.parent?i.getRoot().preset=t:n.load.preset=t,function(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}(this),i.revert()}},width:{get:function(){return n.width},set:function(t){n.width=t,st(i,t)}},name:{get:function(){return n.name},set:function(t){n.name=t,l&&(l.innerHTML=n.name)}},closed:{get:function(){return n.closed},set:function(e){n.closed=e,n.closed?M.addClass(i.__ul,t.CLASS_CLOSED):M.removeClass(i.__ul,t.CLASS_CLOSED),this.onResize(),i.__closeButton&&(i.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return n.load}},useLocalStorage:{get:function(){return a},set:function(t){V&&(a=t,t?M.bind(window,"unload",o):M.unbind(window,"unload",o),localStorage.setItem(it(i,"isLocal"),t))}}}),s.isUndefined(n.parent)){if(this.closed=n.closed||!1,M.addClass(this.domElement,t.CLASS_MAIN),M.makeSelectable(this.domElement,!1),V&&a){i.useLocalStorage=!0;var h=localStorage.getItem(it(this,"gui"));h&&(n.load=JSON.parse(h))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,M.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),n.closeOnTop?(M.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(M.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),M.bind(this.__closeButton,"click",function(){i.closed=!i.closed})}else{void 0===n.closed&&(n.closed=!0);var c=document.createTextNode(n.name);M.addClass(c,"controller-name"),l=K(i,c);M.addClass(this.__ul,t.CLASS_CLOSED),M.addClass(l,"title"),M.bind(l,"click",function(t){return t.preventDefault(),i.closed=!i.closed,!1}),n.closed||(this.closed=!1)}n.autoPlace&&(s.isUndefined(n.parent)&&(q&&(X=document.createElement("div"),M.addClass(X,"dg"),M.addClass(X,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(X),q=!1),X.appendChild(this.domElement),M.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||st(i,n.width)),this.__resizeHandler=function(){i.onResizeDebounced()},M.bind(window,"resize",this.__resizeHandler),M.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),M.bind(this.__ul,"transitionend",this.__resizeHandler),M.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),n.resizable&&at(this),o=function(){V&&"true"===localStorage.getItem(it(i,"isLocal"))&&localStorage.setItem(it(i,"gui"),JSON.stringify(i.getSaveObject()))},this.saveToLocalStorageIfPossible=o,n.parent||((r=i.getRoot()).width+=1,s.defer(function(){r.width-=1}))};function K(t,e,i){var n=document.createElement("li");return e&&n.appendChild(e),i?t.__ul.insertBefore(n,i):t.__ul.appendChild(n),t.onResize(),n}function Q(t){M.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&M.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function $(t,e){var i=t.__preset_select[t.__preset_select.selectedIndex];i.innerHTML=e?i.value+"*":i.value}function tt(t,e){var i=t.getRoot(),n=i.__rememberedObjects.indexOf(e.object);if(-1!==n){var r=i.__rememberedObjectIndecesToControllers[n];if(void 0===r&&(r={},i.__rememberedObjectIndecesToControllers[n]=r),r[e.property]=e,i.load&&i.load.remembered){var a=i.load.remembered,s=void 0;if(a[t.preset])s=a[t.preset];else{if(!a[j])return;s=a[j]}if(s[n]&&void 0!==s[n][e.property]){var o=s[n][e.property];e.initialValue=o,e.setValue(o)}}}}function et(t,e,i,n){if(void 0===e[i])throw new Error('Object "'+e+'" has no property "'+i+'"');var r=void 0;if(n.color)r=new N(e,i);else{var a=[e,i].concat(n.factoryArgs);r=z.apply(t,a)}n.before instanceof w&&(n.before=n.before.__li),tt(t,r),M.addClass(r.domElement,"c");var o=document.createElement("span");M.addClass(o,"property-name"),o.innerHTML=r.property;var l=document.createElement("div");l.appendChild(o),l.appendChild(r.domElement);var h=K(t,l,n.before);return M.addClass(h,J.CLASS_CONTROLLER_ROW),r instanceof N?M.addClass(h,"color"):M.addClass(h,f(r.getValue())),function(t,e,i){if(i.__li=e,i.__gui=t,s.extend(i,{options:function(e){if(arguments.length>1){var n=i.__li.nextElementSibling;return i.remove(),et(t,i.object,i.property,{before:n,factoryArgs:[s.toArray(arguments)]})}if(s.isArray(e)||s.isObject(e)){var r=i.__li.nextElementSibling;return i.remove(),et(t,i.object,i.property,{before:r,factoryArgs:[e]})}},name:function(t){return i.__li.firstElementChild.firstElementChild.innerHTML=t,i},listen:function(){return i.__gui.listen(i),i},remove:function(){return i.__gui.remove(i),i}}),i instanceof k){var n=new L(i.object,i.property,{min:i.__min,max:i.__max,step:i.__step});s.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(t){var e=i[t],r=n[t];i[t]=n[t]=function(){var t=Array.prototype.slice.call(arguments);return r.apply(n,t),e.apply(i,t)}}),M.addClass(e,"has-slider"),i.domElement.insertBefore(n.domElement,i.domElement.firstElementChild)}else if(i instanceof L){var r=function(e){if(s.isNumber(i.__min)&&s.isNumber(i.__max)){var n=i.__li.firstElementChild.firstElementChild.innerHTML,r=i.__gui.__listening.indexOf(i)>-1;i.remove();var a=et(t,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[i.__min,i.__max,i.__step]});return a.name(n),r&&a.listen(),a}return e};i.min=s.compose(r,i.min),i.max=s.compose(r,i.max)}else i instanceof A?(M.bind(e,"click",function(){M.fakeEvent(i.__checkbox,"click")}),M.bind(i.__checkbox,"click",function(t){t.stopPropagation()})):i instanceof O?(M.bind(e,"click",function(){M.fakeEvent(i.__button,"click")}),M.bind(e,"mouseover",function(){M.addClass(i.__button,"hover")}),M.bind(e,"mouseout",function(){M.removeClass(i.__button,"hover")})):i instanceof N&&(M.addClass(e,"color"),i.updateDisplay=s.compose(function(t){return e.style.borderLeftColor=i.__color.toString(),t},i.updateDisplay),i.updateDisplay());i.setValue=s.compose(function(e){return t.getRoot().__preset_select&&i.isModified()&&$(t.getRoot(),!0),e},i.setValue)}(t,h,r),t.__controllers.push(r),r}function it(t,e){return document.location.href+"."+e}function nt(t,e,i){var n=document.createElement("option");n.innerHTML=e,n.value=e,t.__preset_select.appendChild(n),i&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function rt(t,e){e.style.display=t.useLocalStorage?"block":"none"}function at(t){var e=void 0;function i(i){return i.preventDefault(),t.width+=e-i.clientX,t.onResize(),e=i.clientX,!1}function n(){M.removeClass(t.__closeButton,J.CLASS_DRAG),M.unbind(window,"mousemove",i),M.unbind(window,"mouseup",n)}function r(r){return r.preventDefault(),e=r.clientX,M.addClass(t.__closeButton,J.CLASS_DRAG),M.bind(window,"mousemove",i),M.bind(window,"mouseup",n),!1}t.__resize_handle=document.createElement("div"),s.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),M.bind(t.__resize_handle,"mousedown",r),M.bind(t.__closeButton,"mousedown",r),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function st(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function ot(t,e){var i={};return s.each(t.__rememberedObjects,function(n,r){var a={},o=t.__rememberedObjectIndecesToControllers[r];s.each(o,function(t,i){a[i]=e?t.initialValue:t.getValue()}),i[r]=a}),i}J.toggleHide=function(){Y=!Y,s.each(Z,function(t){t.domElement.style.display=Y?"none":""})},J.CLASS_AUTO_PLACE="a",J.CLASS_AUTO_PLACE_CONTAINER="ac",J.CLASS_MAIN="main",J.CLASS_CONTROLLER_ROW="cr",J.CLASS_TOO_TALL="taller-than-window",J.CLASS_CLOSED="closed",J.CLASS_CLOSE_BUTTON="close-button",J.CLASS_CLOSE_TOP="close-top",J.CLASS_CLOSE_BOTTOM="close-bottom",J.CLASS_DRAG="drag",J.DEFAULT_WIDTH=245,J.TEXT_CLOSED="Close Controls",J.TEXT_OPEN="Open Controls",J._keydownHandler=function(t){"text"===document.activeElement.type||72!==t.which&&72!==t.keyCode||J.toggleHide()},M.bind(window,"keydown",J._keydownHandler,!1),s.extend(J.prototype,{add:function(t,e){return et(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return et(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;s.defer(function(){e.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&X.removeChild(this.domElement);var t=this;s.each(this.__folders,function(e){t.removeFolder(e)}),M.unbind(window,"keydown",J._keydownHandler,!1),Q(this)},addFolder:function(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var i=new J(e);this.__folders[t]=i;var n=K(this,i.domElement);return M.addClass(n,"folder"),i},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],Q(t);var e=this;s.each(t.__folders,function(e){t.removeFolder(e)}),s.defer(function(){e.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=M.getOffset(t.__ul).top,i=0;s.each(t.__ul.childNodes,function(e){t.autoPlace&&e===t.__save_row||(i+=M.getHeight(e))}),window.innerHeight-e-20<i?(M.addClass(t.domElement,J.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(M.removeClass(t.domElement,J.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&s.defer(function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"}),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:s.debounce(function(){this.onResize()},50),remember:function(){if(s.isUndefined(W)&&((W=new G).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;s.each(Array.prototype.slice.call(arguments),function(e){0===t.__rememberedObjects.length&&function(t){var e=t.__save_row=document.createElement("li");M.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),M.addClass(e,"save-row");var i=document.createElement("span");i.innerHTML="&nbsp;",M.addClass(i,"button gears");var n=document.createElement("span");n.innerHTML="Save",M.addClass(n,"button"),M.addClass(n,"save");var r=document.createElement("span");r.innerHTML="New",M.addClass(r,"button"),M.addClass(r,"save-as");var a=document.createElement("span");a.innerHTML="Revert",M.addClass(a,"button"),M.addClass(a,"revert");var o=t.__preset_select=document.createElement("select");t.load&&t.load.remembered?s.each(t.load.remembered,function(e,i){nt(t,i,i===t.preset)}):nt(t,j,!1);if(M.bind(o,"change",function(){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].innerHTML=t.__preset_select[e].value;t.preset=this.value}),e.appendChild(o),e.appendChild(i),e.appendChild(n),e.appendChild(r),e.appendChild(a),V){var l=document.getElementById("dg-local-explain"),h=document.getElementById("dg-local-storage"),c=document.getElementById("dg-save-locally");c.style.display="block","true"===localStorage.getItem(it(t,"isLocal"))&&h.setAttribute("checked","checked"),rt(t,l),M.bind(h,"change",function(){t.useLocalStorage=!t.useLocalStorage,rt(t,l)})}var u=document.getElementById("dg-new-constructor");M.bind(u,"keydown",function(t){!t.metaKey||67!==t.which&&67!==t.keyCode||W.hide()}),M.bind(i,"click",function(){u.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),W.show(),u.focus(),u.select()}),M.bind(n,"click",function(){t.save()}),M.bind(r,"click",function(){var e=prompt("Enter a new preset name.");e&&t.saveAs(e)}),M.bind(a,"click",function(){t.revert()})}(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)}),this.autoPlace&&st(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=ot(this)),t.folders={},s.each(this.__folders,function(e,i){t.folders[i]=e.getSaveObject()}),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=ot(this),$(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered[j]=ot(this,!0)),this.load.remembered[t]=ot(this),this.preset=t,nt(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){s.each(this.__controllers,function(e){this.getRoot().load.remembered?tt(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())},this),s.each(this.__folders,function(t){t.revert(t)}),t||$(this.getRoot(),!1)},listen:function(t){var e=0===this.__listening.length;this.__listening.push(t),e&&function t(e){0!==e.length&&H.call(window,function(){t(e)});s.each(e,function(t){t.updateDisplay()})}(this.__listening)},updateDisplay:function(){s.each(this.__controllers,function(t){t.updateDisplay()}),s.each(this.__folders,function(t){t.updateDisplay()})}});var lt={Color:y,math:d,interpret:c},ht={Controller:w,BooleanController:A,OptionController:I,StringController:C,NumberController:R,NumberControllerBox:L,NumberControllerSlider:k,FunctionController:O,ColorController:N},ct={dom:M},ut={GUI:J},dt=J,ft={color:lt,controllers:ht,dom:ct,gui:ut,GUI:dt};e.default=ft},"+HRN":function(t,e,i){"use strict";var n=i("kkc6").Buffer,r=i(1);t.exports=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.head=null,this.tail=null,this.length=0}return t.prototype.push=function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},t.prototype.unshift=function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},t.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},t.prototype.clear=function(){this.head=this.tail=null,this.length=0},t.prototype.join=function(t){if(0===this.length)return"";for(var e=this.head,i=""+e.data;e=e.next;)i+=t+e.data;return i},t.prototype.concat=function(t){if(0===this.length)return n.alloc(0);if(1===this.length)return this.head.data;for(var e,i,r,a=n.allocUnsafe(t>>>0),s=this.head,o=0;s;)e=s.data,i=a,r=o,e.copy(i,r),o+=s.data.length,s=s.next;return a},t}(),r&&r.inspect&&r.inspect.custom&&(t.exports.prototype[r.inspect.custom]=function(){var t=r.inspect({length:this.length});return this.constructor.name+" "+t})},"+kkw":function(t,e,i){"use strict";t.exports=Math.floor},"/2yO":function(t,e,i){"use strict";(function(t){var n=i("EuP9").Buffer,r=i("9DG0").Transform,a=i("EQyj"),s=i("OMJi"),o=i("N+Om").ok,l=i("EuP9").kMaxLength,h="Cannot create final Buffer. It would be larger than 0x"+l.toString(16)+" bytes";a.Z_MIN_WINDOWBITS=8,a.Z_MAX_WINDOWBITS=15,a.Z_DEFAULT_WINDOWBITS=15,a.Z_MIN_CHUNK=64,a.Z_MAX_CHUNK=1/0,a.Z_DEFAULT_CHUNK=16384,a.Z_MIN_MEMLEVEL=1,a.Z_MAX_MEMLEVEL=9,a.Z_DEFAULT_MEMLEVEL=8,a.Z_MIN_LEVEL=-1,a.Z_MAX_LEVEL=9,a.Z_DEFAULT_LEVEL=a.Z_DEFAULT_COMPRESSION;for(var c=Object.keys(a),u=0;u<c.length;u++){var d=c[u];d.match(/^Z/)&&Object.defineProperty(e,d,{enumerable:!0,value:a[d],writable:!1})}for(var f={Z_OK:a.Z_OK,Z_STREAM_END:a.Z_STREAM_END,Z_NEED_DICT:a.Z_NEED_DICT,Z_ERRNO:a.Z_ERRNO,Z_STREAM_ERROR:a.Z_STREAM_ERROR,Z_DATA_ERROR:a.Z_DATA_ERROR,Z_MEM_ERROR:a.Z_MEM_ERROR,Z_BUF_ERROR:a.Z_BUF_ERROR,Z_VERSION_ERROR:a.Z_VERSION_ERROR},p=Object.keys(f),m=0;m<p.length;m++){var g=p[m];f[f[g]]=g}function v(t,e,i){var r=[],a=0;function s(){for(var e;null!==(e=t.read());)r.push(e),a+=e.length;t.once("readable",s)}function o(){var e,s=null;a>=l?s=new RangeError(h):e=n.concat(r,a),r=[],t.close(),i(s,e)}t.on("error",function(e){t.removeListener("end",o),t.removeListener("readable",s),i(e)}),t.on("end",o),t.end(e),s()}function _(t,e){if("string"==typeof e&&(e=n.from(e)),!n.isBuffer(e))throw new TypeError("Not a string or buffer");var i=t._finishFlushFlag;return t._processChunk(e,i)}function y(t){if(!(this instanceof y))return new y(t);A.call(this,t,a.DEFLATE)}function b(t){if(!(this instanceof b))return new b(t);A.call(this,t,a.INFLATE)}function x(t){if(!(this instanceof x))return new x(t);A.call(this,t,a.GZIP)}function w(t){if(!(this instanceof w))return new w(t);A.call(this,t,a.GUNZIP)}function E(t){if(!(this instanceof E))return new E(t);A.call(this,t,a.DEFLATERAW)}function S(t){if(!(this instanceof S))return new S(t);A.call(this,t,a.INFLATERAW)}function T(t){if(!(this instanceof T))return new T(t);A.call(this,t,a.UNZIP)}function M(t){return t===a.Z_NO_FLUSH||t===a.Z_PARTIAL_FLUSH||t===a.Z_SYNC_FLUSH||t===a.Z_FULL_FLUSH||t===a.Z_FINISH||t===a.Z_BLOCK}function A(t,i){var s=this;if(this._opts=t=t||{},this._chunkSize=t.chunkSize||e.Z_DEFAULT_CHUNK,r.call(this,t),t.flush&&!M(t.flush))throw new Error("Invalid flush flag: "+t.flush);if(t.finishFlush&&!M(t.finishFlush))throw new Error("Invalid flush flag: "+t.finishFlush);if(this._flushFlag=t.flush||a.Z_NO_FLUSH,this._finishFlushFlag=void 0!==t.finishFlush?t.finishFlush:a.Z_FINISH,t.chunkSize&&(t.chunkSize<e.Z_MIN_CHUNK||t.chunkSize>e.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+t.chunkSize);if(t.windowBits&&(t.windowBits<e.Z_MIN_WINDOWBITS||t.windowBits>e.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+t.windowBits);if(t.level&&(t.level<e.Z_MIN_LEVEL||t.level>e.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+t.level);if(t.memLevel&&(t.memLevel<e.Z_MIN_MEMLEVEL||t.memLevel>e.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+t.memLevel);if(t.strategy&&t.strategy!=e.Z_FILTERED&&t.strategy!=e.Z_HUFFMAN_ONLY&&t.strategy!=e.Z_RLE&&t.strategy!=e.Z_FIXED&&t.strategy!=e.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+t.strategy);if(t.dictionary&&!n.isBuffer(t.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new a.Zlib(i);var o=this;this._hadError=!1,this._handle.onerror=function(t,i){I(o),o._hadError=!0;var n=new Error(t);n.errno=i,n.code=e.codes[i],o.emit("error",n)};var l=e.Z_DEFAULT_COMPRESSION;"number"==typeof t.level&&(l=t.level);var h=e.Z_DEFAULT_STRATEGY;"number"==typeof t.strategy&&(h=t.strategy),this._handle.init(t.windowBits||e.Z_DEFAULT_WINDOWBITS,l,t.memLevel||e.Z_DEFAULT_MEMLEVEL,h,t.dictionary),this._buffer=n.allocUnsafe(this._chunkSize),this._offset=0,this._level=l,this._strategy=h,this.once("end",this.close),Object.defineProperty(this,"_closed",{get:function(){return!s._handle},configurable:!0,enumerable:!0})}function I(e,i){i&&t.nextTick(i),e._handle&&(e._handle.close(),e._handle=null)}function C(t){t.emit("close")}Object.defineProperty(e,"codes",{enumerable:!0,value:Object.freeze(f),writable:!1}),e.Deflate=y,e.Inflate=b,e.Gzip=x,e.Gunzip=w,e.DeflateRaw=E,e.InflateRaw=S,e.Unzip=T,e.createDeflate=function(t){return new y(t)},e.createInflate=function(t){return new b(t)},e.createDeflateRaw=function(t){return new E(t)},e.createInflateRaw=function(t){return new S(t)},e.createGzip=function(t){return new x(t)},e.createGunzip=function(t){return new w(t)},e.createUnzip=function(t){return new T(t)},e.deflate=function(t,e,i){return"function"==typeof e&&(i=e,e={}),v(new y(e),t,i)},e.deflateSync=function(t,e){return _(new y(e),t)},e.gzip=function(t,e,i){return"function"==typeof e&&(i=e,e={}),v(new x(e),t,i)},e.gzipSync=function(t,e){return _(new x(e),t)},e.deflateRaw=function(t,e,i){return"function"==typeof e&&(i=e,e={}),v(new E(e),t,i)},e.deflateRawSync=function(t,e){return _(new E(e),t)},e.unzip=function(t,e,i){return"function"==typeof e&&(i=e,e={}),v(new T(e),t,i)},e.unzipSync=function(t,e){return _(new T(e),t)},e.inflate=function(t,e,i){return"function"==typeof e&&(i=e,e={}),v(new b(e),t,i)},e.inflateSync=function(t,e){return _(new b(e),t)},e.gunzip=function(t,e,i){return"function"==typeof e&&(i=e,e={}),v(new w(e),t,i)},e.gunzipSync=function(t,e){return _(new w(e),t)},e.inflateRaw=function(t,e,i){return"function"==typeof e&&(i=e,e={}),v(new S(e),t,i)},e.inflateRawSync=function(t,e){return _(new S(e),t)},s.inherits(A,r),A.prototype.params=function(i,n,r){if(i<e.Z_MIN_LEVEL||i>e.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+i);if(n!=e.Z_FILTERED&&n!=e.Z_HUFFMAN_ONLY&&n!=e.Z_RLE&&n!=e.Z_FIXED&&n!=e.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+n);if(this._level!==i||this._strategy!==n){var s=this;this.flush(a.Z_SYNC_FLUSH,function(){o(s._handle,"zlib binding closed"),s._handle.params(i,n),s._hadError||(s._level=i,s._strategy=n,r&&r())})}else t.nextTick(r)},A.prototype.reset=function(){return o(this._handle,"zlib binding closed"),this._handle.reset()},A.prototype._flush=function(t){this._transform(n.alloc(0),"",t)},A.prototype.flush=function(e,i){var r=this,s=this._writableState;("function"==typeof e||void 0===e&&!i)&&(i=e,e=a.Z_FULL_FLUSH),s.ended?i&&t.nextTick(i):s.ending?i&&this.once("end",i):s.needDrain?i&&this.once("drain",function(){return r.flush(e,i)}):(this._flushFlag=e,this.write(n.alloc(0),"",i))},A.prototype.close=function(e){I(this,e),t.nextTick(C,this)},A.prototype._transform=function(t,e,i){var r,s=this._writableState,o=(s.ending||s.ended)&&(!t||s.length===t.length);return null===t||n.isBuffer(t)?this._handle?(o?r=this._finishFlushFlag:(r=this._flushFlag,t.length>=s.length&&(this._flushFlag=this._opts.flush||a.Z_NO_FLUSH)),void this._processChunk(t,r,i)):i(new Error("zlib binding closed")):i(new Error("invalid input"))},A.prototype._processChunk=function(t,e,i){var r=t&&t.length,a=this._chunkSize-this._offset,s=0,c=this,u="function"==typeof i;if(!u){var d,f=[],p=0;this.on("error",function(t){d=t}),o(this._handle,"zlib binding closed");do{var m=this._handle.writeSync(e,t,s,r,this._buffer,this._offset,a)}while(!this._hadError&&_(m[0],m[1]));if(this._hadError)throw d;if(p>=l)throw I(this),new RangeError(h);var g=n.concat(f,p);return I(this),g}o(this._handle,"zlib binding closed");var v=this._handle.write(e,t,s,r,this._buffer,this._offset,a);function _(l,h){if(this&&(this.buffer=null,this.callback=null),!c._hadError){var d=a-h;if(o(d>=0,"have should not go down"),d>0){var m=c._buffer.slice(c._offset,c._offset+d);c._offset+=d,u?c.push(m):(f.push(m),p+=m.length)}if((0===h||c._offset>=c._chunkSize)&&(a=c._chunkSize,c._offset=0,c._buffer=n.allocUnsafe(c._chunkSize)),0===h){if(s+=r-l,r=l,!u)return!0;var g=c._handle.write(e,t,s,r,c._buffer,c._offset,c._chunkSize);return g.callback=_,void(g.buffer=t)}if(!u)return!1;i()}}v.buffer=t,v.callback=_},s.inherits(y,A),s.inherits(b,A),s.inherits(x,A),s.inherits(w,A),s.inherits(E,A),s.inherits(S,A),s.inherits(T,A)}).call(e,i("W2nU"))},"/MLu":function(t,e,i){t.exports=i("cSWu").PassThrough},0:function(t,e){},"0JKJ":function(t,e,i){"use strict";t.exports=function(t,e){var i,n,r,a,s,o,l,h,c,u,d,f,p,m,g,v,_,y,b,x,w,E,S,T,M;i=t.state,n=t.next_in,T=t.input,r=n+(t.avail_in-5),a=t.next_out,M=t.output,s=a-(e-t.avail_out),o=a+(t.avail_out-257),l=i.dmax,h=i.wsize,c=i.whave,u=i.wnext,d=i.window,f=i.hold,p=i.bits,m=i.lencode,g=i.distcode,v=(1<<i.lenbits)-1,_=(1<<i.distbits)-1;t:do{p<15&&(f+=T[n++]<<p,p+=8,f+=T[n++]<<p,p+=8),y=m[f&v];e:for(;;){if(f>>>=b=y>>>24,p-=b,0===(b=y>>>16&255))M[a++]=65535&y;else{if(!(16&b)){if(0==(64&b)){y=m[(65535&y)+(f&(1<<b)-1)];continue e}if(32&b){i.mode=12;break t}t.msg="invalid literal/length code",i.mode=30;break t}x=65535&y,(b&=15)&&(p<b&&(f+=T[n++]<<p,p+=8),x+=f&(1<<b)-1,f>>>=b,p-=b),p<15&&(f+=T[n++]<<p,p+=8,f+=T[n++]<<p,p+=8),y=g[f&_];i:for(;;){if(f>>>=b=y>>>24,p-=b,!(16&(b=y>>>16&255))){if(0==(64&b)){y=g[(65535&y)+(f&(1<<b)-1)];continue i}t.msg="invalid distance code",i.mode=30;break t}if(w=65535&y,p<(b&=15)&&(f+=T[n++]<<p,(p+=8)<b&&(f+=T[n++]<<p,p+=8)),(w+=f&(1<<b)-1)>l){t.msg="invalid distance too far back",i.mode=30;break t}if(f>>>=b,p-=b,w>(b=a-s)){if((b=w-b)>c&&i.sane){t.msg="invalid distance too far back",i.mode=30;break t}if(E=0,S=d,0===u){if(E+=h-b,b<x){x-=b;do{M[a++]=d[E++]}while(--b);E=a-w,S=M}}else if(u<b){if(E+=h+u-b,(b-=u)<x){x-=b;do{M[a++]=d[E++]}while(--b);if(E=0,u<x){x-=b=u;do{M[a++]=d[E++]}while(--b);E=a-w,S=M}}}else if(E+=u-b,b<x){x-=b;do{M[a++]=d[E++]}while(--b);E=a-w,S=M}for(;x>2;)M[a++]=S[E++],M[a++]=S[E++],M[a++]=S[E++],x-=3;x&&(M[a++]=S[E++],x>1&&(M[a++]=S[E++]))}else{E=a-w;do{M[a++]=M[E++],M[a++]=M[E++],M[a++]=M[E++],x-=3}while(x>2);x&&(M[a++]=M[E++],x>1&&(M[a++]=M[E++]))}break}}break}}while(n<r&&a<o);n-=x=p>>3,f&=(1<<(p-=x<<3))-1,t.next_in=n,t.next_out=a,t.avail_in=n<r?r-n+5:5-(n-r),t.avail_out=a<o?o-a+257:257-(a-o),i.hold=f,i.bits=p}},"0jOE":function(t,e,i){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},1:function(t,e){},"1nuA":function(t,e,i){"use strict";e.decode=e.parse=i("kMPS"),e.encode=e.stringify=i("xaZU")},"2A+V":function(t,e,i){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},"2WCG":function(t,e,i){"use strict";var n=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}();t.exports=function(t,e,i,r){var a=n,s=r+i;t^=-1;for(var o=r;o<s;o++)t=t>>>8^a[255&(t^e[o])];return-1^t}},"3BHo":function(t,e,i){"use strict";var n=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}();t.exports=function(t,e,i,r){var a=n,s=r+i;t^=-1;for(var o=r;o<s;o++)t=t>>>8^a[255&(t^e[o])];return-1^t}},"3IRH":function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},"3mCb":function(t,e,i){"use strict";var n,r=i("x+d4"),a=i("Aabw"),s=i("Imsi"),o=i("3BHo"),l=i("6akE"),h=0,c=1,u=3,d=4,f=5,p=0,m=1,g=-2,v=-3,_=-5,y=-1,b=1,x=2,w=3,E=4,S=0,T=2,M=8,A=9,I=15,C=8,P=286,R=30,L=19,D=2*P+1,k=15,O=3,N=258,U=N+O+1,F=32,B=42,z=69,H=73,G=91,j=103,V=113,W=666,q=1,X=2,Y=3,Z=4,J=3;function K(t,e){return t.msg=l[e],e}function Q(t){return(t<<1)-(t>4?9:0)}function $(t){for(var e=t.length;--e>=0;)t[e]=0}function tt(t){var e=t.state,i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(r.arraySet(t.output,e.pending_buf,e.pending_out,i,t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))}function et(t,e){a._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,tt(t.strm)}function it(t,e){t.pending_buf[t.pending++]=e}function nt(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function rt(t,e){var i,n,r=t.max_chain_length,a=t.strstart,s=t.prev_length,o=t.nice_match,l=t.strstart>t.w_size-U?t.strstart-(t.w_size-U):0,h=t.window,c=t.w_mask,u=t.prev,d=t.strstart+N,f=h[a+s-1],p=h[a+s];t.prev_length>=t.good_match&&(r>>=2),o>t.lookahead&&(o=t.lookahead);do{if(h[(i=e)+s]===p&&h[i+s-1]===f&&h[i]===h[a]&&h[++i]===h[a+1]){a+=2,i++;do{}while(h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&a<d);if(n=N-(d-a),a=d-N,n>s){if(t.match_start=e,s=n,n>=o)break;f=h[a+s-1],p=h[a+s]}}}while((e=u[e&c])>l&&0!=--r);return s<=t.lookahead?s:t.lookahead}function at(t){var e,i,n,a,l,h,c,u,d,f,p=t.w_size;do{if(a=t.window_size-t.lookahead-t.strstart,t.strstart>=p+(p-U)){r.arraySet(t.window,t.window,p,p,0),t.match_start-=p,t.strstart-=p,t.block_start-=p,e=i=t.hash_size;do{n=t.head[--e],t.head[e]=n>=p?n-p:0}while(--i);e=i=p;do{n=t.prev[--e],t.prev[e]=n>=p?n-p:0}while(--i);a+=p}if(0===t.strm.avail_in)break;if(h=t.strm,c=t.window,u=t.strstart+t.lookahead,d=a,f=void 0,(f=h.avail_in)>d&&(f=d),i=0===f?0:(h.avail_in-=f,r.arraySet(c,h.input,h.next_in,f,u),1===h.state.wrap?h.adler=s(h.adler,c,f,u):2===h.state.wrap&&(h.adler=o(h.adler,c,f,u)),h.next_in+=f,h.total_in+=f,f),t.lookahead+=i,t.lookahead+t.insert>=O)for(l=t.strstart-t.insert,t.ins_h=t.window[l],t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+O-1])&t.hash_mask,t.prev[l&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=l,l++,t.insert--,!(t.lookahead+t.insert<O)););}while(t.lookahead<U&&0!==t.strm.avail_in)}function st(t,e){for(var i,n;;){if(t.lookahead<U){if(at(t),t.lookahead<U&&e===h)return q;if(0===t.lookahead)break}if(i=0,t.lookahead>=O&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+O-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-U&&(t.match_length=rt(t,i)),t.match_length>=O)if(n=a._tr_tally(t,t.strstart-t.match_start,t.match_length-O),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=O){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+O-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else n=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(et(t,!1),0===t.strm.avail_out))return q}return t.insert=t.strstart<O-1?t.strstart:O-1,e===d?(et(t,!0),0===t.strm.avail_out?Y:Z):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?q:X}function ot(t,e){for(var i,n,r;;){if(t.lookahead<U){if(at(t),t.lookahead<U&&e===h)return q;if(0===t.lookahead)break}if(i=0,t.lookahead>=O&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+O-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=O-1,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-U&&(t.match_length=rt(t,i),t.match_length<=5&&(t.strategy===b||t.match_length===O&&t.strstart-t.match_start>4096)&&(t.match_length=O-1)),t.prev_length>=O&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-O,n=a._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-O),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=r&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+O-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=O-1,t.strstart++,n&&(et(t,!1),0===t.strm.avail_out))return q}else if(t.match_available){if((n=a._tr_tally(t,0,t.window[t.strstart-1]))&&et(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return q}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=a._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<O-1?t.strstart:O-1,e===d?(et(t,!0),0===t.strm.avail_out?Y:Z):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?q:X}function lt(t,e,i,n,r){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=n,this.func=r}function ht(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=T,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?B:V,t.adler=2===e.wrap?0:1,e.last_flush=h,a._tr_init(e),p):K(t,g)}function ct(t){var e,i=ht(t);return i===p&&((e=t.state).window_size=2*e.w_size,$(e.head),e.max_lazy_match=n[e.level].max_lazy,e.good_match=n[e.level].good_length,e.nice_match=n[e.level].nice_length,e.max_chain_length=n[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=O-1,e.match_available=0,e.ins_h=0),i}function ut(t,e,i,n,a,s){if(!t)return g;var o=1;if(e===y&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),a<1||a>A||i!==M||n<8||n>15||e<0||e>9||s<0||s>E)return K(t,g);8===n&&(n=9);var l=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=M,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*D),this.dyn_dtree=new r.Buf16(2*(2*R+1)),this.bl_tree=new r.Buf16(2*(2*L+1)),$(this.dyn_ltree),$(this.dyn_dtree),$(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(k+1),this.heap=new r.Buf16(2*P+1),$(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*P+1),$(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return t.state=l,l.strm=t,l.wrap=o,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+O-1)/O),l.window=new r.Buf8(2*l.w_size),l.head=new r.Buf16(l.hash_size),l.prev=new r.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new r.Buf8(l.pending_buf_size),l.d_buf=l.lit_bufsize>>1,l.l_buf=3*l.lit_bufsize,l.level=e,l.strategy=s,l.method=i,ct(t)}n=[new lt(0,0,0,0,function(t,e){var i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(at(t),0===t.lookahead&&e===h)return q;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+i;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,et(t,!1),0===t.strm.avail_out))return q;if(t.strstart-t.block_start>=t.w_size-U&&(et(t,!1),0===t.strm.avail_out))return q}return t.insert=0,e===d?(et(t,!0),0===t.strm.avail_out?Y:Z):(t.strstart>t.block_start&&(et(t,!1),t.strm.avail_out),q)}),new lt(4,4,8,4,st),new lt(4,5,16,8,st),new lt(4,6,32,32,st),new lt(4,4,16,16,ot),new lt(8,16,32,32,ot),new lt(8,16,128,128,ot),new lt(8,32,128,256,ot),new lt(32,128,258,1024,ot),new lt(32,258,258,4096,ot)],e.deflateInit=function(t,e){return ut(t,e,M,I,C,S)},e.deflateInit2=ut,e.deflateReset=ct,e.deflateResetKeep=ht,e.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?g:(t.state.gzhead=e,p):g},e.deflate=function(t,e){var i,r,s,l;if(!t||!t.state||e>f||e<0)return t?K(t,g):g;if(r=t.state,!t.output||!t.input&&0!==t.avail_in||r.status===W&&e!==d)return K(t,0===t.avail_out?_:g);if(r.strm=t,i=r.last_flush,r.last_flush=e,r.status===B)if(2===r.wrap)t.adler=0,it(r,31),it(r,139),it(r,8),r.gzhead?(it(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),it(r,255&r.gzhead.time),it(r,r.gzhead.time>>8&255),it(r,r.gzhead.time>>16&255),it(r,r.gzhead.time>>24&255),it(r,9===r.level?2:r.strategy>=x||r.level<2?4:0),it(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(it(r,255&r.gzhead.extra.length),it(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=o(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=z):(it(r,0),it(r,0),it(r,0),it(r,0),it(r,0),it(r,9===r.level?2:r.strategy>=x||r.level<2?4:0),it(r,J),r.status=V);else{var v=M+(r.w_bits-8<<4)<<8;v|=(r.strategy>=x||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(v|=F),v+=31-v%31,r.status=V,nt(r,v),0!==r.strstart&&(nt(r,t.adler>>>16),nt(r,65535&t.adler)),t.adler=1}if(r.status===z)if(r.gzhead.extra){for(s=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>s&&(t.adler=o(t.adler,r.pending_buf,r.pending-s,s)),tt(t),s=r.pending,r.pending!==r.pending_buf_size));)it(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>s&&(t.adler=o(t.adler,r.pending_buf,r.pending-s,s)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=H)}else r.status=H;if(r.status===H)if(r.gzhead.name){s=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>s&&(t.adler=o(t.adler,r.pending_buf,r.pending-s,s)),tt(t),s=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,it(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>s&&(t.adler=o(t.adler,r.pending_buf,r.pending-s,s)),0===l&&(r.gzindex=0,r.status=G)}else r.status=G;if(r.status===G)if(r.gzhead.comment){s=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>s&&(t.adler=o(t.adler,r.pending_buf,r.pending-s,s)),tt(t),s=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,it(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>s&&(t.adler=o(t.adler,r.pending_buf,r.pending-s,s)),0===l&&(r.status=j)}else r.status=j;if(r.status===j&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&tt(t),r.pending+2<=r.pending_buf_size&&(it(r,255&t.adler),it(r,t.adler>>8&255),t.adler=0,r.status=V)):r.status=V),0!==r.pending){if(tt(t),0===t.avail_out)return r.last_flush=-1,p}else if(0===t.avail_in&&Q(e)<=Q(i)&&e!==d)return K(t,_);if(r.status===W&&0!==t.avail_in)return K(t,_);if(0!==t.avail_in||0!==r.lookahead||e!==h&&r.status!==W){var y=r.strategy===x?function(t,e){for(var i;;){if(0===t.lookahead&&(at(t),0===t.lookahead)){if(e===h)return q;break}if(t.match_length=0,i=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(et(t,!1),0===t.strm.avail_out))return q}return t.insert=0,e===d?(et(t,!0),0===t.strm.avail_out?Y:Z):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?q:X}(r,e):r.strategy===w?function(t,e){for(var i,n,r,s,o=t.window;;){if(t.lookahead<=N){if(at(t),t.lookahead<=N&&e===h)return q;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=O&&t.strstart>0&&(n=o[r=t.strstart-1])===o[++r]&&n===o[++r]&&n===o[++r]){s=t.strstart+N;do{}while(n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&r<s);t.match_length=N-(s-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=O?(i=a._tr_tally(t,1,t.match_length-O),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(et(t,!1),0===t.strm.avail_out))return q}return t.insert=0,e===d?(et(t,!0),0===t.strm.avail_out?Y:Z):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?q:X}(r,e):n[r.level].func(r,e);if(y!==Y&&y!==Z||(r.status=W),y===q||y===Y)return 0===t.avail_out&&(r.last_flush=-1),p;if(y===X&&(e===c?a._tr_align(r):e!==f&&(a._tr_stored_block(r,0,0,!1),e===u&&($(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),tt(t),0===t.avail_out))return r.last_flush=-1,p}return e!==d?p:r.wrap<=0?m:(2===r.wrap?(it(r,255&t.adler),it(r,t.adler>>8&255),it(r,t.adler>>16&255),it(r,t.adler>>24&255),it(r,255&t.total_in),it(r,t.total_in>>8&255),it(r,t.total_in>>16&255),it(r,t.total_in>>24&255)):(nt(r,t.adler>>>16),nt(r,65535&t.adler)),tt(t),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?p:m)},e.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==B&&e!==z&&e!==H&&e!==G&&e!==j&&e!==V&&e!==W?K(t,g):(t.state=null,e===V?K(t,v):p):g},e.deflateSetDictionary=function(t,e){var i,n,a,o,l,h,c,u,d=e.length;if(!t||!t.state)return g;if(2===(o=(i=t.state).wrap)||1===o&&i.status!==B||i.lookahead)return g;for(1===o&&(t.adler=s(t.adler,e,d,0)),i.wrap=0,d>=i.w_size&&(0===o&&($(i.head),i.strstart=0,i.block_start=0,i.insert=0),u=new r.Buf8(i.w_size),r.arraySet(u,e,d-i.w_size,i.w_size,0),e=u,d=i.w_size),l=t.avail_in,h=t.next_in,c=t.input,t.avail_in=d,t.next_in=0,t.input=e,at(i);i.lookahead>=O;){n=i.strstart,a=i.lookahead-(O-1);do{i.ins_h=(i.ins_h<<i.hash_shift^i.window[n+O-1])&i.hash_mask,i.prev[n&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=n,n++}while(--a);i.strstart=n,i.lookahead=O-1,at(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=O-1,i.match_available=0,t.next_in=h,t.input=c,t.avail_in=l,i.wrap=o,p},e.deflateInfo="pako deflate (from Nodeca project)"},"3v+v":function(t,e,i){"use strict";t.exports=function(t){return("number"==typeof t||"[object Number]"===Object.prototype.toString.call(t))&&t.valueOf()==t.valueOf()}},"4/4u":function(t,e,i){t.exports=i("cSWu").Transform},"4Tar":function(t,e,i){"use strict";var n=i("IjlT"),r=i("x+d4"),a=i("Ytp1"),s=i("JNao"),o=i("6akE"),l=i("5Ek+"),h=i("RfIG"),c=Object.prototype.toString;function u(t){if(!(this instanceof u))return new u(t);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var i=n.inflateInit2(this.strm,e.windowBits);if(i!==s.Z_OK)throw new Error(o[i]);this.header=new h,n.inflateGetHeader(this.strm,this.header)}function d(t,e){var i=new u(e);if(i.push(t,!0),i.err)throw i.msg;return i.result}u.prototype.push=function(t,e){var i,o,l,h,u,d,f=this.strm,p=this.options.chunkSize,m=this.options.dictionary,g=!1;if(this.ended)return!1;o=e===~~e?e:!0===e?s.Z_FINISH:s.Z_NO_FLUSH,"string"==typeof t?f.input=a.binstring2buf(t):"[object ArrayBuffer]"===c.call(t)?f.input=new Uint8Array(t):f.input=t,f.next_in=0,f.avail_in=f.input.length;do{if(0===f.avail_out&&(f.output=new r.Buf8(p),f.next_out=0,f.avail_out=p),(i=n.inflate(f,s.Z_NO_FLUSH))===s.Z_NEED_DICT&&m&&(d="string"==typeof m?a.string2buf(m):"[object ArrayBuffer]"===c.call(m)?new Uint8Array(m):m,i=n.inflateSetDictionary(this.strm,d)),i===s.Z_BUF_ERROR&&!0===g&&(i=s.Z_OK,g=!1),i!==s.Z_STREAM_END&&i!==s.Z_OK)return this.onEnd(i),this.ended=!0,!1;f.next_out&&(0!==f.avail_out&&i!==s.Z_STREAM_END&&(0!==f.avail_in||o!==s.Z_FINISH&&o!==s.Z_SYNC_FLUSH)||("string"===this.options.to?(l=a.utf8border(f.output,f.next_out),h=f.next_out-l,u=a.buf2string(f.output,l),f.next_out=h,f.avail_out=p-h,h&&r.arraySet(f.output,f.output,l,h,0),this.onData(u)):this.onData(r.shrinkBuf(f.output,f.next_out)))),0===f.avail_in&&0===f.avail_out&&(g=!0)}while((f.avail_in>0||0===f.avail_out)&&i!==s.Z_STREAM_END);return i===s.Z_STREAM_END&&(o=s.Z_FINISH),o===s.Z_FINISH?(i=n.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===s.Z_OK):o!==s.Z_SYNC_FLUSH||(this.onEnd(s.Z_OK),f.avail_out=0,!0)},u.prototype.onData=function(t){this.chunks.push(t)},u.prototype.onEnd=function(t){t===s.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Inflate=u,e.inflate=d,e.inflateRaw=function(t,e){return(e=e||{}).raw=!0,d(t,e)},e.ungzip=d},"5Ek+":function(t,e,i){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},"5Xl1":function(t,e,i){(function(t,n){var r,a,s,o;/*! dicom-parser - v1.7.3 - 2016-08-18 | (c) 2014 Chris Hafey | https://github.com/chafey/dicomParser */ /*! dicom-parser - v1.7.3 - 2016-08-18 | (c) 2014 Chris Hafey | https://github.com/chafey/dicomParser */
o=function(){var e;return e=function(t){"use strict";return void 0===t&&(t={}),t.version="1.7.3",t}(e=function(t){"use strict";return void 0===t&&(t={}),t.sharedCopy=function(t,e,i){if(void 0!==n&&t instanceof n)return t.slice(e,e+i);if(t instanceof Uint8Array)return new Uint8Array(t.buffer,t.byteOffset+e,i);throw"dicomParser.from: unknown type for byteArray"},t}(e=function(t){"use strict";return void 0===t&&(t={}),t.readTag=function(t){if(void 0===t)throw"dicomParser.readTag: missing required parameter 'byteStream'";return"x"+("00000000"+(256*t.readUint16()*256+t.readUint16()).toString(16)).substr(-8)},t}(e=function(t){"use strict";return void 0===t&&(t={}),t.readSequenceItem=function(e){if(void 0===e)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var i={tag:t.readTag(e),length:e.readUint32(),dataOffset:e.position};if("xfffee000"!==i.tag)throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset "+e.position;return i},t}(e=function(t){"use strict";function e(e,i){var n=t.readSequenceItem(e);return 4294967295===n.length?(n.hadUndefinedLength=!0,n.dataSet=function(e,i){for(var n={};e.position<e.byteArray.length;){var r=t.readDicomElementImplicit(e,void 0,i);if(n[r.tag]=r,"xfffee00d"===r.tag)return new t.DataSet(e.byteArrayParser,e.byteArray,n)}return e.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new t.DataSet(e.byteArrayParser,e.byteArray,n)}(e,i),n.length=e.position-n.dataOffset):(n.dataSet=new t.DataSet(e.byteArrayParser,e.byteArray,{}),t.parseDicomDataSetImplicit(n.dataSet,e,e.position+n.length,{vrCallback:i})),n}return void 0===t&&(t={}),t.readSequenceItemsImplicit=function(i,n,r){if(void 0===i)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(void 0===n)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";n.items=[],4294967295===n.length?function(i,n,r){for(;i.position+4<=i.byteArray.length;){var a=t.readTag(i);if(i.seek(-4),"xfffee0dd"===a)return n.length=i.position-n.dataOffset,i.seek(8),n;var s=e(i,r);n.items.push(s)}i.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),n.length=i.byteArray.length-n.dataOffset}(i,n,r):function(t,i,n){for(var r=i.dataOffset+i.length;t.position<r;){var a=e(t,n);i.items.push(a)}}(i,n,r)},t}(e=function(t){"use strict";function e(e,i){var n=t.readSequenceItem(e);return 4294967295===n.length?(n.hadUndefinedLength=!0,n.dataSet=function(e,i){for(var n={};e.position<e.byteArray.length;){var r=t.readDicomElementExplicit(e,i);if(n[r.tag]=r,"xfffee00d"===r.tag)return new t.DataSet(e.byteArrayParser,e.byteArray,n)}return i.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new t.DataSet(e.byteArrayParser,e.byteArray,n)}(e,i),n.length=e.position-n.dataOffset):(n.dataSet=new t.DataSet(e.byteArrayParser,e.byteArray,{}),t.parseDicomDataSetExplicit(n.dataSet,e,e.position+n.length)),n}return void 0===t&&(t={}),t.readSequenceItemsExplicit=function(i,n,r){if(void 0===i)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(void 0===n)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";n.items=[],4294967295===n.length?function(i,n,r){for(;i.position+4<=i.byteArray.length;){var a=t.readTag(i);if(i.seek(-4),"xfffee0dd"===a)return n.length=i.position-n.dataOffset,i.seek(8),n;var s=e(i,r);n.items.push(s)}r.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),n.length=i.position-n.dataOffset}(i,n,r):function(t,i,n){for(var r=i.dataOffset+i.length;t.position<r;){var a=e(t,n);i.items.push(a)}}(i,n,r)},t}(e=function(t){return void 0===t&&(t={}),t.readPart10Header=function(e,i){if(void 0===e)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var n=new t.ByteStream(t.littleEndianByteArrayParser,e);return function(){!function(){if(n.seek(128),"DICM"!==n.readFixedString(4))throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file."}();for(var e=[],i={};n.position<n.byteArray.length;){var r=n.position,a=t.readDicomElementExplicit(n,e);if(a.tag>"x0002ffff"){n.position=r;break}a.parser=t.littleEndianByteArrayParser,i[a.tag]=a}var s=new t.DataSet(n.byteArrayParser,n.byteArray,i);return s.warnings=n.warnings,s.position=n.position,s}()},t}(e=function(t){"use strict";return void 0===t&&(t={}),t.readEncapsulatedPixelDataFromFragments=function(e,i,n,r,a){if(r=r||1,a=a||i.fragments,void 0===e)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(void 0===i)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(void 0===n)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if(void 0===r)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if("x7fe00010"!==i.tag)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(!0!==i.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==i.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===i.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===i.fragments)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(i.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(n<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(n>=i.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(r<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(n+r>i.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var s=new t.ByteStream(e.byteArrayParser,e.byteArray,i.dataOffset),o=t.readSequenceItem(s);if("xfffee000"!==o.tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";s.seek(o.length);var l=s.position;if(1===r)return t.sharedCopy(s.byteArray,l+a[n].offset+8,a[n].length);for(var h=function(t,e,i){for(var n=0,r=e;r<e+i;r++)n+=t[r].length;return n}(a,n,r),c=t.alloc(s.byteArray,h),u=0,d=n;d<n+r;d++)for(var f=l+a[d].offset+8,p=0;p<a[d].length;p++)c[u++]=s.byteArray[f++];return c},t}(e=function(t){"use strict";return void 0===t&&(t={}),t.readEncapsulatedImageFrame=function(e,i,n,r,a){if(r=r||i.basicOffsetTable,a=a||i.fragments,void 0===e)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(void 0===i)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(void 0===n)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(void 0===r)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if("x7fe00010"!==i.tag)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(!0!==i.encapsulatedPixelData)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==i.hadUndefinedLength)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(void 0===i.fragments)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(0===r.length)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(n<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(n>=r.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var s=function(t,e){for(var i=0;i<t.length;i++)if(t[i].offset===e)return i}(a,r[n]);if(void 0===s)throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";var o=function(t,e,i,n){if(t===e.length-1)return i.length-n;for(var r=e[t+1],a=n+1;a<i.length;a++)if(i[a].offset===r)return a-n;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"}(n,r,a,s);return t.readEncapsulatedPixelDataFromFragments(e,i,s,o,a)},t}(e=function(t){"use strict";return void 0===t&&(t={}),t.readDicomElementImplicit=function(e,i,n){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var r={tag:t.readTag(e),length:e.readUint32(),dataOffset:e.position};return 4294967295===r.length&&(r.hadUndefinedLength=!0),r.tag===i?r:function(e,i,n){if(void 0!==n)return"SQ"===n(e.tag);if(i.position+4<=i.byteArray.length){var r=t.readTag(i);return i.seek(-4),"xfffee000"===r||"xfffee0dd"===r}return i.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!1}(r,e,n)?(t.readSequenceItemsImplicit(e,r),r):r.hadUndefinedLength?(t.findItemDelimitationItemAndSetElementLength(e,r),r):(e.seek(r.length),r)},t}(e=function(t){"use strict";return void 0===t&&(t={}),t.readDicomElementExplicit=function(e,i,n){if(void 0===e)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var r,a={tag:t.readTag(e),vr:e.readFixedString(2)};return 2===("OB"===(r=a.vr)||"OW"===r||"SQ"===r||"OF"===r||"UT"===r||"UN"===r?4:2)?(a.length=e.readUint16(),a.dataOffset=e.position):(e.seek(2),a.length=e.readUint32(),a.dataOffset=e.position),4294967295===a.length&&(a.hadUndefinedLength=!0),a.tag===n?a:"SQ"===a.vr?(t.readSequenceItemsExplicit(e,a,i),a):4294967295===a.length?"x7fe00010"===a.tag?(t.findEndOfEncapsulatedElement(e,a,i),a):"UN"===a.vr?(t.findAndSetUNElementLength(e,a),a):(t.readSequenceItemsImplicit(e,a),a):(e.seek(a.length),a)},t}(e=function(t){"use strict";return void 0===t&&(t={}),t.parseDicomDataSetExplicit=function(e,i,n,r){if(n=void 0===n?i.byteArray.length:n,r=r||{},void 0===i)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(n<i.position||n>i.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxPosition'";for(var a=e.elements;i.position<n;){var s=t.readDicomElementExplicit(i,e.warnings,r.untilTag);if(a[s.tag]=s,s.tag===r.untilTag)return}if(i.position>n)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"},t.parseDicomDataSetImplicit=function(e,i,n,r){if(n=void 0===n?e.byteArray.length:n,r=r||{},void 0===i)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(n<i.position||n>i.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var a=e.elements;i.position<n;){var s=t.readDicomElementImplicit(i,r.untilTag,r.vrCallback);if(a[s.tag]=s,s.tag===r.untilTag)return}},t}(e=function(t){"use strict";return void 0===t&&(t={}),t.littleEndianByteArrayParser={readUint16:function(t,e){if(e<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(e+2>t.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return t[e]+256*t[e+1]},readInt16:function(t,e){if(e<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(e+2>t.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";var i=t[e]+(t[e+1]<<8);return 32768&i&&(i=i-65535-1),i},readUint32:function(t,e){if(e<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(e+4>t.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return t[e]+256*t[e+1]+256*t[e+2]*256+256*t[e+3]*256*256},readInt32:function(t,e){if(e<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(e+4>t.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24)},readFloat:function(t,e){if(e<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(e+4>t.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var i=new Uint8Array(4);return i[0]=t[e],i[1]=t[e+1],i[2]=t[e+2],i[3]=t[e+3],new Float32Array(i.buffer)[0]},readDouble:function(t,e){if(e<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(e+8>t.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var i=new Uint8Array(8);return i[0]=t[e],i[1]=t[e+1],i[2]=t[e+2],i[3]=t[e+3],i[4]=t[e+4],i[5]=t[e+5],i[6]=t[e+6],i[7]=t[e+7],new Float64Array(i.buffer)[0]}},t}(e=function(t){"use strict";return void 0===t&&(t={}),t.findItemDelimitationItemAndSetElementLength=function(t,e){if(void 0===t)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var i=t.byteArray.length-8;t.position<=i;){if(65534===t.readUint16())if(57357===t.readUint16())return 0!==t.readUint32()&&t.warnings("encountered non zero length following item delimiter at position"+t.position-4+" while reading element of undefined length with tag ' + element.tag"),void(e.length=t.position-e.dataOffset)}e.length=t.byteArray.length-e.dataOffset,t.seek(t.byteArray.length-t.position)},t}(e=function(t){"use strict";return void 0===t&&(t={}),t.findEndOfEncapsulatedElement=function(e,i,n){if(void 0===e)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(void 0===i)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(i.encapsulatedPixelData=!0,i.basicOffsetTable=[],i.fragments=[],"xfffee000"!==t.readTag(e))throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var r=e.readUint32()/4,a=0;a<r;a++){var s=e.readUint32();i.basicOffsetTable.push(s)}for(var o=e.position;e.position<e.byteArray.length;){var l=t.readTag(e),h=e.readUint32();if("xfffee0dd"===l)return e.seek(h),void(i.length=e.position-i.dataOffset);if("xfffee000"!==l)return n&&n.push("unexpected tag "+l+" while searching for end of pixel data element with undefined length"),h>e.byteArray.length-e.position&&(h=e.byteArray.length-e.position),i.fragments.push({offset:e.position-o-8,position:e.position,length:h}),e.seek(h),void(i.length=e.position-i.dataOffset);i.fragments.push({offset:e.position-o-8,position:e.position,length:h}),e.seek(h)}n&&n.push("pixel data element "+i.tag+" missing sequence delimiter tag xfffee0dd")},t}(e=function(t){"use strict";return void 0===t&&(t={}),t.findAndSetUNElementLength=function(t,e){if(void 0===t)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var i=t.byteArray.length-8;t.position<=i;){if(65534===t.readUint16())if(57565===t.readUint16())return 0!==t.readUint32()&&t.warnings("encountered non zero length following item delimiter at position"+t.position-4+" while reading element of undefined length with tag ' + element.tag"),void(e.length=t.position-e.dataOffset)}e.length=t.byteArray.length-e.dataOffset,t.seek(t.byteArray.length-t.position)},t}(e=function(t){"use strict";function e(t,e){return void 0!==t.parser?t.parser:e}return void 0===t&&(t={}),t.DataSet=function(t,e,i){this.byteArrayParser=t,this.byteArray=e,this.elements=i},t.DataSet.prototype.uint16=function(t,i){var n=this.elements[t];if(i=void 0!==i?i:0,n&&0!==n.length)return e(n,this.byteArrayParser).readUint16(this.byteArray,n.dataOffset+2*i)},t.DataSet.prototype.int16=function(t,i){var n=this.elements[t];if(i=void 0!==i?i:0,n&&0!==n.length)return e(n,this.byteArrayParser).readInt16(this.byteArray,n.dataOffset+2*i)},t.DataSet.prototype.uint32=function(t,i){var n=this.elements[t];if(i=void 0!==i?i:0,n&&0!==n.length)return e(n,this.byteArrayParser).readUint32(this.byteArray,n.dataOffset+4*i)},t.DataSet.prototype.int32=function(t,i){var n=this.elements[t];if(i=void 0!==i?i:0,n&&0!==n.length)return e(n,this.byteArrayParser).readInt32(this.byteArray,n.dataOffset+4*i)},t.DataSet.prototype.float=function(t,i){var n=this.elements[t];if(i=void 0!==i?i:0,n&&0!==n.length)return e(n,this.byteArrayParser).readFloat(this.byteArray,n.dataOffset+4*i)},t.DataSet.prototype.double=function(t,i){var n=this.elements[t];if(i=void 0!==i?i:0,n&&0!==n.length)return e(n,this.byteArrayParser).readDouble(this.byteArray,n.dataOffset+8*i)},t.DataSet.prototype.numStringValues=function(e){var i=this.elements[e];if(i&&i.length>0){var n=t.readFixedString(this.byteArray,i.dataOffset,i.length).match(/\\/g);return null===n?1:n.length+1}},t.DataSet.prototype.string=function(e,i){var n=this.elements[e];if(n&&n.length>0){var r=t.readFixedString(this.byteArray,n.dataOffset,n.length);return i>=0?r.split("\\")[i].trim():r.trim()}},t.DataSet.prototype.text=function(e,i){var n=this.elements[e];if(n&&n.length>0){var r=t.readFixedString(this.byteArray,n.dataOffset,n.length);return i>=0?r.split("\\")[i].replace(/ +$/,""):r.replace(/ +$/,"")}},t.DataSet.prototype.floatString=function(t,e){var i=this.elements[t];if(i&&i.length>0){e=void 0!==e?e:0;var n=this.string(t,e);if(void 0!==n)return parseFloat(n)}},t.DataSet.prototype.intString=function(t,e){var i=this.elements[t];if(i&&i.length>0){e=void 0!==e?e:0;var n=this.string(t,e);if(void 0!==n)return parseInt(n)}},t}(e=function(t){"use strict";return void 0===t&&(t={}),t.ByteStream=function(t,e,i){if(void 0===t)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(void 0===e)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(e instanceof Uint8Array==!1&&e instanceof n==!1)throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(i<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(i>=e.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=t,this.byteArray=e,this.position=i||0,this.warnings=[]},t.ByteStream.prototype.seek=function(t){if(this.position+t<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=t},t.ByteStream.prototype.readByteStream=function(e){if(this.position+e>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var i=t.sharedCopy(this.byteArray,this.position,e);return this.position+=e,new t.ByteStream(this.byteArrayParser,i)},t.ByteStream.prototype.readUint16=function(){var t=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,t},t.ByteStream.prototype.readUint32=function(){var t=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,t},t.ByteStream.prototype.readFixedString=function(e){var i=t.readFixedString(this.byteArray,this.position,e);return this.position+=e,i},t}(e=function(t){"use strict";return void 0===t&&(t={}),t.readFixedString=function(t,e,i){if(i<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(e+i>t.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var n,r="",a=0;a<i;a++){if(0===(n=t[e+a]))return e+=i,r;r+=String.fromCharCode(n)}return r},t}(e=function(t){"use strict";return void 0===t&&(t={}),t.bigEndianByteArrayParser={readUint16:function(t,e){if(e<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(e+2>t.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(t[e]<<8)+t[e+1]},readInt16:function(t,e){if(e<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(e+2>t.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";var i=(t[e]<<8)+t[e+1];return 32768&i&&(i=i-65535-1),i},readUint32:function(t,e){if(e<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(e+4>t.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*t[e]+t[e+1])+t[e+2])+t[e+3]},readInt32:function(t,e){if(e<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(e+4>t.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return(t[e]<<24)+(t[e+1]<<16)+(t[e+2]<<8)+t[e+3]},readFloat:function(t,e){if(e<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(e+4>t.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var i=new Uint8Array(4);return i[3]=t[e],i[2]=t[e+1],i[1]=t[e+2],i[0]=t[e+3],new Float32Array(i.buffer)[0]},readDouble:function(t,e){if(e<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(e+8>t.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var i=new Uint8Array(8);return i[7]=t[e],i[6]=t[e+1],i[5]=t[e+2],i[4]=t[e+3],i[3]=t[e+4],i[2]=t[e+5],i[1]=t[e+6],i[0]=t[e+7],new Float64Array(i.buffer)[0]}},t}(e=function(t){"use strict";return void 0===t&&(t={}),t.alloc=function(t,e){if(void 0!==n&&t instanceof n)return n.alloc(e);if(t instanceof Uint8Array)return new Uint8Array(e);throw"dicomParser.alloc: unknown type for byteArray"},t}(e=function(t){"use strict";void 0===t&&(t={});var e=!1;return t.readEncapsulatedPixelData=function(i,n,r){if(e||(e=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),void 0===i)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(void 0===n)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(void 0===r)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if("x7fe00010"!==n.tag)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010'";if(!0!==n.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(!0!==n.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===n.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===n.fragments)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(r<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return 0!==n.basicOffsetTable.length?t.readEncapsulatedImageFrame(i,n,r):t.readEncapsulatedPixelDataFromFragments(i,n,0,n.fragments.length)},t}(e=function(t){"use strict";void 0===t&&(t={});var e={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0};return t.isStringVr=function(t){return e[t]},t.isPrivateTag=function(t){return parseInt(t[4])%2==1},t.parsePN=function(t){if(void 0!==t){var e=t.split("^");return{familyName:e[0],givenName:e[1],middleName:e[2],prefix:e[3],suffix:e[4]}}},t}(e=function(t){"use strict";return void 0===t&&(t={}),t.parseTM=function(t,e){if(t.length>=2){var i=parseInt(t.substring(0,2),10),n=t.length>=4?parseInt(t.substring(2,4),10):void 0,r=t.length>=6?parseInt(t.substring(4,6),10):void 0,a=t.length>=8?parseInt(t.substring(7,13),10):void 0;if(e&&(isNaN(i)||void 0!==n&&isNaN(n)||void 0!==r&&isNaN(r)||void 0!==a&&isNaN(a)||i<0||i>23||n&&(n<0||n>59)||r&&(r<0||r>59)||a&&(a<0||a>999999)))throw"invalid TM '"+t+"'";return{hours:i,minutes:n,seconds:r,fractionalSeconds:a}}if(e)throw"invalid TM '"+t+"'"},t}(e=function(t){"use strict";return void 0===t&&(t={}),t.parseDA=function(t,e){if(t&&8===t.length){var i=parseInt(t.substring(0,4),10),n=parseInt(t.substring(4,6),10),r=parseInt(t.substring(6,8),10);if(e&&!0!=(a=r,s=n,o=i,!isNaN(o)&&s>0&&s<=12&&a>0&&a<=function(t,e){switch(t){case 2:return e%4==0&&e%100||e%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}(s,o)))throw"invalid DA '"+t+"'";return{year:i,month:n,day:r}}var a,s,o;if(e)throw"invalid DA '"+t+"'"},t}(e=function(t){"use strict";return void 0===t&&(t={}),t.explicitElementToString=function(e,i){if(void 0===e||void 0===i)throw"dicomParser.explicitElementToString: missing required parameters";if(void 0===i.vr)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var n,r=i.vr,a=i.tag;function s(t,i){for(var n="",r=0;r<t;r++)0!==r&&(n+="/"),n+=i.call(e,a,r).toString();return n}if(!0===t.isStringVr(r))n=e.string(a);else{if("AT"==r){var o=e.uint32(a);if(void 0===o)return;return o<0&&(o=4294967295+o+1),"x"+o.toString(16).toUpperCase()}"US"==r?n=s(i.length/2,e.uint16):"SS"===r?n=s(i.length/2,e.int16):"UL"==r?n=s(i.length/4,e.uint32):"SL"===r?n=s(i.length/4,e.int32):"FD"==r?n=s(i.length/8,e.double):"FL"==r&&(n=s(i.length/4,e.float))}return n},t}(e=function(t){"use strict";return void 0===t&&(t={}),t.explicitDataSetToJS=function(e,i){if(void 0===e)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";i=i||{omitPrivateAttibutes:!0,maxElementLength:128};var n={};for(var r in e.elements){var a=e.elements[r];if(!0!==i.omitPrivateAttibutes||!t.isPrivateTag(r))if(a.items){for(var s=[],o=0;o<a.items.length;o++)s.push(t.explicitDataSetToJS(a.items[o].dataSet,i));n[r]=s}else{var l;l=void 0,a.length<i.maxElementLength&&(l=t.explicitElementToString(e,a)),n[r]=void 0!==l?l:{dataOffset:a.dataOffset,length:a.length}}}return n},t}(e=function(t){"use strict";function e(t,e){return 255===t.byteArray[e]&&217===t.byteArray[e+1]}function i(t,i,n){var r=i.fragments[n];return!(!e(t,r.position+r.length-2)&&!e(t,r.position+r.length-3))}function n(t,e,n){for(var r=n;r<e.fragments.length;r++)if(i(t,e,r))return r}return void 0===t&&(t={}),t.createJPEGBasicOffsetTable=function(t,e,i){if(void 0===t)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(void 0===e)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if("x7fe00010"!==e.tag)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(!0!==e.encapsulatedPixelData)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==e.hadUndefinedLength)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===e.basicOffsetTable)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(void 0===e.fragments)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(e.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(i&&i.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";i=i||e.fragments;for(var r=[],a=0;;){r.push(e.fragments[a].offset);var s=n(t,e,a);if(void 0===s||s===e.fragments.length-1)return r;a=s+1}},t}(e=function(e){return void 0===e&&(e={}),e.parseDicom=function(n,r){if(void 0===n)throw"dicomParser.parseDicom: missing required parameter 'byteArray'";function a(a){var s=function(t){if(void 0===t.elements.x00020010)throw"dicomParser.parseDicom: missing required meta header attribute 0002,0010";var i=t.elements.x00020010;return e.readFixedString(n,i.dataOffset,i.length)}(a),o=function(t){return"1.2.840.10008.1.2"!==t}(s),l=function(a,s){if("1.2.840.10008.1.2.1.99"===a){if(r&&r.inflater){var o=r.inflater(n,s);return new e.ByteStream(e.littleEndianByteArrayParser,o,0)}if(void 0!==t&&this.module!==t){var l=i("/2yO"),h=e.sharedCopy(n,s,n.length-s),c=l.inflateRawSync(h),u=e.alloc(n,c.length+s);return n.copy(u,0,0,s),c.copy(u,s),new e.ByteStream(e.littleEndianByteArrayParser,u,0)}if("undefined"!=typeof pako){var d=n.slice(s),f=pako.inflateRaw(d),p=e.alloc(n,f.length+s);return p.set(n.slice(0,s),0),p.set(f,s),new e.ByteStream(e.littleEndianByteArrayParser,p,0)}throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax"}return"1.2.840.10008.1.2.2"===a?new e.ByteStream(e.bigEndianByteArrayParser,n,s):new e.ByteStream(e.littleEndianByteArrayParser,n,s)}(s,a.position),h=new e.DataSet(l.byteArrayParser,l.byteArray,{});h.warnings=l.warnings;try{o?e.parseDicomDataSetExplicit(h,l,l.byteArray.length,r):e.parseDicomDataSetImplicit(h,l,l.byteArray.length,r)}catch(t){throw{exception:t,dataSet:h}}return h}return function(t,e){for(var i in t.elements)t.elements.hasOwnProperty(i)&&(e.elements[i]=t.elements[i]);return void 0!==t.warnings&&(e.warnings=t.warnings.concat(e.warnings)),e}(s=e.readPart10Header(n,r),a(s));var s},e}(e)))))))))))))))))))))))))))))},void 0!==t&&t.exports?t.exports=o():(a=[],void 0===(s="function"==typeof(r=o)?r.apply(e,a):r)||(t.exports=s))}).call(e,i("3IRH")(t),i("EuP9").Buffer)},"63tJ":function(t,e,i){"use strict";var n=i("lKw5"),r=i("K+Sl"),a=i("nhZT"),s=i("+kkw"),o=i("ds5T"),l=i("7+2i"),h=i("EOWi"),c=i("fxPE"),u=i("sv+W"),d=127;t.exports=function(t){var e,i,f,p,m,g,v;if(i=t<0||1/t===r?"1":"0",t===n||t===r)return i+(p=h("1",8))+(f=h("0",23));if(t!=t)return i+(p=h("1",8))+(f="1"+h("0",22));if(0===t)return i+(p=h("0",8))+(f=h("0",23));if(g=(t=a(t))-(m=s(t)),m=c(m),g=u(g),m)p=m.length-1;else{for(v=0;v<g.length;v++)if("1"===g[v]){e=v+1;break}p=-e}return f=m+g,p<0?(p<=-d&&(e=d-1),f=f.substring(e)):f=f.substring(1),p=c(p+d),i+(p=l(p,8,"0"))+(f=o(f,23,"0").substring(0,23))}},"6Rxh":function(t,e,i){"use strict";var n=i("x+d4"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],s=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(t,e,i,l,h,c,u,d){var f,p,m,g,v,_,y,b,x,w=d.bits,E=0,S=0,T=0,M=0,A=0,I=0,C=0,P=0,R=0,L=0,D=null,k=0,O=new n.Buf16(16),N=new n.Buf16(16),U=null,F=0;for(E=0;E<=15;E++)O[E]=0;for(S=0;S<l;S++)O[e[i+S]]++;for(A=w,M=15;M>=1&&0===O[M];M--);if(A>M&&(A=M),0===M)return h[c++]=20971520,h[c++]=20971520,d.bits=1,0;for(T=1;T<M&&0===O[T];T++);for(A<T&&(A=T),P=1,E=1;E<=15;E++)if(P<<=1,(P-=O[E])<0)return-1;if(P>0&&(0===t||1!==M))return-1;for(N[1]=0,E=1;E<15;E++)N[E+1]=N[E]+O[E];for(S=0;S<l;S++)0!==e[i+S]&&(u[N[e[i+S]]++]=S);if(0===t?(D=U=u,_=19):1===t?(D=r,k-=257,U=a,F-=257,_=256):(D=s,U=o,_=-1),L=0,S=0,E=T,v=c,I=A,C=0,m=-1,g=(R=1<<A)-1,1===t&&R>852||2===t&&R>592)return 1;for(;;){0,y=E-C,u[S]<_?(b=0,x=u[S]):u[S]>_?(b=U[F+u[S]],x=D[k+u[S]]):(b=96,x=0),f=1<<E-C,T=p=1<<I;do{h[v+(L>>C)+(p-=f)]=y<<24|b<<16|x|0}while(0!==p);for(f=1<<E-1;L&f;)f>>=1;if(0!==f?(L&=f-1,L+=f):L=0,S++,0==--O[E]){if(E===M)break;E=e[i+u[S]]}if(E>A&&(L&g)!==m){for(0===C&&(C=A),v+=T,P=1<<(I=E-C);I+C<M&&!((P-=O[I+C])<=0);)I++,P<<=1;if(R+=1<<I,1===t&&R>852||2===t&&R>592)return 1;h[m=L&g]=A<<24|I<<16|v-c|0}}return 0!==L&&(h[v+L]=E-C<<24|64<<16|0),d.bits=A,0}},"6akE":function(t,e,i){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},"6iCK":function(t,e,i){"use strict";var n=i("3v+v");t.exports=function(t){return n(t)&&t%1==0}},"6ktE":function(t,e,i){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},"7+2i":function(t,e,i){"use strict";var n=i("GA34"),r=i("eBA+"),a=i("Ul2F"),s=i("EOWi"),o=9007199254740991;t.exports=function(t,e,i){var l,h;if(!n(t))throw new TypeError("invalid input argument. First argument must be a string. Value: `"+t+"`.");if(!r(e))throw new TypeError("invalid input argument. Second argument must be a nonnegative integer. Value: `"+e+"`.");if(arguments.length>2){if(!n(h=i))throw new TypeError("invalid input argument. Third argument must be a string. Value: `"+h+"`.");if(0===h.length)throw new RangeError("invalid input argument. Pad string must not be an empty string.")}else h=" ";if(e>o)throw new RangeError("invalid input argument. Output string length exceeds maximum allowed string length.");return(l=(e-t.length)/h.length)<=0?t:(l=a(l),s(h,l)+t)}},"7dSG":function(t,e,i){"use strict";(function(e,n){var r=i("ypnx");function a(t){var e=this;this.next=null,this.entry=null,this.finish=function(){!function(t,e,i){var n=t.entry;t.entry=null;for(;n;){var r=n.callback;e.pendingcb--,r(i),n=n.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}(e,t)}}t.exports=v;var s,o=!e.browser&&["v0.10","v0.9."].indexOf(e.version.slice(0,5))>-1?setImmediate:r.nextTick;v.WritableState=g;var l=Object.create(i("jOgh"));l.inherits=i("LC74");var h={deprecate:i("iP15")},c=i("UcPO"),u=i("kkc6").Buffer,d=n.Uint8Array||function(){};var f,p=i("x0Ha");function m(){}function g(t,e){s=s||i("DsFX"),t=t||{};var n=e instanceof s;this.objectMode=!!t.objectMode,n&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var l=t.highWaterMark,h=t.writableHighWaterMark,c=this.objectMode?16:16384;this.highWaterMark=l||0===l?l:n&&(h||0===h)?h:c,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var u=!1===t.decodeStrings;this.decodeStrings=!u,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function(t,e){var i=t._writableState,n=i.sync,a=i.writecb;if(function(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(i),e)!function(t,e,i,n,a){--e.pendingcb,i?(r.nextTick(a,n),r.nextTick(E,t,e),t._writableState.errorEmitted=!0,t.emit("error",n)):(a(n),t._writableState.errorEmitted=!0,t.emit("error",n),E(t,e))}(t,i,n,e,a);else{var s=x(i);s||i.corked||i.bufferProcessing||!i.bufferedRequest||b(t,i),n?o(y,t,i,s,a):y(t,i,s,a)}}(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new a(this)}function v(t){if(s=s||i("DsFX"),!(f.call(v,this)||this instanceof s))return new v(t);this._writableState=new g(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),c.call(this)}function _(t,e,i,n,r,a,s){e.writelen=n,e.writecb=s,e.writing=!0,e.sync=!0,i?t._writev(r,e.onwrite):t._write(r,a,e.onwrite),e.sync=!1}function y(t,e,i,n){i||function(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}(t,e),e.pendingcb--,n(),E(t,e)}function b(t,e){e.bufferProcessing=!0;var i=e.bufferedRequest;if(t._writev&&i&&i.next){var n=e.bufferedRequestCount,r=new Array(n),s=e.corkedRequestsFree;s.entry=i;for(var o=0,l=!0;i;)r[o]=i,i.isBuf||(l=!1),i=i.next,o+=1;r.allBuffers=l,_(t,e,!0,e.length,r,"",s.finish),e.pendingcb++,e.lastBufferedRequest=null,s.next?(e.corkedRequestsFree=s.next,s.next=null):e.corkedRequestsFree=new a(e),e.bufferedRequestCount=0}else{for(;i;){var h=i.chunk,c=i.encoding,u=i.callback;if(_(t,e,!1,e.objectMode?1:h.length,h,c,u),i=i.next,e.bufferedRequestCount--,e.writing)break}null===i&&(e.lastBufferedRequest=null)}e.bufferedRequest=i,e.bufferProcessing=!1}function x(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function w(t,e){t._final(function(i){e.pendingcb--,i&&t.emit("error",i),e.prefinished=!0,t.emit("prefinish"),E(t,e)})}function E(t,e){var i=x(e);return i&&(!function(t,e){e.prefinished||e.finalCalled||("function"==typeof t._final?(e.pendingcb++,e.finalCalled=!0,r.nextTick(w,t,e)):(e.prefinished=!0,t.emit("prefinish")))}(t,e),0===e.pendingcb&&(e.finished=!0,t.emit("finish"))),i}l.inherits(v,c),g.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(g.prototype,"buffer",{get:h.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(f=Function.prototype[Symbol.hasInstance],Object.defineProperty(v,Symbol.hasInstance,{value:function(t){return!!f.call(this,t)||this===v&&(t&&t._writableState instanceof g)}})):f=function(t){return t instanceof this},v.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},v.prototype.write=function(t,e,i){var n,a=this._writableState,s=!1,o=!a.objectMode&&(n=t,u.isBuffer(n)||n instanceof d);return o&&!u.isBuffer(t)&&(t=function(t){return u.from(t)}(t)),"function"==typeof e&&(i=e,e=null),o?e="buffer":e||(e=a.defaultEncoding),"function"!=typeof i&&(i=m),a.ended?function(t,e){var i=new Error("write after end");t.emit("error",i),r.nextTick(e,i)}(this,i):(o||function(t,e,i,n){var a=!0,s=!1;return null===i?s=new TypeError("May not write null values to stream"):"string"==typeof i||void 0===i||e.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(t.emit("error",s),r.nextTick(n,s),a=!1),a}(this,a,t,i))&&(a.pendingcb++,s=function(t,e,i,n,r,a){if(!i){var s=function(t,e,i){t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=u.from(e,i));return e}(e,n,r);n!==s&&(i=!0,r="buffer",n=s)}var o=e.objectMode?1:n.length;e.length+=o;var l=e.length<e.highWaterMark;l||(e.needDrain=!0);if(e.writing||e.corked){var h=e.lastBufferedRequest;e.lastBufferedRequest={chunk:n,encoding:r,isBuf:i,callback:a,next:null},h?h.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else _(t,e,!1,o,n,r,a);return l}(this,a,o,t,e,i)),s},v.prototype.cork=function(){this._writableState.corked++},v.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||b(this,t))},v.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(v.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),v.prototype._write=function(t,e,i){i(new Error("_write() is not implemented"))},v.prototype._writev=null,v.prototype.end=function(t,e,i){var n=this._writableState;"function"==typeof t?(i=t,t=null,e=null):"function"==typeof e&&(i=e,e=null),null!==t&&void 0!==t&&this.write(t,e),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function(t,e,i){e.ending=!0,E(t,e),i&&(e.finished?r.nextTick(i):t.once("finish",i));e.ended=!0,t.writable=!1}(this,n,i)},Object.defineProperty(v.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),v.prototype.destroy=p.destroy,v.prototype._undestroy=p.undestroy,v.prototype._destroy=function(t,e){this.end(),e(t)}}).call(e,i("W2nU"),i("DuR2"))},"87vf":function(t,e,i){t.exports=i("7dSG")},"9DG0":function(t,e,i){t.exports=r;var n=i("vzCy").EventEmitter;function r(){n.call(this)}i("LC74")(r,n),r.Readable=i("cSWu"),r.Writable=i("87vf"),r.Duplex=i("SDM6"),r.Transform=i("4/4u"),r.PassThrough=i("/MLu"),r.Stream=r,r.prototype.pipe=function(t,e){var i=this;function r(e){t.writable&&!1===t.write(e)&&i.pause&&i.pause()}function a(){i.readable&&i.resume&&i.resume()}i.on("data",r),t.on("drain",a),t._isStdio||e&&!1===e.end||(i.on("end",o),i.on("close",l));var s=!1;function o(){s||(s=!0,t.end())}function l(){s||(s=!0,"function"==typeof t.destroy&&t.destroy())}function h(t){if(c(),0===n.listenerCount(this,"error"))throw t}function c(){i.removeListener("data",r),t.removeListener("drain",a),i.removeListener("end",o),i.removeListener("close",l),i.removeListener("error",h),t.removeListener("error",h),i.removeListener("end",c),i.removeListener("close",c),t.removeListener("close",c)}return i.on("error",h),t.on("error",h),i.on("end",c),i.on("close",c),t.on("close",c),t.emit("pipe",i),t}},Aabw:function(t,e,i){"use strict";var n=i("x+d4"),r=4,a=0,s=1,o=2;function l(t){for(var e=t.length;--e>=0;)t[e]=0}var h=0,c=1,u=2,d=29,f=256,p=f+1+d,m=30,g=19,v=2*p+1,_=15,y=16,b=7,x=256,w=16,E=17,S=18,T=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],I=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],C=new Array(2*(p+2));l(C);var P=new Array(2*m);l(P);var R=new Array(512);l(R);var L=new Array(256);l(L);var D=new Array(d);l(D);var k,O,N,U=new Array(m);function F(t,e,i,n,r){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=n,this.max_length=r,this.has_stree=t&&t.length}function B(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function z(t){return t<256?R[t]:R[256+(t>>>7)]}function H(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function G(t,e,i){t.bi_valid>y-i?(t.bi_buf|=e<<t.bi_valid&65535,H(t,t.bi_buf),t.bi_buf=e>>y-t.bi_valid,t.bi_valid+=i-y):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)}function j(t,e,i){G(t,i[2*e],i[2*e+1])}function V(t,e){var i=0;do{i|=1&t,t>>>=1,i<<=1}while(--e>0);return i>>>1}function W(t,e,i){var n,r,a=new Array(_+1),s=0;for(n=1;n<=_;n++)a[n]=s=s+i[n-1]<<1;for(r=0;r<=e;r++){var o=t[2*r+1];0!==o&&(t[2*r]=V(a[o]++,o))}}function q(t){var e;for(e=0;e<p;e++)t.dyn_ltree[2*e]=0;for(e=0;e<m;e++)t.dyn_dtree[2*e]=0;for(e=0;e<g;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*x]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function X(t){t.bi_valid>8?H(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function Y(t,e,i,n){var r=2*e,a=2*i;return t[r]<t[a]||t[r]===t[a]&&n[e]<=n[i]}function Z(t,e,i){for(var n=t.heap[i],r=i<<1;r<=t.heap_len&&(r<t.heap_len&&Y(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!Y(e,n,t.heap[r],t.depth));)t.heap[i]=t.heap[r],i=r,r<<=1;t.heap[i]=n}function J(t,e,i){var n,r,a,s,o=0;if(0!==t.last_lit)do{n=t.pending_buf[t.d_buf+2*o]<<8|t.pending_buf[t.d_buf+2*o+1],r=t.pending_buf[t.l_buf+o],o++,0===n?j(t,r,e):(j(t,(a=L[r])+f+1,e),0!==(s=T[a])&&G(t,r-=D[a],s),j(t,a=z(--n),i),0!==(s=M[a])&&G(t,n-=U[a],s))}while(o<t.last_lit);j(t,x,e)}function K(t,e){var i,n,r,a=e.dyn_tree,s=e.stat_desc.static_tree,o=e.stat_desc.has_stree,l=e.stat_desc.elems,h=-1;for(t.heap_len=0,t.heap_max=v,i=0;i<l;i++)0!==a[2*i]?(t.heap[++t.heap_len]=h=i,t.depth[i]=0):a[2*i+1]=0;for(;t.heap_len<2;)a[2*(r=t.heap[++t.heap_len]=h<2?++h:0)]=1,t.depth[r]=0,t.opt_len--,o&&(t.static_len-=s[2*r+1]);for(e.max_code=h,i=t.heap_len>>1;i>=1;i--)Z(t,a,i);r=l;do{i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Z(t,a,1),n=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=n,a[2*r]=a[2*i]+a[2*n],t.depth[r]=(t.depth[i]>=t.depth[n]?t.depth[i]:t.depth[n])+1,a[2*i+1]=a[2*n+1]=r,t.heap[1]=r++,Z(t,a,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var i,n,r,a,s,o,l=e.dyn_tree,h=e.max_code,c=e.stat_desc.static_tree,u=e.stat_desc.has_stree,d=e.stat_desc.extra_bits,f=e.stat_desc.extra_base,p=e.stat_desc.max_length,m=0;for(a=0;a<=_;a++)t.bl_count[a]=0;for(l[2*t.heap[t.heap_max]+1]=0,i=t.heap_max+1;i<v;i++)(a=l[2*l[2*(n=t.heap[i])+1]+1]+1)>p&&(a=p,m++),l[2*n+1]=a,n>h||(t.bl_count[a]++,s=0,n>=f&&(s=d[n-f]),o=l[2*n],t.opt_len+=o*(a+s),u&&(t.static_len+=o*(c[2*n+1]+s)));if(0!==m){do{for(a=p-1;0===t.bl_count[a];)a--;t.bl_count[a]--,t.bl_count[a+1]+=2,t.bl_count[p]--,m-=2}while(m>0);for(a=p;0!==a;a--)for(n=t.bl_count[a];0!==n;)(r=t.heap[--i])>h||(l[2*r+1]!==a&&(t.opt_len+=(a-l[2*r+1])*l[2*r],l[2*r+1]=a),n--)}}(t,e),W(a,h,t.bl_count)}function Q(t,e,i){var n,r,a=-1,s=e[1],o=0,l=7,h=4;for(0===s&&(l=138,h=3),e[2*(i+1)+1]=65535,n=0;n<=i;n++)r=s,s=e[2*(n+1)+1],++o<l&&r===s||(o<h?t.bl_tree[2*r]+=o:0!==r?(r!==a&&t.bl_tree[2*r]++,t.bl_tree[2*w]++):o<=10?t.bl_tree[2*E]++:t.bl_tree[2*S]++,o=0,a=r,0===s?(l=138,h=3):r===s?(l=6,h=3):(l=7,h=4))}function $(t,e,i){var n,r,a=-1,s=e[1],o=0,l=7,h=4;for(0===s&&(l=138,h=3),n=0;n<=i;n++)if(r=s,s=e[2*(n+1)+1],!(++o<l&&r===s)){if(o<h)do{j(t,r,t.bl_tree)}while(0!=--o);else 0!==r?(r!==a&&(j(t,r,t.bl_tree),o--),j(t,w,t.bl_tree),G(t,o-3,2)):o<=10?(j(t,E,t.bl_tree),G(t,o-3,3)):(j(t,S,t.bl_tree),G(t,o-11,7));o=0,a=r,0===s?(l=138,h=3):r===s?(l=6,h=3):(l=7,h=4)}}l(U);var tt=!1;function et(t,e,i,r){G(t,(h<<1)+(r?1:0),3),function(t,e,i,r){X(t),r&&(H(t,i),H(t,~i)),n.arraySet(t.pending_buf,t.window,e,i,t.pending),t.pending+=i}(t,e,i,!0)}e._tr_init=function(t){tt||(function(){var t,e,i,n,r,a=new Array(_+1);for(i=0,n=0;n<d-1;n++)for(D[n]=i,t=0;t<1<<T[n];t++)L[i++]=n;for(L[i-1]=n,r=0,n=0;n<16;n++)for(U[n]=r,t=0;t<1<<M[n];t++)R[r++]=n;for(r>>=7;n<m;n++)for(U[n]=r<<7,t=0;t<1<<M[n]-7;t++)R[256+r++]=n;for(e=0;e<=_;e++)a[e]=0;for(t=0;t<=143;)C[2*t+1]=8,t++,a[8]++;for(;t<=255;)C[2*t+1]=9,t++,a[9]++;for(;t<=279;)C[2*t+1]=7,t++,a[7]++;for(;t<=287;)C[2*t+1]=8,t++,a[8]++;for(W(C,p+1,a),t=0;t<m;t++)P[2*t+1]=5,P[2*t]=V(t,5);k=new F(C,T,f+1,p,_),O=new F(P,M,0,m,_),N=new F(new Array(0),A,0,g,b)}(),tt=!0),t.l_desc=new B(t.dyn_ltree,k),t.d_desc=new B(t.dyn_dtree,O),t.bl_desc=new B(t.bl_tree,N),t.bi_buf=0,t.bi_valid=0,q(t)},e._tr_stored_block=et,e._tr_flush_block=function(t,e,i,n){var l,h,d=0;t.level>0?(t.strm.data_type===o&&(t.strm.data_type=function(t){var e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return a;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return s;for(e=32;e<f;e++)if(0!==t.dyn_ltree[2*e])return s;return a}(t)),K(t,t.l_desc),K(t,t.d_desc),d=function(t){var e;for(Q(t,t.dyn_ltree,t.l_desc.max_code),Q(t,t.dyn_dtree,t.d_desc.max_code),K(t,t.bl_desc),e=g-1;e>=3&&0===t.bl_tree[2*I[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),l=t.opt_len+3+7>>>3,(h=t.static_len+3+7>>>3)<=l&&(l=h)):l=h=i+5,i+4<=l&&-1!==e?et(t,e,i,n):t.strategy===r||h===l?(G(t,(c<<1)+(n?1:0),3),J(t,C,P)):(G(t,(u<<1)+(n?1:0),3),function(t,e,i,n){var r;for(G(t,e-257,5),G(t,i-1,5),G(t,n-4,4),r=0;r<n;r++)G(t,t.bl_tree[2*I[r]+1],3);$(t,t.dyn_ltree,e-1),$(t,t.dyn_dtree,i-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,d+1),J(t,t.dyn_ltree,t.dyn_dtree)),q(t),n&&X(t)},e._tr_tally=function(t,e,i){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(L[i]+f+1)]++,t.dyn_dtree[2*z(e)]++),t.last_lit===t.lit_bufsize-1},e._tr_align=function(t){G(t,c<<1,3),j(t,x,C),function(t){16===t.bi_valid?(H(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},BEQ0:function(t,e,i){"use strict";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var n=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},i=0;i<10;i++)e["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(t){n[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var i,s,o=function(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),l=1;l<arguments.length;l++){for(var h in i=Object(arguments[l]))r.call(i,h)&&(o[h]=i[h]);if(n){s=n(i);for(var c=0;c<s.length;c++)a.call(i,s[c])&&(o[s[c]]=i[s[c]])}}return o}},BYXA:function(t,e,i){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.DataStream=n.lossless.DataStream||i("NuSx"),n.lossless.Utils=n.lossless.Utils||i("Ixlh"),n.lossless.QuantizationTable=n.lossless.QuantizationTable||function(){this.precision=[],this.tq=[],this.quantTables=n.lossless.Utils.createArray(4,64),this.tq[0]=0,this.tq[1]=0,this.tq[2]=0,this.tq[3]=0},n.lossless.QuantizationTable.enhanceQuantizationTable=function(t,e){var i;for(i=0;i<8;i+=1)t[e[0+i]]*=90,t[e[32+i]]*=90,t[e[16+i]]*=118,t[e[48+i]]*=49,t[e[40+i]]*=71,t[e[8+i]]*=126,t[e[56+i]]*=25,t[e[24+i]]*=106;for(i=0;i<8;i+=1)t[e[0+8*i]]*=90,t[e[4+8*i]]*=90,t[e[2+8*i]]*=118,t[e[6+8*i]]*=49,t[e[5+8*i]]*=71,t[e[1+8*i]]*=126,t[e[7+8*i]]*=25,t[e[3+8*i]]*=106;for(i=0;i<64;i+=1)t[i]>>=6},n.lossless.QuantizationTable.prototype.read=function(t,e){var i,r,a,s,o=0;for(i=t.get16(),o+=2;o<i;){if(o+=1,(a=15&(r=t.get8()))>3)throw new Error("ERROR: Quantization table ID > 3");if(this.precision[a]=r>>4,0===this.precision[a])this.precision[a]=8;else{if(1!==this.precision[a])throw new Error("ERROR: Quantization table precision error");this.precision[a]=16}if(this.tq[a]=1,8===this.precision[a]){for(s=0;s<64;s+=1){if(o>i)throw new Error("ERROR: Quantization table format error");this.quantTables[a][s]=t.get8(),o+=1}n.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[a],e)}else{for(s=0;s<64;s+=1){if(o>i)throw new Error("ERROR: Quantization table format error");this.quantTables[a][s]=t.get16(),o+=2}n.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[a],e)}}if(o!==i)throw new Error("ERROR: Quantization table error [count!=Lq]");return 1},"undefined"!==typeof t&&t.exports&&(t.exports=n.lossless.QuantizationTable)},D1Va:function(t,e,i){"use strict";t.exports=a;var n=i("DsFX"),r=Object.create(i("jOgh"));function a(t){if(!(this instanceof a))return new a(t);n.call(this,t),this._transformState={afterTransform:function(t,e){var i=this._transformState;i.transforming=!1;var n=i.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));i.writechunk=null,i.writecb=null,null!=e&&this.push(e),n(t);var r=this._readableState;r.reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",s)}function s(){var t=this;"function"==typeof this._flush?this._flush(function(e,i){o(t,e,i)}):o(this,null,null)}function o(t,e,i){if(e)return t.emit("error",e);if(null!=i&&t.push(i),t._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(t._transformState.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}r.inherits=i("LC74"),r.inherits(a,n),a.prototype.push=function(t,e){return this._transformState.needTransform=!1,n.prototype.push.call(this,t,e)},a.prototype._transform=function(t,e,i){throw new Error("_transform() is not implemented")},a.prototype._write=function(t,e,i){var n=this._transformState;if(n.writecb=i,n.writechunk=t,n.writeencoding=e,!n.transforming){var r=this._readableState;(n.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},a.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},a.prototype._destroy=function(t,e){var i=this;n.prototype._destroy.call(this,t,function(t){e(t),i.emit("close")})}},DsFX:function(t,e,i){"use strict";var n=i("ypnx"),r=Object.keys||function(t){var e=[];for(var i in t)e.push(i);return e};t.exports=u;var a=Object.create(i("jOgh"));a.inherits=i("LC74");var s=i("Rt1F"),o=i("7dSG");a.inherits(u,s);for(var l=r(o.prototype),h=0;h<l.length;h++){var c=l[h];u.prototype[c]||(u.prototype[c]=o.prototype[c])}function u(t){if(!(this instanceof u))return new u(t);s.call(this,t),o.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d)}function d(){this.allowHalfOpen||this._writableState.ended||n.nextTick(f,this)}function f(t){t.end()}Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}),u.prototype._destroy=function(t,e){this.push(null),this.end(),n.nextTick(e,t)}},EKta:function(t,e,i){"use strict";e.byteLength=function(t){var e=h(t),i=e[0],n=e[1];return 3*(i+n)/4-n},e.toByteArray=function(t){var e,i,n=h(t),s=n[0],o=n[1],l=new a(function(t,e,i){return 3*(e+i)/4-i}(0,s,o)),c=0,u=o>0?s-4:s;for(i=0;i<u;i+=4)e=r[t.charCodeAt(i)]<<18|r[t.charCodeAt(i+1)]<<12|r[t.charCodeAt(i+2)]<<6|r[t.charCodeAt(i+3)],l[c++]=e>>16&255,l[c++]=e>>8&255,l[c++]=255&e;2===o&&(e=r[t.charCodeAt(i)]<<2|r[t.charCodeAt(i+1)]>>4,l[c++]=255&e);1===o&&(e=r[t.charCodeAt(i)]<<10|r[t.charCodeAt(i+1)]<<4|r[t.charCodeAt(i+2)]>>2,l[c++]=e>>8&255,l[c++]=255&e);return l},e.fromByteArray=function(t){for(var e,i=t.length,r=i%3,a=[],s=0,o=i-r;s<o;s+=16383)a.push(c(t,s,s+16383>o?o:s+16383));1===r?(e=t[i-1],a.push(n[e>>2]+n[e<<4&63]+"==")):2===r&&(e=(t[i-2]<<8)+t[i-1],a.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"="));return a.join("")};for(var n=[],r=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,l=s.length;o<l;++o)n[o]=s[o],r[s.charCodeAt(o)]=o;function h(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=t.indexOf("=");return-1===i&&(i=e),[i,i===e?0:4-i%4]}function c(t,e,i){for(var r,a,s=[],o=e;o<i;o+=3)r=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]),s.push(n[(a=r)>>18&63]+n[a>>12&63]+n[a>>6&63]+n[63&a]);return s.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},EOWi:function(t,e,i){"use strict";var n=i("GA34"),r=i("eBA+"),a=9007199254740991;t.exports=function(t,e){var i,s;if(!n(t))throw new TypeError("invalid input argument. First argument must be a string. Value: `"+t+"`.");if(!r(e))throw new TypeError("invalid input argument. Second argument must be a nonnegative integer. Value: `"+e+"`.");if(0===t.length||0===e)return"";if(t.length*e>a)throw new RangeError("invalid input argument. Output string length exceeds maximum allowed string length.");for(i="",s=e;1==(1&s)&&(i+=t),0!=(s>>>=1);)t+=t;return i}},EQyj:function(t,e,i){"use strict";(function(t,n){var r=i("N+Om"),a=i("h95s"),s=i("VOug"),o=i("fkix"),l=i("0jOE");for(var h in l)e[h]=l[h];e.NONE=0,e.DEFLATE=1,e.INFLATE=2,e.GZIP=3,e.GUNZIP=4,e.DEFLATERAW=5,e.INFLATERAW=6,e.UNZIP=7;function c(t){if("number"!=typeof t||t<e.DEFLATE||t>e.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=t,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}c.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,r(this.init_done,"close before init"),r(this.mode<=e.UNZIP),this.mode===e.DEFLATE||this.mode===e.GZIP||this.mode===e.DEFLATERAW?s.deflateEnd(this.strm):this.mode!==e.INFLATE&&this.mode!==e.GUNZIP&&this.mode!==e.INFLATERAW&&this.mode!==e.UNZIP||o.inflateEnd(this.strm),this.mode=e.NONE,this.dictionary=null)},c.prototype.write=function(t,e,i,n,r,a,s){return this._write(!0,t,e,i,n,r,a,s)},c.prototype.writeSync=function(t,e,i,n,r,a,s){return this._write(!1,t,e,i,n,r,a,s)},c.prototype._write=function(i,a,s,o,l,h,c,u){if(r.equal(arguments.length,8),r(this.init_done,"write before init"),r(this.mode!==e.NONE,"already finalized"),r.equal(!1,this.write_in_progress,"write already in progress"),r.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,r.equal(!1,void 0===a,"must provide flush value"),this.write_in_progress=!0,a!==e.Z_NO_FLUSH&&a!==e.Z_PARTIAL_FLUSH&&a!==e.Z_SYNC_FLUSH&&a!==e.Z_FULL_FLUSH&&a!==e.Z_FINISH&&a!==e.Z_BLOCK)throw new Error("Invalid flush value");if(null==s&&(s=t.alloc(0),l=0,o=0),this.strm.avail_in=l,this.strm.input=s,this.strm.next_in=o,this.strm.avail_out=u,this.strm.output=h,this.strm.next_out=c,this.flush=a,!i)return this._process(),this._checkError()?this._afterSync():void 0;var d=this;return n.nextTick(function(){d._process(),d._after()}),this},c.prototype._afterSync=function(){var t=this.strm.avail_out,e=this.strm.avail_in;return this.write_in_progress=!1,[e,t]},c.prototype._process=function(){var t=null;switch(this.mode){case e.DEFLATE:case e.GZIP:case e.DEFLATERAW:this.err=s.deflate(this.strm,this.flush);break;case e.UNZIP:switch(this.strm.avail_in>0&&(t=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(null===t)break;if(31!==this.strm.input[t]){this.mode=e.INFLATE;break}if(this.gzip_id_bytes_read=1,t++,1===this.strm.avail_in)break;case 1:if(null===t)break;139===this.strm.input[t]?(this.gzip_id_bytes_read=2,this.mode=e.GUNZIP):this.mode=e.INFLATE;break;default:throw new Error("invalid number of gzip magic number bytes read")}case e.INFLATE:case e.GUNZIP:case e.INFLATERAW:for(this.err=o.inflate(this.strm,this.flush),this.err===e.Z_NEED_DICT&&this.dictionary&&(this.err=o.inflateSetDictionary(this.strm,this.dictionary),this.err===e.Z_OK?this.err=o.inflate(this.strm,this.flush):this.err===e.Z_DATA_ERROR&&(this.err=e.Z_NEED_DICT));this.strm.avail_in>0&&this.mode===e.GUNZIP&&this.err===e.Z_STREAM_END&&0!==this.strm.next_in[0];)this.reset(),this.err=o.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},c.prototype._checkError=function(){switch(this.err){case e.Z_OK:case e.Z_BUF_ERROR:if(0!==this.strm.avail_out&&this.flush===e.Z_FINISH)return this._error("unexpected end of file"),!1;break;case e.Z_STREAM_END:break;case e.Z_NEED_DICT:return null==this.dictionary?this._error("Missing dictionary"):this._error("Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return!0},c.prototype._after=function(){if(this._checkError()){var t=this.strm.avail_out,e=this.strm.avail_in;this.write_in_progress=!1,this.callback(e,t),this.pending_close&&this.close()}},c.prototype._error=function(t){this.strm.msg&&(t=this.strm.msg),this.onerror(t,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},c.prototype.init=function(t,i,n,a,s){r(4===arguments.length||5===arguments.length,"init(windowBits, level, memLevel, strategy, [dictionary])"),r(t>=8&&t<=15,"invalid windowBits"),r(i>=-1&&i<=9,"invalid compression level"),r(n>=1&&n<=9,"invalid memlevel"),r(a===e.Z_FILTERED||a===e.Z_HUFFMAN_ONLY||a===e.Z_RLE||a===e.Z_FIXED||a===e.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(i,t,n,a,s),this._setDictionary()},c.prototype.params=function(){throw new Error("deflateParams Not supported")},c.prototype.reset=function(){this._reset(),this._setDictionary()},c.prototype._init=function(t,i,n,r,l){switch(this.level=t,this.windowBits=i,this.memLevel=n,this.strategy=r,this.flush=e.Z_NO_FLUSH,this.err=e.Z_OK,this.mode!==e.GZIP&&this.mode!==e.GUNZIP||(this.windowBits+=16),this.mode===e.UNZIP&&(this.windowBits+=32),this.mode!==e.DEFLATERAW&&this.mode!==e.INFLATERAW||(this.windowBits=-1*this.windowBits),this.strm=new a,this.mode){case e.DEFLATE:case e.GZIP:case e.DEFLATERAW:this.err=s.deflateInit2(this.strm,this.level,e.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case e.INFLATE:case e.GUNZIP:case e.INFLATERAW:case e.UNZIP:this.err=o.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}this.err!==e.Z_OK&&this._error("Init error"),this.dictionary=l,this.write_in_progress=!1,this.init_done=!0},c.prototype._setDictionary=function(){if(null!=this.dictionary){switch(this.err=e.Z_OK,this.mode){case e.DEFLATE:case e.DEFLATERAW:this.err=s.deflateSetDictionary(this.strm,this.dictionary)}this.err!==e.Z_OK&&this._error("Failed to set dictionary")}},c.prototype._reset=function(){switch(this.err=e.Z_OK,this.mode){case e.DEFLATE:case e.DEFLATERAW:case e.GZIP:this.err=s.deflateReset(this.strm);break;case e.INFLATE:case e.INFLATERAW:case e.GUNZIP:this.err=o.inflateReset(this.strm)}this.err!==e.Z_OK&&this._error("Failed to reset stream")},e.Zlib=c}).call(e,i("EuP9").Buffer,i("W2nU"))},EuP9:function(t,e,i){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var n=i("EKta"),r=i("ujcs"),a=i("sOR5");function s(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(t,e){if(s()<e)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=l.prototype:(null===t&&(t=new l(e)),t.length=e),t}function l(t,e,i){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(t,e,i);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return u(this,t)}return h(this,t,e,i)}function h(t,e,i,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,i,n){if(e.byteLength,i<0||e.byteLength<i)throw new RangeError("'offset' is out of bounds");if(e.byteLength<i+(n||0))throw new RangeError("'length' is out of bounds");e=void 0===i&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,i):new Uint8Array(e,i,n);l.TYPED_ARRAY_SUPPORT?(t=e).__proto__=l.prototype:t=d(t,e);return t}(t,e,i,n):"string"==typeof e?function(t,e,i){"string"==typeof i&&""!==i||(i="utf8");if(!l.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var n=0|p(e,i),r=(t=o(t,n)).write(e,i);r!==n&&(t=t.slice(0,r));return t}(t,e,i):function(t,e){if(l.isBuffer(e)){var i=0|f(e.length);return 0===(t=o(t,i)).length?t:(e.copy(t,0,0,i),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(n=e.length)!=n?o(t,0):d(t,e);if("Buffer"===e.type&&a(e.data))return d(t,e.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function c(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function u(t,e){if(c(e),t=o(t,e<0?0:0|f(e)),!l.TYPED_ARRAY_SUPPORT)for(var i=0;i<e;++i)t[i]=0;return t}function d(t,e){var i=e.length<0?0:0|f(e.length);t=o(t,i);for(var n=0;n<i;n+=1)t[n]=255&e[n];return t}function f(t){if(t>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|t}function p(t,e){if(l.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var i=t.length;if(0===i)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return z(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return H(t).length;default:if(n)return z(t).length;e=(""+e).toLowerCase(),n=!0}}function m(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function g(t,e,i,n,r){if(0===t.length)return-1;if("string"==typeof i?(n=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=r?0:t.length-1),i<0&&(i=t.length+i),i>=t.length){if(r)return-1;i=t.length-1}else if(i<0){if(!r)return-1;i=0}if("string"==typeof e&&(e=l.from(e,n)),l.isBuffer(e))return 0===e.length?-1:v(t,e,i,n,r);if("number"==typeof e)return e&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(t,e,i):Uint8Array.prototype.lastIndexOf.call(t,e,i):v(t,[e],i,n,r);throw new TypeError("val must be string, number or Buffer")}function v(t,e,i,n,r){var a,s=1,o=t.length,l=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;s=2,o/=2,l/=2,i/=2}function h(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(r){var c=-1;for(a=i;a<o;a++)if(h(t,a)===h(e,-1===c?0:a-c)){if(-1===c&&(c=a),a-c+1===l)return c*s}else-1!==c&&(a-=a-c),c=-1}else for(i+l>o&&(i=o-l),a=i;a>=0;a--){for(var u=!0,d=0;d<l;d++)if(h(t,a+d)!==h(e,d)){u=!1;break}if(u)return a}return-1}function _(t,e,i,n){i=Number(i)||0;var r=t.length-i;n?(n=Number(n))>r&&(n=r):n=r;var a=e.length;if(a%2!=0)throw new TypeError("Invalid hex string");n>a/2&&(n=a/2);for(var s=0;s<n;++s){var o=parseInt(e.substr(2*s,2),16);if(isNaN(o))return s;t[i+s]=o}return s}function y(t,e,i,n){return G(z(e,t.length-i),t,i,n)}function b(t,e,i,n){return G(function(t){for(var e=[],i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}(e),t,i,n)}function x(t,e,i,n){return b(t,e,i,n)}function w(t,e,i,n){return G(H(e),t,i,n)}function E(t,e,i,n){return G(function(t,e){for(var i,n,r,a=[],s=0;s<t.length&&!((e-=2)<0);++s)i=t.charCodeAt(s),n=i>>8,r=i%256,a.push(r),a.push(n);return a}(e,t.length-i),t,i,n)}function S(t,e,i){return 0===e&&i===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,i))}function T(t,e,i){i=Math.min(t.length,i);for(var n=[],r=e;r<i;){var a,s,o,l,h=t[r],c=null,u=h>239?4:h>223?3:h>191?2:1;if(r+u<=i)switch(u){case 1:h<128&&(c=h);break;case 2:128==(192&(a=t[r+1]))&&(l=(31&h)<<6|63&a)>127&&(c=l);break;case 3:a=t[r+1],s=t[r+2],128==(192&a)&&128==(192&s)&&(l=(15&h)<<12|(63&a)<<6|63&s)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:a=t[r+1],s=t[r+2],o=t[r+3],128==(192&a)&&128==(192&s)&&128==(192&o)&&(l=(15&h)<<18|(63&a)<<12|(63&s)<<6|63&o)>65535&&l<1114112&&(c=l)}null===c?(c=65533,u=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),r+=u}return function(t){var e=t.length;if(e<=M)return String.fromCharCode.apply(String,t);var i="",n=0;for(;n<e;)i+=String.fromCharCode.apply(String,t.slice(n,n+=M));return i}(n)}e.Buffer=l,e.SlowBuffer=function(t){+t!=t&&(t=0);return l.alloc(+t)},e.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=s(),l.poolSize=8192,l._augment=function(t){return t.__proto__=l.prototype,t},l.from=function(t,e,i){return h(null,t,e,i)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(t,e,i){return function(t,e,i,n){return c(e),e<=0?o(t,e):void 0!==i?"string"==typeof n?o(t,e).fill(i,n):o(t,e).fill(i):o(t,e)}(null,t,e,i)},l.allocUnsafe=function(t){return u(null,t)},l.allocUnsafeSlow=function(t){return u(null,t)},l.isBuffer=function(t){return!(null==t||!t._isBuffer)},l.compare=function(t,e){if(!l.isBuffer(t)||!l.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var i=t.length,n=e.length,r=0,a=Math.min(i,n);r<a;++r)if(t[r]!==e[r]){i=t[r],n=e[r];break}return i<n?-1:n<i?1:0},l.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(t,e){if(!a(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return l.alloc(0);var i;if(void 0===e)for(e=0,i=0;i<t.length;++i)e+=t[i].length;var n=l.allocUnsafe(e),r=0;for(i=0;i<t.length;++i){var s=t[i];if(!l.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,r),r+=s.length}return n},l.byteLength=p,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)m(this,e,e+1);return this},l.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)m(this,e,e+3),m(this,e+1,e+2);return this},l.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)m(this,e,e+7),m(this,e+1,e+6),m(this,e+2,e+5),m(this,e+3,e+4);return this},l.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?T(this,0,t):function(t,e,i){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return C(this,e,i);case"utf8":case"utf-8":return T(this,e,i);case"ascii":return A(this,e,i);case"latin1":case"binary":return I(this,e,i);case"base64":return S(this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,e,i);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}.apply(this,arguments)},l.prototype.equals=function(t){if(!l.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===l.compare(this,t)},l.prototype.inspect=function(){var t="",i=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,i).match(/.{2}/g).join(" "),this.length>i&&(t+=" ... ")),"<Buffer "+t+">"},l.prototype.compare=function(t,e,i,n,r){if(!l.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===i&&(i=t?t.length:0),void 0===n&&(n=0),void 0===r&&(r=this.length),e<0||i>t.length||n<0||r>this.length)throw new RangeError("out of range index");if(n>=r&&e>=i)return 0;if(n>=r)return-1;if(e>=i)return 1;if(e>>>=0,i>>>=0,n>>>=0,r>>>=0,this===t)return 0;for(var a=r-n,s=i-e,o=Math.min(a,s),h=this.slice(n,r),c=t.slice(e,i),u=0;u<o;++u)if(h[u]!==c[u]){a=h[u],s=c[u];break}return a<s?-1:s<a?1:0},l.prototype.includes=function(t,e,i){return-1!==this.indexOf(t,e,i)},l.prototype.indexOf=function(t,e,i){return g(this,t,e,i,!0)},l.prototype.lastIndexOf=function(t,e,i){return g(this,t,e,i,!1)},l.prototype.write=function(t,e,i,n){if(void 0===e)n="utf8",i=this.length,e=0;else if(void 0===i&&"string"==typeof e)n=e,i=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(i)?(i|=0,void 0===n&&(n="utf8")):(n=i,i=void 0)}var r=this.length-e;if((void 0===i||i>r)&&(i=r),t.length>0&&(i<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return _(this,t,e,i);case"utf8":case"utf-8":return y(this,t,e,i);case"ascii":return b(this,t,e,i);case"latin1":case"binary":return x(this,t,e,i);case"base64":return w(this,t,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,t,e,i);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var M=4096;function A(t,e,i){var n="";i=Math.min(t.length,i);for(var r=e;r<i;++r)n+=String.fromCharCode(127&t[r]);return n}function I(t,e,i){var n="";i=Math.min(t.length,i);for(var r=e;r<i;++r)n+=String.fromCharCode(t[r]);return n}function C(t,e,i){var n=t.length;(!e||e<0)&&(e=0),(!i||i<0||i>n)&&(i=n);for(var r="",a=e;a<i;++a)r+=B(t[a]);return r}function P(t,e,i){for(var n=t.slice(e,i),r="",a=0;a<n.length;a+=2)r+=String.fromCharCode(n[a]+256*n[a+1]);return r}function R(t,e,i){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}function L(t,e,i,n,r,a){if(!l.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>r||e<a)throw new RangeError('"value" argument is out of bounds');if(i+n>t.length)throw new RangeError("Index out of range")}function D(t,e,i,n){e<0&&(e=65535+e+1);for(var r=0,a=Math.min(t.length-i,2);r<a;++r)t[i+r]=(e&255<<8*(n?r:1-r))>>>8*(n?r:1-r)}function k(t,e,i,n){e<0&&(e=4294967295+e+1);for(var r=0,a=Math.min(t.length-i,4);r<a;++r)t[i+r]=e>>>8*(n?r:3-r)&255}function O(t,e,i,n,r,a){if(i+n>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function N(t,e,i,n,a){return a||O(t,0,i,4),r.write(t,e,i,n,23,4),i+4}function U(t,e,i,n,a){return a||O(t,0,i,8),r.write(t,e,i,n,52,8),i+8}l.prototype.slice=function(t,e){var i,n=this.length;if(t=~~t,e=void 0===e?n:~~e,t<0?(t+=n)<0&&(t=0):t>n&&(t=n),e<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t),l.TYPED_ARRAY_SUPPORT)(i=this.subarray(t,e)).__proto__=l.prototype;else{var r=e-t;i=new l(r,void 0);for(var a=0;a<r;++a)i[a]=this[a+t]}return i},l.prototype.readUIntLE=function(t,e,i){t|=0,e|=0,i||R(t,e,this.length);for(var n=this[t],r=1,a=0;++a<e&&(r*=256);)n+=this[t+a]*r;return n},l.prototype.readUIntBE=function(t,e,i){t|=0,e|=0,i||R(t,e,this.length);for(var n=this[t+--e],r=1;e>0&&(r*=256);)n+=this[t+--e]*r;return n},l.prototype.readUInt8=function(t,e){return e||R(t,1,this.length),this[t]},l.prototype.readUInt16LE=function(t,e){return e||R(t,2,this.length),this[t]|this[t+1]<<8},l.prototype.readUInt16BE=function(t,e){return e||R(t,2,this.length),this[t]<<8|this[t+1]},l.prototype.readUInt32LE=function(t,e){return e||R(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},l.prototype.readUInt32BE=function(t,e){return e||R(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},l.prototype.readIntLE=function(t,e,i){t|=0,e|=0,i||R(t,e,this.length);for(var n=this[t],r=1,a=0;++a<e&&(r*=256);)n+=this[t+a]*r;return n>=(r*=128)&&(n-=Math.pow(2,8*e)),n},l.prototype.readIntBE=function(t,e,i){t|=0,e|=0,i||R(t,e,this.length);for(var n=e,r=1,a=this[t+--n];n>0&&(r*=256);)a+=this[t+--n]*r;return a>=(r*=128)&&(a-=Math.pow(2,8*e)),a},l.prototype.readInt8=function(t,e){return e||R(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},l.prototype.readInt16LE=function(t,e){e||R(t,2,this.length);var i=this[t]|this[t+1]<<8;return 32768&i?4294901760|i:i},l.prototype.readInt16BE=function(t,e){e||R(t,2,this.length);var i=this[t+1]|this[t]<<8;return 32768&i?4294901760|i:i},l.prototype.readInt32LE=function(t,e){return e||R(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},l.prototype.readInt32BE=function(t,e){return e||R(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},l.prototype.readFloatLE=function(t,e){return e||R(t,4,this.length),r.read(this,t,!0,23,4)},l.prototype.readFloatBE=function(t,e){return e||R(t,4,this.length),r.read(this,t,!1,23,4)},l.prototype.readDoubleLE=function(t,e){return e||R(t,8,this.length),r.read(this,t,!0,52,8)},l.prototype.readDoubleBE=function(t,e){return e||R(t,8,this.length),r.read(this,t,!1,52,8)},l.prototype.writeUIntLE=function(t,e,i,n){(t=+t,e|=0,i|=0,n)||L(this,t,e,i,Math.pow(2,8*i)-1,0);var r=1,a=0;for(this[e]=255&t;++a<i&&(r*=256);)this[e+a]=t/r&255;return e+i},l.prototype.writeUIntBE=function(t,e,i,n){(t=+t,e|=0,i|=0,n)||L(this,t,e,i,Math.pow(2,8*i)-1,0);var r=i-1,a=1;for(this[e+r]=255&t;--r>=0&&(a*=256);)this[e+r]=t/a&255;return e+i},l.prototype.writeUInt8=function(t,e,i){return t=+t,e|=0,i||L(this,t,e,1,255,0),l.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},l.prototype.writeUInt16LE=function(t,e,i){return t=+t,e|=0,i||L(this,t,e,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):D(this,t,e,!0),e+2},l.prototype.writeUInt16BE=function(t,e,i){return t=+t,e|=0,i||L(this,t,e,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):D(this,t,e,!1),e+2},l.prototype.writeUInt32LE=function(t,e,i){return t=+t,e|=0,i||L(this,t,e,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):k(this,t,e,!0),e+4},l.prototype.writeUInt32BE=function(t,e,i){return t=+t,e|=0,i||L(this,t,e,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):k(this,t,e,!1),e+4},l.prototype.writeIntLE=function(t,e,i,n){if(t=+t,e|=0,!n){var r=Math.pow(2,8*i-1);L(this,t,e,i,r-1,-r)}var a=0,s=1,o=0;for(this[e]=255&t;++a<i&&(s*=256);)t<0&&0===o&&0!==this[e+a-1]&&(o=1),this[e+a]=(t/s>>0)-o&255;return e+i},l.prototype.writeIntBE=function(t,e,i,n){if(t=+t,e|=0,!n){var r=Math.pow(2,8*i-1);L(this,t,e,i,r-1,-r)}var a=i-1,s=1,o=0;for(this[e+a]=255&t;--a>=0&&(s*=256);)t<0&&0===o&&0!==this[e+a+1]&&(o=1),this[e+a]=(t/s>>0)-o&255;return e+i},l.prototype.writeInt8=function(t,e,i){return t=+t,e|=0,i||L(this,t,e,1,127,-128),l.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},l.prototype.writeInt16LE=function(t,e,i){return t=+t,e|=0,i||L(this,t,e,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):D(this,t,e,!0),e+2},l.prototype.writeInt16BE=function(t,e,i){return t=+t,e|=0,i||L(this,t,e,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):D(this,t,e,!1),e+2},l.prototype.writeInt32LE=function(t,e,i){return t=+t,e|=0,i||L(this,t,e,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):k(this,t,e,!0),e+4},l.prototype.writeInt32BE=function(t,e,i){return t=+t,e|=0,i||L(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):k(this,t,e,!1),e+4},l.prototype.writeFloatLE=function(t,e,i){return N(this,t,e,!0,i)},l.prototype.writeFloatBE=function(t,e,i){return N(this,t,e,!1,i)},l.prototype.writeDoubleLE=function(t,e,i){return U(this,t,e,!0,i)},l.prototype.writeDoubleBE=function(t,e,i){return U(this,t,e,!1,i)},l.prototype.copy=function(t,e,i,n){if(i||(i=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<i&&(n=i),n===i)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-i&&(n=t.length-e+i);var r,a=n-i;if(this===t&&i<e&&e<n)for(r=a-1;r>=0;--r)t[r+e]=this[r+i];else if(a<1e3||!l.TYPED_ARRAY_SUPPORT)for(r=0;r<a;++r)t[r+e]=this[r+i];else Uint8Array.prototype.set.call(t,this.subarray(i,i+a),e);return a},l.prototype.fill=function(t,e,i,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,i=this.length):"string"==typeof i&&(n=i,i=this.length),1===t.length){var r=t.charCodeAt(0);r<256&&(t=r)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<i)throw new RangeError("Out of range index");if(i<=e)return this;var a;if(e>>>=0,i=void 0===i?this.length:i>>>0,t||(t=0),"number"==typeof t)for(a=e;a<i;++a)this[a]=t;else{var s=l.isBuffer(t)?t:z(new l(t,n).toString()),o=s.length;for(a=0;a<i-e;++a)this[a+e]=s[a%o]}return this};var F=/[^+\/0-9A-Za-z-_]/g;function B(t){return t<16?"0"+t.toString(16):t.toString(16)}function z(t,e){var i;e=e||1/0;for(var n=t.length,r=null,a=[],s=0;s<n;++s){if((i=t.charCodeAt(s))>55295&&i<57344){if(!r){if(i>56319){(e-=3)>-1&&a.push(239,191,189);continue}if(s+1===n){(e-=3)>-1&&a.push(239,191,189);continue}r=i;continue}if(i<56320){(e-=3)>-1&&a.push(239,191,189),r=i;continue}i=65536+(r-55296<<10|i-56320)}else r&&(e-=3)>-1&&a.push(239,191,189);if(r=null,i<128){if((e-=1)<0)break;a.push(i)}else if(i<2048){if((e-=2)<0)break;a.push(i>>6|192,63&i|128)}else if(i<65536){if((e-=3)<0)break;a.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;a.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return a}function H(t){return n.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(F,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function G(t,e,i,n){for(var r=0;r<n&&!(r+i>=e.length||r>=t.length);++r)e[r+i]=t[r];return r}}).call(e,i("DuR2"))},GA34:function(t,e,i){"use strict";t.exports=function(t){return"string"==typeof t}},IjlT:function(t,e,i){"use strict";var n=i("x+d4"),r=i("Imsi"),a=i("3BHo"),s=i("0JKJ"),o=i("6Rxh"),l=0,h=1,c=2,u=4,d=5,f=6,p=0,m=1,g=2,v=-2,_=-3,y=-4,b=-5,x=8,w=1,E=2,S=3,T=4,M=5,A=6,I=7,C=8,P=9,R=10,L=11,D=12,k=13,O=14,N=15,U=16,F=17,B=18,z=19,H=20,G=21,j=22,V=23,W=24,q=25,X=26,Y=27,Z=28,J=29,K=30,Q=31,$=32,tt=852,et=592,it=15;function nt(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function rt(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=w,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new n.Buf32(tt),e.distcode=e.distdyn=new n.Buf32(et),e.sane=1,e.back=-1,p):v}function at(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,rt(t)):v}function st(t,e){var i,n;return t&&t.state?(n=t.state,e<0?(i=0,e=-e):(i=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?v:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=i,n.wbits=e,at(t))):v}function ot(t,e){var i,r;return t?(r=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},t.state=r,r.window=null,(i=st(t,e))!==p&&(t.state=null),i):v}var lt,ht,ct=!0;function ut(t){if(ct){var e;for(lt=new n.Buf32(512),ht=new n.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(o(h,t.lens,0,288,lt,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;o(c,t.lens,0,32,ht,0,t.work,{bits:5}),ct=!1}t.lencode=lt,t.lenbits=9,t.distcode=ht,t.distbits=5}function dt(t,e,i,r){var a,s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new n.Buf8(s.wsize)),r>=s.wsize?(n.arraySet(s.window,e,i-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):((a=s.wsize-s.wnext)>r&&(a=r),n.arraySet(s.window,e,i-r,a,s.wnext),(r-=a)?(n.arraySet(s.window,e,i-r,r,0),s.wnext=r,s.whave=s.wsize):(s.wnext+=a,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=a))),0}e.inflateReset=at,e.inflateReset2=st,e.inflateResetKeep=rt,e.inflateInit=function(t){return ot(t,it)},e.inflateInit2=ot,e.inflate=function(t,e){var i,tt,et,it,rt,at,st,ot,lt,ht,ct,ft,pt,mt,gt,vt,_t,yt,bt,xt,wt,Et,St,Tt,Mt=0,At=new n.Buf8(4),It=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return v;(i=t.state).mode===D&&(i.mode=k),rt=t.next_out,et=t.output,st=t.avail_out,it=t.next_in,tt=t.input,at=t.avail_in,ot=i.hold,lt=i.bits,ht=at,ct=st,Et=p;t:for(;;)switch(i.mode){case w:if(0===i.wrap){i.mode=k;break}for(;lt<16;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(2&i.wrap&&35615===ot){i.check=0,At[0]=255&ot,At[1]=ot>>>8&255,i.check=a(i.check,At,2,0),ot=0,lt=0,i.mode=E;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&ot)<<8)+(ot>>8))%31){t.msg="incorrect header check",i.mode=K;break}if((15&ot)!==x){t.msg="unknown compression method",i.mode=K;break}if(lt-=4,wt=8+(15&(ot>>>=4)),0===i.wbits)i.wbits=wt;else if(wt>i.wbits){t.msg="invalid window size",i.mode=K;break}i.dmax=1<<wt,t.adler=i.check=1,i.mode=512&ot?R:D,ot=0,lt=0;break;case E:for(;lt<16;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(i.flags=ot,(255&i.flags)!==x){t.msg="unknown compression method",i.mode=K;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=K;break}i.head&&(i.head.text=ot>>8&1),512&i.flags&&(At[0]=255&ot,At[1]=ot>>>8&255,i.check=a(i.check,At,2,0)),ot=0,lt=0,i.mode=S;case S:for(;lt<32;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}i.head&&(i.head.time=ot),512&i.flags&&(At[0]=255&ot,At[1]=ot>>>8&255,At[2]=ot>>>16&255,At[3]=ot>>>24&255,i.check=a(i.check,At,4,0)),ot=0,lt=0,i.mode=T;case T:for(;lt<16;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}i.head&&(i.head.xflags=255&ot,i.head.os=ot>>8),512&i.flags&&(At[0]=255&ot,At[1]=ot>>>8&255,i.check=a(i.check,At,2,0)),ot=0,lt=0,i.mode=M;case M:if(1024&i.flags){for(;lt<16;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}i.length=ot,i.head&&(i.head.extra_len=ot),512&i.flags&&(At[0]=255&ot,At[1]=ot>>>8&255,i.check=a(i.check,At,2,0)),ot=0,lt=0}else i.head&&(i.head.extra=null);i.mode=A;case A:if(1024&i.flags&&((ft=i.length)>at&&(ft=at),ft&&(i.head&&(wt=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),n.arraySet(i.head.extra,tt,it,ft,wt)),512&i.flags&&(i.check=a(i.check,tt,ft,it)),at-=ft,it+=ft,i.length-=ft),i.length))break t;i.length=0,i.mode=I;case I:if(2048&i.flags){if(0===at)break t;ft=0;do{wt=tt[it+ft++],i.head&&wt&&i.length<65536&&(i.head.name+=String.fromCharCode(wt))}while(wt&&ft<at);if(512&i.flags&&(i.check=a(i.check,tt,ft,it)),at-=ft,it+=ft,wt)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=C;case C:if(4096&i.flags){if(0===at)break t;ft=0;do{wt=tt[it+ft++],i.head&&wt&&i.length<65536&&(i.head.comment+=String.fromCharCode(wt))}while(wt&&ft<at);if(512&i.flags&&(i.check=a(i.check,tt,ft,it)),at-=ft,it+=ft,wt)break t}else i.head&&(i.head.comment=null);i.mode=P;case P:if(512&i.flags){for(;lt<16;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(ot!==(65535&i.check)){t.msg="header crc mismatch",i.mode=K;break}ot=0,lt=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=D;break;case R:for(;lt<32;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}t.adler=i.check=nt(ot),ot=0,lt=0,i.mode=L;case L:if(0===i.havedict)return t.next_out=rt,t.avail_out=st,t.next_in=it,t.avail_in=at,i.hold=ot,i.bits=lt,g;t.adler=i.check=1,i.mode=D;case D:if(e===d||e===f)break t;case k:if(i.last){ot>>>=7&lt,lt-=7&lt,i.mode=Y;break}for(;lt<3;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}switch(i.last=1&ot,lt-=1,3&(ot>>>=1)){case 0:i.mode=O;break;case 1:if(ut(i),i.mode=H,e===f){ot>>>=2,lt-=2;break t}break;case 2:i.mode=F;break;case 3:t.msg="invalid block type",i.mode=K}ot>>>=2,lt-=2;break;case O:for(ot>>>=7&lt,lt-=7&lt;lt<32;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if((65535&ot)!=(ot>>>16^65535)){t.msg="invalid stored block lengths",i.mode=K;break}if(i.length=65535&ot,ot=0,lt=0,i.mode=N,e===f)break t;case N:i.mode=U;case U:if(ft=i.length){if(ft>at&&(ft=at),ft>st&&(ft=st),0===ft)break t;n.arraySet(et,tt,it,ft,rt),at-=ft,it+=ft,st-=ft,rt+=ft,i.length-=ft;break}i.mode=D;break;case F:for(;lt<14;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(i.nlen=257+(31&ot),ot>>>=5,lt-=5,i.ndist=1+(31&ot),ot>>>=5,lt-=5,i.ncode=4+(15&ot),ot>>>=4,lt-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=K;break}i.have=0,i.mode=B;case B:for(;i.have<i.ncode;){for(;lt<3;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}i.lens[It[i.have++]]=7&ot,ot>>>=3,lt-=3}for(;i.have<19;)i.lens[It[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,St={bits:i.lenbits},Et=o(l,i.lens,0,19,i.lencode,0,i.work,St),i.lenbits=St.bits,Et){t.msg="invalid code lengths set",i.mode=K;break}i.have=0,i.mode=z;case z:for(;i.have<i.nlen+i.ndist;){for(;vt=(Mt=i.lencode[ot&(1<<i.lenbits)-1])>>>16&255,_t=65535&Mt,!((gt=Mt>>>24)<=lt);){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(_t<16)ot>>>=gt,lt-=gt,i.lens[i.have++]=_t;else{if(16===_t){for(Tt=gt+2;lt<Tt;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(ot>>>=gt,lt-=gt,0===i.have){t.msg="invalid bit length repeat",i.mode=K;break}wt=i.lens[i.have-1],ft=3+(3&ot),ot>>>=2,lt-=2}else if(17===_t){for(Tt=gt+3;lt<Tt;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}lt-=gt,wt=0,ft=3+(7&(ot>>>=gt)),ot>>>=3,lt-=3}else{for(Tt=gt+7;lt<Tt;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}lt-=gt,wt=0,ft=11+(127&(ot>>>=gt)),ot>>>=7,lt-=7}if(i.have+ft>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=K;break}for(;ft--;)i.lens[i.have++]=wt}}if(i.mode===K)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=K;break}if(i.lenbits=9,St={bits:i.lenbits},Et=o(h,i.lens,0,i.nlen,i.lencode,0,i.work,St),i.lenbits=St.bits,Et){t.msg="invalid literal/lengths set",i.mode=K;break}if(i.distbits=6,i.distcode=i.distdyn,St={bits:i.distbits},Et=o(c,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,St),i.distbits=St.bits,Et){t.msg="invalid distances set",i.mode=K;break}if(i.mode=H,e===f)break t;case H:i.mode=G;case G:if(at>=6&&st>=258){t.next_out=rt,t.avail_out=st,t.next_in=it,t.avail_in=at,i.hold=ot,i.bits=lt,s(t,ct),rt=t.next_out,et=t.output,st=t.avail_out,it=t.next_in,tt=t.input,at=t.avail_in,ot=i.hold,lt=i.bits,i.mode===D&&(i.back=-1);break}for(i.back=0;vt=(Mt=i.lencode[ot&(1<<i.lenbits)-1])>>>16&255,_t=65535&Mt,!((gt=Mt>>>24)<=lt);){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(vt&&0==(240&vt)){for(yt=gt,bt=vt,xt=_t;vt=(Mt=i.lencode[xt+((ot&(1<<yt+bt)-1)>>yt)])>>>16&255,_t=65535&Mt,!(yt+(gt=Mt>>>24)<=lt);){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}ot>>>=yt,lt-=yt,i.back+=yt}if(ot>>>=gt,lt-=gt,i.back+=gt,i.length=_t,0===vt){i.mode=X;break}if(32&vt){i.back=-1,i.mode=D;break}if(64&vt){t.msg="invalid literal/length code",i.mode=K;break}i.extra=15&vt,i.mode=j;case j:if(i.extra){for(Tt=i.extra;lt<Tt;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}i.length+=ot&(1<<i.extra)-1,ot>>>=i.extra,lt-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=V;case V:for(;vt=(Mt=i.distcode[ot&(1<<i.distbits)-1])>>>16&255,_t=65535&Mt,!((gt=Mt>>>24)<=lt);){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(0==(240&vt)){for(yt=gt,bt=vt,xt=_t;vt=(Mt=i.distcode[xt+((ot&(1<<yt+bt)-1)>>yt)])>>>16&255,_t=65535&Mt,!(yt+(gt=Mt>>>24)<=lt);){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}ot>>>=yt,lt-=yt,i.back+=yt}if(ot>>>=gt,lt-=gt,i.back+=gt,64&vt){t.msg="invalid distance code",i.mode=K;break}i.offset=_t,i.extra=15&vt,i.mode=W;case W:if(i.extra){for(Tt=i.extra;lt<Tt;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}i.offset+=ot&(1<<i.extra)-1,ot>>>=i.extra,lt-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=K;break}i.mode=q;case q:if(0===st)break t;if(ft=ct-st,i.offset>ft){if((ft=i.offset-ft)>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=K;break}ft>i.wnext?(ft-=i.wnext,pt=i.wsize-ft):pt=i.wnext-ft,ft>i.length&&(ft=i.length),mt=i.window}else mt=et,pt=rt-i.offset,ft=i.length;ft>st&&(ft=st),st-=ft,i.length-=ft;do{et[rt++]=mt[pt++]}while(--ft);0===i.length&&(i.mode=G);break;case X:if(0===st)break t;et[rt++]=i.length,st--,i.mode=G;break;case Y:if(i.wrap){for(;lt<32;){if(0===at)break t;at--,ot|=tt[it++]<<lt,lt+=8}if(ct-=st,t.total_out+=ct,i.total+=ct,ct&&(t.adler=i.check=i.flags?a(i.check,et,ct,rt-ct):r(i.check,et,ct,rt-ct)),ct=st,(i.flags?ot:nt(ot))!==i.check){t.msg="incorrect data check",i.mode=K;break}ot=0,lt=0}i.mode=Z;case Z:if(i.wrap&&i.flags){for(;lt<32;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(ot!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=K;break}ot=0,lt=0}i.mode=J;case J:Et=m;break t;case K:Et=_;break t;case Q:return y;case $:default:return v}return t.next_out=rt,t.avail_out=st,t.next_in=it,t.avail_in=at,i.hold=ot,i.bits=lt,(i.wsize||ct!==t.avail_out&&i.mode<K&&(i.mode<Y||e!==u))&&dt(t,t.output,t.next_out,ct-t.avail_out)?(i.mode=Q,y):(ht-=t.avail_in,ct-=t.avail_out,t.total_in+=ht,t.total_out+=ct,i.total+=ct,i.wrap&&ct&&(t.adler=i.check=i.flags?a(i.check,et,ct,t.next_out-ct):r(i.check,et,ct,t.next_out-ct)),t.data_type=i.bits+(i.last?64:0)+(i.mode===D?128:0)+(i.mode===H||i.mode===N?256:0),(0===ht&&0===ct||e===u)&&Et===p&&(Et=b),Et)},e.inflateEnd=function(t){if(!t||!t.state)return v;var e=t.state;return e.window&&(e.window=null),t.state=null,p},e.inflateGetHeader=function(t,e){var i;return t&&t.state?0==(2&(i=t.state).wrap)?v:(i.head=e,e.done=!1,p):v},e.inflateSetDictionary=function(t,e){var i,n=e.length;return t&&t.state?0!==(i=t.state).wrap&&i.mode!==L?v:i.mode===L&&r(1,e,n,0)!==i.check?_:dt(t,e,n,n)?(i.mode=Q,y):(i.havedict=1,p):v},e.inflateInfo="pako inflate (from Nodeca project)"},Imsi:function(t,e,i){"use strict";t.exports=function(t,e,i,n){for(var r=65535&t|0,a=t>>>16&65535|0,s=0;0!==i;){i-=s=i>2e3?2e3:i;do{a=a+(r=r+e[n++]|0)|0}while(--s);r%=65521,a%=65521}return r|a<<16|0}},Ixlh:function(t,e,i){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.Utils=n.lossless.Utils||{},n.lossless.Utils.createArray=function(t){var e=new Array(t||0),i=t;if(arguments.length>1)for(var r=Array.prototype.slice.call(arguments,1);i--;)e[t-1-i]=n.lossless.Utils.createArray.apply(this,r);return e},n.lossless.Utils.makeCRCTable=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e},n.lossless.Utils.crc32=function(t){for(var e=n.lossless.Utils.crcTable||(n.lossless.Utils.crcTable=n.lossless.Utils.makeCRCTable()),i=-1,r=0;r<t.byteLength;r++)i=i>>>8^e[255&(i^t.getUint8(r))];return(-1^i)>>>0},"undefined"!==typeof t&&t.exports&&(t.exports=n.lossless.Utils)},JNao:function(t,e,i){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},"K+Sl":function(t,e,i){"use strict";var n=new Float32Array(1);new Uint32Array(n.buffer)[0]=4286578688,t.exports=n[0]},K0S7:function(t,e,i){"use strict";var n=i("gt5T"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],s=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(t,e,i,l,h,c,u,d){var f,p,m,g,v,_,y,b,x,w=d.bits,E=0,S=0,T=0,M=0,A=0,I=0,C=0,P=0,R=0,L=0,D=null,k=0,O=new n.Buf16(16),N=new n.Buf16(16),U=null,F=0;for(E=0;E<=15;E++)O[E]=0;for(S=0;S<l;S++)O[e[i+S]]++;for(A=w,M=15;M>=1&&0===O[M];M--);if(A>M&&(A=M),0===M)return h[c++]=20971520,h[c++]=20971520,d.bits=1,0;for(T=1;T<M&&0===O[T];T++);for(A<T&&(A=T),P=1,E=1;E<=15;E++)if(P<<=1,(P-=O[E])<0)return-1;if(P>0&&(0===t||1!==M))return-1;for(N[1]=0,E=1;E<15;E++)N[E+1]=N[E]+O[E];for(S=0;S<l;S++)0!==e[i+S]&&(u[N[e[i+S]]++]=S);if(0===t?(D=U=u,_=19):1===t?(D=r,k-=257,U=a,F-=257,_=256):(D=s,U=o,_=-1),L=0,S=0,E=T,v=c,I=A,C=0,m=-1,g=(R=1<<A)-1,1===t&&R>852||2===t&&R>592)return 1;for(;;){y=E-C,u[S]<_?(b=0,x=u[S]):u[S]>_?(b=U[F+u[S]],x=D[k+u[S]]):(b=96,x=0),f=1<<E-C,T=p=1<<I;do{h[v+(L>>C)+(p-=f)]=y<<24|b<<16|x|0}while(0!==p);for(f=1<<E-1;L&f;)f>>=1;if(0!==f?(L&=f-1,L+=f):L=0,S++,0==--O[E]){if(E===M)break;E=e[i+u[S]]}if(E>A&&(L&g)!==m){for(0===C&&(C=A),v+=T,P=1<<(I=E-C);I+C<M&&!((P-=O[I+C])<=0);)I++,P<<=1;if(R+=1<<I,1===t&&R>852||2===t&&R>592)return 1;h[m=L&g]=A<<24|I<<16|v-c|0}}return 0!==L&&(h[v+L]=E-C<<24|64<<16|0),d.bits=A,0}},KpjM:function(t,e,i){"use strict";t.exports=function(t,e,i,n){for(var r=65535&t|0,a=t>>>16&65535|0,s=0;0!==i;){i-=s=i>2e3?2e3:i;do{a=a+(r=r+e[n++]|0)|0}while(--s);r%=65521,a%=65521}return r|a<<16|0}},KyNI:function(t,e,i){"use strict";
/*! image-JPEG2000 - v0.3.1 - 2015-08-26 | https://github.com/OHIF/image-JPEG2000 */var n=function(){var t={LL:0,LH:1,HL:1,HH:2};function e(){this.failOnCorruptedImage=!1}function i(t,e){t.x0=Math.ceil(e.XOsiz/t.XRsiz),t.x1=Math.ceil(e.Xsiz/t.XRsiz),t.y0=Math.ceil(e.YOsiz/t.YRsiz),t.y1=Math.ceil(e.Ysiz/t.YRsiz),t.width=t.x1-t.x0,t.height=t.y1-t.y0}function n(t,e){for(var i,n=t.SIZ,r=[],a=Math.ceil((n.Xsiz-n.XTOsiz)/n.XTsiz),s=Math.ceil((n.Ysiz-n.YTOsiz)/n.YTsiz),o=0;o<s;o++)for(var l=0;l<a;l++)(i={}).tx0=Math.max(n.XTOsiz+l*n.XTsiz,n.XOsiz),i.ty0=Math.max(n.YTOsiz+o*n.YTsiz,n.YOsiz),i.tx1=Math.min(n.XTOsiz+(l+1)*n.XTsiz,n.Xsiz),i.ty1=Math.min(n.YTOsiz+(o+1)*n.YTsiz,n.Ysiz),i.width=i.tx1-i.tx0,i.height=i.ty1-i.ty0,i.components=[],r.push(i);t.tiles=r;for(var h=0,c=n.Csiz;h<c;h++)for(var u=e[h],d=0,f=r.length;d<f;d++){var p={};i=r[d],p.tcx0=Math.ceil(i.tx0/u.XRsiz),p.tcy0=Math.ceil(i.ty0/u.YRsiz),p.tcx1=Math.ceil(i.tx1/u.XRsiz),p.tcy1=Math.ceil(i.ty1/u.YRsiz),p.width=p.tcx1-p.tcx0,p.height=p.tcy1-p.tcy0,i.components[h]=p}}function a(t,e,i){var n=e.codingStyleParameters,r={};return n.entropyCoderWithCustomPrecincts?(r.PPx=n.precinctsSizes[i].PPx,r.PPy=n.precinctsSizes[i].PPy):(r.PPx=15,r.PPy=15),r.xcb_=i>0?Math.min(n.xcb,r.PPx-1):Math.min(n.xcb,r.PPx),r.ycb_=i>0?Math.min(n.ycb,r.PPy-1):Math.min(n.ycb,r.PPy),r}function l(t,e,i){var n=1<<i.PPx,r=1<<i.PPy,a=0===e.resLevel,s=1<<i.PPx+(a?0:-1),o=1<<i.PPy+(a?0:-1),l=e.trx1>e.trx0?Math.ceil(e.trx1/n)-Math.floor(e.trx0/n):0,h=e.try1>e.try0?Math.ceil(e.try1/r)-Math.floor(e.try0/r):0,c=l*h;e.precinctParameters={precinctWidth:n,precinctHeight:r,numprecinctswide:l,numprecinctshigh:h,numprecincts:c,precinctWidthInSubband:s,precinctHeightInSubband:o}}function h(t,e,i){var n,r,a,s,o=i.xcb_,l=i.ycb_,h=1<<o,c=1<<l,u=e.tbx0>>o,d=e.tby0>>l,f=e.tbx1+h-1>>o,p=e.tby1+c-1>>l,m=e.resolution.precinctParameters,g=[],v=[];for(r=d;r<p;r++)for(n=u;n<f;n++){if((a={cbx:n,cby:r,tbx0:h*n,tby0:c*r,tbx1:h*(n+1),tby1:c*(r+1)}).tbx0_=Math.max(e.tbx0,a.tbx0),a.tby0_=Math.max(e.tby0,a.tby0),a.tbx1_=Math.min(e.tbx1,a.tbx1),a.tby1_=Math.min(e.tby1,a.tby1),s=Math.floor((a.tbx0_-e.tbx0)/m.precinctWidthInSubband)+Math.floor((a.tby0_-e.tby0)/m.precinctHeightInSubband)*m.numprecinctswide,a.precinctNumber=s,a.subbandType=e.type,a.Lblock=3,!(a.tbx1_<=a.tbx0_||a.tby1_<=a.tby0_)){g.push(a);var _=v[s];void 0!==_?(n<_.cbxMin?_.cbxMin=n:n>_.cbxMax&&(_.cbxMax=n),r<_.cbyMin?_.cbxMin=r:r>_.cbyMax&&(_.cbyMax=r)):v[s]=_={cbxMin:n,cbyMin:r,cbxMax:n,cbyMax:r},a.precinct=_}}e.codeblockParameters={codeblockWidth:o,codeblockHeight:l,numcodeblockwide:f-u+1,numcodeblockhigh:p-d+1},e.codeblocks=g,e.precincts=v}function c(t,e,i){for(var n=[],r=t.subbands,a=0,s=r.length;a<s;a++)for(var o=r[a].codeblocks,l=0,h=o.length;l<h;l++){var c=o[l];c.precinctNumber===e&&n.push(c)}return{layerNumber:i,codeblocks:n}}function u(t,e,i,n,r){var a=t*n.minWidth,s=e*n.minHeight;if(a%i.width!=0||s%i.height!=0)return null;var o=s/i.width*r.precinctParameters.numprecinctswide;return a/i.height+o}function d(t){for(var e=t.components.length,i=Number.MAX_VALUE,n=Number.MAX_VALUE,r=0,a=0,s=new Array(e),o=0;o<e;o++){for(var l=t.components[o],h=l.codingStyleParameters.decompositionLevelsCount,c=new Array(h+1),u=Number.MAX_VALUE,d=Number.MAX_VALUE,f=0,p=0,m=1,g=h;g>=0;--g){var v=l.resolutions[g],_=m*v.precinctParameters.precinctWidth,y=m*v.precinctParameters.precinctHeight;u=Math.min(u,_),d=Math.min(d,y),f=Math.max(f,v.precinctParameters.numprecinctswide),p=Math.max(p,v.precinctParameters.numprecinctshigh),c[g]={width:_,height:y},m<<=1}i=Math.min(i,u),n=Math.min(n,d),r=Math.max(r,f),a=Math.max(a,p),s[o]={resolutions:c,minWidth:u,minHeight:d,maxNumWide:f,maxNumHigh:p}}return{components:s,minWidth:i,minHeight:n,maxNumWide:r,maxNumHigh:a}}function f(t){for(var e=t.SIZ,i=t.currentTile.index,n=t.tiles[i],r=e.Csiz,s=0;s<r;s++){for(var o=n.components[s],f=o.codingStyleParameters.decompositionLevelsCount,p=[],m=[],g=0;g<=f;g++){var v,_=a(0,o,g),y={},b=1<<f-g;if(y.trx0=Math.ceil(o.tcx0/b),y.try0=Math.ceil(o.tcy0/b),y.trx1=Math.ceil(o.tcx1/b),y.try1=Math.ceil(o.tcy1/b),y.resLevel=g,l(0,y,_),p.push(y),0===g)(v={}).type="LL",v.tbx0=Math.ceil(o.tcx0/b),v.tby0=Math.ceil(o.tcy0/b),v.tbx1=Math.ceil(o.tcx1/b),v.tby1=Math.ceil(o.tcy1/b),v.resolution=y,h(0,v,_),m.push(v),y.subbands=[v];else{var x=1<<f-g+1,w=[];(v={}).type="HL",v.tbx0=Math.ceil(o.tcx0/x-.5),v.tby0=Math.ceil(o.tcy0/x),v.tbx1=Math.ceil(o.tcx1/x-.5),v.tby1=Math.ceil(o.tcy1/x),v.resolution=y,h(0,v,_),m.push(v),w.push(v),(v={}).type="LH",v.tbx0=Math.ceil(o.tcx0/x),v.tby0=Math.ceil(o.tcy0/x-.5),v.tbx1=Math.ceil(o.tcx1/x),v.tby1=Math.ceil(o.tcy1/x-.5),v.resolution=y,h(0,v,_),m.push(v),w.push(v),(v={}).type="HH",v.tbx0=Math.ceil(o.tcx0/x-.5),v.tby0=Math.ceil(o.tcy0/x-.5),v.tbx1=Math.ceil(o.tcx1/x-.5),v.tby1=Math.ceil(o.tcy1/x-.5),v.resolution=y,h(0,v,_),m.push(v),w.push(v),y.subbands=w}}o.resolutions=p,o.subbands=m}var E=n.codingStyleDefaultParameters.progressionOrder;switch(E){case 0:n.packetsIterator=new function(t){for(var e=t.SIZ,i=t.currentTile.index,n=t.tiles[i],r=n.codingStyleDefaultParameters.layersCount,a=e.Csiz,s=0,o=0;o<a;o++)s=Math.max(s,n.components[o].codingStyleParameters.decompositionLevelsCount);var l=0,h=0,u=0,d=0;this.nextPacket=function(){for(;l<r;l++){for(;h<=s;h++){for(;u<a;u++){var t=n.components[u];if(!(h>t.codingStyleParameters.decompositionLevelsCount)){for(var e=t.resolutions[h],i=e.precinctParameters.numprecincts;d<i;){var o=c(e,d,l);return d++,o}d=0}}u=0}h=0}}}(t);break;case 1:n.packetsIterator=new function(t){for(var e=t.SIZ,i=t.currentTile.index,n=t.tiles[i],r=n.codingStyleDefaultParameters.layersCount,a=e.Csiz,s=0,o=0;o<a;o++)s=Math.max(s,n.components[o].codingStyleParameters.decompositionLevelsCount);var l=0,h=0,u=0,d=0;this.nextPacket=function(){for(;l<=s;l++){for(;h<r;h++){for(;u<a;u++){var t=n.components[u];if(!(l>t.codingStyleParameters.decompositionLevelsCount)){for(var e=t.resolutions[l],i=e.precinctParameters.numprecincts;d<i;){var o=c(e,d,h);return d++,o}d=0}}u=0}h=0}}}(t);break;case 2:n.packetsIterator=new function(t){var e,i,n,r,a=t.SIZ,s=t.currentTile.index,o=t.tiles[s],l=o.codingStyleDefaultParameters.layersCount,h=a.Csiz,u=0;for(n=0;n<h;n++){var d=o.components[n];u=Math.max(u,d.codingStyleParameters.decompositionLevelsCount)}var f=new Int32Array(u+1);for(i=0;i<=u;++i){var p=0;for(n=0;n<h;++n){var m=o.components[n].resolutions;i<m.length&&(p=Math.max(p,m[i].precinctParameters.numprecincts))}f[i]=p}e=0,i=0,n=0,r=0,this.nextPacket=function(){for(;i<=u;i++){for(;r<f[i];r++){for(;n<h;n++){var t=o.components[n];if(!(i>t.codingStyleParameters.decompositionLevelsCount)){var a=t.resolutions[i],s=a.precinctParameters.numprecincts;if(!(r>=s)){for(;e<l;){var d=c(a,r,e);return e++,d}e=0}}}n=0}r=0}}}(t);break;case 3:n.packetsIterator=new function(t){var e=t.SIZ,i=t.currentTile.index,n=t.tiles[i],r=n.codingStyleDefaultParameters.layersCount,a=e.Csiz,s=d(n),o=s,l=0,h=0,f=0,p=0,m=0;this.nextPacket=function(){for(;m<o.maxNumHigh;m++){for(;p<o.maxNumWide;p++){for(;f<a;f++){for(var t=n.components[f],e=t.codingStyleParameters.decompositionLevelsCount;h<=e;h++){var i=t.resolutions[h],d=s.components[f].resolutions[h],g=u(p,m,d,o,i);if(null!==g){for(;l<r;){var v=c(i,g,l);return l++,v}l=0}}h=0}f=0}p=0}}}(t);break;case 4:n.packetsIterator=new function(t){var e=t.SIZ,i=t.currentTile.index,n=t.tiles[i],r=n.codingStyleDefaultParameters.layersCount,a=e.Csiz,s=d(n),o=0,l=0,h=0,f=0,p=0;this.nextPacket=function(){for(;h<a;++h){for(var t=n.components[h],e=s.components[h],i=t.codingStyleParameters.decompositionLevelsCount;p<e.maxNumHigh;p++){for(;f<e.maxNumWide;f++){for(;l<=i;l++){var d=t.resolutions[l],m=e.resolutions[l],g=u(f,p,m,e,d);if(null!==g){for(;o<r;){var v=c(d,g,o);return o++,v}o=0}}l=0}f=0}p=0}}}(t);break;default:throw new Error("JPX Error: Unsupported progression order "+E)}}function p(t,e,i,n){var r,a=0,s=0,o=!1;function l(t){for(;s<t;){if(i+a>=e.length)throw new Error("Unexpected EOF");var n=e[i+a];a++,o?(r=r<<7|n,s+=7,o=!1):(r=r<<8|n,s+=8),255===n&&(o=!0)}return r>>>(s-=t)&(1<<t)-1}function h(t){return 255===e[i+a-1]&&e[i+a]===t?(c(1),!0):255===e[i+a]&&e[i+a+1]===t&&(c(2),!0)}function c(t){a+=t}function u(){s=0,o&&(a++,o=!1)}function d(){if(0===l(1))return 1;if(0===l(1))return 2;var t=l(2);return t<3?t+3:(t=l(5))<31?t+6:(t=l(7))+37}for(var f=t.currentTile.index,p=t.tiles[f],g=t.COD.sopMarkerUsed,v=t.COD.ephMarkerUsed,_=p.packetsIterator;a<n;)try{u(),g&&h(145)&&c(4);var y=_.nextPacket();if(void 0===y)return;if(!l(1))continue;for(var b,E=y.layerNumber,S=[],T=0,M=y.codeblocks.length;T<M;T++){var A=(b=y.codeblocks[T]).precinct,I=b.cbx-A.cbxMin,C=b.cby-A.cbyMin,P=!1,R=!1;if(void 0!==b.included)P=!!l(1);else{var L,D;if(void 0!==(A=b.precinct).inclusionTree)L=A.inclusionTree;else{var k=A.cbxMax-A.cbxMin+1,O=A.cbyMax-A.cbyMin+1;L=new w(k,O),D=new x(k,O),A.inclusionTree=L,A.zeroBitPlanesTree=D}for(L.reset(I,C,E);;){if(a>=e.length)return;if(L.isAboveThreshold())break;if(L.isKnown())L.nextLevel();else if(l(1)){if(L.setKnown(),L.isLeaf()){b.included=!0,P=R=!0;break}L.nextLevel()}else L.incrementValue()}}if(P){if(R){for((D=A.zeroBitPlanesTree).reset(I,C);;){if(a>=e.length)return;if(l(1)){if(!D.nextLevel())break}else D.incrementValue()}b.zeroBitPlanes=D.value}for(var N=d();l(1);)b.Lblock++;var U=m(N),F=l((N<1<<U?U-1:U)+b.Lblock);S.push({codeblock:b,codingpasses:N,dataLength:F})}}for(u(),v&&h(146);S.length>0;){var B=S.shift();void 0===(b=B.codeblock).data&&(b.data=[]),b.data.push({data:e,start:i+a,end:i+a+B.dataLength,codingpasses:B.codingpasses}),a+=B.dataLength}}catch(t){return}return a}function _(t,e,i,n,a,s,o,l){for(var h=n.tbx0,c=n.tby0,u=n.tbx1-n.tbx0,d=n.codeblocks,f="H"===n.type.charAt(0)?1:0,p="H"===n.type.charAt(1)?e:0,m=0,g=d.length;m<g;++m){var v=d[m],_=v.tbx1_-v.tbx0_,y=v.tby1_-v.tby0_;if(0!==_&&0!==y&&void 0!==v.data){var b,x;b=new E(_,y,v.subbandType,v.zeroBitPlanes,s),x=2;var w,S,T,M=v.data,A=0,I=0;for(w=0,S=M.length;w<S;w++)A+=(T=M[w]).end-T.start,I+=T.codingpasses;var C=new Int16Array(A),P=0;for(w=0,S=M.length;w<S;w++){var R=(T=M[w]).data.subarray(T.start,T.end);C.set(R,P),P+=R.length}var L=new r(C,0,A);for(b.setDecoder(L),w=0;w<I;w++){switch(x){case 0:b.runSignificancePropogationPass();break;case 1:b.runMagnitudeRefinementPass();break;case 2:b.runCleanupPass(),l&&b.checkSegmentationSymbol()}x=(x+1)%3}var D,k,O,N=v.tbx0_-h+(v.tby0_-c)*u,U=b.coefficentsSign,F=b.coefficentsMagnitude,B=b.bitsDecoded,z=o?0:.5;P=0;var H="LL"!==n.type;for(w=0;w<y;w++){var G=2*(N/u|0)*(e-u)+f+p;for(D=0;D<_;D++){if(0!==(k=F[P])){k=(k+z)*a,0!==U[P]&&(k=-k),O=B[P];var j=H?G+(N<<1):N;t[j]=o&&O>=s?k:k*(1<<s-O)}N++,P++}N+=u-_}}}}function y(e,i,n){for(var r=i.components[n],a=r.codingStyleParameters,s=r.quantizationParameters,o=a.decompositionLevelsCount,l=s.SPqcds,h=s.scalarExpounded,c=s.guardBits,u=a.segmentationSymbolUsed,d=e.components[n].precision,f=a.reversibleTransformation,p=f?new M:new T,m=[],g=0,v=0;v<=o;v++){for(var y=r.resolutions[v],b=y.trx1-y.trx0,x=y.try1-y.try0,w=new Float32Array(b*x),E=0,S=y.subbands.length;E<S;E++){var A,I;h?(A=l[g].mu,I=l[g].epsilon,g++):(A=l[0].mu,I=l[0].epsilon+(v>0?1-v:0));var C=y.subbands[E],P=t[C.type];_(w,b,0,C,f?1:Math.pow(2,d+P-I)*(1+A/2048),c+I-1,f,u)}m.push({width:b,height:x,items:w})}var R=p.calculate(m,r.tcx0,r.tcy0);return{left:r.tcx0,top:r.tcy0,width:R.width,height:R.height,items:R.items}}function b(t,e){for(var i=t.SIZ.Csiz,n=t.tiles[e],r=0;r<i;r++){var a=n.components[r],s=void 0!==t.currentTile.QCC[r]?t.currentTile.QCC[r]:t.currentTile.QCD;a.quantizationParameters=s;var o=void 0!==t.currentTile.COC[r]?t.currentTile.COC[r]:t.currentTile.COD;a.codingStyleParameters=o}n.codingStyleDefaultParameters=t.currentTile.COD}e.prototype={parse:function(t){if(65359!==g(t,0))for(var e=0,i=t.length;e<i;){var n=8,r=v(t,e),a=v(t,e+4);if(e+=n,1===r&&(r=4294967296*v(t,e)+v(t,e+4),e+=8,n+=8),0===r&&(r=i-e+n),r<n)throw new Error("JPX Error: Invalid box field size");var l=r-n,h=!0;switch(a){case 1785737832:h=!1;break;case 1668246642:var c=t[e];t[e+1],t[e+2];if(1===c){var u=v(t,e+3);switch(u){case 16:case 17:case 18:break;default:o("Unknown colorspace "+u)}}else 2===c&&s("ICC profile not supported");break;case 1785737827:this.parseCodestream(t,e,e+l);break;case 1783636e3:218793738!==v(t,e)&&o("Invalid JP2 signature");break;case 1783634458:case 1718909296:case 1920099697:case 1919251232:case 1768449138:break;default:o("Unsupported header type "+a+" ("+String.fromCharCode(a>>24&255,a>>16&255,a>>8&255,255&a)+")")}h&&(e+=l)}else this.parseCodestream(t,0,t.length)},parseImageProperties:function(t){for(var e=t.getByte();e>=0;){if(65361===(e<<8|(e=t.getByte()))){t.skip(4);var i=t.getInt32()>>>0,n=t.getInt32()>>>0,r=t.getInt32()>>>0,a=t.getInt32()>>>0;t.skip(16);var s=t.getUint16();return this.width=i-r,this.height=n-a,this.componentsCount=s,void(this.bitsPerComponent=8)}}throw new Error("JPX Error: No size marker found in JPX stream")},parseCodestream:function(t,e,r){var a={};try{for(var s=!1,l=e;l+1<r;){var h=g(t,l);l+=2;var c,u,d,m,_,x,w=0;switch(h){case 65359:a.mainHeader=!0;break;case 65497:break;case 65361:w=g(t,l);var E={};E.Xsiz=v(t,l+4),E.Ysiz=v(t,l+8),E.XOsiz=v(t,l+12),E.YOsiz=v(t,l+16),E.XTsiz=v(t,l+20),E.YTsiz=v(t,l+24),E.XTOsiz=v(t,l+28),E.YTOsiz=v(t,l+32);var S=g(t,l+36);E.Csiz=S;var T=[];c=l+38;for(var M=0;M<S;M++){var A={precision:1+(127&t[c]),isSigned:!!(128&t[c]),XRsiz:t[c+1],YRsiz:t[c+1]};i(A,E),T.push(A)}a.SIZ=E,a.components=T,n(a,T),a.QCC=[],a.COC=[];break;case 65372:w=g(t,l);var I={};switch(c=l+2,31&(u=t[c++])){case 0:m=8,_=!0;break;case 1:m=16,_=!1;break;case 2:m=16,_=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+u)}for(I.noQuantization=8===m,I.scalarExpounded=_,I.guardBits=u>>5,d=[];c<w+l;){var C={};8===m?(C.epsilon=t[c++]>>3,C.mu=0):(C.epsilon=t[c]>>3,C.mu=(7&t[c])<<8|t[c+1],c+=2),d.push(C)}I.SPqcds=d,a.mainHeader?a.QCD=I:(a.currentTile.QCD=I,a.currentTile.QCC=[]);break;case 65373:w=g(t,l);var P,R={};switch(c=l+2,a.SIZ.Csiz<257?P=t[c++]:(P=g(t,c),c+=2),31&(u=t[c++])){case 0:m=8,_=!0;break;case 1:m=16,_=!1;break;case 2:m=16,_=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+u)}for(R.noQuantization=8===m,R.scalarExpounded=_,R.guardBits=u>>5,d=[];c<w+l;)C={},8===m?(C.epsilon=t[c++]>>3,C.mu=0):(C.epsilon=t[c]>>3,C.mu=(7&t[c])<<8|t[c+1],c+=2),d.push(C);R.SPqcds=d,a.mainHeader?a.QCC[P]=R:a.currentTile.QCC[P]=R;break;case 65362:w=g(t,l);var L={};c=l+2;var D=t[c++];L.entropyCoderWithCustomPrecincts=!!(1&D),L.sopMarkerUsed=!!(2&D),L.ephMarkerUsed=!!(4&D),L.progressionOrder=t[c++],L.layersCount=g(t,c),c+=2,L.multipleComponentTransform=t[c++],L.decompositionLevelsCount=t[c++],L.xcb=2+(15&t[c++]),L.ycb=2+(15&t[c++]);var k=t[c++];if(L.selectiveArithmeticCodingBypass=!!(1&k),L.resetContextProbabilities=!!(2&k),L.terminationOnEachCodingPass=!!(4&k),L.verticalyStripe=!!(8&k),L.predictableTermination=!!(16&k),L.segmentationSymbolUsed=!!(32&k),L.reversibleTransformation=t[c++],L.entropyCoderWithCustomPrecincts){for(var O=[];c<w+l;){var N=t[c++];O.push({PPx:15&N,PPy:N>>4})}L.precinctsSizes=O}var U=[];if(L.selectiveArithmeticCodingBypass&&U.push("selectiveArithmeticCodingBypass"),L.resetContextProbabilities&&U.push("resetContextProbabilities"),L.terminationOnEachCodingPass&&U.push("terminationOnEachCodingPass"),L.verticalyStripe&&U.push("verticalyStripe"),L.predictableTermination&&U.push("predictableTermination"),U.length>0)throw s=!0,new Error("JPX Error: Unsupported COD options ("+U.join(", ")+")");a.mainHeader?a.COD=L:(a.currentTile.COD=L,a.currentTile.COC=[]);break;case 65424:w=g(t,l),(x={}).index=g(t,l+2),x.length=v(t,l+4),x.dataEnd=x.length+l-2,x.partIndex=t[l+8],x.partsCount=t[l+9],a.mainHeader=!1,0===x.partIndex&&(x.COD=a.COD,x.COC=a.COC.slice(0),x.QCD=a.QCD,x.QCC=a.QCC.slice(0)),a.currentTile=x;break;case 65427:0===(x=a.currentTile).partIndex&&(b(a,x.index),f(a)),p(a,t,l,w=x.dataEnd-l);break;case 65365:case 65367:case 65368:case 65380:w=g(t,l);break;case 65363:throw new Error("JPX Error: Codestream code 0xFF53 (COC) is not implemented");default:throw new Error("JPX Error: Unknown codestream code: "+h.toString(16))}l+=w}}catch(t){if(s||this.failOnCorruptedImage)throw t;o("Trying to recover from "+t.message)}this.tiles=function(t){for(var e=t.SIZ,i=t.components,n=e.Csiz,r=[],a=0,s=t.tiles.length;a<s;a++){var o,l=t.tiles[a],h=[];for(o=0;o<n;o++)h[o]=y(t,l,o);var c=h[0],u=i[0].isSigned;if(u)var d=new Int16Array(c.items.length*n);else var d=new Uint16Array(c.items.length*n);var f,p,m,g,v,_,b,x,w,E,S,T,M,A,I,C={left:c.left,top:c.top,width:c.width,height:c.height,items:d},P=0;if(l.codingStyleDefaultParameters.multipleComponentTransform){var R=4===n,L=h[0].items,D=h[1].items,k=h[2].items,O=R?h[3].items:null;f=i[0].precision-8,p=.5+(128<<f),g=-(v=.5*(m=255*(1<<f)));var N=l.components[0],U=n-3;if(b=L.length,N.codingStyleParameters.reversibleTransformation)for(_=0;_<b;_++,P+=U)x=L[_]+p,w=D[_],E=k[_],S=(T=x-(E+w>>2))+E,M=T+w,d[P++]=S<=0?0:S>=m?255:S>>f,d[P++]=T<=0?0:T>=m?255:T>>f,d[P++]=M<=0?0:M>=m?255:M>>f;else for(_=0;_<b;_++,P+=U)x=L[_]+p,w=D[_],E=k[_],S=x+1.402*E,T=x-.34413*w-.71414*E,M=x+1.772*w,d[P++]=S<=0?0:S>=m?255:S>>f,d[P++]=T<=0?0:T>=m?255:T>>f,d[P++]=M<=0?0:M>=m?255:M>>f;if(R)for(_=0,P=3;_<b;_++,P+=4)A=O[_],d[P]=A<=g?0:A>=v?255:A+p>>f}else for(o=0;o<n;o++)if(8===i[o].precision){var F=h[o].items;for(f=i[o].precision-8,p=.5+(128<<f),g=-(m=127.5*(1<<f)),P=o,_=0,b=F.length;_<b;_++)I=F[_],d[P]=I<=g?0:I>=m?255:I+p>>f,P+=n}else{var u=i[o].isSigned,F=h[o].items;if(u)for(P=o,_=0,b=F.length;_<b;_++)d[P]=F[_],P+=n;else{f=i[o].precision-8,p=.5+(128<<f);var B=Math.pow(2,i[o].precision)-1;for(P=o,_=0,b=F.length;_<b;_++)I=F[_],d[P]=Math.max(Math.min(I+p,B),0),P+=n}}r.push(C)}return r}(a),this.width=a.SIZ.Xsiz-a.SIZ.XOsiz,this.height=a.SIZ.Ysiz-a.SIZ.YOsiz,this.componentsCount=a.SIZ.Csiz}};var x=function(){function t(t,e){var i=m(Math.max(t,e))+1;this.levels=[];for(var n=0;n<i;n++){var r={width:t,height:e,items:[]};this.levels.push(r),t=Math.ceil(t/2),e=Math.ceil(e/2)}}return t.prototype={reset:function(t,e){for(var i,n=0,r=0;n<this.levels.length;){var a=t+e*(i=this.levels[n]).width;if(void 0!==i.items[a]){r=i.items[a];break}i.index=a,t>>=1,e>>=1,n++}n--,(i=this.levels[n]).items[i.index]=r,this.currentLevel=n,delete this.value},incrementValue:function(){var t=this.levels[this.currentLevel];t.items[t.index]++},nextLevel:function(){var t=this.currentLevel,e=this.levels[t],i=e.items[e.index];return--t<0?(this.value=i,!1):(this.currentLevel=t,(e=this.levels[t]).items[e.index]=i,!0)}},t}(),w=function(){function t(t,e){var i=m(Math.max(t,e))+1;this.levels=[];for(var n=0;n<i;n++){for(var r=new Uint8Array(t*e),a=new Uint8Array(t*e),s=0,o=r.length;s<o;s++)r[s]=0,a[s]=0;var l={width:t,height:e,items:r,status:a};this.levels.push(l),t=Math.ceil(t/2),e=Math.ceil(e/2)}}return t.prototype={reset:function(t,e,i){this.currentStopValue=i;for(var n=0;n<this.levels.length;){var r=this.levels[n],a=t+e*r.width;r.index=a,t>>=1,e>>=1,n++}this.currentLevel=this.levels.length-1,this.minValue=this.levels[this.currentLevel].items[0]},incrementValue:function(){var t=this.levels[this.currentLevel];t.items[t.index]=t.items[t.index]+1,t.items[t.index]>this.minValue&&(this.minValue=t.items[t.index])},nextLevel:function(){var t=this.currentLevel;if(--t<0)return!1;this.currentLevel=t;var e=this.levels[t];return e.items[e.index]<this.minValue?e.items[e.index]=this.minValue:e.items[e.index]>this.minValue&&(this.minValue=e.items[e.index]),!0},isLeaf:function(){return 0===this.currentLevel},isAboveThreshold:function(){var t=this.currentLevel,e=this.levels[t];return e.items[e.index]>this.currentStopValue},isKnown:function(){var t=this.currentLevel,e=this.levels[t];return e.status[e.index]>0},setKnown:function(){var t=this.currentLevel,e=this.levels[t];e.status[e.index]=1}},t}(),E=function(){var t=new Uint8Array([0,5,8,0,3,7,8,0,4,7,8,0,0,0,0,0,1,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8]),e=new Uint8Array([0,3,4,0,5,7,7,0,8,8,8,0,0,0,0,0,1,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8]),i=new Uint8Array([0,1,2,0,1,2,2,0,2,2,2,0,0,0,0,0,3,4,5,0,4,5,5,0,5,5,5,0,0,0,0,0,6,7,7,0,7,7,7,0,7,7,7,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8]);function n(n,r,a,s,o){this.width=n,this.height=r,this.contextLabelTable="HH"===a?i:"HL"===a?e:t;var l=n*r;this.neighborsSignificance=new Uint8Array(l),this.coefficentsSign=new Uint8Array(l),this.coefficentsMagnitude=o>14?new Uint32Array(l):o>6?new Uint16Array(l):new Uint8Array(l),this.processingFlags=new Uint8Array(l);var h=new Uint8Array(l);if(0!==s)for(var c=0;c<l;c++)h[c]=s;this.bitsDecoded=h,this.reset()}return n.prototype={setDecoder:function(t){this.decoder=t},reset:function(){this.contexts=new Int8Array(19),this.contexts[0]=8,this.contexts[17]=92,this.contexts[18]=6},setNeighborsSignificance:function(t,e,i){var n,r=this.neighborsSignificance,a=this.width,s=this.height,o=e>0,l=e+1<a;t>0&&(n=i-a,o&&(r[n-1]+=16),l&&(r[n+1]+=16),r[n]+=4),t+1<s&&(n=i+a,o&&(r[n-1]+=16),l&&(r[n+1]+=16),r[n]+=4),o&&(r[i-1]+=1),l&&(r[i+1]+=1),r[i]|=128},runSignificancePropogationPass:function(){for(var t=this.decoder,e=this.width,i=this.height,n=this.coefficentsMagnitude,r=this.coefficentsSign,a=this.neighborsSignificance,s=this.processingFlags,o=this.contexts,l=this.contextLabelTable,h=this.bitsDecoded,c=0;c<i;c+=4)for(var u=0;u<e;u++)for(var d=c*e+u,f=0;f<4;f++,d+=e){var p=c+f;if(p>=i)break;if(s[d]&=-2,!n[d]&&a[d]){var m=l[a[d]];if(t.readBit(o,m)){var g=this.decodeSignBit(p,u,d);r[d]=g,n[d]=1,this.setNeighborsSignificance(p,u,d),s[d]|=2}h[d]++,s[d]|=1}}},decodeSignBit:function(t,e,i){var n,r,a,s,o,l,h=this.width,c=this.height,u=this.coefficentsMagnitude,d=this.coefficentsSign;s=e>0&&0!==u[i-1],e+1<h&&0!==u[i+1]?(a=d[i+1],n=s?1-a-(r=d[i-1]):1-a-a):n=s?1-(r=d[i-1])-r:0;var f=3*n;return s=t>0&&0!==u[i-h],t+1<c&&0!==u[i+h]?(a=d[i+h],n=s?1-a-(r=d[i-h])+f:1-a-a+f):n=s?1-(r=d[i-h])-r+f:f,n>=0?(o=9+n,l=this.decoder.readBit(this.contexts,o)):(o=9-n,l=1^this.decoder.readBit(this.contexts,o)),l},runMagnitudeRefinementPass:function(){for(var t,e=this.decoder,i=this.width,n=this.height,r=this.coefficentsMagnitude,a=this.neighborsSignificance,s=this.contexts,o=this.bitsDecoded,l=this.processingFlags,h=i*n,c=4*i,u=0;u<h;u=t){t=Math.min(h,u+c);for(var d=0;d<i;d++)for(var f=u+d;f<t;f+=i)if(r[f]&&0==(1&l[f])){var p=16;if(0!=(2&l[f]))l[f]^=2,p=0===(127&a[f])?15:14;var m=e.readBit(s,p);r[f]=r[f]<<1|m,o[f]++,l[f]|=1}}},runCleanupPass:function(){for(var t,e=this.decoder,i=this.width,n=this.height,r=this.neighborsSignificance,a=this.coefficentsMagnitude,s=this.coefficentsSign,o=this.contexts,l=this.contextLabelTable,h=this.bitsDecoded,c=this.processingFlags,u=i,d=2*i,f=3*i,p=0;p<n;p=t){t=Math.min(p+4,n);for(var m=p*i,g=p+3<n,v=0;v<i;v++){var _,y=m+v,b=0,x=y,w=p;if(g&&0===c[y]&&0===c[y+u]&&0===c[y+d]&&0===c[y+f]&&0===r[y]&&0===r[y+u]&&0===r[y+d]&&0===r[y+f]){if(!e.readBit(o,18)){h[y]++,h[y+u]++,h[y+d]++,h[y+f]++;continue}0!==(b=e.readBit(o,17)<<1|e.readBit(o,17))&&(w=p+b,x+=b*i),_=this.decodeSignBit(w,v,x),s[x]=_,a[x]=1,this.setNeighborsSignificance(w,v,x),c[x]|=2,x=y;for(var E=p;E<=w;E++,x+=i)h[x]++;b++}for(w=p+b;w<t;w++,x+=i)if(!a[x]&&0==(1&c[x])){var S=l[r[x]];1===e.readBit(o,S)&&(_=this.decodeSignBit(w,v,x),s[x]=_,a[x]=1,this.setNeighborsSignificance(w,v,x),c[x]|=2),h[x]++}}}},checkSegmentationSymbol:function(){var t=this.decoder,e=this.contexts;if(10!==(t.readBit(e,17)<<3|t.readBit(e,17)<<2|t.readBit(e,17)<<1|t.readBit(e,17)))throw new Error("JPX Error: Invalid segmentation symbol")}},n}(),S=function(){function t(){}return t.prototype.calculate=function(t,e,i){for(var n=t[0],r=1,a=t.length;r<a;r++)n=this.iterate(n,t[r],e,i);return n},t.prototype.extend=function(t,e,i){var n=e-1,r=e+1,a=e+i-2,s=e+i;t[n--]=t[r++],t[s++]=t[a--],t[n--]=t[r++],t[s++]=t[a--],t[n--]=t[r++],t[s++]=t[a--],t[n]=t[r],t[s]=t[a]},t.prototype.iterate=function(t,e,i,n){var r,a,s,o,l,h,c=t.width,u=t.height,d=t.items,f=e.width,p=e.height,m=e.items;for(s=0,r=0;r<u;r++)for(o=2*r*f,a=0;a<c;a++,s++,o+=2)m[o]=d[s];d=t.items=null;var g=new Float32Array(f+8);if(1===f){if(0!=(1&i))for(h=0,s=0;h<p;h++,s+=f)m[s]*=.5}else for(h=0,s=0;h<p;h++,s+=f)g.set(m.subarray(s,s+f),4),this.extend(g,4,f),this.filter(g,4,f),m.set(g.subarray(4,4+f),s);var v=16,_=[];for(r=0;r<v;r++)_.push(new Float32Array(p+8));var y,b=0;if(t=4+p,1===p){if(0!=(1&n))for(l=0;l<f;l++)m[l]*=.5}else for(l=0;l<f;l++){if(0===b){for(v=Math.min(f-l,v),s=l,o=4;o<t;s+=f,o++)for(y=0;y<v;y++)_[y][o]=m[s+y];b=v}var x=_[--b];if(this.extend(x,4,p),this.filter(x,4,p),0===b)for(s=l-v+1,o=4;o<t;s+=f,o++)for(y=0;y<v;y++)m[s+y]=_[y][o]}return{width:f,height:p,items:m}},t}(),T=function(){function t(){S.call(this)}return t.prototype=Object.create(S.prototype),t.prototype.filter=function(t,e,i){var n,r,a,s,o=i>>1,l=-1.586134342059924,h=-.052980118572961,c=.882911075530934,u=.443506852043971,d=1.230174104914001;for(n=(e|=0)-3,r=o+4;r--;n+=2)t[n]*=.8128930661159609;for(a=u*t[(n=e-2)-1],r=o+3;r--&&(s=u*t[n+1],t[n]=d*t[n]-a-s,r--);n+=2)a=u*t[(n+=2)+1],t[n]=d*t[n]-a-s;for(a=c*t[(n=e-1)-1],r=o+2;r--&&(s=c*t[n+1],t[n]-=a+s,r--);n+=2)a=c*t[(n+=2)+1],t[n]-=a+s;for(a=h*t[(n=e)-1],r=o+1;r--&&(s=h*t[n+1],t[n]-=a+s,r--);n+=2)a=h*t[(n+=2)+1],t[n]-=a+s;if(0!==o)for(a=l*t[(n=e+1)-1],r=o;r--&&(s=l*t[n+1],t[n]-=a+s,r--);n+=2)a=l*t[(n+=2)+1],t[n]-=a+s},t}(),M=function(){function t(){S.call(this)}return t.prototype=Object.create(S.prototype),t.prototype.filter=function(t,e,i){var n,r,a=i>>1;for(n=e|=0,r=a+1;r--;n+=2)t[n]-=t[n-1]+t[n+1]+2>>2;for(n=e+1,r=a;r--;n+=2)t[n]+=t[n-1]+t[n+1]>>1},t}();return e}(),r=function(){var t=[{qe:22017,nmps:1,nlps:1,switchFlag:1},{qe:13313,nmps:2,nlps:6,switchFlag:0},{qe:6145,nmps:3,nlps:9,switchFlag:0},{qe:2753,nmps:4,nlps:12,switchFlag:0},{qe:1313,nmps:5,nlps:29,switchFlag:0},{qe:545,nmps:38,nlps:33,switchFlag:0},{qe:22017,nmps:7,nlps:6,switchFlag:1},{qe:21505,nmps:8,nlps:14,switchFlag:0},{qe:18433,nmps:9,nlps:14,switchFlag:0},{qe:14337,nmps:10,nlps:14,switchFlag:0},{qe:12289,nmps:11,nlps:17,switchFlag:0},{qe:9217,nmps:12,nlps:18,switchFlag:0},{qe:7169,nmps:13,nlps:20,switchFlag:0},{qe:5633,nmps:29,nlps:21,switchFlag:0},{qe:22017,nmps:15,nlps:14,switchFlag:1},{qe:21505,nmps:16,nlps:14,switchFlag:0},{qe:20737,nmps:17,nlps:15,switchFlag:0},{qe:18433,nmps:18,nlps:16,switchFlag:0},{qe:14337,nmps:19,nlps:17,switchFlag:0},{qe:13313,nmps:20,nlps:18,switchFlag:0},{qe:12289,nmps:21,nlps:19,switchFlag:0},{qe:10241,nmps:22,nlps:19,switchFlag:0},{qe:9217,nmps:23,nlps:20,switchFlag:0},{qe:8705,nmps:24,nlps:21,switchFlag:0},{qe:7169,nmps:25,nlps:22,switchFlag:0},{qe:6145,nmps:26,nlps:23,switchFlag:0},{qe:5633,nmps:27,nlps:24,switchFlag:0},{qe:5121,nmps:28,nlps:25,switchFlag:0},{qe:4609,nmps:29,nlps:26,switchFlag:0},{qe:4353,nmps:30,nlps:27,switchFlag:0},{qe:2753,nmps:31,nlps:28,switchFlag:0},{qe:2497,nmps:32,nlps:29,switchFlag:0},{qe:2209,nmps:33,nlps:30,switchFlag:0},{qe:1313,nmps:34,nlps:31,switchFlag:0},{qe:1089,nmps:35,nlps:32,switchFlag:0},{qe:673,nmps:36,nlps:33,switchFlag:0},{qe:545,nmps:37,nlps:34,switchFlag:0},{qe:321,nmps:38,nlps:35,switchFlag:0},{qe:273,nmps:39,nlps:36,switchFlag:0},{qe:133,nmps:40,nlps:37,switchFlag:0},{qe:73,nmps:41,nlps:38,switchFlag:0},{qe:37,nmps:42,nlps:39,switchFlag:0},{qe:21,nmps:43,nlps:40,switchFlag:0},{qe:9,nmps:44,nlps:41,switchFlag:0},{qe:5,nmps:45,nlps:42,switchFlag:0},{qe:1,nmps:45,nlps:43,switchFlag:0},{qe:22017,nmps:46,nlps:46,switchFlag:0}];function e(t,e,i){this.data=t,this.bp=e,this.dataEnd=i,this.chigh=t[e],this.clow=0,this.byteIn(),this.chigh=this.chigh<<7&65535|this.clow>>9&127,this.clow=this.clow<<7&65535,this.ct-=7,this.a=32768}return e.prototype={byteIn:function(){var t=this.data,e=this.bp;255===t[e]?t[e+1]>143?(this.clow+=65280,this.ct=8):(e++,this.clow+=t[e]<<9,this.ct=7,this.bp=e):(e++,this.clow+=e<this.dataEnd?t[e]<<8:65280,this.ct=8,this.bp=e);this.clow>65535&&(this.chigh+=this.clow>>16,this.clow&=65535)},readBit:function(e,i){var n,r=e[i]>>1,a=1&e[i],s=t[r],o=s.qe,l=this.a-o;if(this.chigh<o)l<o?(l=o,n=a,r=s.nmps):(l=o,n=1^a,1===s.switchFlag&&(a=n),r=s.nlps);else{if(this.chigh-=o,0!=(32768&l))return this.a=l,a;l<o?(n=1^a,1===s.switchFlag&&(a=n),r=s.nlps):(n=a,r=s.nmps)}do{0===this.ct&&this.byteIn(),l<<=1,this.chigh=this.chigh<<1&65535|this.clow>>15&1,this.clow=this.clow<<1&65535,this.ct--}while(0==(32768&l));return this.a=l,e[i]=r<<1|a,n}},e}(),a="undefined"==typeof window?this:window;a.PDFJS||(a.PDFJS={}),a.PDFJS.pdfBug=!1,PDFJS.VERBOSITY_LEVELS={errors:0,warnings:1,infos:5};PDFJS.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};function s(t){PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.infos&&console.log("Info: "+t)}function o(t){PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.warnings&&console.log("Warning: "+t)}var l;PDFJS.UNSUPPORTED_FEATURES={unknown:"unknown",forms:"forms",javaScript:"javaScript",smask:"smask",shadingPattern:"shadingPattern",font:"font"},PDFJS.UnsupportedManager=(l=[],{listen:function(t){l.push(t)},notify:function(t){o('Unsupported feature "'+t+'"');for(var e=0,i=l.length;e<i;e++)l[e](t)}});function h(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!1}),i}PDFJS.isValidUrl=function(t,e){if(!t)return!1;var i=/^[a-z][a-z0-9+\-.]*(?=:)/i.exec(t);if(!i)return e;switch(i=i[0].toLowerCase()){case"http":case"https":case"ftp":case"mailto":case"tel":return!0;default:return!1}},PDFJS.shadow=h;PDFJS.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};var c=function(){function t(t,e){this.name="PasswordException",this.message=t,this.code=e}return t.prototype=new Error,t.constructor=t,t}();PDFJS.PasswordException=c;var u=function(){function t(t,e){this.name="UnknownErrorException",this.message=t,this.details=e}return t.prototype=new Error,t.constructor=t,t}();PDFJS.UnknownErrorException=u;var d=function(){function t(t){this.name="InvalidPDFException",this.message=t}return t.prototype=new Error,t.constructor=t,t}();PDFJS.InvalidPDFException=d;var f=function(){function t(t){this.name="MissingPDFException",this.message=t}return t.prototype=new Error,t.constructor=t,t}();PDFJS.MissingPDFException=f;var p=function(){function t(t,e){this.name="UnexpectedResponseException",this.message=t,this.status=e}return t.prototype=new Error,t.constructor=t,t}();PDFJS.UnexpectedResponseException=p;(function(){function t(t){this.message=t}t.prototype=new Error,t.prototype.name="NotImplementedException",t.constructor=t})(),function(){function t(t,e){this.begin=t,this.end=e,this.message="Missing data ["+t+", "+e+")"}t.prototype=new Error,t.prototype.name="MissingDataException",t.constructor=t}(),function(){function t(t){this.message=t}t.prototype=new Error,t.prototype.name="XRefParseException",t.constructor=t}();function m(t){for(var e=1,i=0;t>e;)e<<=1,i++;return i}function g(t,e){return t[e]<<8|t[e+1]}function v(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}Object.defineProperty(PDFJS,"isLittleEndian",{configurable:!0,get:function(){return h(PDFJS,"isLittleEndian",((t=new Uint8Array(2))[0]=1,1===new Uint16Array(t.buffer)[0]));var t}}),Object.defineProperty(PDFJS,"hasCanvasTypedArrays",{configurable:!0,get:function(){return h(PDFJS,"hasCanvasTypedArrays",((t=document.createElement("canvas")).width=t.height=1,void 0!==t.getContext("2d").createImageData(1,1).data.buffer));var t}});!function(){function t(n,r){this.buffer=n,this.byteLength=n.length,this.length=void 0===r?this.byteLength>>2:r,function(n){for(;e<n;)Object.defineProperty(t.prototype,e,i(e)),e++}(this.length)}t.prototype=Object.create(null);var e=0;function i(t){return{get:function(){var e=this.buffer,i=t<<2;return(e[i]|e[i+1]<<8|e[i+2]<<16|e[i+3]<<24)>>>0},set:function(e){var i=this.buffer,n=t<<2;i[n]=255&e,i[n+1]=e>>8&255,i[n+2]=e>>16&255,i[n+3]=e>>>24&255}}}}();var _=PDFJS.Util=function(){function t(){}var e=["rgb(",0,",",0,",",0,")"];return t.makeCssRgb=function(t,i,n){return e[1]=t,e[3]=i,e[5]=n,e.join("")},t.transform=function(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]},t.applyTransform=function(t,e){return[t[0]*e[0]+t[1]*e[2]+e[4],t[0]*e[1]+t[1]*e[3]+e[5]]},t.applyInverseTransform=function(t,e){var i=e[0]*e[3]-e[1]*e[2];return[(t[0]*e[3]-t[1]*e[2]+e[2]*e[5]-e[4]*e[3])/i,(-t[0]*e[1]+t[1]*e[0]+e[4]*e[1]-e[5]*e[0])/i]},t.getAxialAlignedBoundingBox=function(e,i){var n=t.applyTransform(e,i),r=t.applyTransform(e.slice(2,4),i),a=t.applyTransform([e[0],e[3]],i),s=t.applyTransform([e[2],e[1]],i);return[Math.min(n[0],r[0],a[0],s[0]),Math.min(n[1],r[1],a[1],s[1]),Math.max(n[0],r[0],a[0],s[0]),Math.max(n[1],r[1],a[1],s[1])]},t.inverseTransform=function(t){var e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]},t.apply3dTransform=function(t,e){return[t[0]*e[0]+t[1]*e[1]+t[2]*e[2],t[3]*e[0]+t[4]*e[1]+t[5]*e[2],t[6]*e[0]+t[7]*e[1]+t[8]*e[2]]},t.singularValueDecompose2dScale=function(t){var e=[t[0],t[2],t[1],t[3]],i=t[0]*e[0]+t[1]*e[2],n=t[0]*e[1]+t[1]*e[3],r=t[2]*e[0]+t[3]*e[2],a=t[2]*e[1]+t[3]*e[3],s=(i+a)/2,o=Math.sqrt((i+a)*(i+a)-4*(i*a-r*n))/2,l=s+o||1,h=s-o||1;return[Math.sqrt(l),Math.sqrt(h)]},t.normalizeRect=function(t){var e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e},t.intersect=function(e,i){function n(t,e){return t-e}var r=[e[0],e[2],i[0],i[2]].sort(n),a=[e[1],e[3],i[1],i[3]].sort(n),s=[];return e=t.normalizeRect(e),i=t.normalizeRect(i),(r[0]===e[0]&&r[1]===i[0]||r[0]===i[0]&&r[1]===e[0])&&(s[0]=r[1],s[2]=r[2],(a[0]===e[1]&&a[1]===i[1]||a[0]===i[1]&&a[1]===e[1])&&(s[1]=a[1],s[3]=a[2],s))},t.sign=function(t){return t<0?-1:1},t.appendToArray=function(t,e){Array.prototype.push.apply(t,e)},t.prependToArray=function(t,e){Array.prototype.unshift.apply(t,e)},t.extendObj=function(t,e){for(var i in e)t[i]=e[i]},t.getInheritableProperty=function(t,e){for(;t&&!t.has(e);)t=t.get("Parent");return t?t.get(e):null},t.inherit=function(t,e,i){for(var n in t.prototype=Object.create(e.prototype),t.prototype.constructor=t,i)t.prototype[n]=i[n]},t.loadScript=function(t,e){var i=document.createElement("script"),n=!1;i.setAttribute("src",t),e&&(i.onload=function(){n||e(),n=!0}),document.getElementsByTagName("head")[0].appendChild(i)},t}();PDFJS.PageViewport=function(){function t(t,e,i,n,r,a){this.viewBox=t,this.scale=e,this.rotation=i,this.offsetX=n,this.offsetY=r;var s,o,l,h,c,u,d,f,p=(t[2]+t[0])/2,m=(t[3]+t[1])/2;switch(i=(i%=360)<0?i+360:i){case 180:s=-1,o=0,l=0,h=1;break;case 90:s=0,o=1,l=1,h=0;break;case 270:s=0,o=-1,l=-1,h=0;break;default:s=1,o=0,l=0,h=-1}a&&(l=-l,h=-h),0===s?(c=Math.abs(m-t[1])*e+n,u=Math.abs(p-t[0])*e+r,d=Math.abs(t[3]-t[1])*e,f=Math.abs(t[2]-t[0])*e):(c=Math.abs(p-t[0])*e+n,u=Math.abs(m-t[1])*e+r,d=Math.abs(t[2]-t[0])*e,f=Math.abs(t[3]-t[1])*e),this.transform=[s*e,o*e,l*e,h*e,c-s*e*p-l*e*m,u-o*e*p-h*e*m],this.width=d,this.height=f,this.fontScale=e}return t.prototype={clone:function(e){var i="scale"in(e=e||{})?e.scale:this.scale,n="rotation"in e?e.rotation:this.rotation;return new t(this.viewBox.slice(),i,n,this.offsetX,this.offsetY,e.dontFlip)},convertToViewportPoint:function(t,e){return _.applyTransform([t,e],this.transform)},convertToViewportRectangle:function(t){var e=_.applyTransform([t[0],t[1]],this.transform),i=_.applyTransform([t[2],t[3]],this.transform);return[e[0],e[1],i[0],i[1]]},convertToPdfPoint:function(t,e){return _.applyInverseTransform([t,e],this.transform)}},t}();function y(){var t={};return t.promise=new Promise(function(e,i){t.resolve=e,t.reject=i}),t}PDFJS.createPromiseCapability=y,function(){if(a.Promise)return"function"!=typeof a.Promise.all&&(a.Promise.all=function(t){var e,i,n=0,r=[],s=new a.Promise(function(t,n){e=t,i=n});return t.forEach(function(t,a){n++,t.then(function(t){r[a]=t,0===--n&&e(r)},i)}),0===n&&e(r),s}),"function"!=typeof a.Promise.resolve&&(a.Promise.resolve=function(t){return new a.Promise(function(e){e(t)})}),"function"!=typeof a.Promise.reject&&(a.Promise.reject=function(t){return new a.Promise(function(e,i){i(t)})}),void("function"!=typeof a.Promise.prototype.catch&&(a.Promise.prototype.catch=function(t){return a.Promise.prototype.then(void 0,t)}));var t=0,e=2,i={handlers:[],running:!1,unhandledRejections:[],pendingRejectionCheck:!1,scheduleHandlers:function(e){e._status!==t&&(this.handlers=this.handlers.concat(e._handlers),e._handlers=[],this.running||(this.running=!0,setTimeout(this.runHandlers.bind(this),0)))},runHandlers:function(){for(var t=Date.now()+1;this.handlers.length>0;){var i=this.handlers.shift(),n=i.thisPromise._status,r=i.thisPromise._value;try{1===n?"function"==typeof i.onResolve&&(r=i.onResolve(r)):"function"==typeof i.onReject&&(r=i.onReject(r),n=1,i.thisPromise._unhandledRejection&&this.removeUnhandeledRejection(i.thisPromise))}catch(t){n=e,r=t}if(i.nextPromise._updateStatus(n,r),Date.now()>=t)break}this.handlers.length>0?setTimeout(this.runHandlers.bind(this),0):this.running=!1},addUnhandledRejection:function(t){this.unhandledRejections.push({promise:t,time:Date.now()}),this.scheduleRejectionCheck()},removeUnhandeledRejection:function(t){t._unhandledRejection=!1;for(var e=0;e<this.unhandledRejections.length;e++)this.unhandledRejections[e].promise===t&&(this.unhandledRejections.splice(e),e--)},scheduleRejectionCheck:function(){this.pendingRejectionCheck||(this.pendingRejectionCheck=!0,setTimeout(function(){this.pendingRejectionCheck=!1;for(var t=Date.now(),e=0;e<this.unhandledRejections.length;e++)if(t-this.unhandledRejections[e].time>500){var i=this.unhandledRejections[e].promise._value,n="Unhandled rejection: "+i;i.stack&&(n+="\n"+i.stack),o(n),this.unhandledRejections.splice(e),e--}this.unhandledRejections.length&&this.scheduleRejectionCheck()}.bind(this),500))}};function n(e){this._status=t,this._handlers=[];try{e.call(this,this._resolve.bind(this),this._reject.bind(this))}catch(t){this._reject(t)}}n.all=function(t){var i,r,a=new n(function(t,e){i=t,r=e}),s=t.length,o=[];if(0===s)return i(o),a;function l(t){a._status!==e&&(o=[],r(t))}for(var h=0,c=t.length;h<c;++h){var u=t[h],d=function(t){return function(n){a._status!==e&&(o[t]=n,0===--s&&i(o))}}(h);n.isPromise(u)?u.then(d,l):d(u)}return a},n.isPromise=function(t){return t&&"function"==typeof t.then},n.resolve=function(t){return new n(function(e){e(t)})},n.reject=function(t){return new n(function(e,i){i(t)})},n.prototype={_status:null,_value:null,_handlers:null,_unhandledRejection:null,_updateStatus:function(t,r){1!==this._status&&this._status!==e&&(1===t&&n.isPromise(r)?r.then(this._updateStatus.bind(this,1),this._updateStatus.bind(this,e)):(this._status=t,this._value=r,t===e&&0===this._handlers.length&&(this._unhandledRejection=!0,i.addUnhandledRejection(this)),i.scheduleHandlers(this)))},_resolve:function(t){this._updateStatus(1,t)},_reject:function(t){this._updateStatus(e,t)},then:function(t,e){var r=new n(function(t,e){this.resolve=t,this.reject=e});return this._handlers.push({thisPromise:this,onResolve:t,onReject:e,nextPromise:r}),i.scheduleHandlers(this),r},catch:function(t){return this.then(void 0,t)}},a.Promise=n}();var b;!function(){function t(t,e,i){for(;t.length<i;)t+=e;return t}function e(){this.started={},this.times=[],this.enabled=!0}e.prototype={time:function(t){this.enabled&&(t in this.started&&o("Timer is already running for "+t),this.started[t]=Date.now())},timeEnd:function(t){this.enabled&&(t in this.started||o("Timer has not been started for "+t),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t])},toString:function(){var e,i,n=this.times,r="",a=0;for(e=0,i=n.length;e<i;++e){var s=n[e].name;s.length>a&&(a=s.length)}for(e=0,i=n.length;e<i;++e){var o=n[e],l=o.end-o.start;r+=t(o.name," ",a)+" "+l+"ms\n"}return r}}}();PDFJS.createBlob=function(t,e){if("undefined"!=typeof Blob)return new Blob([t],{type:e});var i=new MozBlobBuilder;return i.append(t),i.getBlob(e)},PDFJS.createObjectURL=(b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",function(t,e){if(!PDFJS.disableCreateObjectURL&&"undefined"!=typeof URL&&URL.createObjectURL){var i=PDFJS.createBlob(t,e);return URL.createObjectURL(i)}for(var n="data:"+e+";base64,",r=0,a=t.length;r<a;r+=3){var s=255&t[r],o=255&t[r+1],l=255&t[r+2];n+=b[s>>2]+b[(3&s)<<4|o>>4]+b[r+1<a?(15&o)<<2|l>>6:64]+b[r+2<a?63&l:64]}return n}),"undefined"!==typeof t&&t.exports&&(t.exports=n)},LC74:function(t,e){"function"==typeof Object.create?t.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(t,e){if(e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}}},LGU4:function(t,e,i){"use strict";var n=i("fkix"),r=i("gt5T"),a=i("LjBA"),s=i("0jOE"),o=i("2A+V"),l=i("h95s"),h=i("6ktE"),c=Object.prototype.toString;function u(t){if(!(this instanceof u))return new u(t);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var i=n.inflateInit2(this.strm,e.windowBits);if(i!==s.Z_OK)throw new Error(o[i]);if(this.header=new h,n.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=a.string2buf(e.dictionary):"[object ArrayBuffer]"===c.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(i=n.inflateSetDictionary(this.strm,e.dictionary))!==s.Z_OK))throw new Error(o[i])}function d(t,e){var i=new u(e);if(i.push(t,!0),i.err)throw i.msg||o[i.err];return i.result}u.prototype.push=function(t,e){var i,o,l,h,u,d=this.strm,f=this.options.chunkSize,p=this.options.dictionary,m=!1;if(this.ended)return!1;o=e===~~e?e:!0===e?s.Z_FINISH:s.Z_NO_FLUSH,"string"==typeof t?d.input=a.binstring2buf(t):"[object ArrayBuffer]"===c.call(t)?d.input=new Uint8Array(t):d.input=t,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new r.Buf8(f),d.next_out=0,d.avail_out=f),(i=n.inflate(d,s.Z_NO_FLUSH))===s.Z_NEED_DICT&&p&&(i=n.inflateSetDictionary(this.strm,p)),i===s.Z_BUF_ERROR&&!0===m&&(i=s.Z_OK,m=!1),i!==s.Z_STREAM_END&&i!==s.Z_OK)return this.onEnd(i),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&i!==s.Z_STREAM_END&&(0!==d.avail_in||o!==s.Z_FINISH&&o!==s.Z_SYNC_FLUSH)||("string"===this.options.to?(l=a.utf8border(d.output,d.next_out),h=d.next_out-l,u=a.buf2string(d.output,l),d.next_out=h,d.avail_out=f-h,h&&r.arraySet(d.output,d.output,l,h,0),this.onData(u)):this.onData(r.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(m=!0)}while((d.avail_in>0||0===d.avail_out)&&i!==s.Z_STREAM_END);return i===s.Z_STREAM_END&&(o=s.Z_FINISH),o===s.Z_FINISH?(i=n.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===s.Z_OK):o!==s.Z_SYNC_FLUSH||(this.onEnd(s.Z_OK),d.avail_out=0,!0)},u.prototype.onData=function(t){this.chunks.push(t)},u.prototype.onEnd=function(t){t===s.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Inflate=u,e.inflate=d,e.inflateRaw=function(t,e){return(e=e||{}).raw=!0,d(t,e)},e.ungzip=d},LjBA:function(t,e,i){"use strict";var n=i("gt5T"),r=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(t){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){a=!1}for(var s=new n.Buf8(256),o=0;o<256;o++)s[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;function l(t,e){if(e<65534&&(t.subarray&&a||!t.subarray&&r))return String.fromCharCode.apply(null,n.shrinkBuf(t,e));for(var i="",s=0;s<e;s++)i+=String.fromCharCode(t[s]);return i}s[254]=s[254]=1,e.string2buf=function(t){var e,i,r,a,s,o=t.length,l=0;for(a=0;a<o;a++)55296==(64512&(i=t.charCodeAt(a)))&&a+1<o&&56320==(64512&(r=t.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(r-56320),a++),l+=i<128?1:i<2048?2:i<65536?3:4;for(e=new n.Buf8(l),s=0,a=0;s<l;a++)55296==(64512&(i=t.charCodeAt(a)))&&a+1<o&&56320==(64512&(r=t.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(r-56320),a++),i<128?e[s++]=i:i<2048?(e[s++]=192|i>>>6,e[s++]=128|63&i):i<65536?(e[s++]=224|i>>>12,e[s++]=128|i>>>6&63,e[s++]=128|63&i):(e[s++]=240|i>>>18,e[s++]=128|i>>>12&63,e[s++]=128|i>>>6&63,e[s++]=128|63&i);return e},e.buf2binstring=function(t){return l(t,t.length)},e.binstring2buf=function(t){for(var e=new n.Buf8(t.length),i=0,r=e.length;i<r;i++)e[i]=t.charCodeAt(i);return e},e.buf2string=function(t,e){var i,n,r,a,o=e||t.length,h=new Array(2*o);for(n=0,i=0;i<o;)if((r=t[i++])<128)h[n++]=r;else if((a=s[r])>4)h[n++]=65533,i+=a-1;else{for(r&=2===a?31:3===a?15:7;a>1&&i<o;)r=r<<6|63&t[i++],a--;a>1?h[n++]=65533:r<65536?h[n++]=r:(r-=65536,h[n++]=55296|r>>10&1023,h[n++]=56320|1023&r)}return l(h,n)},e.utf8border=function(t,e){var i;for((e=e||t.length)>t.length&&(e=t.length),i=e-1;i>=0&&128==(192&t[i]);)i--;return i<0?e:0===i?e:i+s[t[i]]>e?i:e}},MsCo:function(t,e,i){(function(t,n){var r;/*! https://mths.be/punycode v1.4.1 by @mathias */!function(a){"object"==typeof e&&e&&e.nodeType,"object"==typeof t&&t&&t.nodeType;var s="object"==typeof n&&n;s.global!==s&&s.window!==s&&s.self;var o,l=2147483647,h=36,c=1,u=26,d=38,f=700,p=72,m=128,g="-",v=/^xn--/,_=/[^\x20-\x7E]/,y=/[\x2E\u3002\uFF0E\uFF61]/g,b={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=h-c,w=Math.floor,E=String.fromCharCode;function S(t){throw new RangeError(b[t])}function T(t,e){for(var i=t.length,n=[];i--;)n[i]=e(t[i]);return n}function M(t,e){var i=t.split("@"),n="";return i.length>1&&(n=i[0]+"@",t=i[1]),n+T((t=t.replace(y,".")).split("."),e).join(".")}function A(t){for(var e,i,n=[],r=0,a=t.length;r<a;)(e=t.charCodeAt(r++))>=55296&&e<=56319&&r<a?56320==(64512&(i=t.charCodeAt(r++)))?n.push(((1023&e)<<10)+(1023&i)+65536):(n.push(e),r--):n.push(e);return n}function I(t){return T(t,function(t){var e="";return t>65535&&(e+=E((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=E(t)}).join("")}function C(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function P(t,e,i){var n=0;for(t=i?w(t/f):t>>1,t+=w(t/e);t>x*u>>1;n+=h)t=w(t/x);return w(n+(x+1)*t/(t+d))}function R(t){var e,i,n,r,a,s,o,d,f,v,_,y=[],b=t.length,x=0,E=m,T=p;for((i=t.lastIndexOf(g))<0&&(i=0),n=0;n<i;++n)t.charCodeAt(n)>=128&&S("not-basic"),y.push(t.charCodeAt(n));for(r=i>0?i+1:0;r<b;){for(a=x,s=1,o=h;r>=b&&S("invalid-input"),((d=(_=t.charCodeAt(r++))-48<10?_-22:_-65<26?_-65:_-97<26?_-97:h)>=h||d>w((l-x)/s))&&S("overflow"),x+=d*s,!(d<(f=o<=T?c:o>=T+u?u:o-T));o+=h)s>w(l/(v=h-f))&&S("overflow"),s*=v;T=P(x-a,e=y.length+1,0==a),w(x/e)>l-E&&S("overflow"),E+=w(x/e),x%=e,y.splice(x++,0,E)}return I(y)}function L(t){var e,i,n,r,a,s,o,d,f,v,_,y,b,x,T,M=[];for(y=(t=A(t)).length,e=m,i=0,a=p,s=0;s<y;++s)(_=t[s])<128&&M.push(E(_));for(n=r=M.length,r&&M.push(g);n<y;){for(o=l,s=0;s<y;++s)(_=t[s])>=e&&_<o&&(o=_);for(o-e>w((l-i)/(b=n+1))&&S("overflow"),i+=(o-e)*b,e=o,s=0;s<y;++s)if((_=t[s])<e&&++i>l&&S("overflow"),_==e){for(d=i,f=h;!(d<(v=f<=a?c:f>=a+u?u:f-a));f+=h)T=d-v,x=h-v,M.push(E(C(v+T%x,0))),d=w(T/x);M.push(E(C(d,0))),a=P(i,b,n==r),i=0,++n}++i,++e}return M.join("")}o={version:"1.4.1",ucs2:{decode:A,encode:I},decode:R,encode:L,toASCII:function(t){return M(t,function(t){return _.test(t)?"xn--"+L(t):t})},toUnicode:function(t){return M(t,function(t){return v.test(t)?R(t.slice(4).toLowerCase()):t})}},void 0===(r=function(){return o}.call(e,i,e,t))||(t.exports=r)}()}).call(e,i("3IRH")(t),i("DuR2"))},"N+Om":function(t,e,i){"use strict";(function(e){var n=i("BEQ0");
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function r(t,e){if(t===e)return 0;for(var i=t.length,n=e.length,r=0,a=Math.min(i,n);r<a;++r)if(t[r]!==e[r]){i=t[r],n=e[r];break}return i<n?-1:n<i?1:0}function a(t){return e.Buffer&&"function"==typeof e.Buffer.isBuffer?e.Buffer.isBuffer(t):!(null==t||!t._isBuffer)}var s=i("OMJi"),o=Object.prototype.hasOwnProperty,l=Array.prototype.slice,h="foo"===function(){}.name;function c(t){return Object.prototype.toString.call(t)}function u(t){return!a(t)&&("function"==typeof e.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):!!t&&(t instanceof DataView||!!(t.buffer&&t.buffer instanceof ArrayBuffer))))}var d=t.exports=_,f=/\s*function\s+([^\(\s]*)\s*/;function p(t){if(s.isFunction(t)){if(h)return t.name;var e=t.toString().match(f);return e&&e[1]}}function m(t,e){return"string"==typeof t?t.length<e?t:t.slice(0,e):t}function g(t){if(h||!s.isFunction(t))return s.inspect(t);var e=p(t);return"[Function"+(e?": "+e:"")+"]"}function v(t,e,i,n,r){throw new d.AssertionError({message:i,actual:t,expected:e,operator:n,stackStartFunction:r})}function _(t,e){t||v(t,!0,e,"==",d.ok)}function y(t,e,i,n){if(t===e)return!0;if(a(t)&&a(e))return 0===r(t,e);if(s.isDate(t)&&s.isDate(e))return t.getTime()===e.getTime();if(s.isRegExp(t)&&s.isRegExp(e))return t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase;if(null!==t&&"object"==typeof t||null!==e&&"object"==typeof e){if(u(t)&&u(e)&&c(t)===c(e)&&!(t instanceof Float32Array||t instanceof Float64Array))return 0===r(new Uint8Array(t.buffer),new Uint8Array(e.buffer));if(a(t)!==a(e))return!1;var o=(n=n||{actual:[],expected:[]}).actual.indexOf(t);return-1!==o&&o===n.expected.indexOf(e)||(n.actual.push(t),n.expected.push(e),function(t,e,i,n){if(null===t||void 0===t||null===e||void 0===e)return!1;if(s.isPrimitive(t)||s.isPrimitive(e))return t===e;if(i&&Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;var r=b(t),a=b(e);if(r&&!a||!r&&a)return!1;if(r)return t=l.call(t),e=l.call(e),y(t,e,i);var o,h,c=E(t),u=E(e);if(c.length!==u.length)return!1;for(c.sort(),u.sort(),h=c.length-1;h>=0;h--)if(c[h]!==u[h])return!1;for(h=c.length-1;h>=0;h--)if(o=c[h],!y(t[o],e[o],i,n))return!1;return!0}(t,e,i,n))}return i?t===e:t==e}function b(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function x(t,e){if(!t||!e)return!1;if("[object RegExp]"==Object.prototype.toString.call(e))return e.test(t);try{if(t instanceof e)return!0}catch(t){}return!Error.isPrototypeOf(e)&&!0===e.call({},t)}function w(t,e,i,n){var r;if("function"!=typeof e)throw new TypeError('"block" argument must be a function');"string"==typeof i&&(n=i,i=null),r=function(t){var e;try{t()}catch(t){e=t}return e}(e),n=(i&&i.name?" ("+i.name+").":".")+(n?" "+n:"."),t&&!r&&v(r,i,"Missing expected exception"+n);var a="string"==typeof n,o=!t&&s.isError(r),l=!t&&r&&!i;if((o&&a&&x(r,i)||l)&&v(r,i,"Got unwanted exception"+n),t&&r&&i&&!x(r,i)||!t&&r)throw r}d.AssertionError=function(t){var e;this.name="AssertionError",this.actual=t.actual,this.expected=t.expected,this.operator=t.operator,t.message?(this.message=t.message,this.generatedMessage=!1):(this.message=m(g((e=this).actual),128)+" "+e.operator+" "+m(g(e.expected),128),this.generatedMessage=!0);var i=t.stackStartFunction||v;if(Error.captureStackTrace)Error.captureStackTrace(this,i);else{var n=new Error;if(n.stack){var r=n.stack,a=p(i),s=r.indexOf("\n"+a);if(s>=0){var o=r.indexOf("\n",s+1);r=r.substring(o+1)}this.stack=r}}},s.inherits(d.AssertionError,Error),d.fail=v,d.ok=_,d.equal=function(t,e,i){t!=e&&v(t,e,i,"==",d.equal)},d.notEqual=function(t,e,i){t==e&&v(t,e,i,"!=",d.notEqual)},d.deepEqual=function(t,e,i){y(t,e,!1)||v(t,e,i,"deepEqual",d.deepEqual)},d.deepStrictEqual=function(t,e,i){y(t,e,!0)||v(t,e,i,"deepStrictEqual",d.deepStrictEqual)},d.notDeepEqual=function(t,e,i){y(t,e,!1)&&v(t,e,i,"notDeepEqual",d.notDeepEqual)},d.notDeepStrictEqual=function t(e,i,n){y(e,i,!0)&&v(e,i,n,"notDeepStrictEqual",t)},d.strictEqual=function(t,e,i){t!==e&&v(t,e,i,"===",d.strictEqual)},d.notStrictEqual=function(t,e,i){t===e&&v(t,e,i,"!==",d.notStrictEqual)},d.throws=function(t,e,i){w(!0,t,e,i)},d.doesNotThrow=function(t,e,i){w(!1,t,e,i)},d.ifError=function(t){if(t)throw t},d.strict=n(function t(e,i){e||v(e,!0,i,"==",t)},d,{equal:d.strictEqual,deepEqual:d.deepStrictEqual,notEqual:d.notStrictEqual,notDeepEqual:d.notDeepStrictEqual}),d.strict.strict=d.strict;var E=Object.keys||function(t){var e=[];for(var i in t)o.call(t,i)&&e.push(i);return e}}).call(e,i("DuR2"))},NuSx:function(t,e,i){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.DataStream=n.lossless.DataStream||function(t,e,i){this.buffer=new DataView(t,e,i),this.index=0},n.lossless.DataStream.prototype.get16=function(){var t=this.buffer.getUint16(this.index,!1);return this.index+=2,t},n.lossless.DataStream.prototype.get8=function(){var t=this.buffer.getUint8(this.index);return this.index+=1,t},"undefined"!==typeof t&&t.exports&&(t.exports=n.lossless.DataStream)},OMJi:function(t,e,i){(function(t){var n=Object.getOwnPropertyDescriptors||function(t){for(var e=Object.keys(t),i={},n=0;n<e.length;n++)i[e[n]]=Object.getOwnPropertyDescriptor(t,e[n]);return i},r=/%[sdj%]/g;e.format=function(t){if(!v(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(o(arguments[i]));return e.join(" ")}i=1;for(var n=arguments,a=n.length,s=String(t).replace(r,function(t){if("%%"===t)return"%";if(i>=a)return t;switch(t){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(t){return"[Circular]"}default:return t}}),l=n[i];i<a;l=n[++i])m(l)||!b(l)?s+=" "+l:s+=" "+o(l);return s},e.deprecate=function(i,n){if(void 0!==t&&!0===t.noDeprecation)return i;if(void 0===t)return function(){return e.deprecate(i,n).apply(this,arguments)};var r=!1;return function(){if(!r){if(t.throwDeprecation)throw new Error(n);t.traceDeprecation?console.trace(n):console.error(n),r=!0}return i.apply(this,arguments)}};var a,s={};function o(t,i){var n={seen:[],stylize:h};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),p(i)?n.showHidden=i:i&&e._extend(n,i),_(n.showHidden)&&(n.showHidden=!1),_(n.depth)&&(n.depth=2),_(n.colors)&&(n.colors=!1),_(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=l),c(n,t,n.depth)}function l(t,e){var i=o.styles[e];return i?"["+o.colors[i][0]+"m"+t+"["+o.colors[i][1]+"m":t}function h(t,e){return t}function c(t,i,n){if(t.customInspect&&i&&E(i.inspect)&&i.inspect!==e.inspect&&(!i.constructor||i.constructor.prototype!==i)){var r=i.inspect(n,t);return v(r)||(r=c(t,r,n)),r}var a=function(t,e){if(_(e))return t.stylize("undefined","undefined");if(v(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}if(g(e))return t.stylize(""+e,"number");if(p(e))return t.stylize(""+e,"boolean");if(m(e))return t.stylize("null","null")}(t,i);if(a)return a;var s=Object.keys(i),o=function(t){var e={};return t.forEach(function(t,i){e[t]=!0}),e}(s);if(t.showHidden&&(s=Object.getOwnPropertyNames(i)),w(i)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return u(i);if(0===s.length){if(E(i)){var l=i.name?": "+i.name:"";return t.stylize("[Function"+l+"]","special")}if(y(i))return t.stylize(RegExp.prototype.toString.call(i),"regexp");if(x(i))return t.stylize(Date.prototype.toString.call(i),"date");if(w(i))return u(i)}var h,b="",S=!1,T=["{","}"];(f(i)&&(S=!0,T=["[","]"]),E(i))&&(b=" [Function"+(i.name?": "+i.name:"")+"]");return y(i)&&(b=" "+RegExp.prototype.toString.call(i)),x(i)&&(b=" "+Date.prototype.toUTCString.call(i)),w(i)&&(b=" "+u(i)),0!==s.length||S&&0!=i.length?n<0?y(i)?t.stylize(RegExp.prototype.toString.call(i),"regexp"):t.stylize("[Object]","special"):(t.seen.push(i),h=S?function(t,e,i,n,r){for(var a=[],s=0,o=e.length;s<o;++s)A(e,String(s))?a.push(d(t,e,i,n,String(s),!0)):a.push("");return r.forEach(function(r){r.match(/^\d+$/)||a.push(d(t,e,i,n,r,!0))}),a}(t,i,n,o,s):s.map(function(e){return d(t,i,n,o,e,S)}),t.seen.pop(),function(t,e,i){if(t.reduce(function(t,e){return 0,e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1];return i[0]+e+" "+t.join(", ")+" "+i[1]}(h,b,T)):T[0]+b+T[1]}function u(t){return"["+Error.prototype.toString.call(t)+"]"}function d(t,e,i,n,r,a){var s,o,l;if((l=Object.getOwnPropertyDescriptor(e,r)||{value:e[r]}).get?o=l.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):l.set&&(o=t.stylize("[Setter]","special")),A(n,r)||(s="["+r+"]"),o||(t.seen.indexOf(l.value)<0?(o=m(i)?c(t,l.value,null):c(t,l.value,i-1)).indexOf("\n")>-1&&(o=a?o.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+o.split("\n").map(function(t){return"   "+t}).join("\n")):o=t.stylize("[Circular]","special")),_(s)){if(a&&r.match(/^\d+$/))return o;(s=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=t.stylize(s,"string"))}return s+": "+o}function f(t){return Array.isArray(t)}function p(t){return"boolean"==typeof t}function m(t){return null===t}function g(t){return"number"==typeof t}function v(t){return"string"==typeof t}function _(t){return void 0===t}function y(t){return b(t)&&"[object RegExp]"===S(t)}function b(t){return"object"==typeof t&&null!==t}function x(t){return b(t)&&"[object Date]"===S(t)}function w(t){return b(t)&&("[object Error]"===S(t)||t instanceof Error)}function E(t){return"function"==typeof t}function S(t){return Object.prototype.toString.call(t)}function T(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(i){if(_(a)&&(a=Object({NODE_ENV:"production"}).NODE_DEBUG||""),i=i.toUpperCase(),!s[i])if(new RegExp("\\b"+i+"\\b","i").test(a)){var n=t.pid;s[i]=function(){var t=e.format.apply(e,arguments);console.error("%s %d: %s",i,n,t)}}else s[i]=function(){};return s[i]},e.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=f,e.isBoolean=p,e.isNull=m,e.isNullOrUndefined=function(t){return null==t},e.isNumber=g,e.isString=v,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=_,e.isRegExp=y,e.isObject=b,e.isDate=x,e.isError=w,e.isFunction=E,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=i("fC4T");var M=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function A(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){var t,i;console.log("%s - %s",(t=new Date,i=[T(t.getHours()),T(t.getMinutes()),T(t.getSeconds())].join(":"),[t.getDate(),M[t.getMonth()],i].join(" ")),e.format.apply(e,arguments))},e.inherits=i("ONRY"),e._extend=function(t,e){if(!e||!b(e))return t;for(var i=Object.keys(e),n=i.length;n--;)t[i[n]]=e[i[n]];return t};var I="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function C(t,e){if(!t){var i=new Error("Promise was rejected with a falsy value");i.reason=t,t=i}return e(t)}e.promisify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');if(I&&t[I]){var e;if("function"!=typeof(e=t[I]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,I,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,i,n=new Promise(function(t,n){e=t,i=n}),r=[],a=0;a<arguments.length;a++)r.push(arguments[a]);r.push(function(t,n){t?i(t):e(n)});try{t.apply(this,r)}catch(t){i(t)}return n}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),I&&Object.defineProperty(e,I,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,n(t))},e.promisify.custom=I,e.callbackify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function i(){for(var i=[],n=0;n<arguments.length;n++)i.push(arguments[n]);var r=i.pop();if("function"!=typeof r)throw new TypeError("The last argument must be of type Function");var a=this,s=function(){return r.apply(a,arguments)};e.apply(this,i).then(function(e){t.nextTick(s,null,e)},function(e){t.nextTick(C,e,s)})}return Object.setPrototypeOf(i,Object.getPrototypeOf(e)),Object.defineProperties(i,n(e)),i}}).call(e,i("W2nU"))},ONRY:function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},Ob0N:function(t,e,i){"use strict";var n=n||{};n.Utils=n.Utils||i("kLuP"),n.NIFTI1=n.NIFTI1||i("RfEm"),n.NIFTI2=n.NIFTI2||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.extensionFlag=[0,0,0,0]},n.NIFTI2.MAGIC_COOKIE=540,n.NIFTI2.MAGIC_NUMBER_LOCATION=4,n.NIFTI2.MAGIC_NUMBER=[110,43,50,0,13,10,26,10],n.NIFTI2.prototype.readHeader=function(t){var e,i,r,a,s=new DataView(t),o=n.Utils.getIntAt(s,0,this.littleEndian);if(o!==n.NIFTI2.MAGIC_COOKIE&&(this.littleEndian=!0,o=n.Utils.getIntAt(s,0,this.littleEndian)),o!==n.NIFTI2.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.datatypeCode=n.Utils.getShortAt(s,12,this.littleEndian),this.numBitsPerVoxel=n.Utils.getShortAt(s,14,this.littleEndian),e=0;e<8;e+=1)a=16+8*e,this.dims[e]=n.Utils.getLongAt(s,a,this.littleEndian);for(this.intent_p1=n.Utils.getDoubleAt(s,80,this.littleEndian),this.intent_p2=n.Utils.getDoubleAt(s,88,this.littleEndian),this.intent_p3=n.Utils.getDoubleAt(s,96,this.littleEndian),e=0;e<8;e+=1)a=104+8*e,this.pixDims[e]=n.Utils.getDoubleAt(s,a,this.littleEndian);for(this.vox_offset=n.Utils.getLongAt(s,168,this.littleEndian),this.scl_slope=n.Utils.getDoubleAt(s,176,this.littleEndian),this.scl_inter=n.Utils.getDoubleAt(s,184,this.littleEndian),this.cal_max=n.Utils.getDoubleAt(s,192,this.littleEndian),this.cal_min=n.Utils.getDoubleAt(s,200,this.littleEndian),this.slice_duration=n.Utils.getDoubleAt(s,208,this.littleEndian),this.toffset=n.Utils.getDoubleAt(s,216,this.littleEndian),this.slice_start=n.Utils.getLongAt(s,224,this.littleEndian),this.slice_end=n.Utils.getLongAt(s,232,this.littleEndian),this.description=n.Utils.getStringAt(s,240,320),this.aux_file=n.Utils.getStringAt(s,320,344),this.qform_code=n.Utils.getIntAt(s,344,this.littleEndian),this.sform_code=n.Utils.getIntAt(s,348,this.littleEndian),this.quatern_b=n.Utils.getDoubleAt(s,352,this.littleEndian),this.quatern_c=n.Utils.getDoubleAt(s,360,this.littleEndian),this.quatern_d=n.Utils.getDoubleAt(s,368,this.littleEndian),this.qoffset_x=n.Utils.getDoubleAt(s,376,this.littleEndian),this.qoffset_y=n.Utils.getDoubleAt(s,384,this.littleEndian),this.qoffset_z=n.Utils.getDoubleAt(s,392,this.littleEndian),i=0;i<3;i+=1)for(r=0;r<4;r+=1)a=400+8*(4*i+r),this.affine[i][r]=n.Utils.getDoubleAt(s,a,this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.slice_code=n.Utils.getIntAt(s,496,this.littleEndian),this.xyzt_units=n.Utils.getIntAt(s,500,this.littleEndian),this.intent_code=n.Utils.getIntAt(s,504,this.littleEndian),this.intent_name=n.Utils.getStringAt(s,508,524),this.dim_info=n.Utils.getByteAt(s,524),s.byteLength>n.NIFTI2.MAGIC_COOKIE&&(this.extensionFlag[0]=n.Utils.getByteAt(s,540),this.extensionFlag[1]=n.Utils.getByteAt(s,541),this.extensionFlag[2]=n.Utils.getByteAt(s,542),this.extensionFlag[3]=n.Utils.getByteAt(s,543),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(s),this.extensionCode=this.getExtensionCode(s)))},n.NIFTI2.prototype.toFormattedString=function(){var t=n.Utils.formatNumber,e="";return e+="Datatype = "+ +this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+")\n",e+="Bits Per Voxel =  = "+this.numBitsPerVoxel+"\n",e+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+"\n",e+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+"\n",e+="Voxel Dimensions (1-8): "+t(this.pixDims[0])+", "+t(this.pixDims[1])+", "+t(this.pixDims[2])+", "+t(this.pixDims[3])+", "+t(this.pixDims[4])+", "+t(this.pixDims[5])+", "+t(this.pixDims[6])+", "+t(this.pixDims[7])+"\n",e+="Image Offset = "+this.vox_offset+"\n",e+="Data Scale:  Slope = "+t(this.scl_slope)+"  Intercept = "+t(this.scl_inter)+"\n",e+="Display Range:  Max = "+t(this.cal_max)+"  Min = "+t(this.cal_min)+"\n",e+="Slice Duration = "+this.slice_duration+"\n",e+="Time Axis Shift = "+this.toffset+"\n",e+="Slice Start = "+this.slice_start+"\n",e+="Slice End = "+this.slice_end+"\n",e+='Description: "'+this.description+'"\n',e+='Auxiliary File: "'+this.aux_file+'"\n',e+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+")\n",e+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+")\n",e+="Quaternion Parameters:  b = "+t(this.quatern_b)+"  c = "+t(this.quatern_c)+"  d = "+t(this.quatern_d)+"\n",e+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+"\n",e+="S-Form Parameters X: "+t(this.affine[0][0])+", "+t(this.affine[0][1])+", "+t(this.affine[0][2])+", "+t(this.affine[0][3])+"\n",e+="S-Form Parameters Y: "+t(this.affine[1][0])+", "+t(this.affine[1][1])+", "+t(this.affine[1][2])+", "+t(this.affine[1][3])+"\n",e+="S-Form Parameters Z: "+t(this.affine[2][0])+", "+t(this.affine[2][1])+", "+t(this.affine[2][2])+", "+t(this.affine[2][3])+"\n",e+="Slice Code = "+this.slice_code+"\n",e+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(n.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(n.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+")\n",e+="Intent Code = "+this.intent_code+"\n",e+='Intent Name: "'+this.intent_name+'"\n',e+="Dim Info = "+this.dim_info+"\n"},n.NIFTI2.prototype.getExtensionLocation=function(){return n.NIFTI2.MAGIC_COOKIE+4},n.NIFTI2.prototype.getExtensionSize=n.NIFTI1.prototype.getExtensionSize,n.NIFTI2.prototype.getExtensionCode=n.NIFTI1.prototype.getExtensionCode,n.NIFTI2.prototype.getDatatypeCodeString=n.NIFTI1.prototype.getDatatypeCodeString,n.NIFTI2.prototype.getTransformCodeString=n.NIFTI1.prototype.getTransformCodeString,n.NIFTI2.prototype.getUnitsCodeString=n.NIFTI1.prototype.getUnitsCodeString,n.NIFTI2.prototype.getQformMat=n.NIFTI1.prototype.getQformMat,n.NIFTI2.prototype.convertNiftiQFormToNiftiSForm=n.NIFTI1.prototype.convertNiftiQFormToNiftiSForm,n.NIFTI2.prototype.convertNiftiSFormToNEMA=n.NIFTI1.prototype.convertNiftiSFormToNEMA,n.NIFTI2.prototype.nifti_mat33_mul=n.NIFTI1.prototype.nifti_mat33_mul,n.NIFTI2.prototype.nifti_mat33_determ=n.NIFTI1.prototype.nifti_mat33_determ,"undefined"!==typeof t&&t.exports&&(t.exports=n.NIFTI2)},RfEm:function(t,e,i){"use strict";var n=n||{};n.Utils=n.Utils||i("kLuP"),n.NIFTI1=n.NIFTI1||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.isHDR=!1,this.extensionFlag=[0,0,0,0],this.extensionSize=0,this.extensionCode=0},n.NIFTI1.TYPE_NONE=0,n.NIFTI1.TYPE_BINARY=1,n.NIFTI1.TYPE_UINT8=2,n.NIFTI1.TYPE_INT16=4,n.NIFTI1.TYPE_INT32=8,n.NIFTI1.TYPE_FLOAT32=16,n.NIFTI1.TYPE_COMPLEX64=32,n.NIFTI1.TYPE_FLOAT64=64,n.NIFTI1.TYPE_RGB24=128,n.NIFTI1.TYPE_INT8=256,n.NIFTI1.TYPE_UINT16=512,n.NIFTI1.TYPE_UINT32=768,n.NIFTI1.TYPE_INT64=1024,n.NIFTI1.TYPE_UINT64=1280,n.NIFTI1.TYPE_FLOAT128=1536,n.NIFTI1.TYPE_COMPLEX128=1792,n.NIFTI1.TYPE_COMPLEX256=2048,n.NIFTI1.XFORM_UNKNOWN=0,n.NIFTI1.XFORM_SCANNER_ANAT=1,n.NIFTI1.XFORM_ALIGNED_ANAT=2,n.NIFTI1.XFORM_TALAIRACH=3,n.NIFTI1.XFORM_MNI_152=4,n.NIFTI1.SPATIAL_UNITS_MASK=7,n.NIFTI1.TEMPORAL_UNITS_MASK=56,n.NIFTI1.UNITS_UNKNOWN=0,n.NIFTI1.UNITS_METER=1,n.NIFTI1.UNITS_MM=2,n.NIFTI1.UNITS_MICRON=3,n.NIFTI1.UNITS_SEC=8,n.NIFTI1.UNITS_MSEC=16,n.NIFTI1.UNITS_USEC=24,n.NIFTI1.UNITS_HZ=32,n.NIFTI1.UNITS_PPM=40,n.NIFTI1.UNITS_RADS=48,n.NIFTI1.MAGIC_COOKIE=348,n.NIFTI1.MAGIC_NUMBER_LOCATION=344,n.NIFTI1.MAGIC_NUMBER=[110,43,49],n.NIFTI1.MAGIC_NUMBER2=[110,105,49],n.NIFTI1.EXTENSION_HEADER_SIZE=8,n.NIFTI1.prototype.readHeader=function(t){var e,i,r,a,s=new DataView(t),o=n.Utils.getIntAt(s,0,this.littleEndian);if(o!==n.NIFTI1.MAGIC_COOKIE&&(this.littleEndian=!0,o=n.Utils.getIntAt(s,0,this.littleEndian)),o!==n.NIFTI1.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.dim_info=n.Utils.getByteAt(s,39),e=0;e<8;e+=1)a=40+2*e,this.dims[e]=n.Utils.getShortAt(s,a,this.littleEndian);for(this.intent_p1=n.Utils.getFloatAt(s,56,this.littleEndian),this.intent_p2=n.Utils.getFloatAt(s,60,this.littleEndian),this.intent_p3=n.Utils.getFloatAt(s,64,this.littleEndian),this.intent_code=n.Utils.getShortAt(s,68,this.littleEndian),this.datatypeCode=n.Utils.getShortAt(s,70,this.littleEndian),this.numBitsPerVoxel=n.Utils.getShortAt(s,72,this.littleEndian),this.slice_start=n.Utils.getShortAt(s,74,this.littleEndian),e=0;e<8;e+=1)a=76+4*e,this.pixDims[e]=n.Utils.getFloatAt(s,a,this.littleEndian);for(this.vox_offset=n.Utils.getFloatAt(s,108,this.littleEndian),this.scl_slope=n.Utils.getFloatAt(s,112,this.littleEndian),this.scl_inter=n.Utils.getFloatAt(s,116,this.littleEndian),this.slice_end=n.Utils.getShortAt(s,120,this.littleEndian),this.slice_code=n.Utils.getByteAt(s,122),this.xyzt_units=n.Utils.getByteAt(s,123),this.cal_max=n.Utils.getFloatAt(s,124,this.littleEndian),this.cal_min=n.Utils.getFloatAt(s,128,this.littleEndian),this.slice_duration=n.Utils.getFloatAt(s,132,this.littleEndian),this.toffset=n.Utils.getFloatAt(s,136,this.littleEndian),this.description=n.Utils.getStringAt(s,148,228),this.aux_file=n.Utils.getStringAt(s,228,252),this.qform_code=n.Utils.getShortAt(s,252,this.littleEndian),this.sform_code=n.Utils.getShortAt(s,254,this.littleEndian),this.quatern_b=n.Utils.getFloatAt(s,256,this.littleEndian),this.quatern_c=n.Utils.getFloatAt(s,260,this.littleEndian),this.quatern_d=n.Utils.getFloatAt(s,264,this.littleEndian),this.qoffset_x=n.Utils.getFloatAt(s,268,this.littleEndian),this.qoffset_y=n.Utils.getFloatAt(s,272,this.littleEndian),this.qoffset_z=n.Utils.getFloatAt(s,276,this.littleEndian),i=0;i<3;i+=1)for(r=0;r<4;r+=1)a=280+4*(4*i+r),this.affine[i][r]=n.Utils.getFloatAt(s,a,this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.intent_name=n.Utils.getStringAt(s,328,344),this.magic=n.Utils.getStringAt(s,344,348),this.isHDR=this.magic===n.NIFTI1.MAGIC_NUMBER2,s.byteLength>n.NIFTI1.MAGIC_COOKIE&&(this.extensionFlag[0]=n.Utils.getByteAt(s,348),this.extensionFlag[1]=n.Utils.getByteAt(s,349),this.extensionFlag[2]=n.Utils.getByteAt(s,350),this.extensionFlag[3]=n.Utils.getByteAt(s,351),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(s),this.extensionCode=this.getExtensionCode(s)))},n.NIFTI1.prototype.toFormattedString=function(){var t=n.Utils.formatNumber,e="";return e+="Dim Info = "+this.dim_info+"\n",e+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+"\n",e+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+"\n",e+="Intent Code = "+this.intent_code+"\n",e+="Datatype = "+this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+")\n",e+="Bits Per Voxel = "+this.numBitsPerVoxel+"\n",e+="Slice Start = "+this.slice_start+"\n",e+="Voxel Dimensions (1-8): "+t(this.pixDims[0])+", "+t(this.pixDims[1])+", "+t(this.pixDims[2])+", "+t(this.pixDims[3])+", "+t(this.pixDims[4])+", "+t(this.pixDims[5])+", "+t(this.pixDims[6])+", "+t(this.pixDims[7])+"\n",e+="Image Offset = "+this.vox_offset+"\n",e+="Data Scale:  Slope = "+t(this.scl_slope)+"  Intercept = "+t(this.scl_inter)+"\n",e+="Slice End = "+this.slice_end+"\n",e+="Slice Code = "+this.slice_code+"\n",e+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(n.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(n.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+")\n",e+="Display Range:  Max = "+t(this.cal_max)+"  Min = "+t(this.cal_min)+"\n",e+="Slice Duration = "+this.slice_duration+"\n",e+="Time Axis Shift = "+this.toffset+"\n",e+='Description: "'+this.description+'"\n',e+='Auxiliary File: "'+this.aux_file+'"\n',e+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+")\n",e+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+")\n",e+="Quaternion Parameters:  b = "+t(this.quatern_b)+"  c = "+t(this.quatern_c)+"  d = "+t(this.quatern_d)+"\n",e+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+"\n",e+="S-Form Parameters X: "+t(this.affine[0][0])+", "+t(this.affine[0][1])+", "+t(this.affine[0][2])+", "+t(this.affine[0][3])+"\n",e+="S-Form Parameters Y: "+t(this.affine[1][0])+", "+t(this.affine[1][1])+", "+t(this.affine[1][2])+", "+t(this.affine[1][3])+"\n",e+="S-Form Parameters Z: "+t(this.affine[2][0])+", "+t(this.affine[2][1])+", "+t(this.affine[2][2])+", "+t(this.affine[2][3])+"\n",e+='Intent Name: "'+this.intent_name+'"\n',this.extensionFlag[0]&&(e+="Extension: Size = "+this.extensionSize+"  Code = "+this.extensionCode+"\n"),e},n.NIFTI1.prototype.getDatatypeCodeString=function(t){return t===n.NIFTI1.TYPE_UINT8?"1-Byte Unsigned Integer":t===n.NIFTI1.TYPE_INT16?"2-Byte Signed Integer":t===n.NIFTI1.TYPE_INT32?"4-Byte Signed Integer":t===n.NIFTI1.TYPE_FLOAT32?"4-Byte Float":t===n.NIFTI1.TYPE_FLOAT64?"8-Byte Float":t===n.NIFTI1.TYPE_RGB24?"RGB":t===n.NIFTI1.TYPE_INT8?"1-Byte Signed Integer":t===n.NIFTI1.TYPE_UINT16?"2-Byte Unsigned Integer":t===n.NIFTI1.TYPE_UINT32?"4-Byte Unsigned Integer":t===n.NIFTI1.TYPE_INT64?"8-Byte Signed Integer":t===n.NIFTI1.TYPE_UINT64?"8-Byte Unsigned Integer":"Unknown"},n.NIFTI1.prototype.getTransformCodeString=function(t){return t===n.NIFTI1.XFORM_SCANNER_ANAT?"Scanner":t===n.NIFTI1.XFORM_ALIGNED_ANAT?"Aligned":t===n.NIFTI1.XFORM_TALAIRACH?"Talairach":t===n.NIFTI1.XFORM_MNI_152?"MNI":"Unknown"},n.NIFTI1.prototype.getUnitsCodeString=function(t){return t===n.NIFTI1.UNITS_METER?"Meters":t===n.NIFTI1.UNITS_MM?"Millimeters":t===n.NIFTI1.UNITS_MICRON?"Microns":t===n.NIFTI1.UNITS_SEC?"Seconds":t===n.NIFTI1.UNITS_MSEC?"Milliseconds":t===n.NIFTI1.UNITS_USEC?"Microseconds":t===n.NIFTI1.UNITS_HZ?"Hz":t===n.NIFTI1.UNITS_PPM?"PPM":t===n.NIFTI1.UNITS_RADS?"Rads":"Unknown"},n.NIFTI1.prototype.getQformMat=function(){return this.convertNiftiQFormToNiftiSForm(this.quatern_b,this.quatern_c,this.quatern_d,this.qoffset_x,this.qoffset_y,this.qoffset_z,this.pixDims[1],this.pixDims[2],this.pixDims[3],this.pixDims[0])},n.NIFTI1.prototype.convertNiftiQFormToNiftiSForm=function(t,e,i,n,r,a,s,o,l,h){var c,u,d,f,p=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],m=t,g=e,v=i;return p[3][0]=p[3][1]=p[3][2]=0,p[3][3]=1,(c=1-(m*m+g*g+v*v))<1e-7?(m*=c=1/Math.sqrt(m*m+g*g+v*v),g*=c,v*=c,c=0):c=Math.sqrt(c),u=s>0?s:1,d=o>0?o:1,f=l>0?l:1,h<0&&(f=-f),p[0][0]=(c*c+m*m-g*g-v*v)*u,p[0][1]=2*(m*g-c*v)*d,p[0][2]=2*(m*v+c*g)*f,p[1][0]=2*(m*g+c*v)*u,p[1][1]=(c*c+g*g-m*m-v*v)*d,p[1][2]=2*(g*v-c*m)*f,p[2][0]=2*(m*v-c*g)*u,p[2][1]=2*(g*v+c*m)*d,p[2][2]=(c*c+v*v-g*g-m*m)*f,p[0][3]=n,p[1][3]=r,p[2][3]=a,p},n.NIFTI1.prototype.convertNiftiSFormToNEMA=function(t){var e,i,n,r,a,s,o,l,h,c,u,d,f,p,m,g,v,_,y,b,x,w,E,S,T,M,A,I,C,P,R,L,D;if(p=0,M=[[0,0,0],[0,0,0],[0,0,0]],A=[[0,0,0],[0,0,0],[0,0,0]],e=t[0][0],i=t[0][1],n=t[0][2],r=t[1][0],a=t[1][1],s=t[1][2],o=t[2][0],l=t[2][1],h=t[2][2],0===(c=Math.sqrt(e*e+r*r+o*o)))return null;if(e/=c,r/=c,o/=c,0===(c=Math.sqrt(i*i+a*a+l*l)))return null;if(c=e*(i/=c)+r*(a/=c)+o*(l/=c),Math.abs(c)>1e-4){if(i-=c*e,a-=c*r,l-=c*o,0===(c=Math.sqrt(i*i+a*a+l*l)))return null;i/=c,a/=c,l/=c}if(0===(c=Math.sqrt(n*n+s*s+h*h))?(n=r*l-o*a,s=o*i-l*e,h=e*a-r*i):(n/=c,s/=c,h/=c),c=e*n+r*s+o*h,Math.abs(c)>1e-4){if(n-=c*e,s-=c*r,h-=c*o,0===(c=Math.sqrt(n*n+s*s+h*h)))return null;n/=c,s/=c,h/=c}if(c=i*n+a*s+l*h,Math.abs(c)>1e-4){if(n-=c*i,s-=c*a,h-=c*l,0===(c=Math.sqrt(n*n+s*s+h*h)))return null;n/=c,s/=c,h/=c}if(M[0][0]=e,M[0][1]=i,M[0][2]=n,M[1][0]=r,M[1][1]=a,M[1][2]=s,M[2][0]=o,M[2][1]=l,M[2][2]=h,0===(u=this.nifti_mat33_determ(M)))return null;for(T=-666,_=x=w=E=1,y=2,b=3,d=1;d<=3;d+=1)for(f=1;f<=3;f+=1)if(d!==f)for(p=1;p<=3;p+=1)if(d!==p&&f!==p)for(A[0][0]=A[0][1]=A[0][2]=A[1][0]=A[1][1]=A[1][2]=A[2][0]=A[2][1]=A[2][2]=0,m=-1;m<=1;m+=2)for(g=-1;g<=1;g+=2)for(v=-1;v<=1;v+=2)A[0][d-1]=m,A[1][f-1]=g,A[2][p-1]=v,this.nifti_mat33_determ(A)*u>0&&(c=(S=this.nifti_mat33_mul(A,M))[0][0]+S[1][1]+S[2][2])>T&&(T=c,_=d,y=f,b=p,x=m,w=g,E=v);switch(I=C=P=R=L=D=0,_*x){case 1:I="X",R="+";break;case-1:I="X",R="-";break;case 2:I="Y",R="+";break;case-2:I="Y",R="-";break;case 3:I="Z",R="+";break;case-3:I="Z",R="-"}switch(y*w){case 1:C="X",L="+";break;case-1:C="X",L="-";break;case 2:C="Y",L="+";break;case-2:C="Y",L="-";break;case 3:C="Z",L="+";break;case-3:C="Z",L="-"}switch(b*E){case 1:P="X",D="+";break;case-1:P="X",D="-";break;case 2:P="Y",D="+";break;case-2:P="Y",D="-";break;case 3:P="Z",D="+";break;case-3:P="Z",D="-"}return I+C+P+R+L+D},n.NIFTI1.prototype.nifti_mat33_mul=function(t,e){var i,n,r=[[0,0,0],[0,0,0],[0,0,0]];for(i=0;i<3;i+=1)for(n=0;n<3;n+=1)r[i][n]=t[i][0]*e[0][n]+t[i][1]*e[1][n]+t[i][2]*e[2][n];return r},n.NIFTI1.prototype.nifti_mat33_determ=function(t){var e,i,n,r,a,s,o,l,h;return e=t[0][0],i=t[0][1],n=t[0][2],r=t[1][0],a=t[1][1],s=t[1][2],o=t[2][0],l=t[2][1],e*a*(h=t[2][2])-e*l*s-r*i*h+r*l*n+o*i*s-o*a*n},n.NIFTI1.prototype.getExtensionLocation=function(){return n.NIFTI1.MAGIC_COOKIE+4},n.NIFTI1.prototype.getExtensionSize=function(t){return n.Utils.getIntAt(t,this.getExtensionLocation(),this.littleEndian)},n.NIFTI1.prototype.getExtensionCode=function(t){return n.Utils.getIntAt(t,this.getExtensionLocation()+4,this.littleEndian)},"undefined"!==typeof t&&t.exports&&(t.exports=n.NIFTI1)},RfIG:function(t,e,i){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},Rt1F:function(t,e,i){"use strict";(function(e,n){var r=i("ypnx");t.exports=y;var a,s=i("sOR5");y.ReadableState=_;i("vzCy").EventEmitter;var o=function(t,e){return t.listeners(e).length},l=i("UcPO"),h=i("kkc6").Buffer,c=e.Uint8Array||function(){};var u=Object.create(i("jOgh"));u.inherits=i("LC74");var d=i(0),f=void 0;f=d&&d.debuglog?d.debuglog("stream"):function(){};var p,m=i("+HRN"),g=i("x0Ha");u.inherits(y,l);var v=["error","close","destroy","pause","resume"];function _(t,e){a=a||i("DsFX"),t=t||{};var n=e instanceof a;this.objectMode=!!t.objectMode,n&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var r=t.highWaterMark,s=t.readableHighWaterMark,o=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n&&(s||0===s)?s:o,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new m,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(p||(p=i("X4X3").StringDecoder),this.decoder=new p(t.encoding),this.encoding=t.encoding)}function y(t){if(a=a||i("DsFX"),!(this instanceof y))return new y(t);this._readableState=new _(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),l.call(this)}function b(t,e,i,n,r){var a,s=t._readableState;null===e?(s.reading=!1,function(t,e){if(e.ended)return;if(e.decoder){var i=e.decoder.end();i&&i.length&&(e.buffer.push(i),e.length+=e.objectMode?1:i.length)}e.ended=!0,S(t)}(t,s)):(r||(a=function(t,e){var i;n=e,h.isBuffer(n)||n instanceof c||"string"==typeof e||void 0===e||t.objectMode||(i=new TypeError("Invalid non-string/buffer chunk"));var n;return i}(s,e)),a?t.emit("error",a):s.objectMode||e&&e.length>0?("string"==typeof e||s.objectMode||Object.getPrototypeOf(e)===h.prototype||(e=function(t){return h.from(t)}(e)),n?s.endEmitted?t.emit("error",new Error("stream.unshift() after end event")):x(t,s,e,!0):s.ended?t.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!i?(e=s.decoder.write(e),s.objectMode||0!==e.length?x(t,s,e,!1):M(t,s)):x(t,s,e,!1))):n||(s.reading=!1));return function(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}(s)}function x(t,e,i,n){e.flowing&&0===e.length&&!e.sync?(t.emit("data",i),t.read(0)):(e.length+=e.objectMode?1:i.length,n?e.buffer.unshift(i):e.buffer.push(i),e.needReadable&&S(t)),M(t,e)}Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),y.prototype.destroy=g.destroy,y.prototype._undestroy=g.undestroy,y.prototype._destroy=function(t,e){this.push(null),e(t)},y.prototype.push=function(t,e){var i,n=this._readableState;return n.objectMode?i=!0:"string"==typeof t&&((e=e||n.defaultEncoding)!==n.encoding&&(t=h.from(t,e),e=""),i=!0),b(this,t,e,!1,i)},y.prototype.unshift=function(t){return b(this,t,null,!0,!1)},y.prototype.isPaused=function(){return!1===this._readableState.flowing},y.prototype.setEncoding=function(t){return p||(p=i("X4X3").StringDecoder),this._readableState.decoder=new p(t),this._readableState.encoding=t,this};var w=8388608;function E(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=function(t){return t>=w?t=w:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function S(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(f("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?r.nextTick(T,t):T(t))}function T(t){f("emit readable"),t.emit("readable"),P(t)}function M(t,e){e.readingMore||(e.readingMore=!0,r.nextTick(A,t,e))}function A(t,e){for(var i=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(f("maybeReadMore read 0"),t.read(0),i!==e.length);)i=e.length;e.readingMore=!1}function I(t){f("readable nexttick read 0"),t.read(0)}function C(t,e){e.reading||(f("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),P(t),e.flowing&&!e.reading&&t.read(0)}function P(t){var e=t._readableState;for(f("flow",e.flowing);e.flowing&&null!==t.read(););}function R(t,e){return 0===e.length?null:(e.objectMode?i=e.buffer.shift():!t||t>=e.length?(i=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):i=function(t,e,i){var n;t<e.head.data.length?(n=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):n=t===e.head.data.length?e.shift():i?function(t,e){var i=e.head,n=1,r=i.data;t-=r.length;for(;i=i.next;){var a=i.data,s=t>a.length?a.length:t;if(s===a.length?r+=a:r+=a.slice(0,t),0===(t-=s)){s===a.length?(++n,i.next?e.head=i.next:e.head=e.tail=null):(e.head=i,i.data=a.slice(s));break}++n}return e.length-=n,r}(t,e):function(t,e){var i=h.allocUnsafe(t),n=e.head,r=1;n.data.copy(i),t-=n.data.length;for(;n=n.next;){var a=n.data,s=t>a.length?a.length:t;if(a.copy(i,i.length-t,0,s),0===(t-=s)){s===a.length?(++r,n.next?e.head=n.next:e.head=e.tail=null):(e.head=n,n.data=a.slice(s));break}++r}return e.length-=r,i}(t,e);return n}(t,e.buffer,e.decoder),i);var i}function L(t){var e=t._readableState;if(e.length>0)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,r.nextTick(D,e,t))}function D(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function k(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return i;return-1}y.prototype.read=function(t){f("read",t),t=parseInt(t,10);var e=this._readableState,i=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return f("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?L(this):S(this),null;if(0===(t=E(t,e))&&e.ended)return 0===e.length&&L(this),null;var n,r=e.needReadable;return f("need readable",r),(0===e.length||e.length-t<e.highWaterMark)&&f("length less than watermark",r=!0),e.ended||e.reading?f("reading or ended",r=!1):r&&(f("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=E(i,e))),null===(n=t>0?R(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),i!==t&&e.ended&&L(this)),null!==n&&this.emit("data",n),n},y.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},y.prototype.pipe=function(t,e){var i=this,a=this._readableState;switch(a.pipesCount){case 0:a.pipes=t;break;case 1:a.pipes=[a.pipes,t];break;default:a.pipes.push(t)}a.pipesCount+=1,f("pipe count=%d opts=%j",a.pipesCount,e);var l=(!e||!1!==e.end)&&t!==n.stdout&&t!==n.stderr?c:y;function h(e,n){f("onunpipe"),e===i&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,f("cleanup"),t.removeListener("close",v),t.removeListener("finish",_),t.removeListener("drain",u),t.removeListener("error",g),t.removeListener("unpipe",h),i.removeListener("end",c),i.removeListener("end",y),i.removeListener("data",m),d=!0,!a.awaitDrain||t._writableState&&!t._writableState.needDrain||u())}function c(){f("onend"),t.end()}a.endEmitted?r.nextTick(l):i.once("end",l),t.on("unpipe",h);var u=function(t){return function(){var e=t._readableState;f("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&o(t,"data")&&(e.flowing=!0,P(t))}}(i);t.on("drain",u);var d=!1;var p=!1;function m(e){f("ondata"),p=!1,!1!==t.write(e)||p||((1===a.pipesCount&&a.pipes===t||a.pipesCount>1&&-1!==k(a.pipes,t))&&!d&&(f("false write response, pause",i._readableState.awaitDrain),i._readableState.awaitDrain++,p=!0),i.pause())}function g(e){f("onerror",e),y(),t.removeListener("error",g),0===o(t,"error")&&t.emit("error",e)}function v(){t.removeListener("finish",_),y()}function _(){f("onfinish"),t.removeListener("close",v),y()}function y(){f("unpipe"),i.unpipe(t)}return i.on("data",m),function(t,e,i){if("function"==typeof t.prependListener)return t.prependListener(e,i);t._events&&t._events[e]?s(t._events[e])?t._events[e].unshift(i):t._events[e]=[i,t._events[e]]:t.on(e,i)}(t,"error",g),t.once("close",v),t.once("finish",_),t.emit("pipe",i),a.flowing||(f("pipe resume"),i.resume()),t},y.prototype.unpipe=function(t){var e=this._readableState,i={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,i),this);if(!t){var n=e.pipes,r=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var a=0;a<r;a++)n[a].emit("unpipe",this,i);return this}var s=k(e.pipes,t);return-1===s?this:(e.pipes.splice(s,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,i),this)},y.prototype.on=function(t,e){var i=l.prototype.on.call(this,t,e);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&S(this):r.nextTick(I,this))}return i},y.prototype.addListener=y.prototype.on,y.prototype.resume=function(){var t=this._readableState;return t.flowing||(f("resume"),t.flowing=!0,function(t,e){e.resumeScheduled||(e.resumeScheduled=!0,r.nextTick(C,t,e))}(this,t)),this},y.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},y.prototype.wrap=function(t){var e=this,i=this._readableState,n=!1;for(var r in t.on("end",function(){if(f("wrapped end"),i.decoder&&!i.ended){var t=i.decoder.end();t&&t.length&&e.push(t)}e.push(null)}),t.on("data",function(r){(f("wrapped data"),i.decoder&&(r=i.decoder.write(r)),!i.objectMode||null!==r&&void 0!==r)&&((i.objectMode||r&&r.length)&&(e.push(r)||(n=!0,t.pause())))}),t)void 0===this[r]&&"function"==typeof t[r]&&(this[r]=function(e){return function(){return t[e].apply(t,arguments)}}(r));for(var a=0;a<v.length;a++)t.on(v[a],this.emit.bind(this,v[a]));return this._read=function(e){f("wrapped _read",e),n&&(n=!1,t.resume())},this},Object.defineProperty(y.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),y._fromList=R}).call(e,i("DuR2"),i("W2nU"))},SDM6:function(t,e,i){t.exports=i("DsFX")},U2Z7:function(t,e){},UZ5h:function(t,e,i){"use strict";var n=i("MsCo"),r=i("qOJP");function a(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}e.parse=y,e.resolve=function(t,e){return y(t,!1,!0).resolve(e)},e.resolveObject=function(t,e){return t?y(t,!1,!0).resolveObject(e):e},e.format=function(t){r.isString(t)&&(t=y(t));return t instanceof a?t.format():a.prototype.format.call(t)},e.Url=a;var s=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,h=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),c=["'"].concat(h),u=["%","/","?",";","#"].concat(c),d=["/","?","#"],f=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},v={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},_=i("1nuA");function y(t,e,i){if(t&&r.isObject(t)&&t instanceof a)return t;var n=new a;return n.parse(t,e,i),n}a.prototype.parse=function(t,e,i){if(!r.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var a=t.indexOf("?"),o=-1!==a&&a<t.indexOf("#")?"?":"#",h=t.split(o);h[0]=h[0].replace(/\\/g,"/");var y=t=h.join(o);if(y=y.trim(),!i&&1===t.split("#").length){var b=l.exec(y);if(b)return this.path=y,this.href=y,this.pathname=b[1],b[2]?(this.search=b[2],this.query=e?_.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var x=s.exec(y);if(x){var w=(x=x[0]).toLowerCase();this.protocol=w,y=y.substr(x.length)}if(i||x||y.match(/^\/\/[^@\/]+@[^@\/]+/)){var E="//"===y.substr(0,2);!E||x&&g[x]||(y=y.substr(2),this.slashes=!0)}if(!g[x]&&(E||x&&!v[x])){for(var S,T,M=-1,A=0;A<d.length;A++){-1!==(I=y.indexOf(d[A]))&&(-1===M||I<M)&&(M=I)}-1!==(T=-1===M?y.lastIndexOf("@"):y.lastIndexOf("@",M))&&(S=y.slice(0,T),y=y.slice(T+1),this.auth=decodeURIComponent(S)),M=-1;for(A=0;A<u.length;A++){var I;-1!==(I=y.indexOf(u[A]))&&(-1===M||I<M)&&(M=I)}-1===M&&(M=y.length),this.host=y.slice(0,M),y=y.slice(M),this.parseHost(),this.hostname=this.hostname||"";var C="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!C)for(var P=this.hostname.split(/\./),R=(A=0,P.length);A<R;A++){var L=P[A];if(L&&!L.match(f)){for(var D="",k=0,O=L.length;k<O;k++)L.charCodeAt(k)>127?D+="x":D+=L[k];if(!D.match(f)){var N=P.slice(0,A),U=P.slice(A+1),F=L.match(p);F&&(N.push(F[1]),U.unshift(F[2])),U.length&&(y="/"+U.join(".")+y),this.hostname=N.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),C||(this.hostname=n.toASCII(this.hostname));var B=this.port?":"+this.port:"",z=this.hostname||"";this.host=z+B,this.href+=this.host,C&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==y[0]&&(y="/"+y))}if(!m[w])for(A=0,R=c.length;A<R;A++){var H=c[A];if(-1!==y.indexOf(H)){var G=encodeURIComponent(H);G===H&&(G=escape(H)),y=y.split(H).join(G)}}var j=y.indexOf("#");-1!==j&&(this.hash=y.substr(j),y=y.slice(0,j));var V=y.indexOf("?");if(-1!==V?(this.search=y.substr(V),this.query=y.substr(V+1),e&&(this.query=_.parse(this.query)),y=y.slice(0,V)):e&&(this.search="",this.query={}),y&&(this.pathname=y),v[w]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){B=this.pathname||"";var W=this.search||"";this.path=B+W}return this.href=this.format(),this},a.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",i=this.pathname||"",n=this.hash||"",a=!1,s="";this.host?a=t+this.host:this.hostname&&(a=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(a+=":"+this.port)),this.query&&r.isObject(this.query)&&Object.keys(this.query).length&&(s=_.stringify(this.query));var o=this.search||s&&"?"+s||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||v[e])&&!1!==a?(a="//"+(a||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):a||(a=""),n&&"#"!==n.charAt(0)&&(n="#"+n),o&&"?"!==o.charAt(0)&&(o="?"+o),e+a+(i=i.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(o=o.replace("#","%23"))+n},a.prototype.resolve=function(t){return this.resolveObject(y(t,!1,!0)).format()},a.prototype.resolveObject=function(t){if(r.isString(t)){var e=new a;e.parse(t,!1,!0),t=e}for(var i=new a,n=Object.keys(this),s=0;s<n.length;s++){var o=n[s];i[o]=this[o]}if(i.hash=t.hash,""===t.href)return i.href=i.format(),i;if(t.slashes&&!t.protocol){for(var l=Object.keys(t),h=0;h<l.length;h++){var c=l[h];"protocol"!==c&&(i[c]=t[c])}return v[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(t.protocol&&t.protocol!==i.protocol){if(!v[t.protocol]){for(var u=Object.keys(t),d=0;d<u.length;d++){var f=u[d];i[f]=t[f]}return i.href=i.format(),i}if(i.protocol=t.protocol,t.host||g[t.protocol])i.pathname=t.pathname;else{for(var p=(t.pathname||"").split("/");p.length&&!(t.host=p.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),i.pathname=p.join("/")}if(i.search=t.search,i.query=t.query,i.host=t.host||"",i.auth=t.auth,i.hostname=t.hostname||t.host,i.port=t.port,i.pathname||i.search){var m=i.pathname||"",_=i.search||"";i.path=m+_}return i.slashes=i.slashes||t.slashes,i.href=i.format(),i}var y=i.pathname&&"/"===i.pathname.charAt(0),b=t.host||t.pathname&&"/"===t.pathname.charAt(0),x=b||y||i.host&&t.pathname,w=x,E=i.pathname&&i.pathname.split("/")||[],S=(p=t.pathname&&t.pathname.split("/")||[],i.protocol&&!v[i.protocol]);if(S&&(i.hostname="",i.port=null,i.host&&(""===E[0]?E[0]=i.host:E.unshift(i.host)),i.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===p[0]?p[0]=t.host:p.unshift(t.host)),t.host=null),x=x&&(""===p[0]||""===E[0])),b)i.host=t.host||""===t.host?t.host:i.host,i.hostname=t.hostname||""===t.hostname?t.hostname:i.hostname,i.search=t.search,i.query=t.query,E=p;else if(p.length)E||(E=[]),E.pop(),E=E.concat(p),i.search=t.search,i.query=t.query;else if(!r.isNullOrUndefined(t.search)){if(S)i.hostname=i.host=E.shift(),(C=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=C.shift(),i.host=i.hostname=C.shift());return i.search=t.search,i.query=t.query,r.isNull(i.pathname)&&r.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!E.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var T=E.slice(-1)[0],M=(i.host||t.host||E.length>1)&&("."===T||".."===T)||""===T,A=0,I=E.length;I>=0;I--)"."===(T=E[I])?E.splice(I,1):".."===T?(E.splice(I,1),A++):A&&(E.splice(I,1),A--);if(!x&&!w)for(;A--;A)E.unshift("..");!x||""===E[0]||E[0]&&"/"===E[0].charAt(0)||E.unshift(""),M&&"/"!==E.join("/").substr(-1)&&E.push("");var C,P=""===E[0]||E[0]&&"/"===E[0].charAt(0);S&&(i.hostname=i.host=P?"":E.length?E.shift():"",(C=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=C.shift(),i.host=i.hostname=C.shift()));return(x=x||i.host&&E.length)&&!P&&E.unshift(""),E.length?i.pathname=E.join("/"):(i.pathname=null,i.path=null),r.isNull(i.pathname)&&r.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=t.auth||i.auth,i.slashes=i.slashes||t.slashes,i.href=i.format(),i},a.prototype.parseHost=function(){var t=this.host,e=o.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},UcPO:function(t,e,i){t.exports=i("vzCy").EventEmitter},UdOt:function(t,e,i){"use strict";var n=n||{};n.NIFTI1=n.NIFTI1||i("RfEm"),n.NIFTI2=n.NIFTI2||i("Ob0N"),n.Utils=n.Utils||i("kLuP");var r=r||i("xe4/");n.isNIFTI1=function(t){var e,i,r,a;return i=(e=new DataView(t)).getUint8(n.NIFTI1.MAGIC_NUMBER_LOCATION),r=e.getUint8(n.NIFTI1.MAGIC_NUMBER_LOCATION+1),a=e.getUint8(n.NIFTI1.MAGIC_NUMBER_LOCATION+2),!(i!==n.NIFTI1.MAGIC_NUMBER[0]||r!==n.NIFTI1.MAGIC_NUMBER[1]||a!==n.NIFTI1.MAGIC_NUMBER[2])},n.isNIFTI2=function(t){var e,i,r,a;return i=(e=new DataView(t)).getUint8(n.NIFTI2.MAGIC_NUMBER_LOCATION),r=e.getUint8(n.NIFTI2.MAGIC_NUMBER_LOCATION+1),a=e.getUint8(n.NIFTI2.MAGIC_NUMBER_LOCATION+2),!(i!==n.NIFTI2.MAGIC_NUMBER[0]||r!==n.NIFTI2.MAGIC_NUMBER[1]||a!==n.NIFTI2.MAGIC_NUMBER[2])},n.isNIFTI=function(t){return n.isNIFTI1(t)||n.isNIFTI2(t)},n.isCompressed=function(t){var e,i,r;if(t){if(i=(e=new DataView(t)).getUint8(0),r=e.getUint8(1),i===n.Utils.GUNZIP_MAGIC_COOKIE1)return!0;if(r===n.Utils.GUNZIP_MAGIC_COOKIE2)return!0}return!1},n.decompress=function(t){return r.inflate(t).buffer},n.readHeader=function(t){var e=null;return n.isCompressed(t)&&(t=n.decompress(t)),n.isNIFTI1(t)?e=new n.NIFTI1:n.isNIFTI2(t)&&(e=new n.NIFTI2),e?e.readHeader(t):console.error("That file does not appear to be NIFTI!"),e},n.hasExtension=function(t){return 0!=t.extensionFlag[0]},n.readImage=function(t,e){var i=t.vox_offset,n=1,r=1;t.dims[4]&&(n=t.dims[4]),t.dims[5]&&(r=t.dims[5]);var a=t.dims[1]*t.dims[2]*t.dims[3]*n*r*(t.numBitsPerVoxel/8);return e.slice(i,i+a)},n.readExtension=function(t,e){var i=t.getExtensionLocation(),n=t.extensionSize;return e.slice(i,i+n)},n.readExtensionData=function(t,e){var i=t.getExtensionLocation(),n=t.extensionSize;return e.slice(i+8,i+n-8)},"undefined"!==typeof t&&t.exports&&(t.exports=n)},Ul2F:function(t,e,i){"use strict";t.exports=Math.ceil},"Un+M":function(t,e,i){"use strict";t.exports=function(t,e){var i,n,r,a,s,o,l,h,c,u,d,f,p,m,g,v,_,y,b,x,w,E,S,T,M;i=t.state,n=t.next_in,T=t.input,r=n+(t.avail_in-5),a=t.next_out,M=t.output,s=a-(e-t.avail_out),o=a+(t.avail_out-257),l=i.dmax,h=i.wsize,c=i.whave,u=i.wnext,d=i.window,f=i.hold,p=i.bits,m=i.lencode,g=i.distcode,v=(1<<i.lenbits)-1,_=(1<<i.distbits)-1;t:do{p<15&&(f+=T[n++]<<p,p+=8,f+=T[n++]<<p,p+=8),y=m[f&v];e:for(;;){if(f>>>=b=y>>>24,p-=b,0===(b=y>>>16&255))M[a++]=65535&y;else{if(!(16&b)){if(0==(64&b)){y=m[(65535&y)+(f&(1<<b)-1)];continue e}if(32&b){i.mode=12;break t}t.msg="invalid literal/length code",i.mode=30;break t}x=65535&y,(b&=15)&&(p<b&&(f+=T[n++]<<p,p+=8),x+=f&(1<<b)-1,f>>>=b,p-=b),p<15&&(f+=T[n++]<<p,p+=8,f+=T[n++]<<p,p+=8),y=g[f&_];i:for(;;){if(f>>>=b=y>>>24,p-=b,!(16&(b=y>>>16&255))){if(0==(64&b)){y=g[(65535&y)+(f&(1<<b)-1)];continue i}t.msg="invalid distance code",i.mode=30;break t}if(w=65535&y,p<(b&=15)&&(f+=T[n++]<<p,(p+=8)<b&&(f+=T[n++]<<p,p+=8)),(w+=f&(1<<b)-1)>l){t.msg="invalid distance too far back",i.mode=30;break t}if(f>>>=b,p-=b,w>(b=a-s)){if((b=w-b)>c&&i.sane){t.msg="invalid distance too far back",i.mode=30;break t}if(E=0,S=d,0===u){if(E+=h-b,b<x){x-=b;do{M[a++]=d[E++]}while(--b);E=a-w,S=M}}else if(u<b){if(E+=h+u-b,(b-=u)<x){x-=b;do{M[a++]=d[E++]}while(--b);if(E=0,u<x){x-=b=u;do{M[a++]=d[E++]}while(--b);E=a-w,S=M}}}else if(E+=u-b,b<x){x-=b;do{M[a++]=d[E++]}while(--b);E=a-w,S=M}for(;x>2;)M[a++]=S[E++],M[a++]=S[E++],M[a++]=S[E++],x-=3;x&&(M[a++]=S[E++],x>1&&(M[a++]=S[E++]))}else{E=a-w;do{M[a++]=M[E++],M[a++]=M[E++],M[a++]=M[E++],x-=3}while(x>2);x&&(M[a++]=M[E++],x>1&&(M[a++]=M[E++]))}break}}break}}while(n<r&&a<o);n-=x=p>>3,f&=(1<<(p-=x<<3))-1,t.next_in=n,t.next_out=a,t.avail_in=n<r?r-n+5:5-(n-r),t.avail_out=a<o?o-a+257:257-(a-o),i.hold=f,i.bits=p}},VOug:function(t,e,i){"use strict";var n,r=i("gt5T"),a=i("ZjIE"),s=i("KpjM"),o=i("2WCG"),l=i("2A+V"),h=0,c=1,u=3,d=4,f=5,p=0,m=1,g=-2,v=-3,_=-5,y=-1,b=1,x=2,w=3,E=4,S=0,T=2,M=8,A=9,I=15,C=8,P=286,R=30,L=19,D=2*P+1,k=15,O=3,N=258,U=N+O+1,F=32,B=42,z=69,H=73,G=91,j=103,V=113,W=666,q=1,X=2,Y=3,Z=4,J=3;function K(t,e){return t.msg=l[e],e}function Q(t){return(t<<1)-(t>4?9:0)}function $(t){for(var e=t.length;--e>=0;)t[e]=0}function tt(t){var e=t.state,i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(r.arraySet(t.output,e.pending_buf,e.pending_out,i,t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))}function et(t,e){a._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,tt(t.strm)}function it(t,e){t.pending_buf[t.pending++]=e}function nt(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function rt(t,e){var i,n,r=t.max_chain_length,a=t.strstart,s=t.prev_length,o=t.nice_match,l=t.strstart>t.w_size-U?t.strstart-(t.w_size-U):0,h=t.window,c=t.w_mask,u=t.prev,d=t.strstart+N,f=h[a+s-1],p=h[a+s];t.prev_length>=t.good_match&&(r>>=2),o>t.lookahead&&(o=t.lookahead);do{if(h[(i=e)+s]===p&&h[i+s-1]===f&&h[i]===h[a]&&h[++i]===h[a+1]){a+=2,i++;do{}while(h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&h[++a]===h[++i]&&a<d);if(n=N-(d-a),a=d-N,n>s){if(t.match_start=e,s=n,n>=o)break;f=h[a+s-1],p=h[a+s]}}}while((e=u[e&c])>l&&0!=--r);return s<=t.lookahead?s:t.lookahead}function at(t){var e,i,n,a,l,h,c,u,d,f,p=t.w_size;do{if(a=t.window_size-t.lookahead-t.strstart,t.strstart>=p+(p-U)){r.arraySet(t.window,t.window,p,p,0),t.match_start-=p,t.strstart-=p,t.block_start-=p,e=i=t.hash_size;do{n=t.head[--e],t.head[e]=n>=p?n-p:0}while(--i);e=i=p;do{n=t.prev[--e],t.prev[e]=n>=p?n-p:0}while(--i);a+=p}if(0===t.strm.avail_in)break;if(h=t.strm,c=t.window,u=t.strstart+t.lookahead,d=a,f=void 0,(f=h.avail_in)>d&&(f=d),i=0===f?0:(h.avail_in-=f,r.arraySet(c,h.input,h.next_in,f,u),1===h.state.wrap?h.adler=s(h.adler,c,f,u):2===h.state.wrap&&(h.adler=o(h.adler,c,f,u)),h.next_in+=f,h.total_in+=f,f),t.lookahead+=i,t.lookahead+t.insert>=O)for(l=t.strstart-t.insert,t.ins_h=t.window[l],t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+O-1])&t.hash_mask,t.prev[l&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=l,l++,t.insert--,!(t.lookahead+t.insert<O)););}while(t.lookahead<U&&0!==t.strm.avail_in)}function st(t,e){for(var i,n;;){if(t.lookahead<U){if(at(t),t.lookahead<U&&e===h)return q;if(0===t.lookahead)break}if(i=0,t.lookahead>=O&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+O-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-U&&(t.match_length=rt(t,i)),t.match_length>=O)if(n=a._tr_tally(t,t.strstart-t.match_start,t.match_length-O),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=O){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+O-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else n=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(et(t,!1),0===t.strm.avail_out))return q}return t.insert=t.strstart<O-1?t.strstart:O-1,e===d?(et(t,!0),0===t.strm.avail_out?Y:Z):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?q:X}function ot(t,e){for(var i,n,r;;){if(t.lookahead<U){if(at(t),t.lookahead<U&&e===h)return q;if(0===t.lookahead)break}if(i=0,t.lookahead>=O&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+O-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=O-1,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-U&&(t.match_length=rt(t,i),t.match_length<=5&&(t.strategy===b||t.match_length===O&&t.strstart-t.match_start>4096)&&(t.match_length=O-1)),t.prev_length>=O&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-O,n=a._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-O),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=r&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+O-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=O-1,t.strstart++,n&&(et(t,!1),0===t.strm.avail_out))return q}else if(t.match_available){if((n=a._tr_tally(t,0,t.window[t.strstart-1]))&&et(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return q}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=a._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<O-1?t.strstart:O-1,e===d?(et(t,!0),0===t.strm.avail_out?Y:Z):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?q:X}function lt(t,e,i,n,r){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=n,this.func=r}function ht(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=T,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?B:V,t.adler=2===e.wrap?0:1,e.last_flush=h,a._tr_init(e),p):K(t,g)}function ct(t){var e,i=ht(t);return i===p&&((e=t.state).window_size=2*e.w_size,$(e.head),e.max_lazy_match=n[e.level].max_lazy,e.good_match=n[e.level].good_length,e.nice_match=n[e.level].nice_length,e.max_chain_length=n[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=O-1,e.match_available=0,e.ins_h=0),i}function ut(t,e,i,n,a,s){if(!t)return g;var o=1;if(e===y&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),a<1||a>A||i!==M||n<8||n>15||e<0||e>9||s<0||s>E)return K(t,g);8===n&&(n=9);var l=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=M,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*D),this.dyn_dtree=new r.Buf16(2*(2*R+1)),this.bl_tree=new r.Buf16(2*(2*L+1)),$(this.dyn_ltree),$(this.dyn_dtree),$(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(k+1),this.heap=new r.Buf16(2*P+1),$(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*P+1),$(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return t.state=l,l.strm=t,l.wrap=o,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+O-1)/O),l.window=new r.Buf8(2*l.w_size),l.head=new r.Buf16(l.hash_size),l.prev=new r.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new r.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=e,l.strategy=s,l.method=i,ct(t)}n=[new lt(0,0,0,0,function(t,e){var i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(at(t),0===t.lookahead&&e===h)return q;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+i;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,et(t,!1),0===t.strm.avail_out))return q;if(t.strstart-t.block_start>=t.w_size-U&&(et(t,!1),0===t.strm.avail_out))return q}return t.insert=0,e===d?(et(t,!0),0===t.strm.avail_out?Y:Z):(t.strstart>t.block_start&&(et(t,!1),t.strm.avail_out),q)}),new lt(4,4,8,4,st),new lt(4,5,16,8,st),new lt(4,6,32,32,st),new lt(4,4,16,16,ot),new lt(8,16,32,32,ot),new lt(8,16,128,128,ot),new lt(8,32,128,256,ot),new lt(32,128,258,1024,ot),new lt(32,258,258,4096,ot)],e.deflateInit=function(t,e){return ut(t,e,M,I,C,S)},e.deflateInit2=ut,e.deflateReset=ct,e.deflateResetKeep=ht,e.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?g:(t.state.gzhead=e,p):g},e.deflate=function(t,e){var i,r,s,l;if(!t||!t.state||e>f||e<0)return t?K(t,g):g;if(r=t.state,!t.output||!t.input&&0!==t.avail_in||r.status===W&&e!==d)return K(t,0===t.avail_out?_:g);if(r.strm=t,i=r.last_flush,r.last_flush=e,r.status===B)if(2===r.wrap)t.adler=0,it(r,31),it(r,139),it(r,8),r.gzhead?(it(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),it(r,255&r.gzhead.time),it(r,r.gzhead.time>>8&255),it(r,r.gzhead.time>>16&255),it(r,r.gzhead.time>>24&255),it(r,9===r.level?2:r.strategy>=x||r.level<2?4:0),it(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(it(r,255&r.gzhead.extra.length),it(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=o(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=z):(it(r,0),it(r,0),it(r,0),it(r,0),it(r,0),it(r,9===r.level?2:r.strategy>=x||r.level<2?4:0),it(r,J),r.status=V);else{var v=M+(r.w_bits-8<<4)<<8;v|=(r.strategy>=x||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(v|=F),v+=31-v%31,r.status=V,nt(r,v),0!==r.strstart&&(nt(r,t.adler>>>16),nt(r,65535&t.adler)),t.adler=1}if(r.status===z)if(r.gzhead.extra){for(s=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>s&&(t.adler=o(t.adler,r.pending_buf,r.pending-s,s)),tt(t),s=r.pending,r.pending!==r.pending_buf_size));)it(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>s&&(t.adler=o(t.adler,r.pending_buf,r.pending-s,s)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=H)}else r.status=H;if(r.status===H)if(r.gzhead.name){s=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>s&&(t.adler=o(t.adler,r.pending_buf,r.pending-s,s)),tt(t),s=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,it(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>s&&(t.adler=o(t.adler,r.pending_buf,r.pending-s,s)),0===l&&(r.gzindex=0,r.status=G)}else r.status=G;if(r.status===G)if(r.gzhead.comment){s=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>s&&(t.adler=o(t.adler,r.pending_buf,r.pending-s,s)),tt(t),s=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,it(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>s&&(t.adler=o(t.adler,r.pending_buf,r.pending-s,s)),0===l&&(r.status=j)}else r.status=j;if(r.status===j&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&tt(t),r.pending+2<=r.pending_buf_size&&(it(r,255&t.adler),it(r,t.adler>>8&255),t.adler=0,r.status=V)):r.status=V),0!==r.pending){if(tt(t),0===t.avail_out)return r.last_flush=-1,p}else if(0===t.avail_in&&Q(e)<=Q(i)&&e!==d)return K(t,_);if(r.status===W&&0!==t.avail_in)return K(t,_);if(0!==t.avail_in||0!==r.lookahead||e!==h&&r.status!==W){var y=r.strategy===x?function(t,e){for(var i;;){if(0===t.lookahead&&(at(t),0===t.lookahead)){if(e===h)return q;break}if(t.match_length=0,i=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(et(t,!1),0===t.strm.avail_out))return q}return t.insert=0,e===d?(et(t,!0),0===t.strm.avail_out?Y:Z):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?q:X}(r,e):r.strategy===w?function(t,e){for(var i,n,r,s,o=t.window;;){if(t.lookahead<=N){if(at(t),t.lookahead<=N&&e===h)return q;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=O&&t.strstart>0&&(n=o[r=t.strstart-1])===o[++r]&&n===o[++r]&&n===o[++r]){s=t.strstart+N;do{}while(n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&r<s);t.match_length=N-(s-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=O?(i=a._tr_tally(t,1,t.match_length-O),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(et(t,!1),0===t.strm.avail_out))return q}return t.insert=0,e===d?(et(t,!0),0===t.strm.avail_out?Y:Z):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?q:X}(r,e):n[r.level].func(r,e);if(y!==Y&&y!==Z||(r.status=W),y===q||y===Y)return 0===t.avail_out&&(r.last_flush=-1),p;if(y===X&&(e===c?a._tr_align(r):e!==f&&(a._tr_stored_block(r,0,0,!1),e===u&&($(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),tt(t),0===t.avail_out))return r.last_flush=-1,p}return e!==d?p:r.wrap<=0?m:(2===r.wrap?(it(r,255&t.adler),it(r,t.adler>>8&255),it(r,t.adler>>16&255),it(r,t.adler>>24&255),it(r,255&t.total_in),it(r,t.total_in>>8&255),it(r,t.total_in>>16&255),it(r,t.total_in>>24&255)):(nt(r,t.adler>>>16),nt(r,65535&t.adler)),tt(t),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?p:m)},e.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==B&&e!==z&&e!==H&&e!==G&&e!==j&&e!==V&&e!==W?K(t,g):(t.state=null,e===V?K(t,v):p):g},e.deflateSetDictionary=function(t,e){var i,n,a,o,l,h,c,u,d=e.length;if(!t||!t.state)return g;if(2===(o=(i=t.state).wrap)||1===o&&i.status!==B||i.lookahead)return g;for(1===o&&(t.adler=s(t.adler,e,d,0)),i.wrap=0,d>=i.w_size&&(0===o&&($(i.head),i.strstart=0,i.block_start=0,i.insert=0),u=new r.Buf8(i.w_size),r.arraySet(u,e,d-i.w_size,i.w_size,0),e=u,d=i.w_size),l=t.avail_in,h=t.next_in,c=t.input,t.avail_in=d,t.next_in=0,t.input=e,at(i);i.lookahead>=O;){n=i.strstart,a=i.lookahead-(O-1);do{i.ins_h=(i.ins_h<<i.hash_shift^i.window[n+O-1])&i.hash_mask,i.prev[n&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=n,n++}while(--a);i.strstart=n,i.lookahead=O-1,at(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=O-1,i.match_available=0,t.next_in=h,t.input=c,t.avail_in=l,i.wrap=o,p},e.deflateInfo="pako deflate (from Nodeca project)"},X3l8:function(t,e,i){
/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
var n=i("EuP9"),r=n.Buffer;function a(t,e){for(var i in t)e[i]=t[i]}function s(t,e,i){return r(t,e,i)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=n:(a(n,e),e.Buffer=s),s.prototype=Object.create(r.prototype),a(r,s),s.from=function(t,e,i){if("number"==typeof t)throw new TypeError("Argument must not be a number");return r(t,e,i)},s.alloc=function(t,e,i){if("number"!=typeof t)throw new TypeError("Argument must be a number");var n=r(t);return void 0!==e?"string"==typeof i?n.fill(e,i):n.fill(e):n.fill(0),n},s.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return r(t)},s.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n.SlowBuffer(t)}},X4X3:function(t,e,i){"use strict";var n=i("X3l8").Buffer,r=n.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function a(t){var e;switch(this.encoding=function(t){var e=function(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}(t);if("string"!=typeof e&&(n.isEncoding===r||!r(t)))throw new Error("Unknown encoding: "+t);return e||t}(t),this.encoding){case"utf16le":this.text=l,this.end=h,e=4;break;case"utf8":this.fillLast=o,e=4;break;case"base64":this.text=c,this.end=u,e=3;break;default:return this.write=d,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(e)}function s(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function o(t){var e=this.lastTotal-this.lastNeed,i=function(t,e,i){if(128!=(192&e[0]))return t.lastNeed=0,"";if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,"";if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,""}}(this,t);return void 0!==i?i:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function l(t,e){if((t.length-e)%2==0){var i=t.toString("utf16le",e);if(i){var n=i.charCodeAt(i.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],i.slice(0,-1)}return i}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function h(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var i=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,i)}return e}function c(t,e){var i=(t.length-e)%3;return 0===i?t.toString("base64",e):(this.lastNeed=3-i,this.lastTotal=3,1===i?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-i))}function u(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function d(t){return t.toString(this.encoding)}function f(t){return t&&t.length?this.write(t):""}e.StringDecoder=a,a.prototype.write=function(t){if(0===t.length)return"";var e,i;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<t.length?e?e+this.text(t,i):this.text(t,i):e||""},a.prototype.end=function(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"":e},a.prototype.text=function(t,e){var i=function(t,e,i){var n=e.length-1;if(n<i)return 0;var r=s(e[n]);if(r>=0)return r>0&&(t.lastNeed=r-1),r;if(--n<i||-2===r)return 0;if((r=s(e[n]))>=0)return r>0&&(t.lastNeed=r-2),r;if(--n<i||-2===r)return 0;if((r=s(e[n]))>=0)return r>0&&(2===r?r=0:t.lastNeed=r-3),r;return 0}(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=i;var n=t.length-(i-this.lastNeed);return t.copy(this.lastChar,0,n),t.toString("utf8",e,n)},a.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},Ytp1:function(t,e,i){"use strict";var n=i("x+d4"),r=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(t){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){a=!1}for(var s=new n.Buf8(256),o=0;o<256;o++)s[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;function l(t,e){if(e<65537&&(t.subarray&&a||!t.subarray&&r))return String.fromCharCode.apply(null,n.shrinkBuf(t,e));for(var i="",s=0;s<e;s++)i+=String.fromCharCode(t[s]);return i}s[254]=s[254]=1,e.string2buf=function(t){var e,i,r,a,s,o=t.length,l=0;for(a=0;a<o;a++)55296==(64512&(i=t.charCodeAt(a)))&&a+1<o&&56320==(64512&(r=t.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(r-56320),a++),l+=i<128?1:i<2048?2:i<65536?3:4;for(e=new n.Buf8(l),s=0,a=0;s<l;a++)55296==(64512&(i=t.charCodeAt(a)))&&a+1<o&&56320==(64512&(r=t.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(r-56320),a++),i<128?e[s++]=i:i<2048?(e[s++]=192|i>>>6,e[s++]=128|63&i):i<65536?(e[s++]=224|i>>>12,e[s++]=128|i>>>6&63,e[s++]=128|63&i):(e[s++]=240|i>>>18,e[s++]=128|i>>>12&63,e[s++]=128|i>>>6&63,e[s++]=128|63&i);return e},e.buf2binstring=function(t){return l(t,t.length)},e.binstring2buf=function(t){for(var e=new n.Buf8(t.length),i=0,r=e.length;i<r;i++)e[i]=t.charCodeAt(i);return e},e.buf2string=function(t,e){var i,n,r,a,o=e||t.length,h=new Array(2*o);for(n=0,i=0;i<o;)if((r=t[i++])<128)h[n++]=r;else if((a=s[r])>4)h[n++]=65533,i+=a-1;else{for(r&=2===a?31:3===a?15:7;a>1&&i<o;)r=r<<6|63&t[i++],a--;a>1?h[n++]=65533:r<65536?h[n++]=r:(r-=65536,h[n++]=55296|r>>10&1023,h[n++]=56320|1023&r)}return l(h,n)},e.utf8border=function(t,e){var i;for((e=e||t.length)>t.length&&(e=t.length),i=e-1;i>=0&&128==(192&t[i]);)i--;return i<0?e:0===i?e:i+s[t[i]]>e?i:e}},ZNxy:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("//Fk"),r=i.n(n),a=i("+G5l"),s=i("QTrw");class o{static matrix4(t){return!(null===t||void 0===t||!t.hasOwnProperty("elements")||16!==t.elements.length||"function"!=typeof t.identity||"function"!=typeof t.copy||"function"!=typeof t.determinant)}static vector3(t){return!(!(null!==t&&void 0!==t&&t.hasOwnProperty("x")&&t.hasOwnProperty("y")&&t.hasOwnProperty("z"))||t.hasOwnProperty("w"))}static box(t){return!!(null!==t&&void 0!==t&&t.hasOwnProperty("center")&&this.vector3(t.center)&&t.hasOwnProperty("halfDimensions")&&this.vector3(t.halfDimensions)&&t.halfDimensions.x>=0&&t.halfDimensions.y>=0&&t.halfDimensions.z>=0)}static ray(t){return!!(null!==t&&void 0!==t&&t.hasOwnProperty("position")&&this.vector3(t.position)&&t.hasOwnProperty("direction")&&this.vector3(t.direction))}}function l(){}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var n=arguments[i];if(void 0!==n&&null!==n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}),Object.assign(l.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var i=this._listeners[t];if(void 0!==i){var n=i.indexOf(e);-1!==n&&i.splice(n,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var i=e.slice(0),n=0,r=i.length;n<r;n++)i[n].call(this,t)}}}});var h,c,u,d,f,p,m="87",g=0,v=1,_=2,y=0,b=1,x=2,w=0,E=1,S=2,T=0,M=1,A=2,I=0,C=1,P=2,R=3,L=4,D=5,k=100,O=101,N=102,U=103,F=104,B=200,z=201,H=202,G=203,j=204,V=205,W=206,q=207,X=208,Y=209,Z=210,J=0,K=1,Q=2,$=3,tt=4,et=5,it=6,nt=7,rt=0,at=1,st=2,ot=0,lt=1,ht=2,ct=3,ut=4,dt=301,ft=302,pt=303,mt=304,gt=305,vt=306,_t=307,yt=1e3,bt=1001,xt=1002,wt=1003,Et=1004,St=1005,Tt=1006,Mt=1007,At=1008,It=1009,Ct=1010,Pt=1011,Rt=1012,Lt=1013,Dt=1014,kt=1015,Ot=1016,Nt=1017,Ut=1018,Ft=1019,Bt=1020,zt=1021,Ht=1022,Gt=1023,jt=1024,Vt=1025,Wt=1026,qt=1027,Xt=2001,Yt=2002,Zt=2003,Jt=2004,Kt=2100,Qt=2101,$t=2102,te=2103,ee=2151,ie=2201,ne=2400,re=0,ae=1,se=2,oe=3e3,le=3001,he=3007,ce=3002,ue=3004,de=3005,fe=3006,pe=3200,me=3201,ge={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:(c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),u=new Array(36),d=0,function(){for(var t=0;t<36;t++)8===t||13===t||18===t||23===t?u[t]="-":14===t?u[t]="4":(d<=2&&(d=33554432+16777216*Math.random()|0),h=15&d,d>>=4,u[t]=c[19===t?3&h|8:h]);return u.join("")}),clamp:function(t,e,i){return Math.max(e,Math.min(i,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)},lerp:function(t,e,i){return(1-i)*t+i*e},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*ge.DEG2RAD},radToDeg:function(t){return t*ge.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},nearestPowerOfTwo:function(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))},nextPowerOfTwo:function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}};function ve(t,e){this.x=t||0,this.y=e||0}Object.defineProperties(ve.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(ve.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:(f=new ve,p=new ve,function(t,e){return f.set(t,t),p.set(e,e),this.clamp(f,p)}),clampLength:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},distanceToManhattan:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,a=this.y-t.y;return this.x=r*i-a*n+t.x,this.y=r*n+a*i+t.y,this}});var _e,ye,be,xe,we,Ee,Se=0;function Te(t,e,i,n,r,a,s,o,l,h){Object.defineProperty(this,"id",{value:Se++}),this.uuid=ge.generateUUID(),this.name="",this.image=void 0!==t?t:Te.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:Te.DEFAULT_MAPPING,this.wrapS=void 0!==i?i:bt,this.wrapT=void 0!==n?n:bt,this.magFilter=void 0!==r?r:Tt,this.minFilter=void 0!==a?a:At,this.anisotropy=void 0!==l?l:1,this.format=void 0!==s?s:Gt,this.type=void 0!==o?o:It,this.offset=new ve(0,0),this.repeat=new ve(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==h?h:oe,this.version=0,this.onUpdate=null}function Me(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1}function Ae(t,e,i){this.uuid=ge.generateUUID(),this.width=t,this.height=e,this.scissor=new Me(0,0,t,e),this.scissorTest=!1,this.viewport=new Me(0,0,t,e),void 0===(i=i||{}).minFilter&&(i.minFilter=Tt),this.texture=new Te(void 0,void 0,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function Ie(t,e,i){Ae.call(this,t,e,i),this.activeCubeFace=0,this.activeMipMapLevel=0}function Ce(t,e,i,n){this._x=t||0,this._y=e||0,this._z=i||0,this._w=void 0!==n?n:1}function Pe(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0}function Re(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function Le(t,e,i,n,r,a,s,o,l,h,c,u){Te.call(this,null,a,s,o,l,h,n,r,c,u),this.image={data:t,width:e,height:i},this.magFilter=void 0!==l?l:wt,this.minFilter=void 0!==h?h:wt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function De(t,e,i,n,r,a,s,o,l,h){t=void 0!==t?t:[],e=void 0!==e?e:dt,Te.call(this,t,e,i,n,r,a,s,o,l,h),this.flipY=!1}Te.DEFAULT_IMAGE=void 0,Te.DEFAULT_MAPPING=300,Object.defineProperty(Te.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Te.prototype,l.prototype,{constructor:Te,isTexture:!0,clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){if(void 0!==t.textures[this.uuid])return t.textures[this.uuid];var e={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var i=this.image;void 0===i.uuid&&(i.uuid=ge.generateUUID()),void 0===t.images[i.uuid]&&(t.images[i.uuid]={uuid:i.uuid,url:function(t){var e;if(t instanceof HTMLCanvasElement)e=t;else{(e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).width=t.width,e.height=t.height;var i=e.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height)}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}(i)}),e.image=i.uuid}return t.textures[this.uuid]=e,e},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300===this.mapping){if(t.multiply(this.repeat),t.add(this.offset),t.x<0||t.x>1)switch(this.wrapS){case yt:t.x=t.x-Math.floor(t.x);break;case bt:t.x=t.x<0?0:1;break;case xt:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case yt:t.y=t.y-Math.floor(t.y);break;case bt:t.y=t.y<0?0:1;break;case xt:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}this.flipY&&(t.y=1-t.y)}}}),Object.assign(Me.prototype,{isVector4:!0,set:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,i=this.y,n=this.z,r=this.w,a=t.elements;return this.x=a[0]*e+a[4]*i+a[8]*n+a[12]*r,this.y=a[1]*e+a[5]*i+a[9]*n+a[13]*r,this.z=a[2]*e+a[6]*i+a[10]*n+a[14]*r,this.w=a[3]*e+a[7]*i+a[11]*n+a[15]*r,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,i,n,r,a=t.elements,s=a[0],o=a[4],l=a[8],h=a[1],c=a[5],u=a[9],d=a[2],f=a[6],p=a[10];if(Math.abs(o-h)<.01&&Math.abs(l-d)<.01&&Math.abs(u-f)<.01){if(Math.abs(o+h)<.1&&Math.abs(l+d)<.1&&Math.abs(u+f)<.1&&Math.abs(s+c+p-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;var m=(s+1)/2,g=(c+1)/2,v=(p+1)/2,_=(o+h)/4,y=(l+d)/4,b=(u+f)/4;return m>g&&m>v?m<.01?(i=0,n=.707106781,r=.707106781):(n=_/(i=Math.sqrt(m)),r=y/i):g>v?g<.01?(i=.707106781,n=0,r=.707106781):(i=_/(n=Math.sqrt(g)),r=b/n):v<.01?(i=.707106781,n=.707106781,r=0):(i=y/(r=Math.sqrt(v)),n=b/r),this.set(i,n,r,e),this}var x=Math.sqrt((f-u)*(f-u)+(l-d)*(l-d)+(h-o)*(h-o));return Math.abs(x)<.001&&(x=1),this.x=(f-u)/x,this.y=(l-d)/x,this.z=(h-o)/x,this.w=Math.acos((s+c+p-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(){var t,e;return function(i,n){return void 0===t&&(t=new Me,e=new Me),t.set(i,i,i,i),e.set(n,n,n,n),this.clamp(t,e)}}(),clampLength:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}}),Object.assign(Ae.prototype,l.prototype,{isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Ie.prototype=Object.create(Ae.prototype),Ie.prototype.constructor=Ie,Ie.prototype.isWebGLRenderTargetCube=!0,Object.assign(Ce,{slerp:function(t,e,i,n){return i.copy(t).slerp(e,n)},slerpFlat:function(t,e,i,n,r,a,s){var o=i[n+0],l=i[n+1],h=i[n+2],c=i[n+3],u=r[a+0],d=r[a+1],f=r[a+2],p=r[a+3];if(c!==p||o!==u||l!==d||h!==f){var m=1-s,g=o*u+l*d+h*f+c*p,v=g>=0?1:-1,_=1-g*g;if(_>Number.EPSILON){var y=Math.sqrt(_),b=Math.atan2(y,g*v);m=Math.sin(m*b)/y,s=Math.sin(s*b)/y}var x=s*v;if(o=o*m+u*x,l=l*m+d*x,h=h*m+f*x,c=c*m+p*x,m===1-s){var w=1/Math.sqrt(o*o+l*l+h*h+c*c);o*=w,l*=w,h*=w,c*=w}}t[e]=o,t[e+1]=l,t[e+2]=h,t[e+3]=c}}),Object.defineProperties(Ce.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this.onChangeCallback()}}}),Object.assign(Ce.prototype,{set:function(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=t._x,n=t._y,r=t._z,a=t.order,s=Math.cos,o=Math.sin,l=s(i/2),h=s(n/2),c=s(r/2),u=o(i/2),d=o(n/2),f=o(r/2);return"XYZ"===a?(this._x=u*h*c+l*d*f,this._y=l*d*c-u*h*f,this._z=l*h*f+u*d*c,this._w=l*h*c-u*d*f):"YXZ"===a?(this._x=u*h*c+l*d*f,this._y=l*d*c-u*h*f,this._z=l*h*f-u*d*c,this._w=l*h*c+u*d*f):"ZXY"===a?(this._x=u*h*c-l*d*f,this._y=l*d*c+u*h*f,this._z=l*h*f+u*d*c,this._w=l*h*c-u*d*f):"ZYX"===a?(this._x=u*h*c-l*d*f,this._y=l*d*c+u*h*f,this._z=l*h*f-u*d*c,this._w=l*h*c+u*d*f):"YZX"===a?(this._x=u*h*c+l*d*f,this._y=l*d*c+u*h*f,this._z=l*h*f-u*d*c,this._w=l*h*c-u*d*f):"XZY"===a&&(this._x=u*h*c-l*d*f,this._y=l*d*c-u*h*f,this._z=l*h*f+u*d*c,this._w=l*h*c+u*d*f),!1!==e&&this.onChangeCallback(),this},setFromAxisAngle:function(t,e){var i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e,i=t.elements,n=i[0],r=i[4],a=i[8],s=i[1],o=i[5],l=i[9],h=i[2],c=i[6],u=i[10],d=n+o+u;return d>0?(e=.5/Math.sqrt(d+1),this._w=.25/e,this._x=(c-l)*e,this._y=(a-h)*e,this._z=(s-r)*e):n>o&&n>u?(e=2*Math.sqrt(1+n-o-u),this._w=(c-l)/e,this._x=.25*e,this._y=(r+s)/e,this._z=(a+h)/e):o>u?(e=2*Math.sqrt(1+o-n-u),this._w=(a-h)/e,this._x=(r+s)/e,this._y=.25*e,this._z=(l+c)/e):(e=2*Math.sqrt(1+u-n-o),this._w=(s-r)/e,this._x=(a+h)/e,this._y=(l+c)/e,this._z=.25*e),this.onChangeCallback(),this},setFromUnitVectors:function(){var t,e=new Pe;return function(i,n){return void 0===e&&(e=new Pe),(t=i.dot(n)+1)<1e-6?(t=0,Math.abs(i.x)>Math.abs(i.z)?e.set(-i.y,i.x,0):e.set(0,-i.z,i.y)):e.crossVectors(i,n),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var i=t._x,n=t._y,r=t._z,a=t._w,s=e._x,o=e._y,l=e._z,h=e._w;return this._x=i*h+a*s+n*l-r*o,this._y=n*h+a*o+r*s-i*l,this._z=r*h+a*l+i*o-n*s,this._w=a*h-i*s-n*o-r*l,this.onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var i=this._x,n=this._y,r=this._z,a=this._w,s=a*t._w+i*t._x+n*t._y+r*t._z;if(s<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,s=-s):this.copy(t),s>=1)return this._w=a,this._x=i,this._y=n,this._z=r,this;var o=Math.sqrt(1-s*s);if(Math.abs(o)<.001)return this._w=.5*(a+this._w),this._x=.5*(i+this._x),this._y=.5*(n+this._y),this._z=.5*(r+this._z),this;var l=Math.atan2(o,s),h=Math.sin((1-e)*l)/o,c=Math.sin(e*l)/o;return this._w=a*h+this._w*c,this._x=i*h+this._x*c,this._y=n*h+this._y*c,this._z=r*h+this._z*c,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(Pe.prototype,{isVector3:!0,set:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:(be=new Ce,function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(be.setFromEuler(t))}),applyAxisAngle:function(){var t=new Ce;return function(e,i){return this.applyQuaternion(t.setFromAxisAngle(e,i))}}(),applyMatrix3:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this},applyMatrix4:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements,a=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*a,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*a,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*a,this},applyQuaternion:function(t){var e=this.x,i=this.y,n=this.z,r=t.x,a=t.y,s=t.z,o=t.w,l=o*e+a*n-s*i,h=o*i+s*e-r*n,c=o*n+r*i-a*e,u=-r*e-a*i-s*n;return this.x=l*o+u*-r+h*-s-c*-a,this.y=h*o+u*-a+c*-r-l*-s,this.z=c*o+u*-s+l*-a-h*-r,this},project:(ye=new Re,function(t){return ye.multiplyMatrices(t.projectionMatrix,ye.getInverse(t.matrixWorld)),this.applyMatrix4(ye)}),unproject:function(){var t=new Re;return function(e){return t.multiplyMatrices(e.matrixWorld,t.getInverse(e.projectionMatrix)),this.applyMatrix4(t)}}(),transformDirection:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(){var t=new Pe,e=new Pe;return function(i,n){return t.set(i,i,i),e.set(n,n,n),this.clamp(t,e)}}(),clampLength:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},cross:function(t,e){if(void 0!==e)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e);var i=this.x,n=this.y,r=this.z;return this.x=n*t.z-r*t.y,this.y=r*t.x-i*t.z,this.z=i*t.y-n*t.x,this},crossVectors:function(t,e){var i=t.x,n=t.y,r=t.z,a=e.x,s=e.y,o=e.z;return this.x=n*o-r*s,this.y=r*a-i*o,this.z=i*s-n*a,this},projectOnVector:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)},projectOnPlane:(_e=new Pe,function(t){return _e.copy(this).projectOnVector(t),this.sub(_e)}),reflect:function(){var t=new Pe;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),angleTo:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(ge.clamp(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n},distanceToManhattan:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){var e=Math.sin(t.phi)*t.radius;return this.x=e*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=e*Math.cos(t.theta),this},setFromCylindrical:function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}}),Object.assign(Re.prototype,{isMatrix4:!0,set:function(t,e,i,n,r,a,s,o,l,h,c,u,d,f,p,m){var g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=n,g[1]=r,g[5]=a,g[9]=s,g[13]=o,g[2]=l,g[6]=h,g[10]=c,g[14]=u,g[3]=d,g[7]=f,g[11]=p,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Re).fromArray(this.elements)},copy:function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this},copyPosition:function(t){var e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this},extractBasis:function(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this},extractRotation:function(){var t=new Pe;return function(e){var i=this.elements,n=e.elements,r=1/t.setFromMatrixColumn(e,0).length(),a=1/t.setFromMatrixColumn(e,1).length(),s=1/t.setFromMatrixColumn(e,2).length();return i[0]=n[0]*r,i[1]=n[1]*r,i[2]=n[2]*r,i[4]=n[4]*a,i[5]=n[5]*a,i[6]=n[6]*a,i[8]=n[8]*s,i[9]=n[9]*s,i[10]=n[10]*s,this}}(),makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,i=t.x,n=t.y,r=t.z,a=Math.cos(i),s=Math.sin(i),o=Math.cos(n),l=Math.sin(n),h=Math.cos(r),c=Math.sin(r);if("XYZ"===t.order){var u=a*h,d=a*c,f=s*h,p=s*c;e[0]=o*h,e[4]=-o*c,e[8]=l,e[1]=d+f*l,e[5]=u-p*l,e[9]=-s*o,e[2]=p-u*l,e[6]=f+d*l,e[10]=a*o}else if("YXZ"===t.order){var m=o*h,g=o*c,v=l*h,_=l*c;e[0]=m+_*s,e[4]=v*s-g,e[8]=a*l,e[1]=a*c,e[5]=a*h,e[9]=-s,e[2]=g*s-v,e[6]=_+m*s,e[10]=a*o}else if("ZXY"===t.order){m=o*h,g=o*c,v=l*h,_=l*c;e[0]=m-_*s,e[4]=-a*c,e[8]=v+g*s,e[1]=g+v*s,e[5]=a*h,e[9]=_-m*s,e[2]=-a*l,e[6]=s,e[10]=a*o}else if("ZYX"===t.order){u=a*h,d=a*c,f=s*h,p=s*c;e[0]=o*h,e[4]=f*l-d,e[8]=u*l+p,e[1]=o*c,e[5]=p*l+u,e[9]=d*l-f,e[2]=-l,e[6]=s*o,e[10]=a*o}else if("YZX"===t.order){var y=a*o,b=a*l,x=s*o,w=s*l;e[0]=o*h,e[4]=w-y*c,e[8]=x*c+b,e[1]=c,e[5]=a*h,e[9]=-s*h,e[2]=-l*h,e[6]=b*c+x,e[10]=y-w*c}else if("XZY"===t.order){y=a*o,b=a*l,x=s*o,w=s*l;e[0]=o*h,e[4]=-c,e[8]=l*h,e[1]=y*c+w,e[5]=a*h,e[9]=b*c-x,e[2]=x*c-b,e[6]=s*h,e[10]=w*c+y}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){var e=this.elements,i=t._x,n=t._y,r=t._z,a=t._w,s=i+i,o=n+n,l=r+r,h=i*s,c=i*o,u=i*l,d=n*o,f=n*l,p=r*l,m=a*s,g=a*o,v=a*l;return e[0]=1-(d+p),e[4]=c-v,e[8]=u+g,e[1]=c+v,e[5]=1-(h+p),e[9]=f-m,e[2]=u-g,e[6]=f+m,e[10]=1-(h+d),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},lookAt:(xe=new Pe,we=new Pe,Ee=new Pe,function(t,e,i){var n=this.elements;return Ee.subVectors(t,e),0===Ee.lengthSq()&&(Ee.z=1),Ee.normalize(),xe.crossVectors(i,Ee),0===xe.lengthSq()&&(1===Math.abs(i.z)?Ee.x+=1e-4:Ee.z+=1e-4,Ee.normalize(),xe.crossVectors(i,Ee)),xe.normalize(),we.crossVectors(Ee,xe),n[0]=xe.x,n[4]=we.x,n[8]=Ee.x,n[1]=xe.y,n[5]=we.y,n[9]=Ee.y,n[2]=xe.z,n[6]=we.z,n[10]=Ee.z,this}),multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var i=t.elements,n=e.elements,r=this.elements,a=i[0],s=i[4],o=i[8],l=i[12],h=i[1],c=i[5],u=i[9],d=i[13],f=i[2],p=i[6],m=i[10],g=i[14],v=i[3],_=i[7],y=i[11],b=i[15],x=n[0],w=n[4],E=n[8],S=n[12],T=n[1],M=n[5],A=n[9],I=n[13],C=n[2],P=n[6],R=n[10],L=n[14],D=n[3],k=n[7],O=n[11],N=n[15];return r[0]=a*x+s*T+o*C+l*D,r[4]=a*w+s*M+o*P+l*k,r[8]=a*E+s*A+o*R+l*O,r[12]=a*S+s*I+o*L+l*N,r[1]=h*x+c*T+u*C+d*D,r[5]=h*w+c*M+u*P+d*k,r[9]=h*E+c*A+u*R+d*O,r[13]=h*S+c*I+u*L+d*N,r[2]=f*x+p*T+m*C+g*D,r[6]=f*w+p*M+m*P+g*k,r[10]=f*E+p*A+m*R+g*O,r[14]=f*S+p*I+m*L+g*N,r[3]=v*x+_*T+y*C+b*D,r[7]=v*w+_*M+y*P+b*k,r[11]=v*E+_*A+y*R+b*O,r[15]=v*S+_*I+y*L+b*N,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToBufferAttribute:function(){var t=new Pe;return function(e){for(var i=0,n=e.count;i<n;i++)t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.applyMatrix4(this),e.setXYZ(i,t.x,t.y,t.z);return e}}(),determinant:function(){var t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],a=t[1],s=t[5],o=t[9],l=t[13],h=t[2],c=t[6],u=t[10],d=t[14];return t[3]*(+r*o*c-n*l*c-r*s*u+i*l*u+n*s*d-i*o*d)+t[7]*(+e*o*d-e*l*u+r*a*u-n*a*d+n*l*h-r*o*h)+t[11]*(+e*l*c-e*s*d-r*a*c+i*a*d+r*s*h-i*l*h)+t[15]*(-n*s*h-e*o*c+e*s*u+n*a*c-i*a*u+i*o*h)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var i=this.elements,n=t.elements,r=n[0],a=n[1],s=n[2],o=n[3],l=n[4],h=n[5],c=n[6],u=n[7],d=n[8],f=n[9],p=n[10],m=n[11],g=n[12],v=n[13],_=n[14],y=n[15],b=f*_*u-v*p*u+v*c*m-h*_*m-f*c*y+h*p*y,x=g*p*u-d*_*u-g*c*m+l*_*m+d*c*y-l*p*y,w=d*v*u-g*f*u+g*h*m-l*v*m-d*h*y+l*f*y,E=g*f*c-d*v*c-g*h*p+l*v*p+d*h*_-l*f*_,S=r*b+a*x+s*w+o*E;if(0===S){var T="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(T);return console.warn(T),this.identity()}var M=1/S;return i[0]=b*M,i[1]=(v*p*o-f*_*o-v*s*m+a*_*m+f*s*y-a*p*y)*M,i[2]=(h*_*o-v*c*o+v*s*u-a*_*u-h*s*y+a*c*y)*M,i[3]=(f*c*o-h*p*o-f*s*u+a*p*u+h*s*m-a*c*m)*M,i[4]=x*M,i[5]=(d*_*o-g*p*o+g*s*m-r*_*m-d*s*y+r*p*y)*M,i[6]=(g*c*o-l*_*o-g*s*u+r*_*u+l*s*y-r*c*y)*M,i[7]=(l*p*o-d*c*o+d*s*u-r*p*u-l*s*m+r*c*m)*M,i[8]=w*M,i[9]=(g*f*o-d*v*o-g*a*m+r*v*m+d*a*y-r*f*y)*M,i[10]=(l*v*o-g*h*o+g*a*u-r*v*u-l*a*y+r*h*y)*M,i[11]=(d*h*o-l*f*o-d*a*u+r*f*u+l*a*m-r*h*m)*M,i[12]=E*M,i[13]=(d*v*s-g*f*s+g*a*p-r*v*p-d*a*_+r*f*_)*M,i[14]=(g*h*s-l*v*s-g*a*c+r*v*c+l*a*_-r*h*_)*M,i[15]=(l*f*s-d*h*s+d*a*c-r*f*c-l*a*p+r*h*p)*M,this},scale:function(t){var e=this.elements,i=t.x,n=t.y,r=t.z;return e[0]*=i,e[4]*=n,e[8]*=r,e[1]*=i,e[5]*=n,e[9]*=r,e[2]*=i,e[6]*=n,e[10]*=r,e[3]*=i,e[7]*=n,e[11]*=r,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))},makeTranslation:function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var i=Math.cos(e),n=Math.sin(e),r=1-i,a=t.x,s=t.y,o=t.z,l=r*a,h=r*s;return this.set(l*a+i,l*s-n*o,l*o+n*s,0,l*s+n*o,h*s+i,h*o-n*a,0,l*o-n*s,h*o+n*a,r*o*o+i,0,0,0,0,1),this},makeScale:function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(t,e,i){return this.set(1,e,i,0,t,1,i,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,i){return this.makeRotationFromQuaternion(e),this.scale(i),this.setPosition(t),this},decompose:function(){var t=new Pe,e=new Re;return function(i,n,r){var a=this.elements,s=t.set(a[0],a[1],a[2]).length(),o=t.set(a[4],a[5],a[6]).length(),l=t.set(a[8],a[9],a[10]).length();this.determinant()<0&&(s=-s),i.x=a[12],i.y=a[13],i.z=a[14],e.copy(this);var h=1/s,c=1/o,u=1/l;return e.elements[0]*=h,e.elements[1]*=h,e.elements[2]*=h,e.elements[4]*=c,e.elements[5]*=c,e.elements[6]*=c,e.elements[8]*=u,e.elements[9]*=u,e.elements[10]*=u,n.setFromRotationMatrix(e),r.x=s,r.y=o,r.z=l,this}}(),makePerspective:function(t,e,i,n,r,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var s=this.elements,o=2*r/(e-t),l=2*r/(i-n),h=(e+t)/(e-t),c=(i+n)/(i-n),u=-(a+r)/(a-r),d=-2*a*r/(a-r);return s[0]=o,s[4]=0,s[8]=h,s[12]=0,s[1]=0,s[5]=l,s[9]=c,s[13]=0,s[2]=0,s[6]=0,s[10]=u,s[14]=d,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makeOrthographic:function(t,e,i,n,r,a){var s=this.elements,o=1/(e-t),l=1/(i-n),h=1/(a-r),c=(e+t)*o,u=(i+n)*l,d=(a+r)*h;return s[0]=2*o,s[4]=0,s[8]=0,s[12]=-c,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-u,s[2]=0,s[6]=0,s[10]=-2*h,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(t){for(var e=this.elements,i=t.elements,n=0;n<16;n++)if(e[n]!==i[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var i=0;i<16;i++)this.elements[i]=t[i+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}),Le.prototype=Object.create(Te.prototype),Le.prototype.constructor=Le,Le.prototype.isDataTexture=!0,De.prototype=Object.create(Te.prototype),De.prototype.constructor=De,De.prototype.isCubeTexture=!0,Object.defineProperty(De.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}});var ke=new Te,Oe=new De;function Ne(){this.seq=[],this.map={}}var Ue=[],Fe=[],Be=new Float32Array(16),ze=new Float32Array(9);function He(t,e,i){var n=t[0];if(n<=0||n>0)return t;var r=e*i,a=Ue[r];if(void 0===a&&(a=new Float32Array(r),Ue[r]=a),0!==e){n.toArray(a,0);for(var s=1,o=0;s!==e;++s)o+=i,t[s].toArray(a,o)}return a}function Ge(t,e){var i=Fe[e];void 0===i&&(i=new Int32Array(e),Fe[e]=i);for(var n=0;n!==e;++n)i[n]=t.allocTextureUnit();return i}function je(t,e){t.uniform1f(this.addr,e)}function Ve(t,e){t.uniform1i(this.addr,e)}function We(t,e){void 0===e.x?t.uniform2fv(this.addr,e):t.uniform2f(this.addr,e.x,e.y)}function qe(t,e){void 0!==e.x?t.uniform3f(this.addr,e.x,e.y,e.z):void 0!==e.r?t.uniform3f(this.addr,e.r,e.g,e.b):t.uniform3fv(this.addr,e)}function Xe(t,e){void 0===e.x?t.uniform4fv(this.addr,e):t.uniform4f(this.addr,e.x,e.y,e.z,e.w)}function Ye(t,e){t.uniformMatrix2fv(this.addr,!1,e.elements||e)}function Ze(t,e){void 0===e.elements?t.uniformMatrix3fv(this.addr,!1,e):(ze.set(e.elements),t.uniformMatrix3fv(this.addr,!1,ze))}function Je(t,e){void 0===e.elements?t.uniformMatrix4fv(this.addr,!1,e):(Be.set(e.elements),t.uniformMatrix4fv(this.addr,!1,Be))}function Ke(t,e,i){var n=i.allocTextureUnit();t.uniform1i(this.addr,n),i.setTexture2D(e||ke,n)}function Qe(t,e,i){var n=i.allocTextureUnit();t.uniform1i(this.addr,n),i.setTextureCube(e||Oe,n)}function $e(t,e){t.uniform2iv(this.addr,e)}function ti(t,e){t.uniform3iv(this.addr,e)}function ei(t,e){t.uniform4iv(this.addr,e)}function ii(t,e){t.uniform1fv(this.addr,e)}function ni(t,e){t.uniform1iv(this.addr,e)}function ri(t,e){t.uniform2fv(this.addr,He(e,this.size,2))}function ai(t,e){t.uniform3fv(this.addr,He(e,this.size,3))}function si(t,e){t.uniform4fv(this.addr,He(e,this.size,4))}function oi(t,e){t.uniformMatrix2fv(this.addr,!1,He(e,this.size,4))}function li(t,e){t.uniformMatrix3fv(this.addr,!1,He(e,this.size,9))}function hi(t,e){t.uniformMatrix4fv(this.addr,!1,He(e,this.size,16))}function ci(t,e,i){var n=e.length,r=Ge(i,n);t.uniform1iv(this.addr,r);for(var a=0;a!==n;++a)i.setTexture2D(e[a]||ke,r[a])}function ui(t,e,i){var n=e.length,r=Ge(i,n);t.uniform1iv(this.addr,r);for(var a=0;a!==n;++a)i.setTextureCube(e[a]||Oe,r[a])}function di(t,e,i){this.id=t,this.addr=i,this.setValue=function(t){switch(t){case 5126:return je;case 35664:return We;case 35665:return qe;case 35666:return Xe;case 35674:return Ye;case 35675:return Ze;case 35676:return Je;case 35678:case 36198:return Ke;case 35680:return Qe;case 5124:case 35670:return Ve;case 35667:case 35671:return $e;case 35668:case 35672:return ti;case 35669:case 35673:return ei}}(e.type)}function fi(t,e,i){this.id=t,this.addr=i,this.size=e.size,this.setValue=function(t){switch(t){case 5126:return ii;case 35664:return ri;case 35665:return ai;case 35666:return si;case 35674:return oi;case 35675:return li;case 35676:return hi;case 35678:return ci;case 35680:return ui;case 5124:case 35670:return ni;case 35667:case 35671:return $e;case 35668:case 35672:return ti;case 35669:case 35673:return ei}}(e.type)}function pi(t){this.id=t,Ne.call(this)}pi.prototype.setValue=function(t,e){for(var i=this.seq,n=0,r=i.length;n!==r;++n){var a=i[n];a.setValue(t,e[a.id])}};var mi=/([\w\d_]+)(\])?(\[|\.)?/g;function gi(t,e){t.seq.push(e),t.map[e.id]=e}function vi(t,e,i){var n=t.name,r=n.length;for(mi.lastIndex=0;;){var a=mi.exec(n),s=mi.lastIndex,o=a[1],l="]"===a[2],h=a[3];if(l&&(o|=0),void 0===h||"["===h&&s+2===r){gi(i,void 0===h?new di(o,t,e):new fi(o,t,e));break}var c=i.map[o];void 0===c&&gi(i,c=new pi(o)),i=c}}function _i(t,e,i){Ne.call(this),this.renderer=i;for(var n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),r=0;r<n;++r){var a=t.getActiveUniform(e,r),s=a.name;vi(a,t.getUniformLocation(e,s),this)}}_i.prototype.setValue=function(t,e,i){var n=this.map[e];void 0!==n&&n.setValue(t,i,this.renderer)},_i.prototype.setOptional=function(t,e,i){var n=e[i];void 0!==n&&this.setValue(t,i,n)},_i.upload=function(t,e,i,n){for(var r=0,a=e.length;r!==a;++r){var s=e[r],o=i[s.id];!1!==o.needsUpdate&&s.setValue(t,o.value,n)}},_i.seqWithValue=function(t,e){for(var i=[],n=0,r=t.length;n!==r;++n){var a=t[n];a.id in e&&i.push(a)}return i};var yi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function bi(t,e,i){return void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}Object.assign(bi.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,i){return this.r=t,this.g=e,this.b=i,this},setHSL:function(){function t(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}return function(e,i,n){if(e=ge.euclideanModulo(e,1),i=ge.clamp(i,0,1),n=ge.clamp(n,0,1),0===i)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+i):n+i-n*i,a=2*n-r;this.r=t(a,r,e+1/3),this.g=t(a,r,e),this.b=t(a,r,e-1/3)}return this}}(),setStyle:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var n,r=i[1],a=i[2];switch(r){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,e(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,e(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)){var s=parseFloat(n[1])/360,o=parseInt(n[2],10)/100,l=parseInt(n[3],10)/100;return e(n[5]),this.setHSL(s,o,l)}}}else if(i=/^\#([A-Fa-f0-9]+)$/.exec(t)){var h,c=(h=i[1]).length;if(3===c)return this.r=parseInt(h.charAt(0)+h.charAt(0),16)/255,this.g=parseInt(h.charAt(1)+h.charAt(1),16)/255,this.b=parseInt(h.charAt(2)+h.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(h.charAt(0)+h.charAt(1),16)/255,this.g=parseInt(h.charAt(2)+h.charAt(3),16)/255,this.b=parseInt(h.charAt(4)+h.charAt(5),16)/255,this}t&&t.length>0&&(void 0!==(h=yi[t])?this.setHex(h):console.warn("THREE.Color: Unknown color "+t));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);var i=e>0?1/e:1;return this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this},convertGammaToLinear:function(){var t=this.r,e=this.g,i=this.b;return this.r=t*t,this.g=e*e,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){var e,i,n=t||{h:0,s:0,l:0},r=this.r,a=this.g,s=this.b,o=Math.max(r,a,s),l=Math.min(r,a,s),h=(l+o)/2;if(l===o)e=0,i=0;else{var c=o-l;switch(i=h<=.5?c/(o+l):c/(2-o-l),o){case r:e=(a-s)/c+(a<s?6:0);break;case a:e=(s-r)/c+2;break;case s:e=(r-a)/c+4}e/=6}return n.h=e,n.s=i,n.l=h,n},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,e,i){var n=this.getHSL();return n.h+=t,n.s+=e,n.l+=i,this.setHSL(n.h,n.s,n.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}});var xi={common:{diffuse:{value:new bi(15658734)},opacity:{value:1},map:{value:null},offsetRepeat:{value:new Me(0,0,1,1)},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ve(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new bi(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new bi(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetRepeat:{value:new Me(0,0,1,1)}}},wi={merge:function(t){for(var e={},i=0;i<t.length;i++){var n=this.clone(t[i]);for(var r in n)e[r]=n[r]}return e},clone:function(t){var e={};for(var i in t)for(var n in e[i]={},t[i]){var r=t[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?e[i][n]=r.clone():Array.isArray(r)?e[i][n]=r.slice():e[i][n]=r}return e}},Ei={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat theta = acos( dot( N, V ) );\n\tvec2 uv = vec2(\n\t\tsqrt( saturate( roughness ) ),\n\t\tsaturate( theta / ( 0.5 * PI ) ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.86267 + (0.49788 + 0.01436 * y ) * y;\n\tfloat b = 3.45068 + (4.18814 + y) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = (x > 0.0) ? v : 0.5 * inversesqrt( 1.0 - x * x ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transpose( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tvec3 result = vec3( LTC_ClippedSphereFormFactor( vectorFormFactor ) );\n\treturn result;\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t\t\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\t\tvec4 plane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transpose( const in mat3 v ) {\n\tmat3 tmp;\n\ttmp[0] = vec3(v[0].x, v[1].x, v[2].x);\n\ttmp[1] = vec3(v[0].y, v[1].y, v[2].y);\n\ttmp[2] = vec3(v[0].z, v[1].z, v[2].z);\n\treturn tmp;\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltcMat;\tuniform sampler2D ltcMag;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tfloat norm = texture2D( ltcMag, uv ).a;\n\t\tvec4 t = texture2D( ltcMat, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3(   1,   0, t.y ),\n\t\t\tvec3(   0, t.z,   0 ),\n\t\t\tvec3( t.w,   0, t.x )\n\t\t);\n\t\treflectedLight.directSpecular += lightColor * material.specularColor * norm * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_template:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_fragment:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 1.0 - 2.0 * rgb.xyz;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n}\n",shadow_vert:"#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n"},Si={basic:{uniforms:wi.merge([xi.common,xi.specularmap,xi.envmap,xi.aomap,xi.lightmap,xi.fog]),vertexShader:Ei.meshbasic_vert,fragmentShader:Ei.meshbasic_frag},lambert:{uniforms:wi.merge([xi.common,xi.specularmap,xi.envmap,xi.aomap,xi.lightmap,xi.emissivemap,xi.fog,xi.lights,{emissive:{value:new bi(0)}}]),vertexShader:Ei.meshlambert_vert,fragmentShader:Ei.meshlambert_frag},phong:{uniforms:wi.merge([xi.common,xi.specularmap,xi.envmap,xi.aomap,xi.lightmap,xi.emissivemap,xi.bumpmap,xi.normalmap,xi.displacementmap,xi.gradientmap,xi.fog,xi.lights,{emissive:{value:new bi(0)},specular:{value:new bi(1118481)},shininess:{value:30}}]),vertexShader:Ei.meshphong_vert,fragmentShader:Ei.meshphong_frag},standard:{uniforms:wi.merge([xi.common,xi.envmap,xi.aomap,xi.lightmap,xi.emissivemap,xi.bumpmap,xi.normalmap,xi.displacementmap,xi.roughnessmap,xi.metalnessmap,xi.fog,xi.lights,{emissive:{value:new bi(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Ei.meshphysical_vert,fragmentShader:Ei.meshphysical_frag},points:{uniforms:wi.merge([xi.points,xi.fog]),vertexShader:Ei.points_vert,fragmentShader:Ei.points_frag},dashed:{uniforms:wi.merge([xi.common,xi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ei.linedashed_vert,fragmentShader:Ei.linedashed_frag},depth:{uniforms:wi.merge([xi.common,xi.displacementmap]),vertexShader:Ei.depth_vert,fragmentShader:Ei.depth_frag},normal:{uniforms:wi.merge([xi.common,xi.bumpmap,xi.normalmap,xi.displacementmap,{opacity:{value:1}}]),vertexShader:Ei.normal_vert,fragmentShader:Ei.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ei.cube_vert,fragmentShader:Ei.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ei.equirect_vert,fragmentShader:Ei.equirect_frag},distanceRGBA:{uniforms:wi.merge([xi.common,xi.displacementmap,{referencePosition:{value:new Pe},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ei.distanceRGBA_vert,fragmentShader:Ei.distanceRGBA_frag},shadow:{uniforms:wi.merge([xi.lights,{color:{value:new bi(0)},opacity:{value:1}}]),vertexShader:Ei.shadow_vert,fragmentShader:Ei.shadow_frag}};function Ti(t,e){this.min=void 0!==t?t:new ve(1/0,1/0),this.max=void 0!==e?e:new ve(-1/0,-1/0)}function Mi(t,e,i,n,r){var a,s,o,l,h,c,u,d;function f(){var t=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),n=new Uint16Array([0,1,2,0,2,3]);a=e.createBuffer(),s=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s),e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW),u=e.createTexture(),d=e.createTexture(),i.bindTexture(e.TEXTURE_2D,u),e.texImage2D(e.TEXTURE_2D,0,e.RGB,16,16,0,e.RGB,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),i.bindTexture(e.TEXTURE_2D,d),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,16,16,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),o={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},l=function(t){var i=e.createProgram(),n=e.createShader(e.FRAGMENT_SHADER),a=e.createShader(e.VERTEX_SHADER),s="precision "+r.precision+" float;\n";return e.shaderSource(n,s+t.fragmentShader),e.shaderSource(a,s+t.vertexShader),e.compileShader(n),e.compileShader(a),e.attachShader(i,n),e.attachShader(i,a),e.linkProgram(i),i}(o),h={vertex:e.getAttribLocation(l,"position"),uv:e.getAttribLocation(l,"uv")},c={renderType:e.getUniformLocation(l,"renderType"),map:e.getUniformLocation(l,"map"),occlusionMap:e.getUniformLocation(l,"occlusionMap"),opacity:e.getUniformLocation(l,"opacity"),color:e.getUniformLocation(l,"color"),scale:e.getUniformLocation(l,"scale"),rotation:e.getUniformLocation(l,"rotation"),screenPosition:e.getUniformLocation(l,"screenPosition")}}this.render=function(t,r,o,p){if(0!==t.length){var m=new Pe,g=p.w/p.z,v=.5*p.z,_=.5*p.w,y=16/p.w,b=new ve(y*g,y),x=new Pe(1,1,0),w=new ve(1,1),E=new Ti;E.min.set(p.x,p.y),E.max.set(p.x+(p.z-16),p.y+(p.w-16)),void 0===l&&f(),i.useProgram(l),i.initAttributes(),i.enableAttribute(h.vertex),i.enableAttribute(h.uv),i.disableUnusedAttributes(),e.uniform1i(c.occlusionMap,0),e.uniform1i(c.map,1),e.bindBuffer(e.ARRAY_BUFFER,a),e.vertexAttribPointer(h.vertex,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(h.uv,2,e.FLOAT,!1,16,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s),i.disable(e.CULL_FACE),i.buffers.depth.setMask(!1);for(var S=0,T=t.length;S<T;S++){y=16/p.w,b.set(y*g,y);var M=t[S];if(m.set(M.matrixWorld.elements[12],M.matrixWorld.elements[13],M.matrixWorld.elements[14]),m.applyMatrix4(o.matrixWorldInverse),m.applyMatrix4(o.projectionMatrix),x.copy(m),w.x=p.x+x.x*v+v-8,w.y=p.y+x.y*_+_-8,!0===E.containsPoint(w)){i.activeTexture(e.TEXTURE0),i.bindTexture(e.TEXTURE_2D,null),i.activeTexture(e.TEXTURE1),i.bindTexture(e.TEXTURE_2D,u),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGB,w.x,w.y,16,16,0),e.uniform1i(c.renderType,0),e.uniform2f(c.scale,b.x,b.y),e.uniform3f(c.screenPosition,x.x,x.y,x.z),i.disable(e.BLEND),i.enable(e.DEPTH_TEST),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),i.activeTexture(e.TEXTURE0),i.bindTexture(e.TEXTURE_2D,d),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,w.x,w.y,16,16,0),e.uniform1i(c.renderType,1),i.disable(e.DEPTH_TEST),i.activeTexture(e.TEXTURE1),i.bindTexture(e.TEXTURE_2D,u),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),M.positionScreen.copy(x),M.customUpdateCallback?M.customUpdateCallback(M):M.updateLensFlares(),e.uniform1i(c.renderType,2),i.enable(e.BLEND);for(var A=0,I=M.lensFlares.length;A<I;A++){var C=M.lensFlares[A];C.opacity>.001&&C.scale>.001&&(x.x=C.x,x.y=C.y,x.z=C.z,y=C.size*C.scale/p.w,b.x=y*g,b.y=y,e.uniform3f(c.screenPosition,x.x,x.y,x.z),e.uniform2f(c.scale,b.x,b.y),e.uniform1f(c.rotation,C.rotation),e.uniform1f(c.opacity,C.opacity),e.uniform3f(c.color,C.color.r,C.color.g,C.color.b),i.setBlending(C.blending,C.blendEquation,C.blendSrc,C.blendDst),n.setTexture2D(C.texture,1),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}}}i.enable(e.CULL_FACE),i.enable(e.DEPTH_TEST),i.buffers.depth.setMask(!0),i.reset()}}}function Ai(t,e,i,n,r,a,s,o,l){Te.call(this,t,e,i,n,r,a,s,o,l),this.needsUpdate=!0}function Ii(t,e,i,n,r){var a,s,o,l,h,c,u=new Pe,d=new Ce,f=new Pe;function p(){var t=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),i=new Uint16Array([0,1,2,0,2,3]);a=e.createBuffer(),s=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s),e.bufferData(e.ELEMENT_ARRAY_BUFFER,i,e.STATIC_DRAW),o=function(){var t=e.createProgram(),i=e.createShader(e.VERTEX_SHADER),n=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(i,["precision "+r.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),e.shaderSource(n,["precision "+r.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),e.compileShader(i),e.compileShader(n),e.attachShader(t,i),e.attachShader(t,n),e.linkProgram(t),t}(),l={position:e.getAttribLocation(o,"position"),uv:e.getAttribLocation(o,"uv")},h={uvOffset:e.getUniformLocation(o,"uvOffset"),uvScale:e.getUniformLocation(o,"uvScale"),rotation:e.getUniformLocation(o,"rotation"),scale:e.getUniformLocation(o,"scale"),color:e.getUniformLocation(o,"color"),map:e.getUniformLocation(o,"map"),opacity:e.getUniformLocation(o,"opacity"),modelViewMatrix:e.getUniformLocation(o,"modelViewMatrix"),projectionMatrix:e.getUniformLocation(o,"projectionMatrix"),fogType:e.getUniformLocation(o,"fogType"),fogDensity:e.getUniformLocation(o,"fogDensity"),fogNear:e.getUniformLocation(o,"fogNear"),fogFar:e.getUniformLocation(o,"fogFar"),fogColor:e.getUniformLocation(o,"fogColor"),alphaTest:e.getUniformLocation(o,"alphaTest")};var n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");n.width=8,n.height=8;var u=n.getContext("2d");u.fillStyle="white",u.fillRect(0,0,8,8),c=new Ai(n)}function m(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:e.id-t.id}this.render=function(r,g,v){if(0!==r.length){void 0===o&&p(),i.useProgram(o),i.initAttributes(),i.enableAttribute(l.position),i.enableAttribute(l.uv),i.disableUnusedAttributes(),i.disable(e.CULL_FACE),i.enable(e.BLEND),e.bindBuffer(e.ARRAY_BUFFER,a),e.vertexAttribPointer(l.position,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(l.uv,2,e.FLOAT,!1,16,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s),e.uniformMatrix4fv(h.projectionMatrix,!1,v.projectionMatrix.elements),i.activeTexture(e.TEXTURE0),e.uniform1i(h.map,0);var _=0,y=0,b=g.fog;b?(e.uniform3f(h.fogColor,b.color.r,b.color.g,b.color.b),b.isFog?(e.uniform1f(h.fogNear,b.near),e.uniform1f(h.fogFar,b.far),e.uniform1i(h.fogType,1),_=1,y=1):b.isFogExp2&&(e.uniform1f(h.fogDensity,b.density),e.uniform1i(h.fogType,2),_=2,y=2)):(e.uniform1i(h.fogType,0),_=0,y=0);for(var x=0,w=r.length;x<w;x++){(S=r[x]).modelViewMatrix.multiplyMatrices(v.matrixWorldInverse,S.matrixWorld),S.z=-S.modelViewMatrix.elements[14]}r.sort(m);var E=[];for(x=0,w=r.length;x<w;x++){var S,T=(S=r[x]).material;if(!1!==T.visible){S.onBeforeRender(t,g,v,void 0,T,void 0),e.uniform1f(h.alphaTest,T.alphaTest),e.uniformMatrix4fv(h.modelViewMatrix,!1,S.modelViewMatrix.elements),S.matrixWorld.decompose(u,d,f),E[0]=f.x,E[1]=f.y;var M=0;g.fog&&T.fog&&(M=y),_!==M&&(e.uniform1i(h.fogType,M),_=M),null!==T.map?(e.uniform2f(h.uvOffset,T.map.offset.x,T.map.offset.y),e.uniform2f(h.uvScale,T.map.repeat.x,T.map.repeat.y)):(e.uniform2f(h.uvOffset,0,0),e.uniform2f(h.uvScale,1,1)),e.uniform1f(h.opacity,T.opacity),e.uniform3f(h.color,T.color.r,T.color.g,T.color.b),e.uniform1f(h.rotation,T.rotation),e.uniform2fv(h.scale,E),i.setBlending(T.blending,T.blendEquation,T.blendSrc,T.blendDst,T.blendEquationAlpha,T.blendSrcAlpha,T.blendDstAlpha,T.premultipliedAlpha),i.buffers.depth.setTest(T.depthTest),i.buffers.depth.setMask(T.depthWrite),n.setTexture2D(T.map||c,0),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),S.onAfterRender(t,g,v,void 0,T,void 0)}}i.enable(e.CULL_FACE),i.reset()}}}Si.physical={uniforms:wi.merge([Si.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Ei.meshphysical_vert,fragmentShader:Ei.meshphysical_frag},Object.assign(Ti.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new ve;return function(e,i){var n=t.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){var e=t||new ve;return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){var e=t||new ve;return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return(e||new ve).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return(e||new ve).copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new ve;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),Ai.prototype=Object.create(Te.prototype),Ai.prototype.constructor=Ai;var Ci,Pi,Ri,Li,Di,ki,Oi,Ni=0;function Ui(){Object.defineProperty(this,"id",{value:Ni++}),this.uuid=ge.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=C,this.side=w,this.flatShading=!1,this.vertexColors=T,this.opacity=1,this.transparent=!1,this.blendSrc=j,this.blendDst=V,this.blendEquation=k,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=$,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this.userData={},this.needsUpdate=!0}function Fi(t){Ui.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function Bi(t){Ui.call(this),this.type="MeshDepthMaterial",this.depthPacking=pe,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(t)}function zi(t){Ui.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Pe,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(t)}function Hi(t,e){this.min=void 0!==t?t:new Pe(1/0,1/0,1/0),this.max=void 0!==e?e:new Pe(-1/0,-1/0,-1/0)}function Gi(t,e){this.center=void 0!==t?t:new Pe,this.radius=void 0!==e?e:0}function ji(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function Vi(t,e){this.normal=void 0!==t?t:new Pe(1,0,0),this.constant=void 0!==e?e:0}function Wi(t,e,i,n,r,a){this.planes=[void 0!==t?t:new Vi,void 0!==e?e:new Vi,void 0!==i?i:new Vi,void 0!==n?n:new Vi,void 0!==r?r:new Vi,void 0!==a?a:new Vi]}function qi(t,e,i){for(var n=new Wi,r=new Re,a=new ve,s=new ve(i,i),o=new Pe,l=new Pe,h=1,c=2,u=1+(h|c),d=new Array(u),f=new Array(u),p={},m=[new Pe(1,0,0),new Pe(-1,0,0),new Pe(0,0,1),new Pe(0,0,-1),new Pe(0,1,0),new Pe(0,-1,0)],g=[new Pe(0,1,0),new Pe(0,1,0),new Pe(0,1,0),new Pe(0,1,0),new Pe(0,0,1),new Pe(0,0,-1)],v=[new Me,new Me,new Me,new Me,new Me,new Me],_=0;_!==u;++_){var y=0!=(_&h),x=0!=(_&c),T=new Bi({depthPacking:me,morphTargets:y,skinning:x});d[_]=T;var M=new zi({morphTargets:y,skinning:x});f[_]=M}var A=this;function I(e,i,n,r,a,s){var o=e.geometry,l=null,u=d,m=e.customDepthMaterial;if(n&&(u=f,m=e.customDistanceMaterial),m)l=m;else{var g=!1;i.morphTargets&&(o&&o.isBufferGeometry?g=o.morphAttributes&&o.morphAttributes.position&&o.morphAttributes.position.length>0:o&&o.isGeometry&&(g=o.morphTargets&&o.morphTargets.length>0)),e.isSkinnedMesh&&!1===i.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e);var v=e.isSkinnedMesh&&i.skinning,_=0;g&&(_|=h),v&&(_|=c),l=u[_]}if(t.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){var y=l.uuid,b=i.uuid,x=p[y];void 0===x&&(x={},p[y]=x);var T=x[b];void 0===T&&(T=l.clone(),x[b]=T),l=T}l.visible=i.visible,l.wireframe=i.wireframe;var M=i.side;return A.renderSingleSided&&M==S&&(M=w),A.renderReverseSided&&(M===w?M=E:M===E&&(M=w)),l.side=M,l.clipShadows=i.clipShadows,l.clippingPlanes=i.clippingPlanes,l.clipIntersection=i.clipIntersection,l.wireframeLinewidth=i.wireframeLinewidth,l.linewidth=i.linewidth,n&&l.isMeshDistanceMaterial&&(l.referencePosition.copy(r),l.nearDistance=a,l.farDistance=s),l}function C(i,r,a,s){if(!1!==i.visible){if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&i.castShadow&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,i.matrixWorld);var o=e.update(i),h=i.material;if(Array.isArray(h))for(var c=o.groups,u=0,d=c.length;u<d;u++){var f=c[u],p=h[f.materialIndex];if(p&&p.visible){var m=I(i,p,s,l,a.near,a.far);t.renderBufferDirect(a,null,o,m,i,f)}}else if(h.visible){m=I(i,h,s,l,a.near,a.far);t.renderBufferDirect(a,null,o,m,i,null)}}for(var g=i.children,v=0,_=g.length;v<_;v++)C(g[v],r,a,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=b,this.renderReverseSided=!0,this.renderSingleSided=!0,this.render=function(e,i,h){if(!1!==A.enabled&&(!1!==A.autoUpdate||!1!==A.needsUpdate)&&0!==e.length){var c,u=t.context,d=t.state;d.disable(u.BLEND),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(var f=0,p=e.length;f<p;f++){var _=e[f],y=_.shadow,b=_&&_.isPointLight;if(void 0!==y){var x=y.camera;if(a.copy(y.mapSize),a.min(s),b){var w=a.x,E=a.y;v[0].set(2*w,E,w,E),v[1].set(0,E,w,E),v[2].set(3*w,E,w,E),v[3].set(w,E,w,E),v[4].set(3*w,0,w,E),v[5].set(w,0,w,E),a.x*=4,a.y*=2}if(null===y.map){var S={minFilter:wt,magFilter:wt,format:Gt};y.map=new Ae(a.x,a.y,S),y.map.texture.name=_.name+".shadowMap",x.updateProjectionMatrix()}y.isSpotLightShadow&&y.update(_);var T=y.map,M=y.matrix;l.setFromMatrixPosition(_.matrixWorld),x.position.copy(l),b?(c=6,M.makeTranslation(-l.x,-l.y,-l.z)):(c=1,o.setFromMatrixPosition(_.target.matrixWorld),x.lookAt(o),x.updateMatrixWorld(),M.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),M.multiply(x.projectionMatrix),M.multiply(x.matrixWorldInverse)),t.setRenderTarget(T),t.clear();for(var I=0;I<c;I++){if(b){o.copy(x.position),o.add(m[I]),x.up.copy(g[I]),x.lookAt(o),x.updateMatrixWorld();var P=v[I];d.viewport(P)}r.multiplyMatrices(x.projectionMatrix,x.matrixWorldInverse),n.setFromMatrix(r),C(i,h,x,b)}}else console.warn("THREE.WebGLShadowMap:",_,"has no shadow.")}A.needsUpdate=!1}}}function Xi(t){var e={};return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e[t.uuid]},remove:function(i){i.isInterleavedBufferAttribute&&(i=i.data);var n=e[i.uuid];n&&(t.deleteBuffer(n.buffer),delete e[i.uuid])},update:function(i,n){i.isInterleavedBufferAttribute&&(i=i.data);var r=e[i.uuid];void 0===r?e[i.uuid]=function(e,i){var n=e.array,r=e.dynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW,a=t.createBuffer();t.bindBuffer(i,a),t.bufferData(i,n,r),e.onUploadCallback();var s=t.FLOAT;return n instanceof Float32Array?s=t.FLOAT:n instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?s=t.UNSIGNED_SHORT:n instanceof Int16Array?s=t.SHORT:n instanceof Uint32Array?s=t.UNSIGNED_INT:n instanceof Int32Array?s=t.INT:n instanceof Int8Array?s=t.BYTE:n instanceof Uint8Array&&(s=t.UNSIGNED_BYTE),{buffer:a,type:s,bytesPerElement:n.BYTES_PER_ELEMENT,version:e.version}}(i,n):r.version<i.version&&(function(e,i,n){var r=i.array,a=i.updateRange;t.bindBuffer(n,e),!1===i.dynamic?t.bufferData(n,r,t.STATIC_DRAW):-1===a.count?t.bufferSubData(n,0,r):0===a.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(t.bufferSubData(n,a.offset*r.BYTES_PER_ELEMENT,r.subarray(a.offset,a.offset+a.count)),a.count=-1)}(r.buffer,i,n),r.version=i.version)}}}function Yi(t,e,i,n){this._x=t||0,this._y=e||0,this._z=i||0,this._order=n||Yi.DefaultOrder}function Zi(){this.mask=1}Object.assign(Ui.prototype,l.prototype,{isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var e in t){var i=t[e];if(void 0!==i)if("shading"!==e){var n=this[e];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]="overdraw"===e?Number(i):i:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===i;else console.warn("THREE.Material: '"+e+"' parameter is undefined.")}},toJSON:function(t){var e=void 0===t;e&&(t={textures:{},images:{}});var i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(t){var e=[];for(var i in t){var n=t[i];delete n.metadata,e.push(n)}return e}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearCoat&&(i.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(i.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,i.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==C&&(i.blending=this.blending),!0===this.flatShading&&(i.flatShading=this.flatShading),this.side!==w&&(i.side=this.side),this.vertexColors!==T&&(i.vertexColors=this.vertexColors),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(i.morphTargets=!0),!0===this.skinning&&(i.skinning=!0),!1===this.visible&&(i.visible=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e){var r=n(t.textures),a=n(t.images);r.length>0&&(i.textures=r),a.length>0&&(i.images=a)}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.lights=t.lights,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.overdraw=t.overdraw,this.visible=t.visible,this.userData=JSON.parse(JSON.stringify(t.userData)),this.clipShadows=t.clipShadows,this.clipIntersection=t.clipIntersection;var e=t.clippingPlanes,i=null;if(null!==e){var n=e.length;i=new Array(n);for(var r=0;r!==n;++r)i[r]=e[r].clone()}return this.clippingPlanes=i,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Fi.prototype=Object.create(Ui.prototype),Fi.prototype.constructor=Fi,Fi.prototype.isShaderMaterial=!0,Fi.prototype.copy=function(t){return Ui.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=wi.clone(t.uniforms),this.defines=t.defines,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},Fi.prototype.toJSON=function(t){var e=Ui.prototype.toJSON.call(this,t);return e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e},Bi.prototype=Object.create(Ui.prototype),Bi.prototype.constructor=Bi,Bi.prototype.isMeshDepthMaterial=!0,Bi.prototype.copy=function(t){return Ui.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},zi.prototype=Object.create(Ui.prototype),zi.prototype.constructor=zi,zi.prototype.isMeshDistanceMaterial=!0,zi.prototype.copy=function(t){return Ui.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this},Object.assign(Hi.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,i=1/0,n=1/0,r=-1/0,a=-1/0,s=-1/0,o=0,l=t.length;o<l;o+=3){var h=t[o],c=t[o+1],u=t[o+2];h<e&&(e=h),c<i&&(i=c),u<n&&(n=u),h>r&&(r=h),c>a&&(a=c),u>s&&(s=u)}return this.min.set(e,i,n),this.max.set(r,a,s),this},setFromBufferAttribute:function(t){for(var e=1/0,i=1/0,n=1/0,r=-1/0,a=-1/0,s=-1/0,o=0,l=t.count;o<l;o++){var h=t.getX(o),c=t.getY(o),u=t.getZ(o);h<e&&(e=h),c<i&&(i=c),u<n&&(n=u),h>r&&(r=h),c>a&&(a=c),u>s&&(s=u)}return this.min.set(e,i,n),this.max.set(r,a,s),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new Pe;return function(e,i){var n=t.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}}(),setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){var e=t||new Pe;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){var e=t||new Pe;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(){var t=new Pe;return function(e){var i=this;return e.updateMatrixWorld(!0),e.traverse(function(e){var n,r,a=e.geometry;if(void 0!==a)if(a.isGeometry){var s=a.vertices;for(n=0,r=s.length;n<r;n++)t.copy(s[n]),t.applyMatrix4(e.matrixWorld),i.expandByPoint(t)}else if(a.isBufferGeometry){var o=a.attributes.position;if(void 0!==o)for(n=0,r=o.count;n<r;n++)t.fromBufferAttribute(o,n).applyMatrix4(e.matrixWorld),i.expandByPoint(t)}}),this}}(),containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return(e||new Pe).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:(Pi=new Pe,function(t){return this.clampPoint(t.center,Pi),Pi.distanceToSquared(t.center)<=t.radius*t.radius}),intersectsPlane:function(t){var e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=t.constant&&i>=t.constant},clampPoint:function(t,e){return(e||new Pe).copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new Pe;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),getBoundingSphere:function(){var t=new Pe;return function(e){var i=e||new Gi;return this.getCenter(i.center),i.radius=.5*this.getSize(t).length(),i}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:(Ci=[new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe],function(t){return this.isEmpty()?this:(Ci[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Ci[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Ci[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Ci[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Ci[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Ci[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Ci[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Ci[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Ci),this)}),translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),Object.assign(Gi.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:(Ri=new Hi,function(t,e){var i=this.center;void 0!==e?i.copy(e):Ri.setFromPoints(t).getCenter(i);for(var n=0,r=0,a=t.length;r<a;r++)n=Math.max(n,i.distanceToSquared(t[r]));return this.radius=Math.sqrt(n),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var i=this.center.distanceToSquared(t),n=e||new Pe;return n.copy(t),i>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n},getBoundingBox:function(t){var e=t||new Hi;return e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}),Object.assign(ji.prototype,{isMatrix3:!0,set:function(t,e,i,n,r,a,s,o,l){var h=this.elements;return h[0]=t,h[1]=n,h[2]=s,h[3]=e,h[4]=r,h[5]=o,h[6]=i,h[7]=a,h[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:function(){var t=new Pe;return function(e){for(var i=0,n=e.count;i<n;i++)t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.applyMatrix3(this),e.setXYZ(i,t.x,t.y,t.z);return e}}(),multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var i=t.elements,n=e.elements,r=this.elements,a=i[0],s=i[3],o=i[6],l=i[1],h=i[4],c=i[7],u=i[2],d=i[5],f=i[8],p=n[0],m=n[3],g=n[6],v=n[1],_=n[4],y=n[7],b=n[2],x=n[5],w=n[8];return r[0]=a*p+s*v+o*b,r[3]=a*m+s*_+o*x,r[6]=a*g+s*y+o*w,r[1]=l*p+h*v+c*b,r[4]=l*m+h*_+c*x,r[7]=l*g+h*y+c*w,r[2]=u*p+d*v+f*b,r[5]=u*m+d*_+f*x,r[8]=u*g+d*y+f*w,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],a=t[4],s=t[5],o=t[6],l=t[7],h=t[8];return e*a*h-e*s*l-i*r*h+i*s*o+n*r*l-n*a*o},getInverse:function(t,e){t&&t.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var i=t.elements,n=this.elements,r=i[0],a=i[1],s=i[2],o=i[3],l=i[4],h=i[5],c=i[6],u=i[7],d=i[8],f=d*l-h*u,p=h*c-d*o,m=u*o-l*c,g=r*f+a*p+s*m;if(0===g){var v="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(v);return console.warn(v),this.identity()}var _=1/g;return n[0]=f*_,n[1]=(s*u-d*a)*_,n[2]=(h*a-s*l)*_,n[3]=p*_,n[4]=(d*r-s*c)*_,n[5]=(s*o-h*r)*_,n[6]=m*_,n[7]=(a*c-u*r)*_,n[8]=(l*r-a*o)*_,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},equals:function(t){for(var e=this.elements,i=t.elements,n=0;n<9;n++)if(e[n]!==i[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var i=0;i<9;i++)this.elements[i]=t[i+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}}),Object.assign(Vi.prototype,{set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new Pe,e=new Pe;return function(i,n,r){var a=t.subVectors(r,n).cross(e.subVectors(i,n)).normalize();return this.setFromNormalAndCoplanarPoint(a,i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return(e||new Pe).copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(){var t=new Pe;return function(e,i){var n=i||new Pe,r=e.delta(t),a=this.normal.dot(r);if(0===a)return 0===this.distanceToPoint(e.start)?n.copy(e.start):void 0;var s=-(e.start.dot(this.normal)+this.constant)/a;return s<0||s>1?void 0:n.copy(r).multiplyScalar(s).add(e.start)}}(),intersectsLine:function(t){var e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return(t||new Pe).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new Pe,e=new ji;return function(i,n){var r=n||e.getNormalMatrix(i),a=this.coplanarPoint(t).applyMatrix4(i),s=this.normal.applyMatrix3(r).normalize();return this.constant=-a.dot(s),this}}(),translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}),Object.assign(Wi.prototype,{set:function(t,e,i,n,r,a){var s=this.planes;return s[0].copy(t),s[1].copy(e),s[2].copy(i),s[3].copy(n),s[4].copy(r),s[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,i=0;i<6;i++)e[i].copy(t.planes[i]);return this},setFromMatrix:function(t){var e=this.planes,i=t.elements,n=i[0],r=i[1],a=i[2],s=i[3],o=i[4],l=i[5],h=i[6],c=i[7],u=i[8],d=i[9],f=i[10],p=i[11],m=i[12],g=i[13],v=i[14],_=i[15];return e[0].setComponents(s-n,c-o,p-u,_-m).normalize(),e[1].setComponents(s+n,c+o,p+u,_+m).normalize(),e[2].setComponents(s+r,c+l,p+d,_+g).normalize(),e[3].setComponents(s-r,c-l,p-d,_-g).normalize(),e[4].setComponents(s-a,c-h,p-f,_-v).normalize(),e[5].setComponents(s+a,c+h,p+f,_+v).normalize(),this},intersectsObject:(ki=new Gi,function(t){var e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),ki.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(ki)}),intersectsSprite:function(){var t=new Gi;return function(e){return t.center.set(0,0,0),t.radius=.7071067811865476,t.applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSphere:function(t){for(var e=this.planes,i=t.center,n=-t.radius,r=0;r<6;r++){if(e[r].distanceToPoint(i)<n)return!1}return!0},intersectsBox:(Li=new Pe,Di=new Pe,function(t){for(var e=this.planes,i=0;i<6;i++){var n=e[i];Li.x=n.normal.x>0?t.min.x:t.max.x,Di.x=n.normal.x>0?t.max.x:t.min.x,Li.y=n.normal.y>0?t.min.y:t.max.y,Di.y=n.normal.y>0?t.max.y:t.min.y,Li.z=n.normal.z>0?t.min.z:t.max.z,Di.z=n.normal.z>0?t.max.z:t.min.z;var r=n.distanceToPoint(Li),a=n.distanceToPoint(Di);if(r<0&&a<0)return!1}return!0}),containsPoint:function(t){for(var e=this.planes,i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}}),Yi.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Yi.DefaultOrder="XYZ",Object.defineProperties(Yi.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this.onChangeCallback()}}}),Object.assign(Yi.prototype,{isEuler:!0,set:function(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._order=n||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e,i){var n=ge.clamp,r=t.elements,a=r[0],s=r[4],o=r[8],l=r[1],h=r[5],c=r[9],u=r[2],d=r[6],f=r[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(n(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(-c,f),this._z=Math.atan2(-s,a)):(this._x=Math.atan2(d,h),this._z=0)):"YXZ"===e?(this._x=Math.asin(-n(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(o,f),this._z=Math.atan2(l,h)):(this._y=Math.atan2(-u,a),this._z=0)):"ZXY"===e?(this._x=Math.asin(n(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-u,f),this._z=Math.atan2(-s,h)):(this._y=0,this._z=Math.atan2(l,a))):"ZYX"===e?(this._y=Math.asin(-n(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-s,h))):"YZX"===e?(this._z=Math.asin(n(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-c,h),this._y=Math.atan2(-u,a)):(this._x=0,this._y=Math.atan2(o,f))):"XZY"===e?(this._z=Math.asin(-n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(d,h),this._y=Math.atan2(o,a)):(this._x=Math.atan2(-c,f),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,!1!==i&&this.onChangeCallback(),this},setFromQuaternion:function(){var t=new Re;return function(e,i,n){return t.makeRotationFromQuaternion(e),this.setFromRotationMatrix(t,i,n)}}(),setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:(Oi=new Ce,function(t){return Oi.setFromEuler(this),this.setFromQuaternion(Oi,t)}),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new Pe(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(Zi.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},test:function(t){return 0!=(this.mask&t.mask)}});var Ji,Ki,Qi,$i,tn=0;function en(){Object.defineProperty(this,"id",{value:tn++}),this.uuid=ge.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=en.DefaultUp.clone();var t=new Pe,e=new Yi,i=new Ce,n=new Pe(1,1,1);e.onChange(function(){i.setFromEuler(e,!1)}),i.onChange(function(){e.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:t},rotation:{enumerable:!0,value:e},quaternion:{enumerable:!0,value:i},scale:{enumerable:!0,value:n},modelViewMatrix:{value:new Re},normalMatrix:{value:new ji}}),this.matrix=new Re,this.matrixWorld=new Re,this.matrixAutoUpdate=en.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Zi,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function nn(){en.call(this),this.type="Camera",this.matrixWorldInverse=new Re,this.projectionMatrix=new Re}function rn(t,e,i,n,r,a){nn.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=void 0!==r?r:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}function an(t,e,i,n){nn.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==i?i:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function sn(t,e,i,n,r,a){this.a=t,this.b=e,this.c=i,this.normal=n&&n.isVector3?n:new Pe,this.vertexNormals=Array.isArray(n)?n:[],this.color=r&&r.isColor?r:new bi,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==a?a:0}en.DefaultUp=new Pe(0,1,0),en.DefaultMatrixAutoUpdate=!0,Object.assign(en.prototype,l.prototype,{isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(t){this.matrix.multiplyMatrices(t,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:($i=new Ce,function(t,e){return $i.setFromAxisAngle(t,e),this.quaternion.multiply($i),this}),rotateX:function(){var t=new Pe(1,0,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateY:function(){var t=new Pe(0,1,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateZ:function(){var t=new Pe(0,0,1);return function(e){return this.rotateOnAxis(t,e)}}(),translateOnAxis:function(){var t=new Pe;return function(e,i){return t.copy(e).applyQuaternion(this.quaternion),this.position.add(t.multiplyScalar(i)),this}}(),translateX:function(){var t=new Pe(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new Pe(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new Pe(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:(Qi=new Re,function(t){return t.applyMatrix4(Qi.getInverse(this.matrixWorld))}),lookAt:function(){var t=new Re;return function(e){this.isCamera?t.lookAt(this.position,e,this.up):t.lookAt(e,this.position,this.up),this.quaternion.setFromRotationMatrix(t)}}(),add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var i=this.children.indexOf(t);return-1!==i&&(t.parent=null,t.dispatchEvent({type:"removed"}),this.children.splice(i,1)),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var i=0,n=this.children.length;i<n;i++){var r=this.children[i].getObjectByProperty(t,e);if(void 0!==r)return r}},getWorldPosition:function(t){var e=t||new Pe;return this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(Ji=new Pe,Ki=new Pe,function(t){var e=t||new Ce;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(Ji,e,Ki),e}),getWorldRotation:function(){var t=new Ce;return function(e){var i=e||new Yi;return this.getWorldQuaternion(t),i.setFromQuaternion(t,this.rotation.order,!1)}}(),getWorldScale:function(){var t=new Pe,e=new Ce;return function(i){var n=i||new Pe;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,e,n),n}}(),getWorldDirection:function(){var t=new Ce;return function(e){var i=e||new Pe;return this.getWorldQuaternion(t),i.set(0,0,1).applyQuaternion(t)}}(),raycast:function(){},traverse:function(t){t(this);for(var e=this.children,i=0,n=e.length;i<n;i++)e[i].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,i=0,n=e.length;i<n;i++)e[i].updateMatrixWorld(t)},toJSON:function(t){var e=void 0===t||""===t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};function r(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.matrix=this.matrix.toArray(),void 0!==this.geometry&&(n.geometry=r(t.geometries,this.geometry)),void 0!==this.material)if(Array.isArray(this.material)){for(var a=[],s=0,o=this.material.length;s<o;s++)a.push(r(t.materials,this.material[s]));n.material=a}else n.material=r(t.materials,this.material);if(this.children.length>0){n.children=[];for(s=0;s<this.children.length;s++)n.children.push(this.children[s].toJSON(t).object)}if(e){var l=d(t.geometries),h=d(t.materials),c=d(t.textures),u=d(t.images);l.length>0&&(i.geometries=l),h.length>0&&(i.materials=h),c.length>0&&(i.textures=c),u.length>0&&(i.images=u)}return i.object=n,i;function d(t){var e=[];for(var i in t){var n=t[i];delete n.metadata,e.push(n)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var i=0;i<t.children.length;i++){var n=t.children[i];this.add(n.clone())}return this}}),nn.prototype=Object.assign(Object.create(en.prototype),{constructor:nn,isCamera:!0,copy:function(t,e){return en.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this},getWorldDirection:function(){var t=new Ce;return function(e){var i=e||new Pe;return this.getWorldQuaternion(t),i.set(0,0,-1).applyQuaternion(t)}}(),updateMatrixWorld:function(t){en.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),rn.prototype=Object.assign(Object.create(nn.prototype),{constructor:rn,isOrthographicCamera:!0,copy:function(t,e){return nn.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,i,n,r,a){this.view={fullWidth:t,fullHeight:e,offsetX:i,offsetY:n,width:r,height:a},this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null,this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2,r=i-t,a=i+t,s=n+e,o=n-e;if(null!==this.view){var l=this.zoom/(this.view.width/this.view.fullWidth),h=this.zoom/(this.view.height/this.view.fullHeight),c=(this.right-this.left)/this.view.width,u=(this.top-this.bottom)/this.view.height;a=(r+=c*(this.view.offsetX/l))+c*(this.view.width/l),o=(s-=u*(this.view.offsetY/h))-u*(this.view.height/h)}this.projectionMatrix.makeOrthographic(r,a,s,o,this.near,this.far)},toJSON:function(t){var e=en.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),an.prototype=Object.assign(Object.create(nn.prototype),{constructor:an,isPerspectiveCamera:!0,copy:function(t,e){return nn.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var e=.5*this.getFilmHeight()/t;this.fov=2*ge.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*ge.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*ge.RAD2DEG*Math.atan(Math.tan(.5*ge.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,i,n,r,a){this.aspect=t/e,this.view={fullWidth:t,fullHeight:e,offsetX:i,offsetY:n,width:r,height:a},this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null,this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*ge.DEG2RAD*this.fov)/this.zoom,i=2*e,n=this.aspect*i,r=-.5*n,a=this.view;if(null!==a){var s=a.fullWidth,o=a.fullHeight;r+=a.offsetX*n/s,e-=a.offsetY*i/o,n*=a.width/s,i*=a.height/o}var l=this.filmOffset;0!==l&&(r+=t*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,e,e-i,t,this.far)},toJSON:function(t){var e=en.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}),Object.assign(sn.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,i=t.vertexNormals.length;e<i;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(e=0,i=t.vertexColors.length;e<i;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}});var on,ln,hn,cn,un,dn,fn,pn,mn,gn=0;function vn(){return gn++}function _n(){Object.defineProperty(this,"id",{value:vn()}),this.uuid=ge.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function yn(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.uuid=ge.generateUUID(),this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===i,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function bn(t,e){yn.call(this,new Int8Array(t),e)}function xn(t,e){yn.call(this,new Uint8Array(t),e)}function wn(t,e){yn.call(this,new Uint8ClampedArray(t),e)}function En(t,e){yn.call(this,new Int16Array(t),e)}function Sn(t,e){yn.call(this,new Uint16Array(t),e)}function Tn(t,e){yn.call(this,new Int32Array(t),e)}function Mn(t,e){yn.call(this,new Uint32Array(t),e)}function An(t,e){yn.call(this,new Float32Array(t),e)}function In(t,e){yn.call(this,new Float64Array(t),e)}function Cn(){this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Pn(t){if(0===t.length)return-1/0;for(var e=t[0],i=1,n=t.length;i<n;++i)t[i]>e&&(e=t[i]);return e}function Rn(){Object.defineProperty(this,"id",{value:vn()}),this.uuid=ge.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}}function Ln(t,e,i,n,r,a){_n.call(this),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:a},this.fromBufferGeometry(new Dn(t,e,i,n,r,a)),this.mergeVertices()}function Dn(t,e,i,n,r,a){Rn.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:a};var s=this;n=Math.floor(n)||1,r=Math.floor(r)||1;var o=[],l=[],h=[],c=[],u=0,d=0;function f(t,e,i,n,r,a,f,p,m,g,v){var _,y,b=a/m,x=f/g,w=a/2,E=f/2,S=p/2,T=m+1,M=g+1,A=0,I=0,C=new Pe;for(y=0;y<M;y++){var P=y*x-E;for(_=0;_<T;_++){var R=_*b-w;C[t]=R*n,C[e]=P*r,C[i]=S,l.push(C.x,C.y,C.z),C[t]=0,C[e]=0,C[i]=p>0?1:-1,h.push(C.x,C.y,C.z),c.push(_/m),c.push(1-y/g),A+=1}}for(y=0;y<g;y++)for(_=0;_<m;_++){var L=u+_+T*y,D=u+_+T*(y+1),k=u+(_+1)+T*(y+1),O=u+(_+1)+T*y;o.push(L,D,O),o.push(D,k,O),I+=6}s.addGroup(d,I,v),d+=I,u+=A}f("z","y","x",-1,-1,i,e,t,a=Math.floor(a)||1,r,0),f("z","y","x",1,-1,i,e,-t,a,r,1),f("x","z","y",1,1,t,i,e,n,a,2),f("x","z","y",1,-1,t,i,-e,n,a,3),f("x","y","z",1,-1,t,e,i,n,r,4),f("x","y","z",-1,-1,t,e,-i,n,r,5),this.setIndex(o),this.addAttribute("position",new An(l,3)),this.addAttribute("normal",new An(h,3)),this.addAttribute("uv",new An(c,2))}function kn(t,e,i,n){_n.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n},this.fromBufferGeometry(new On(t,e,i,n)),this.mergeVertices()}function On(t,e,i,n){Rn.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};var r,a,s=t/2,o=e/2,l=Math.floor(i)||1,h=Math.floor(n)||1,c=l+1,u=h+1,d=t/l,f=e/h,p=[],m=[],g=[],v=[];for(a=0;a<u;a++){var _=a*f-o;for(r=0;r<c;r++){var y=r*d-s;m.push(y,-_,0),g.push(0,0,1),v.push(r/l),v.push(1-a/h)}}for(a=0;a<h;a++)for(r=0;r<l;r++){var b=r+c*a,x=r+c*(a+1),w=r+1+c*(a+1),E=r+1+c*a;p.push(b,x,E),p.push(x,w,E)}this.setIndex(p),this.addAttribute("position",new An(m,3)),this.addAttribute("normal",new An(g,3)),this.addAttribute("uv",new An(v,2))}function Nn(t){Ui.call(this),this.type="MeshBasicMaterial",this.color=new bi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=rt,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(t)}function Un(t,e){this.origin=void 0!==t?t:new Pe,this.direction=void 0!==e?e:new Pe}function Fn(t,e){this.start=void 0!==t?t:new Pe,this.end=void 0!==e?e:new Pe}function Bn(t,e,i){this.a=void 0!==t?t:new Pe,this.b=void 0!==e?e:new Pe,this.c=void 0!==i?i:new Pe}function zn(t,e){en.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new Rn,this.material=void 0!==e?e:new Nn({color:16777215*Math.random()}),this.drawMode=re,this.updateMorphTargets()}function Hn(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program&&e.program&&t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Gn(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function jn(){var t={};return{get:function(e,i){var n=e.id+","+i.id,r=t[n];return void 0===r&&(r=new function(){var t=[],e=0,i=[],n=[];return{opaque:i,transparent:n,init:function(){e=0,i.length=0,n.length=0},push:function(r,a,s,o,l){var h=t[e];void 0===h?(h={id:r.id,object:r,geometry:a,material:s,program:s.program,renderOrder:r.renderOrder,z:o,group:l},t[e]=h):(h.id=r.id,h.object=r,h.geometry=a,h.material=s,h.program=s.program,h.renderOrder=r.renderOrder,h.z=o,h.group=l),(!0===s.transparent?n:i).push(h),e++},sort:function(){i.length>1&&i.sort(Hn),n.length>1&&n.sort(Gn)}}},t[n]=r),r},dispose:function(){t={}}}}function Vn(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Wn(){var t=new function(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];var i;switch(e.type){case"DirectionalLight":i={direction:new Pe,color:new bi,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new ve};break;case"SpotLight":i={position:new Pe,direction:new Pe,color:new bi,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new ve};break;case"PointLight":i={position:new Pe,color:new bi,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new ve,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":i={direction:new Pe,skyColor:new bi,groundColor:new bi};break;case"RectAreaLight":i={color:new bi,position:new Pe,halfWidth:new Pe,halfHeight:new Pe}}return t[e.id]=i,i}}},e={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},i=new Pe,n=new Re,r=new Re;return{setup:function(a,s,o){for(var l=0,h=0,c=0,u=0,d=0,f=0,p=0,m=0,g=o.matrixWorldInverse,v=0,_=a.length;v<_;v++){var y=a[v],b=y.color,x=y.intensity,w=y.distance,E=y.shadow&&y.shadow.map?y.shadow.map.texture:null;if(y.isAmbientLight)l+=b.r*x,h+=b.g*x,c+=b.b*x;else if(y.isDirectionalLight){if((T=t.get(y)).color.copy(y.color).multiplyScalar(y.intensity),T.direction.setFromMatrixPosition(y.matrixWorld),i.setFromMatrixPosition(y.target.matrixWorld),T.direction.sub(i),T.direction.transformDirection(g),T.shadow=y.castShadow,y.castShadow){var S=y.shadow;T.shadowBias=S.bias,T.shadowRadius=S.radius,T.shadowMapSize=S.mapSize}e.directionalShadowMap[u]=E,e.directionalShadowMatrix[u]=y.shadow.matrix,e.directional[u]=T,u++}else if(y.isSpotLight)(T=t.get(y)).position.setFromMatrixPosition(y.matrixWorld),T.position.applyMatrix4(g),T.color.copy(b).multiplyScalar(x),T.distance=w,T.direction.setFromMatrixPosition(y.matrixWorld),i.setFromMatrixPosition(y.target.matrixWorld),T.direction.sub(i),T.direction.transformDirection(g),T.coneCos=Math.cos(y.angle),T.penumbraCos=Math.cos(y.angle*(1-y.penumbra)),T.decay=0===y.distance?0:y.decay,T.shadow=y.castShadow,y.castShadow&&(S=y.shadow,T.shadowBias=S.bias,T.shadowRadius=S.radius,T.shadowMapSize=S.mapSize),e.spotShadowMap[f]=E,e.spotShadowMatrix[f]=y.shadow.matrix,e.spot[f]=T,f++;else if(y.isRectAreaLight)(T=t.get(y)).color.copy(b).multiplyScalar(x/(y.width*y.height)),T.position.setFromMatrixPosition(y.matrixWorld),T.position.applyMatrix4(g),r.identity(),n.copy(y.matrixWorld),n.premultiply(g),r.extractRotation(n),T.halfWidth.set(.5*y.width,0,0),T.halfHeight.set(0,.5*y.height,0),T.halfWidth.applyMatrix4(r),T.halfHeight.applyMatrix4(r),e.rectArea[p]=T,p++;else if(y.isPointLight)(T=t.get(y)).position.setFromMatrixPosition(y.matrixWorld),T.position.applyMatrix4(g),T.color.copy(y.color).multiplyScalar(y.intensity),T.distance=y.distance,T.decay=0===y.distance?0:y.decay,T.shadow=y.castShadow,y.castShadow&&(S=y.shadow,T.shadowBias=S.bias,T.shadowRadius=S.radius,T.shadowMapSize=S.mapSize,T.shadowCameraNear=S.camera.near,T.shadowCameraFar=S.camera.far),e.pointShadowMap[d]=E,e.pointShadowMatrix[d]=y.shadow.matrix,e.point[d]=T,d++;else if(y.isHemisphereLight){var T;(T=t.get(y)).direction.setFromMatrixPosition(y.matrixWorld),T.direction.transformDirection(g),T.direction.normalize(),T.skyColor.copy(y.color).multiplyScalar(x),T.groundColor.copy(y.groundColor).multiplyScalar(x),e.hemi[m]=T,m++}}e.ambient[0]=l,e.ambient[1]=h,e.ambient[2]=c,e.directional.length=u,e.spot.length=f,e.rectArea.length=p,e.point.length=d,e.hemi.length=m,e.hash=u+","+d+","+f+","+p+","+m+","+s.length},state:e}}function qn(t,e,i){var n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),!1===t.getShaderParameter(n,t.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==t.getShaderInfoLog(n)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",e===t.VERTEX_SHADER?"vertex":"fragment",t.getShaderInfoLog(n),function(t){for(var e=t.split("\n"),i=0;i<e.length;i++)e[i]=i+1+": "+e[i];return e.join("\n")}(i)),n}Object.assign(_n.prototype,l.prototype,{isGeometry:!0,applyMatrix:function(t){for(var e=(new ji).getNormalMatrix(t),i=0,n=this.vertices.length;i<n;i++){this.vertices[i].applyMatrix4(t)}for(i=0,n=this.faces.length;i<n;i++){var r=this.faces[i];r.normal.applyMatrix3(e).normalize();for(var a=0,s=r.vertexNormals.length;a<s;a++)r.vertexNormals[a].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var t=new Re;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new Re;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new Re;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new Re;return function(e,i,n){return t.makeTranslation(e,i,n),this.applyMatrix(t),this}}(),scale:function(){var t=new Re;return function(e,i,n){return t.makeScale(e,i,n),this.applyMatrix(t),this}}(),lookAt:(on=new en,function(t){on.lookAt(t),on.updateMatrix(),this.applyMatrix(on.matrix)}),fromBufferGeometry:function(t){var e=this,i=null!==t.index?t.index.array:void 0,n=t.attributes,r=n.position.array,a=void 0!==n.normal?n.normal.array:void 0,s=void 0!==n.color?n.color.array:void 0,o=void 0!==n.uv?n.uv.array:void 0,l=void 0!==n.uv2?n.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var h=[],c=[],u=[],d=0,f=0;d<r.length;d+=3,f+=2)e.vertices.push(new Pe(r[d],r[d+1],r[d+2])),void 0!==a&&h.push(new Pe(a[d],a[d+1],a[d+2])),void 0!==s&&e.colors.push(new bi(s[d],s[d+1],s[d+2])),void 0!==o&&c.push(new ve(o[f],o[f+1])),void 0!==l&&u.push(new ve(l[f],l[f+1]));function p(t,i,n,r){var d=new sn(t,i,n,void 0!==a?[h[t].clone(),h[i].clone(),h[n].clone()]:[],void 0!==s?[e.colors[t].clone(),e.colors[i].clone(),e.colors[n].clone()]:[],r);e.faces.push(d),void 0!==o&&e.faceVertexUvs[0].push([c[t].clone(),c[i].clone(),c[n].clone()]),void 0!==l&&e.faceVertexUvs[1].push([u[t].clone(),u[i].clone(),u[n].clone()])}var m=t.groups;if(m.length>0)for(d=0;d<m.length;d++)for(var g=m[d],v=g.start,_=(f=v,v+g.count);f<_;f+=3)void 0!==i?p(i[f],i[f+1],i[f+2],g.materialIndex):p(f,f+1,f+2,g.materialIndex);else if(void 0!==i)for(d=0;d<i.length;d+=3)p(i[d],i[d+1],i[d+2]);else for(d=0;d<r.length/3;d+=3)p(d,d+1,d+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var t=this.boundingBox.getCenter().negate();return this.translate(t.x,t.y,t.z),t},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,i=0===e?1:1/e,n=new Re;return n.set(i,0,0,-i*t.x,0,i,0,-i*t.y,0,0,i,-i*t.z,0,0,0,1),this.applyMatrix(n),this},computeFaceNormals:function(){for(var t=new Pe,e=new Pe,i=0,n=this.faces.length;i<n;i++){var r=this.faces[i],a=this.vertices[r.a],s=this.vertices[r.b],o=this.vertices[r.c];t.subVectors(o,s),e.subVectors(a,s),t.cross(e),t.normalize(),r.normal.copy(t)}},computeVertexNormals:function(t){var e,i,n,r,a,s;for(void 0===t&&(t=!0),s=new Array(this.vertices.length),e=0,i=this.vertices.length;e<i;e++)s[e]=new Pe;if(t){var o,l,h,c=new Pe,u=new Pe;for(n=0,r=this.faces.length;n<r;n++)a=this.faces[n],o=this.vertices[a.a],l=this.vertices[a.b],h=this.vertices[a.c],c.subVectors(h,l),u.subVectors(o,l),c.cross(u),s[a.a].add(c),s[a.b].add(c),s[a.c].add(c)}else for(this.computeFaceNormals(),n=0,r=this.faces.length;n<r;n++)s[(a=this.faces[n]).a].add(a.normal),s[a.b].add(a.normal),s[a.c].add(a.normal);for(e=0,i=this.vertices.length;e<i;e++)s[e].normalize();for(n=0,r=this.faces.length;n<r;n++){var d=(a=this.faces[n]).vertexNormals;3===d.length?(d[0].copy(s[a.a]),d[1].copy(s[a.b]),d[2].copy(s[a.c])):(d[0]=s[a.a].clone(),d[1]=s[a.b].clone(),d[2]=s[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e,i;for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++){var n=(i=this.faces[t]).vertexNormals;3===n.length?(n[0].copy(i.normal),n[1].copy(i.normal),n[2].copy(i.normal)):(n[0]=i.normal.clone(),n[1]=i.normal.clone(),n[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,i,n,r;for(i=0,n=this.faces.length;i<n;i++)for((r=this.faces[i]).__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]),t=0,e=r.vertexNormals.length;t<e;t++)r.__originalVertexNormals[t]?r.__originalVertexNormals[t].copy(r.vertexNormals[t]):r.__originalVertexNormals[t]=r.vertexNormals[t].clone();var a=new _n;for(a.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var s=this.morphNormals[t].faceNormals,o=this.morphNormals[t].vertexNormals;for(i=0,n=this.faces.length;i<n;i++)l=new Pe,h={a:new Pe,b:new Pe,c:new Pe},s.push(l),o.push(h)}var l,h,c=this.morphNormals[t];for(a.vertices=this.morphTargets[t].vertices,a.computeFaceNormals(),a.computeVertexNormals(),i=0,n=this.faces.length;i<n;i++)r=this.faces[i],l=c.faceNormals[i],h=c.vertexNormals[i],l.copy(r.normal),h.a.copy(r.vertexNormals[0]),h.b.copy(r.vertexNormals[1]),h.c.copy(r.vertexNormals[2])}for(i=0,n=this.faces.length;i<n;i++)(r=this.faces[i]).normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeLineDistances:function(){for(var t=0,e=this.vertices,i=0,n=e.length;i<n;i++)i>0&&(t+=e[i].distanceTo(e[i-1])),this.lineDistances[i]=t},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Hi),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Gi),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,i){if(t&&t.isGeometry){var n,r=this.vertices.length,a=this.vertices,s=t.vertices,o=this.faces,l=t.faces,h=this.faceVertexUvs[0],c=t.faceVertexUvs[0],u=this.colors,d=t.colors;void 0===i&&(i=0),void 0!==e&&(n=(new ji).getNormalMatrix(e));for(var f=0,p=s.length;f<p;f++){var m=s[f].clone();void 0!==e&&m.applyMatrix4(e),a.push(m)}for(f=0,p=d.length;f<p;f++)u.push(d[f].clone());for(f=0,p=l.length;f<p;f++){var g,v,_,y=l[f],b=y.vertexNormals,x=y.vertexColors;(g=new sn(y.a+r,y.b+r,y.c+r)).normal.copy(y.normal),void 0!==n&&g.normal.applyMatrix3(n).normalize();for(var w=0,E=b.length;w<E;w++)v=b[w].clone(),void 0!==n&&v.applyMatrix3(n).normalize(),g.vertexNormals.push(v);g.color.copy(y.color);for(w=0,E=x.length;w<E;w++)_=x[w],g.vertexColors.push(_.clone());g.materialIndex=y.materialIndex+i,o.push(g)}for(f=0,p=c.length;f<p;f++){var S=c[f],T=[];if(void 0!==S){for(w=0,E=S.length;w<E;w++)T.push(S[w].clone());h.push(T)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t)},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(){var t,e,i,n,r,a,s,o,l={},h=[],c=[],u=Math.pow(10,4);for(i=0,n=this.vertices.length;i<n;i++)t=this.vertices[i],void 0===l[e=Math.round(t.x*u)+"_"+Math.round(t.y*u)+"_"+Math.round(t.z*u)]?(l[e]=i,h.push(this.vertices[i]),c[i]=h.length-1):c[i]=c[l[e]];var d=[];for(i=0,n=this.faces.length;i<n;i++){(r=this.faces[i]).a=c[r.a],r.b=c[r.b],r.c=c[r.c],a=[r.a,r.b,r.c];for(var f=0;f<3;f++)if(a[f]===a[(f+1)%3]){d.push(i);break}}for(i=d.length-1;i>=0;i--){var p=d[i];for(this.faces.splice(p,1),s=0,o=this.faceVertexUvs.length;s<o;s++)this.faceVertexUvs[s].splice(p,1)}var m=this.vertices.length-h.length;return this.vertices=h,m},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,i=0;i<e;i++)t[i]._id=i;t.sort(function(t,e){return t.materialIndex-e.materialIndex});var n,r,a=this.faceVertexUvs[0],s=this.faceVertexUvs[1];a&&a.length===e&&(n=[]),s&&s.length===e&&(r=[]);for(i=0;i<e;i++){var o=t[i]._id;n&&n.push(a[o]),r&&r.push(s[o])}n&&(this.faceVertexUvs[0]=n),r&&(this.faceVertexUvs[1]=r)},toJSON:function(){var t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var i in e)void 0!==e[i]&&(t[i]=e[i]);return t}for(var n=[],r=0;r<this.vertices.length;r++){var a=this.vertices[r];n.push(a.x,a.y,a.z)}var s=[],o=[],l={},h=[],c={},u=[],d={};for(r=0;r<this.faces.length;r++){var f=this.faces[r],p=void 0!==this.faceVertexUvs[0][r],m=f.normal.length()>0,g=f.vertexNormals.length>0,v=1!==f.color.r||1!==f.color.g||1!==f.color.b,_=f.vertexColors.length>0,y=0;if(y=E(y=E(y=E(y=E(y=E(y=E(y=E(y=E(y,0,0),1,!0),2,!1),3,p),4,m),5,g),6,v),7,_),s.push(y),s.push(f.a,f.b,f.c),s.push(f.materialIndex),p){var b=this.faceVertexUvs[0][r];s.push(M(b[0]),M(b[1]),M(b[2]))}if(m&&s.push(S(f.normal)),g){var x=f.vertexNormals;s.push(S(x[0]),S(x[1]),S(x[2]))}if(v&&s.push(T(f.color)),_){var w=f.vertexColors;s.push(T(w[0]),T(w[1]),T(w[2]))}}function E(t,e,i){return i?t|1<<e:t&~(1<<e)}function S(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==l[e]?l[e]:(l[e]=o.length/3,o.push(t.x,t.y,t.z),l[e])}function T(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==c[e]?c[e]:(c[e]=h.length,h.push(t.getHex()),c[e])}function M(t){var e=t.x.toString()+t.y.toString();return void 0!==d[e]?d[e]:(d[e]=u.length/2,u.push(t.x,t.y),d[e])}return t.data={},t.data.vertices=n,t.data.normals=o,h.length>0&&(t.data.colors=h),u.length>0&&(t.data.uvs=[u]),t.data.faces=s,t},clone:function(){return(new _n).copy(this)},copy:function(t){var e,i,n,r,a,s;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var o=t.vertices;for(e=0,i=o.length;e<i;e++)this.vertices.push(o[e].clone());var l=t.colors;for(e=0,i=l.length;e<i;e++)this.colors.push(l[e].clone());var h=t.faces;for(e=0,i=h.length;e<i;e++)this.faces.push(h[e].clone());for(e=0,i=t.faceVertexUvs.length;e<i;e++){var c=t.faceVertexUvs[e];for(void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]),n=0,r=c.length;n<r;n++){var u=c[n],d=[];for(a=0,s=u.length;a<s;a++){var f=u[a];d.push(f.clone())}this.faceVertexUvs[e].push(d)}}var p=t.morphTargets;for(e=0,i=p.length;e<i;e++){var m={};if(m.name=p[e].name,void 0!==p[e].vertices)for(m.vertices=[],n=0,r=p[e].vertices.length;n<r;n++)m.vertices.push(p[e].vertices[n].clone());if(void 0!==p[e].normals)for(m.normals=[],n=0,r=p[e].normals.length;n<r;n++)m.normals.push(p[e].normals[n].clone());this.morphTargets.push(m)}var g=t.morphNormals;for(e=0,i=g.length;e<i;e++){var v={};if(void 0!==g[e].vertexNormals)for(v.vertexNormals=[],n=0,r=g[e].vertexNormals.length;n<r;n++){var _=g[e].vertexNormals[n],y={};y.a=_.a.clone(),y.b=_.b.clone(),y.c=_.c.clone(),v.vertexNormals.push(y)}if(void 0!==g[e].faceNormals)for(v.faceNormals=[],n=0,r=g[e].faceNormals.length;n<r;n++)v.faceNormals.push(g[e].faceNormals[n].clone());this.morphNormals.push(v)}var b=t.skinWeights;for(e=0,i=b.length;e<i;e++)this.skinWeights.push(b[e].clone());var x=t.skinIndices;for(e=0,i=x.length;e<i;e++)this.skinIndices.push(x[e].clone());var w=t.lineDistances;for(e=0,i=w.length;e<i;e++)this.lineDistances.push(w[e]);var E=t.boundingBox;null!==E&&(this.boundingBox=E.clone());var S=t.boundingSphere;return null!==S&&(this.boundingSphere=S.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(yn.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(yn.prototype,{isBufferAttribute:!0,setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.itemSize:0,this.array=t},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.dynamic=t.dynamic,this},copyAt:function(t,e,i){t*=this.itemSize,i*=e.itemSize;for(var n=0,r=this.itemSize;n<r;n++)this.array[t+n]=e.array[i+n];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var a=t[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),a=new bi),e[i++]=a.r,e[i++]=a.g,e[i++]=a.b}return this},copyIndicesArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var a=t[n];e[i++]=a.a,e[i++]=a.b,e[i++]=a.c}return this},copyVector2sArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var a=t[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),a=new ve),e[i++]=a.x,e[i++]=a.y}return this},copyVector3sArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var a=t[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),a=new Pe),e[i++]=a.x,e[i++]=a.y,e[i++]=a.z}return this},copyVector4sArray:function(t){for(var e=this.array,i=0,n=0,r=t.length;n<r;n++){var a=t[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),a=new Me),e[i++]=a.x,e[i++]=a.y,e[i++]=a.z,e[i++]=a.w}return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this},setXYZ:function(t,e,i,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this},setXYZW:function(t,e,i,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=r,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),bn.prototype=Object.create(yn.prototype),bn.prototype.constructor=bn,xn.prototype=Object.create(yn.prototype),xn.prototype.constructor=xn,wn.prototype=Object.create(yn.prototype),wn.prototype.constructor=wn,En.prototype=Object.create(yn.prototype),En.prototype.constructor=En,Sn.prototype=Object.create(yn.prototype),Sn.prototype.constructor=Sn,Tn.prototype=Object.create(yn.prototype),Tn.prototype.constructor=Tn,Mn.prototype=Object.create(yn.prototype),Mn.prototype.constructor=Mn,An.prototype=Object.create(yn.prototype),An.prototype.constructor=An,In.prototype=Object.create(yn.prototype),In.prototype.constructor=In,Object.assign(Cn.prototype,{computeGroups:function(t){for(var e,i=[],n=void 0,r=t.faces,a=0;a<r.length;a++){var s=r[a];s.materialIndex!==n&&(n=s.materialIndex,void 0!==e&&(e.count=3*a-e.start,i.push(e)),e={start:3*a,materialIndex:n})}void 0!==e&&(e.count=3*a-e.start,i.push(e)),this.groups=i},fromGeometry:function(t){var e,i=t.faces,n=t.vertices,r=t.faceVertexUvs,a=r[0]&&r[0].length>0,s=r[1]&&r[1].length>0,o=t.morphTargets,l=o.length;if(l>0){e=[];for(var h=0;h<l;h++)e[h]=[];this.morphTargets.position=e}var c,u=t.morphNormals,d=u.length;if(d>0){c=[];for(h=0;h<d;h++)c[h]=[];this.morphTargets.normal=c}var f=t.skinIndices,p=t.skinWeights,m=f.length===n.length,g=p.length===n.length;for(h=0;h<i.length;h++){var v=i[h];this.vertices.push(n[v.a],n[v.b],n[v.c]);var _=v.vertexNormals;if(3===_.length)this.normals.push(_[0],_[1],_[2]);else{var y=v.normal;this.normals.push(y,y,y)}var b,x=v.vertexColors;if(3===x.length)this.colors.push(x[0],x[1],x[2]);else{var w=v.color;this.colors.push(w,w,w)}if(!0===a)void 0!==(b=r[0][h])?this.uvs.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",h),this.uvs.push(new ve,new ve,new ve));if(!0===s)void 0!==(b=r[1][h])?this.uvs2.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",h),this.uvs2.push(new ve,new ve,new ve));for(var E=0;E<l;E++){var S=o[E].vertices;e[E].push(S[v.a],S[v.b],S[v.c])}for(E=0;E<d;E++){var T=u[E].vertexNormals[h];c[E].push(T.a,T.b,T.c)}m&&this.skinIndices.push(f[v.a],f[v.b],f[v.c]),g&&this.skinWeights.push(p[v.a],p[v.b],p[v.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}}),Rn.MaxIndex=65535,Object.assign(Rn.prototype,l.prototype,{isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(Pn(t)>65535?Mn:Sn)(t,1):this.index=t},addAttribute:function(t,e){return e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(e)):(this.attributes[t]=e,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(t,new yn(arguments[1],arguments[2])))},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,i){this.groups.push({start:t,count:e,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix:function(t){var e=this.attributes.position;void 0!==e&&(t.applyToBufferAttribute(e),e.needsUpdate=!0);var i=this.attributes.normal;void 0!==i&&((new ji).getNormalMatrix(t).applyToBufferAttribute(i),i.needsUpdate=!0);return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var t=new Re;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new Re;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new Re;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new Re;return function(e,i,n){return t.makeTranslation(e,i,n),this.applyMatrix(t),this}}(),scale:function(){var t=new Re;return function(e,i,n){return t.makeScale(e,i,n),this.applyMatrix(t),this}}(),lookAt:function(){var t=new en;return function(e){t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),center:function(){this.computeBoundingBox();var t=this.boundingBox.getCenter().negate();return this.translate(t.x,t.y,t.z),t},setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){var i=new An(3*e.vertices.length,3),n=new An(3*e.colors.length,3);if(this.addAttribute("position",i.copyVector3sArray(e.vertices)),this.addAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var r=new An(e.lineDistances.length,1);this.addAttribute("lineDistance",r.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},updateFromObject:function(t){var e,i=t.geometry;if(t.isMesh){var n=i.__directGeometry;if(!0===i.elementsNeedUpdate&&(n=void 0,i.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(i);n.verticesNeedUpdate=i.verticesNeedUpdate,n.normalsNeedUpdate=i.normalsNeedUpdate,n.colorsNeedUpdate=i.colorsNeedUpdate,n.uvsNeedUpdate=i.uvsNeedUpdate,n.groupsNeedUpdate=i.groupsNeedUpdate,i.verticesNeedUpdate=!1,i.normalsNeedUpdate=!1,i.colorsNeedUpdate=!1,i.uvsNeedUpdate=!1,i.groupsNeedUpdate=!1,i=n}return!0===i.verticesNeedUpdate&&(void 0!==(e=this.attributes.position)&&(e.copyVector3sArray(i.vertices),e.needsUpdate=!0),i.verticesNeedUpdate=!1),!0===i.normalsNeedUpdate&&(void 0!==(e=this.attributes.normal)&&(e.copyVector3sArray(i.normals),e.needsUpdate=!0),i.normalsNeedUpdate=!1),!0===i.colorsNeedUpdate&&(void 0!==(e=this.attributes.color)&&(e.copyColorsArray(i.colors),e.needsUpdate=!0),i.colorsNeedUpdate=!1),i.uvsNeedUpdate&&(void 0!==(e=this.attributes.uv)&&(e.copyVector2sArray(i.uvs),e.needsUpdate=!0),i.uvsNeedUpdate=!1),i.lineDistancesNeedUpdate&&(void 0!==(e=this.attributes.lineDistance)&&(e.copyArray(i.lineDistances),e.needsUpdate=!0),i.lineDistancesNeedUpdate=!1),i.groupsNeedUpdate&&(i.computeGroups(t.geometry),this.groups=i.groups,i.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new Cn).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);if(this.addAttribute("position",new yn(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var i=new Float32Array(3*t.normals.length);this.addAttribute("normal",new yn(i,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var n=new Float32Array(3*t.colors.length);this.addAttribute("color",new yn(n,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var r=new Float32Array(2*t.uvs.length);this.addAttribute("uv",new yn(r,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var a=new Float32Array(2*t.uvs2.length);this.addAttribute("uv2",new yn(a,2).copyVector2sArray(t.uvs2))}if(t.indices.length>0){var s=new(Pn(t.indices)>65535?Uint32Array:Uint16Array)(3*t.indices.length);this.setIndex(new yn(s,1).copyIndicesArray(t.indices))}for(var o in this.groups=t.groups,t.morphTargets){for(var l=[],h=t.morphTargets[o],c=0,u=h.length;c<u;c++){var d=h[c],f=new An(3*d.length,3);l.push(f.copyVector3sArray(d))}this.morphAttributes[o]=l}if(t.skinIndices.length>0){var p=new An(4*t.skinIndices.length,4);this.addAttribute("skinIndex",p.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var m=new An(4*t.skinWeights.length,4);this.addAttribute("skinWeight",m.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Hi);var t=this.attributes.position;void 0!==t?this.boundingBox.setFromBufferAttribute(t):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var t=new Hi,e=new Pe;return function(){null===this.boundingSphere&&(this.boundingSphere=new Gi);var i=this.attributes.position;if(i){var n=this.boundingSphere.center;t.setFromBufferAttribute(i),t.getCenter(n);for(var r=0,a=0,s=i.count;a<s;a++)e.x=i.getX(a),e.y=i.getY(a),e.z=i.getZ(a),r=Math.max(r,n.distanceToSquared(e));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes,i=this.groups;if(e.position){var n=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new yn(new Float32Array(n.length),3));else for(var r=e.normal.array,a=0,s=r.length;a<s;a++)r[a]=0;var o,l,h,c=e.normal.array,u=new Pe,d=new Pe,f=new Pe,p=new Pe,m=new Pe;if(t){var g=t.array;0===i.length&&this.addGroup(0,g.length);for(var v=0,_=i.length;v<_;++v){var y=i[v],b=y.start;for(a=b,s=b+y.count;a<s;a+=3)o=3*g[a+0],l=3*g[a+1],h=3*g[a+2],u.fromArray(n,o),d.fromArray(n,l),f.fromArray(n,h),p.subVectors(f,d),m.subVectors(u,d),p.cross(m),c[o]+=p.x,c[o+1]+=p.y,c[o+2]+=p.z,c[l]+=p.x,c[l+1]+=p.y,c[l+2]+=p.z,c[h]+=p.x,c[h+1]+=p.y,c[h+2]+=p.z}}else for(a=0,s=n.length;a<s;a+=9)u.fromArray(n,a),d.fromArray(n,a+3),f.fromArray(n,a+6),p.subVectors(f,d),m.subVectors(u,d),p.cross(m),c[a]=p.x,c[a+1]=p.y,c[a+2]=p.z,c[a+3]=p.x,c[a+4]=p.y,c[a+5]=p.z,c[a+6]=p.x,c[a+7]=p.y,c[a+8]=p.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(t&&t.isBufferGeometry){void 0===e&&(e=0);var i=this.attributes;for(var n in i)if(void 0!==t.attributes[n])for(var r=i[n].array,a=t.attributes[n],s=a.array,o=0,l=a.itemSize*e;o<s.length;o++,l++)r[l]=s[o];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t)},normalizeNormals:(ln=new Pe,function(){for(var t=this.attributes.normal,e=0,i=t.count;e<i;e++)ln.x=t.getX(e),ln.y=t.getY(e),ln.z=t.getZ(e),ln.normalize(),t.setXYZ(e,ln.x,ln.y,ln.z)}),toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new Rn,e=this.index.array,i=this.attributes;for(var n in i){for(var r=i[n],a=r.array,s=r.itemSize,o=new a.constructor(e.length*s),l=0,h=0,c=0,u=e.length;c<u;c++){l=e[c]*s;for(var d=0;d<s;d++)o[h++]=a[l++]}t.addAttribute(n,new yn(o,s))}return t},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};var n=this.index;if(null!==n){var r=Array.prototype.slice.call(n.array);t.data.index={type:n.array.constructor.name,array:r}}var a=this.attributes;for(var i in a){var s=a[i];r=Array.prototype.slice.call(s.array);t.data.attributes[i]={itemSize:s.itemSize,type:s.array.constructor.name,array:r,normalized:s.normalized}}var o=this.groups;o.length>0&&(t.data.groups=JSON.parse(JSON.stringify(o)));var l=this.boundingSphere;return null!==l&&(t.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),t},clone:function(){return(new Rn).copy(this)},copy:function(t){var e,i,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var r=t.index;null!==r&&this.setIndex(r.clone());var a=t.attributes;for(e in a){var s=a[e];this.addAttribute(e,s.clone())}var o=t.morphAttributes;for(e in o){var l=[],h=o[e];for(i=0,n=h.length;i<n;i++)l.push(h[i].clone());this.morphAttributes[e]=l}var c=t.groups;for(i=0,n=c.length;i<n;i++){var u=c[i];this.addGroup(u.start,u.count,u.materialIndex)}var d=t.boundingBox;null!==d&&(this.boundingBox=d.clone());var f=t.boundingSphere;return null!==f&&(this.boundingSphere=f.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Ln.prototype=Object.create(_n.prototype),Ln.prototype.constructor=Ln,Dn.prototype=Object.create(Rn.prototype),Dn.prototype.constructor=Dn,kn.prototype=Object.create(_n.prototype),kn.prototype.constructor=kn,On.prototype=Object.create(Rn.prototype),On.prototype.constructor=On,Nn.prototype=Object.create(Ui.prototype),Nn.prototype.constructor=Nn,Nn.prototype.isMeshBasicMaterial=!0,Nn.prototype.copy=function(t){return Ui.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this},Object.assign(Un.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return(e||new Pe).copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(){var t=new Pe;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(t,e){var i=e||new Pe;i.subVectors(t,this.origin);var n=i.dot(this.direction);return n<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(){var t=new Pe;return function(e){var i=t.subVectors(e,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(e):(t.copy(this.direction).multiplyScalar(i).add(this.origin),t.distanceToSquared(e))}}(),distanceSqToSegment:(cn=new Pe,un=new Pe,dn=new Pe,function(t,e,i,n){cn.copy(t).add(e).multiplyScalar(.5),un.copy(e).sub(t).normalize(),dn.copy(this.origin).sub(cn);var r,a,s,o,l=.5*t.distanceTo(e),h=-this.direction.dot(un),c=dn.dot(this.direction),u=-dn.dot(un),d=dn.lengthSq(),f=Math.abs(1-h*h);if(f>0)if(a=h*c-u,o=l*f,(r=h*u-c)>=0)if(a>=-o)if(a<=o){var p=1/f;s=(r*=p)*(r+h*(a*=p)+2*c)+a*(h*r+a+2*u)+d}else a=l,s=-(r=Math.max(0,-(h*a+c)))*r+a*(a+2*u)+d;else a=-l,s=-(r=Math.max(0,-(h*a+c)))*r+a*(a+2*u)+d;else a<=-o?s=-(r=Math.max(0,-(-h*l+c)))*r+(a=r>0?-l:Math.min(Math.max(-l,-u),l))*(a+2*u)+d:a<=o?(r=0,s=(a=Math.min(Math.max(-l,-u),l))*(a+2*u)+d):s=-(r=Math.max(0,-(h*l+c)))*r+(a=r>0?l:Math.min(Math.max(-l,-u),l))*(a+2*u)+d;else a=h>0?-l:l,s=-(r=Math.max(0,-(h*a+c)))*r+a*(a+2*u)+d;return i&&i.copy(this.direction).multiplyScalar(r).add(this.origin),n&&n.copy(un).multiplyScalar(a).add(cn),s}),intersectSphere:function(){var t=new Pe;return function(e,i){t.subVectors(e.center,this.origin);var n=t.dot(this.direction),r=t.dot(t)-n*n,a=e.radius*e.radius;if(r>a)return null;var s=Math.sqrt(a-r),o=n-s,l=n+s;return o<0&&l<0?null:o<0?this.at(l,i):this.at(o,i)}}(),intersectsSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null},intersectPlane:function(t,e){var i=this.distanceToPlane(t);return null===i?null:this.at(i,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},intersectBox:function(t,e){var i,n,r,a,s,o,l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,u=this.origin;return l>=0?(i=(t.min.x-u.x)*l,n=(t.max.x-u.x)*l):(i=(t.max.x-u.x)*l,n=(t.min.x-u.x)*l),h>=0?(r=(t.min.y-u.y)*h,a=(t.max.y-u.y)*h):(r=(t.max.y-u.y)*h,a=(t.min.y-u.y)*h),i>a||r>n?null:((r>i||i!=i)&&(i=r),(a<n||n!=n)&&(n=a),c>=0?(s=(t.min.z-u.z)*c,o=(t.max.z-u.z)*c):(s=(t.max.z-u.z)*c,o=(t.min.z-u.z)*c),i>o||s>n?null:((s>i||i!=i)&&(i=s),(o<n||n!=n)&&(n=o),n<0?null:this.at(i>=0?i:n,e)))},intersectsBox:(hn=new Pe,function(t){return null!==this.intersectBox(t,hn)}),intersectTriangle:function(){var t=new Pe,e=new Pe,i=new Pe,n=new Pe;return function(r,a,s,o,l){e.subVectors(a,r),i.subVectors(s,r),n.crossVectors(e,i);var h,c=this.direction.dot(n);if(c>0){if(o)return null;h=1}else{if(!(c<0))return null;h=-1,c=-c}t.subVectors(this.origin,r);var u=h*this.direction.dot(i.crossVectors(t,i));if(u<0)return null;var d=h*this.direction.dot(e.cross(t));if(d<0)return null;if(u+d>c)return null;var f=-h*t.dot(n);return f<0?null:this.at(f/c,l)}}(),applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}),Object.assign(Fn.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return(t||new Pe).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return(t||new Pe).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){var i=e||new Pe;return this.delta(i).multiplyScalar(t).add(this.start)},closestPointToPointParameter:(fn=new Pe,pn=new Pe,function(t,e){fn.subVectors(t,this.start),pn.subVectors(this.end,this.start);var i=pn.dot(pn),n=pn.dot(fn)/i;return e&&(n=ge.clamp(n,0,1)),n}),closestPointToPoint:function(t,e,i){var n=this.closestPointToPointParameter(t,e),r=i||new Pe;return this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),Object.assign(Bn,{normal:(mn=new Pe,function(t,e,i,n){var r=n||new Pe;r.subVectors(i,e),mn.subVectors(t,e),r.cross(mn);var a=r.lengthSq();return a>0?r.multiplyScalar(1/Math.sqrt(a)):r.set(0,0,0)}),barycoordFromPoint:function(){var t=new Pe,e=new Pe,i=new Pe;return function(n,r,a,s,o){t.subVectors(s,r),e.subVectors(a,r),i.subVectors(n,r);var l=t.dot(t),h=t.dot(e),c=t.dot(i),u=e.dot(e),d=e.dot(i),f=l*u-h*h,p=o||new Pe;if(0===f)return p.set(-2,-1,-1);var m=1/f,g=(u*c-h*d)*m,v=(l*d-h*c)*m;return p.set(1-g-v,v,g)}}(),containsPoint:function(){var t=new Pe;return function(e,i,n,r){var a=Bn.barycoordFromPoint(e,i,n,r,t);return a.x>=0&&a.y>=0&&a.x+a.y<=1}}()}),Object.assign(Bn.prototype,{set:function(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this},setFromPointsAndIndices:function(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},area:function(){var t=new Pe,e=new Pe;return function(){return t.subVectors(this.c,this.b),e.subVectors(this.a,this.b),.5*t.cross(e).length()}}(),midpoint:function(t){return(t||new Pe).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(t){return Bn.normal(this.a,this.b,this.c,t)},plane:function(t){return(t||new Vi).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(t,e){return Bn.barycoordFromPoint(t,this.a,this.b,this.c,e)},containsPoint:function(t){return Bn.containsPoint(t,this.a,this.b,this.c)},closestPointToPoint:function(){var t=new Vi,e=[new Fn,new Fn,new Fn],i=new Pe,n=new Pe;return function(r,a){var s=a||new Pe,o=1/0;if(t.setFromCoplanarPoints(this.a,this.b,this.c),t.projectPoint(r,i),!0===this.containsPoint(i))s.copy(i);else{e[0].set(this.a,this.b),e[1].set(this.b,this.c),e[2].set(this.c,this.a);for(var l=0;l<e.length;l++){e[l].closestPointToPoint(i,!0,n);var h=i.distanceToSquared(n);h<o&&(o=h,s.copy(n))}}return s}}(),equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}),zn.prototype=Object.assign(Object.create(en.prototype),{constructor:zn,isMesh:!0,setDrawMode:function(t){this.drawMode=t},copy:function(t){return en.prototype.copy.call(this,t),this.drawMode=t.drawMode,this},updateMorphTargets:function(){var t,e,i,n=this.geometry;if(n.isBufferGeometry){var r=n.morphAttributes,a=Object.keys(r);if(a.length>0){var s=r[a[0]];if(void 0!==s)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=s.length;t<e;t++)i=s[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}else{var o=n.morphTargets;if(void 0!==o&&o.length>0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=o.length;t<e;t++)i=o[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}},raycast:function(){var t=new Re,e=new Un,i=new Gi,n=new Pe,r=new Pe,a=new Pe,s=new Pe,o=new Pe,l=new Pe,h=new ve,c=new ve,u=new ve,d=new Pe,f=new Pe,p=new Pe;function m(t,e,i,n,r,a,s){return Bn.barycoordFromPoint(t,e,i,n,d),r.multiplyScalar(d.x),a.multiplyScalar(d.y),s.multiplyScalar(d.z),r.add(a).add(s),r.clone()}function g(t,e,i,n,r,a,s,o){if(null===(e.side===E?n.intersectTriangle(s,a,r,!0,o):n.intersectTriangle(r,a,s,e.side!==S,o)))return null;p.copy(o),p.applyMatrix4(t.matrixWorld);var l=i.ray.origin.distanceTo(p);return l<i.near||l>i.far?null:{distance:l,point:p.clone(),object:t}}function v(t,e,i,s,o,l,d,p){n.fromBufferAttribute(s,l),r.fromBufferAttribute(s,d),a.fromBufferAttribute(s,p);var v=g(t,t.material,e,i,n,r,a,f);return v&&(o&&(h.fromBufferAttribute(o,l),c.fromBufferAttribute(o,d),u.fromBufferAttribute(o,p),v.uv=m(f,n,r,a,h,c,u)),v.face=new sn(l,d,p,Bn.normal(n,r,a)),v.faceIndex=l),v}return function(d,p){var _,y=this.geometry,b=this.material,x=this.matrixWorld;if(void 0!==b&&(null===y.boundingSphere&&y.computeBoundingSphere(),i.copy(y.boundingSphere),i.applyMatrix4(x),!1!==d.ray.intersectsSphere(i)&&(t.getInverse(x),e.copy(d.ray).applyMatrix4(t),null===y.boundingBox||!1!==e.intersectsBox(y.boundingBox))))if(y.isBufferGeometry){var w,E,S,T,M,A=y.index,I=y.attributes.position,C=y.attributes.uv;if(null!==A)for(T=0,M=A.count;T<M;T+=3)w=A.getX(T),E=A.getX(T+1),S=A.getX(T+2),(_=v(this,d,e,I,C,w,E,S))&&(_.faceIndex=Math.floor(T/3),p.push(_));else for(T=0,M=I.count;T<M;T+=3)(_=v(this,d,e,I,C,w=T,E=T+1,S=T+2))&&(_.index=w,p.push(_))}else if(y.isGeometry){var P,R,L,D,k=Array.isArray(b),O=y.vertices,N=y.faces,U=y.faceVertexUvs[0];U.length>0&&(D=U);for(var F=0,B=N.length;F<B;F++){var z=N[F],H=k?b[z.materialIndex]:b;if(void 0!==H){if(P=O[z.a],R=O[z.b],L=O[z.c],!0===H.morphTargets){var G=y.morphTargets,j=this.morphTargetInfluences;n.set(0,0,0),r.set(0,0,0),a.set(0,0,0);for(var V=0,W=G.length;V<W;V++){var q=j[V];if(0!==q){var X=G[V].vertices;n.addScaledVector(s.subVectors(X[z.a],P),q),r.addScaledVector(o.subVectors(X[z.b],R),q),a.addScaledVector(l.subVectors(X[z.c],L),q)}}n.add(P),r.add(R),a.add(L),P=n,R=r,L=a}if(_=g(this,H,d,e,P,R,L,f)){if(D&&D[F]){var Y=D[F];h.copy(Y[0]),c.copy(Y[1]),u.copy(Y[2]),_.uv=m(f,P,R,L,h,c,u)}_.face=z,_.faceIndex=F,p.push(_)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Xn,Yn,Zn,Jn,Kn,Qn,$n=0;function tr(t){switch(t){case oe:return["Linear","( value )"];case le:return["sRGB","( value )"];case ce:return["RGBE","( value )"];case ue:return["RGBM","( value, 7.0 )"];case de:return["RGBM","( value, 16.0 )"];case fe:return["RGBD","( value, 256.0 )"];case he:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+t)}}function er(t,e){var i=tr(e);return"vec4 "+t+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function ir(t){return""!==t}function nr(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights)}function rr(t){return t.replace(/^[ \t]*#include +<([\w\d.]+)>/gm,function(t,e){var i=Ei[e];if(void 0===i)throw new Error("Can not resolve #include <"+e+">");return rr(i)})}function ar(t){return t.replace(/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(t,e,i,n){for(var r="",a=parseInt(e);a<parseInt(i);a++)r+=n.replace(/\[ i \]/g,"[ "+a+" ]");return r})}function sr(t,e,i,n,r,a){var s=t.context,o=n.defines,l=r.vertexShader,h=r.fragmentShader,c="SHADOWMAP_TYPE_BASIC";a.shadowMapType===b?c="SHADOWMAP_TYPE_PCF":a.shadowMapType===x&&(c="SHADOWMAP_TYPE_PCF_SOFT");var u="ENVMAP_TYPE_CUBE",d="ENVMAP_MODE_REFLECTION",f="ENVMAP_BLENDING_MULTIPLY";if(a.envMap){switch(n.envMap.mapping){case dt:case ft:u="ENVMAP_TYPE_CUBE";break;case vt:case _t:u="ENVMAP_TYPE_CUBE_UV";break;case pt:case mt:u="ENVMAP_TYPE_EQUIREC";break;case gt:u="ENVMAP_TYPE_SPHERE"}switch(n.envMap.mapping){case ft:case mt:d="ENVMAP_MODE_REFRACTION"}switch(n.combine){case rt:f="ENVMAP_BLENDING_MULTIPLY";break;case at:f="ENVMAP_BLENDING_MIX";break;case st:f="ENVMAP_BLENDING_ADD"}}var p,m,g,v,_,y=t.gammaFactor>0?t.gammaFactor:1,w=function(t,e,i){return[(t=t||{}).derivatives||e.envMapCubeUV||e.bumpMap||e.normalMap||e.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(t.fragDepth||e.logarithmicDepthBuffer)&&i.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",t.drawBuffers&&i.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(t.shaderTextureLOD||e.envMap)&&i.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ir).join("\n")}(n.extensions,a,e),E=function(t){var e=[];for(var i in t){var n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}(o),S=s.createProgram();n.isRawShaderMaterial?(p=[E,"\n"].filter(ir).join("\n"),m=[w,E,"\n"].filter(ir).join("\n")):(p=["precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+r.name,E,a.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+y,"#define MAX_BONES "+a.maxBones,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+d:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexColors?"#define USE_COLOR":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&!1===a.flatShading?"#define USE_MORPHNORMALS":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+a.numClippingPlanes,a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+c:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&e.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ir).join("\n"),m=[w,"precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+r.name,E,a.alphaTest?"#define ALPHATEST "+a.alphaTest:"","#define GAMMA_FACTOR "+y,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+u:"",a.envMap?"#define "+d:"",a.envMap?"#define "+f:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexColors?"#define USE_COLOR":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+a.numClippingPlanes,"#define UNION_CLIPPING_PLANES "+(a.numClippingPlanes-a.numClipIntersection),a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+c:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&e.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",a.envMap&&e.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",a.toneMapping!==ot?"#define TONE_MAPPING":"",a.toneMapping!==ot?Ei.tonemapping_pars_fragment:"",a.toneMapping!==ot?function(t,e){var i;switch(e){case lt:i="Linear";break;case ht:i="Reinhard";break;case ct:i="Uncharted2";break;case ut:i="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+e)}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",a.outputEncoding||a.mapEncoding||a.envMapEncoding||a.emissiveMapEncoding?Ei.encodings_pars_fragment:"",a.mapEncoding?er("mapTexelToLinear",a.mapEncoding):"",a.envMapEncoding?er("envMapTexelToLinear",a.envMapEncoding):"",a.emissiveMapEncoding?er("emissiveMapTexelToLinear",a.emissiveMapEncoding):"",a.outputEncoding?(g="linearToOutputTexel",v=a.outputEncoding,_=tr(v),"vec4 "+g+"( vec4 value ) { return LinearTo"+_[0]+_[1]+"; }"):"",a.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(ir).join("\n")),l=nr(l=rr(l),a),h=nr(h=rr(h),a),n.isShaderMaterial||(l=ar(l),h=ar(h));var T=p+l,M=m+h,A=qn(s,s.VERTEX_SHADER,T),I=qn(s,s.FRAGMENT_SHADER,M);s.attachShader(S,A),s.attachShader(S,I),void 0!==n.index0AttributeName?s.bindAttribLocation(S,0,n.index0AttributeName):!0===a.morphTargets&&s.bindAttribLocation(S,0,"position"),s.linkProgram(S);var C,P,R=s.getProgramInfoLog(S),L=s.getShaderInfoLog(A),D=s.getShaderInfoLog(I),k=!0,O=!0;return!1===s.getProgramParameter(S,s.LINK_STATUS)?(k=!1,console.error("THREE.WebGLProgram: shader error: ",s.getError(),"gl.VALIDATE_STATUS",s.getProgramParameter(S,s.VALIDATE_STATUS),"gl.getProgramInfoLog",R,L,D)):""!==R?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",R):""!==L&&""!==D||(O=!1),O&&(this.diagnostics={runnable:k,material:n,programLog:R,vertexShader:{log:L,prefix:p},fragmentShader:{log:D,prefix:m}}),s.deleteShader(A),s.deleteShader(I),this.getUniforms=function(){return void 0===C&&(C=new _i(s,S,t)),C},this.getAttributes=function(){return void 0===P&&(P=function(t,e,i){for(var n={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),a=0;a<r;a++){var s=t.getActiveAttrib(e,a).name;n[s]=t.getAttribLocation(e,s)}return n}(s,S)),P},this.destroy=function(){s.deleteProgram(S),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=$n++,this.code=i,this.usedTimes=1,this.program=S,this.vertexShader=A,this.fragmentShader=I,this}function or(t,e,i){var n=[],r={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow"},a=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function s(t,e){var i;return t?t.isTexture?i=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=t.texture.encoding):i=oe,i===oe&&e&&(i=he),i}this.getParameters=function(e,n,a,o,l,h,c){var u=r[e.type],d=c.isSkinnedMesh?function(t){var e=t.skeleton.bones;if(i.floatVertexTextures)return 1024;var n=i.maxVertexUniforms,r=Math.floor((n-20)/4),a=Math.min(r,e.length);return a<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+a+"."),0):a}(c):0,f=i.precision;null!==e.precision&&(f=i.getMaxPrecision(e.precision))!==e.precision&&console.warn("THREE.WebGLProgram.getParameters:",e.precision,"not supported, using",f,"instead.");var p=t.getRenderTarget();return{shaderID:u,precision:f,supportsVertexTextures:i.vertexTextures,outputEncoding:s(p?p.texture:null,t.gammaOutput),map:!!e.map,mapEncoding:s(e.map,t.gammaInput),envMap:!!e.envMap,envMapMode:e.envMap&&e.envMap.mapping,envMapEncoding:s(e.envMap,t.gammaInput),envMapCubeUV:!!e.envMap&&(e.envMap.mapping===vt||e.envMap.mapping===_t),lightMap:!!e.lightMap,aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,emissiveMapEncoding:s(e.emissiveMap,t.gammaInput),bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,displacementMap:!!e.displacementMap,roughnessMap:!!e.roughnessMap,metalnessMap:!!e.metalnessMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,gradientMap:!!e.gradientMap,combine:e.combine,vertexColors:e.vertexColors,fog:!!o,useFog:e.fog,fogExp:o&&o.isFogExp2,flatShading:e.flatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:i.logarithmicDepthBuffer,skinning:e.skinning&&d>0,maxBones:d,useVertexTexture:i.floatVertexTextures,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:n.directional.length,numPointLights:n.point.length,numSpotLights:n.spot.length,numRectAreaLights:n.rectArea.length,numHemiLights:n.hemi.length,numClippingPlanes:l,numClipIntersection:h,dithering:e.dithering,shadowMapEnabled:t.shadowMap.enabled&&c.receiveShadow&&a.length>0,shadowMapType:t.shadowMap.type,toneMapping:t.toneMapping,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:e.premultipliedAlpha,alphaTest:e.alphaTest,doubleSided:e.side===S,flipSided:e.side===E,depthPacking:void 0!==e.depthPacking&&e.depthPacking}},this.getProgramCode=function(e,i){var n=[];if(i.shaderID?n.push(i.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(var r in e.defines)n.push(r),n.push(e.defines[r]);for(var s=0;s<a.length;s++)n.push(i[a[s]]);return n.push(e.onBeforeCompile.toString()),n.push(t.gammaOutput),n.join()},this.acquireProgram=function(i,r,a,s){for(var o,l=0,h=n.length;l<h;l++){var c=n[l];if(c.code===s){++(o=c).usedTimes;break}}return void 0===o&&(o=new sr(t,e,s,i,r,a),n.push(o)),o},this.releaseProgram=function(t){if(0==--t.usedTimes){var e=n.indexOf(t);n[e]=n[n.length-1],n.pop(),t.destroy()}},this.programs=n}function lr(t,e,i,n,r,a,s){var o="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext;function l(t,e){if(t.width>e||t.height>e){var i=e/Math.max(t.width,t.height),n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return n.width=Math.floor(t.width*i),n.height=Math.floor(t.height*i),n.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,n.width,n.height),console.warn("THREE.WebGLRenderer: image is too big ("+t.width+"x"+t.height+"). Resized to "+n.width+"x"+n.height,t),n}return t}function h(t){return ge.isPowerOfTwo(t.width)&&ge.isPowerOfTwo(t.height)}function c(t,e){return t.generateMipmaps&&e&&t.minFilter!==wt&&t.minFilter!==Tt}function u(e){return e===wt||e===Et||e===St?t.NEAREST:t.LINEAR}function d(e){var i=e.target;i.removeEventListener("dispose",d),function(e){var i=n.get(e);if(e.image&&i.__image__webglTextureCube)t.deleteTexture(i.__image__webglTextureCube);else{if(void 0===i.__webglInit)return;t.deleteTexture(i.__webglTexture)}n.remove(e)}(i),s.textures--}function f(e){var i=e.target;i.removeEventListener("dispose",f),function(e){var i=n.get(e),r=n.get(e.texture);if(!e)return;void 0!==r.__webglTexture&&t.deleteTexture(r.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLRenderTargetCube)for(var a=0;a<6;a++)t.deleteFramebuffer(i.__webglFramebuffer[a]),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer[a]);else t.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer);n.remove(e.texture),n.remove(e)}(i),s.textures--}function p(e,u){var f=n.get(e);if(e.version>0&&f.__version!==e.version){var p=e.image;if(void 0===p)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",e);else{if(!1!==p.complete)return void function(e,n,u){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",d),e.__webglTexture=t.createTexture(),s.textures++);i.activeTexture(t.TEXTURE0+u),i.bindTexture(t.TEXTURE_2D,e.__webglTexture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,n.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,n.unpackAlignment);var f=l(n.image,r.maxTextureSize);(function(t){return t.wrapS!==bt||t.wrapT!==bt||t.minFilter!==wt&&t.minFilter!==Tt})(n)&&!1===h(f)&&(f=function(t){if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement){var e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.width=ge.nearestPowerOfTwo(t.width),e.height=ge.nearestPowerOfTwo(t.height),e.getContext("2d").drawImage(t,0,0,e.width,e.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+t.width+"x"+t.height+"). Resized to "+e.width+"x"+e.height,t),e}return t}(f));var p=h(f),g=a.convert(n.format),v=a.convert(n.type);m(t.TEXTURE_2D,n,p);var _,y=n.mipmaps;if(n.isDepthTexture){var b=t.DEPTH_COMPONENT;if(n.type===kt){if(!o)throw new Error("Float Depth Texture only supported in WebGL2.0");b=t.DEPTH_COMPONENT32F}else o&&(b=t.DEPTH_COMPONENT16);n.format===Wt&&b===t.DEPTH_COMPONENT&&n.type!==Rt&&n.type!==Dt&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=Rt,v=a.convert(n.type)),n.format===qt&&(b=t.DEPTH_STENCIL,n.type!==Bt&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=Bt,v=a.convert(n.type))),i.texImage2D(t.TEXTURE_2D,0,b,f.width,f.height,0,g,v,null)}else if(n.isDataTexture)if(y.length>0&&p){for(var x=0,w=y.length;x<w;x++)_=y[x],i.texImage2D(t.TEXTURE_2D,x,g,_.width,_.height,0,g,v,_.data);n.generateMipmaps=!1}else i.texImage2D(t.TEXTURE_2D,0,g,f.width,f.height,0,g,v,f.data);else if(n.isCompressedTexture)for(var x=0,w=y.length;x<w;x++)_=y[x],n.format!==Gt&&n.format!==Ht?i.getCompressedTextureFormats().indexOf(g)>-1?i.compressedTexImage2D(t.TEXTURE_2D,x,g,_.width,_.height,0,_.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(t.TEXTURE_2D,x,g,_.width,_.height,0,g,v,_.data);else if(y.length>0&&p){for(var x=0,w=y.length;x<w;x++)_=y[x],i.texImage2D(t.TEXTURE_2D,x,g,g,v,_);n.generateMipmaps=!1}else i.texImage2D(t.TEXTURE_2D,0,g,g,v,f);c(n,p)&&t.generateMipmap(t.TEXTURE_2D);e.__version=n.version,n.onUpdate&&n.onUpdate(n)}(f,e,u);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",e)}}i.activeTexture(t.TEXTURE0+u),i.bindTexture(t.TEXTURE_2D,f.__webglTexture)}function m(i,s,o){var l;if(o?(t.texParameteri(i,t.TEXTURE_WRAP_S,a.convert(s.wrapS)),t.texParameteri(i,t.TEXTURE_WRAP_T,a.convert(s.wrapT)),t.texParameteri(i,t.TEXTURE_MAG_FILTER,a.convert(s.magFilter)),t.texParameteri(i,t.TEXTURE_MIN_FILTER,a.convert(s.minFilter))):(t.texParameteri(i,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(i,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),s.wrapS===bt&&s.wrapT===bt||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",s),t.texParameteri(i,t.TEXTURE_MAG_FILTER,u(s.magFilter)),t.texParameteri(i,t.TEXTURE_MIN_FILTER,u(s.minFilter)),s.minFilter!==wt&&s.minFilter!==Tt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",s)),l=e.get("EXT_texture_filter_anisotropic")){if(s.type===kt&&null===e.get("OES_texture_float_linear"))return;if(s.type===Ot&&null===e.get("OES_texture_half_float_linear"))return;(s.anisotropy>1||n.get(s).__currentAnisotropy)&&(t.texParameterf(i,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy)}}function g(e,r,s,o){var l=a.convert(r.texture.format),h=a.convert(r.texture.type);i.texImage2D(o,0,l,r.width,r.height,0,l,h,null),t.bindFramebuffer(t.FRAMEBUFFER,e),t.framebufferTexture2D(t.FRAMEBUFFER,s,o,n.get(r.texture).__webglTexture,0),t.bindFramebuffer(t.FRAMEBUFFER,null)}function v(e,i){t.bindRenderbuffer(t.RENDERBUFFER,e),i.depthBuffer&&!i.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,i.width,i.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)):i.depthBuffer&&i.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,i.width,i.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e)):t.renderbufferStorage(t.RENDERBUFFER,t.RGBA4,i.width,i.height),t.bindRenderbuffer(t.RENDERBUFFER,null)}function _(e){var i=n.get(e),r=!0===e.isWebGLRenderTargetCube;if(e.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,i){if(i&&i.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(t.FRAMEBUFFER,e),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),p(i.depthTexture,0);var r=n.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===Wt)t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,r,0);else{if(i.depthTexture.format!==qt)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,r,0)}}(i.__webglFramebuffer,e)}else if(r){i.__webglDepthbuffer=[];for(var a=0;a<6;a++)t.bindFramebuffer(t.FRAMEBUFFER,i.__webglFramebuffer[a]),i.__webglDepthbuffer[a]=t.createRenderbuffer(),v(i.__webglDepthbuffer[a],e)}else t.bindFramebuffer(t.FRAMEBUFFER,i.__webglFramebuffer),i.__webglDepthbuffer=t.createRenderbuffer(),v(i.__webglDepthbuffer,e);t.bindFramebuffer(t.FRAMEBUFFER,null)}this.setTexture2D=p,this.setTextureCube=function(e,o){var u=n.get(e);if(6===e.image.length)if(e.version>0&&u.__version!==e.version){u.__image__webglTextureCube||(e.addEventListener("dispose",d),u.__image__webglTextureCube=t.createTexture(),s.textures++),i.activeTexture(t.TEXTURE0+o),i.bindTexture(t.TEXTURE_CUBE_MAP,u.__image__webglTextureCube),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var f=e&&e.isCompressedTexture,p=e.image[0]&&e.image[0].isDataTexture,g=[],v=0;v<6;v++)g[v]=f||p?p?e.image[v].image:e.image[v]:l(e.image[v],r.maxCubemapSize);var _=h(g[0]),y=a.convert(e.format),b=a.convert(e.type);for(m(t.TEXTURE_CUBE_MAP,e,_),v=0;v<6;v++)if(f)for(var x,w=g[v].mipmaps,E=0,S=w.length;E<S;E++)x=w[E],e.format!==Gt&&e.format!==Ht?i.getCompressedTextureFormats().indexOf(y)>-1?i.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+v,E,y,x.width,x.height,0,x.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+v,E,y,x.width,x.height,0,y,b,x.data);else p?i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+v,0,y,g[v].width,g[v].height,0,y,b,g[v].data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+v,0,y,y,b,g[v]);c(e,_)&&t.generateMipmap(t.TEXTURE_CUBE_MAP),u.__version=e.version,e.onUpdate&&e.onUpdate(e)}else i.activeTexture(t.TEXTURE0+o),i.bindTexture(t.TEXTURE_CUBE_MAP,u.__image__webglTextureCube)},this.setTextureCubeDynamic=function(e,r){i.activeTexture(t.TEXTURE0+r),i.bindTexture(t.TEXTURE_CUBE_MAP,n.get(e).__webglTexture)},this.setupRenderTarget=function(e){var r=n.get(e),a=n.get(e.texture);e.addEventListener("dispose",f),a.__webglTexture=t.createTexture(),s.textures++;var o=!0===e.isWebGLRenderTargetCube,l=h(e);if(o){r.__webglFramebuffer=[];for(var u=0;u<6;u++)r.__webglFramebuffer[u]=t.createFramebuffer()}else r.__webglFramebuffer=t.createFramebuffer();if(o){for(i.bindTexture(t.TEXTURE_CUBE_MAP,a.__webglTexture),m(t.TEXTURE_CUBE_MAP,e.texture,l),u=0;u<6;u++)g(r.__webglFramebuffer[u],e,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+u);c(e.texture,l)&&t.generateMipmap(t.TEXTURE_CUBE_MAP),i.bindTexture(t.TEXTURE_CUBE_MAP,null)}else i.bindTexture(t.TEXTURE_2D,a.__webglTexture),m(t.TEXTURE_2D,e.texture,l),g(r.__webglFramebuffer,e,t.COLOR_ATTACHMENT0,t.TEXTURE_2D),c(e.texture,l)&&t.generateMipmap(t.TEXTURE_2D),i.bindTexture(t.TEXTURE_2D,null);e.depthBuffer&&_(e)},this.updateRenderTargetMipmap=function(e){var r=e.texture;if(c(r,h(e))){var a=e.isWebGLRenderTargetCube?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,s=n.get(r).__webglTexture;i.bindTexture(a,s),t.generateMipmap(a),i.bindTexture(a,null)}}}function hr(t){an.call(this),this.cameras=t||[]}function cr(t){console.log("THREE.WebGLRenderer",m);var e=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),i=void 0!==t.context?t.context:null,n=void 0!==t.alpha&&t.alpha,r=void 0===t.depth||t.depth,a=void 0===t.stencil||t.stencil,s=void 0!==t.antialias&&t.antialias,o=void 0===t.premultipliedAlpha||t.premultipliedAlpha,l=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,h=[],c=[],u=null,d=[],f=[];this.domElement=e,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=lt,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var p,b,x,w,M,A,rt,at,st,ot,ht,ct,ut,dt,ft,pt,mt,gt,vt,_t=this,ie=!1,ne=null,oe=null,le=-1,he="",ce=null,ue=null,de=new Me,fe=new Me,pe=null,me=0,ve=e.width,_e=e.height,ye=1,be=new Me(0,0,ve,_e),xe=new Me(0,0,ve,_e),we=!1,Ee=new Wi,Se=new function(){var t=this,e=null,i=0,n=!1,r=!1,a=new Vi,s=new ji,o={value:null,needsUpdate:!1};function l(){o.value!==e&&(o.value=e,o.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function h(e,i,n,r){var l=null!==e?e.length:0,h=null;if(0!==l){if(h=o.value,!0!==r||null===h){var c=n+4*l,u=i.matrixWorldInverse;s.getNormalMatrix(u),(null===h||h.length<c)&&(h=new Float32Array(c));for(var d=0,f=n;d!==l;++d,f+=4)a.copy(e[d]).applyMatrix4(u,s),a.normal.toArray(h,f),h[f+3]=a.constant}o.value=h,o.needsUpdate=!0}return t.numPlanes=l,h}this.uniform=o,this.numPlanes=0,this.numIntersection=0,this.init=function(t,r,a){var s=0!==t.length||r||0!==i||n;return n=r,e=h(t,a,0),i=t.length,s},this.beginShadows=function(){r=!0,h(null)},this.endShadows=function(){r=!1,l()},this.setState=function(t,a,s,c,u,d){if(!n||null===t||0===t.length||r&&!s)r?h(null):l();else{var f=r?0:i,p=4*f,m=u.clippingState||null;o.value=m,m=h(t,c,p,d);for(var g=0;g!==p;++g)m[g]=e[g];u.clippingState=m,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=f}}},Te=!1,Ae=!1,Ie=new Re,Ce=new Pe,De={geometries:0,textures:0},ke={frame:0,calls:0,vertices:0,faces:0,points:0};function Oe(){return null===ne?ye:1}this.info={render:ke,memory:De,programs:null};try{var Ne={alpha:n,depth:r,stencil:a,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:l};if(null===(p=i||e.getContext("webgl",Ne)||e.getContext("experimental-webgl",Ne)))throw null!==e.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";void 0===p.getShaderPrecisionFormat&&(p.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),e.addEventListener("webglcontextlost",ze,!1),e.addEventListener("webglcontextrestored",He,!1)}catch(t){console.error("THREE.WebGLRenderer: "+t)}function Ue(){(b=new function(t){var e={};return{get:function(i){if(void 0!==e[i])return e[i];var n;switch(i){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":n=t.getExtension("WEBGL_compressed_texture_etc1");break;default:n=t.getExtension(i)}return null===n&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),e[i]=n,n}}}(p)).get("WEBGL_depth_texture"),b.get("OES_texture_float"),b.get("OES_texture_float_linear"),b.get("OES_texture_half_float"),b.get("OES_texture_half_float_linear"),b.get("OES_standard_derivatives"),b.get("ANGLE_instanced_arrays"),b.get("OES_element_index_uint")&&(Rn.MaxIndex=4294967296),vt=new function(t,e){return{convert:function(i){var n;if(i===yt)return t.REPEAT;if(i===bt)return t.CLAMP_TO_EDGE;if(i===xt)return t.MIRRORED_REPEAT;if(i===wt)return t.NEAREST;if(i===Et)return t.NEAREST_MIPMAP_NEAREST;if(i===St)return t.NEAREST_MIPMAP_LINEAR;if(i===Tt)return t.LINEAR;if(i===Mt)return t.LINEAR_MIPMAP_NEAREST;if(i===At)return t.LINEAR_MIPMAP_LINEAR;if(i===It)return t.UNSIGNED_BYTE;if(i===Nt)return t.UNSIGNED_SHORT_4_4_4_4;if(i===Ut)return t.UNSIGNED_SHORT_5_5_5_1;if(i===Ft)return t.UNSIGNED_SHORT_5_6_5;if(i===Ct)return t.BYTE;if(i===Pt)return t.SHORT;if(i===Rt)return t.UNSIGNED_SHORT;if(i===Lt)return t.INT;if(i===Dt)return t.UNSIGNED_INT;if(i===kt)return t.FLOAT;if(i===Ot&&null!==(n=e.get("OES_texture_half_float")))return n.HALF_FLOAT_OES;if(i===zt)return t.ALPHA;if(i===Ht)return t.RGB;if(i===Gt)return t.RGBA;if(i===jt)return t.LUMINANCE;if(i===Vt)return t.LUMINANCE_ALPHA;if(i===Wt)return t.DEPTH_COMPONENT;if(i===qt)return t.DEPTH_STENCIL;if(i===k)return t.FUNC_ADD;if(i===O)return t.FUNC_SUBTRACT;if(i===N)return t.FUNC_REVERSE_SUBTRACT;if(i===B)return t.ZERO;if(i===z)return t.ONE;if(i===H)return t.SRC_COLOR;if(i===G)return t.ONE_MINUS_SRC_COLOR;if(i===j)return t.SRC_ALPHA;if(i===V)return t.ONE_MINUS_SRC_ALPHA;if(i===W)return t.DST_ALPHA;if(i===q)return t.ONE_MINUS_DST_ALPHA;if(i===X)return t.DST_COLOR;if(i===Y)return t.ONE_MINUS_DST_COLOR;if(i===Z)return t.SRC_ALPHA_SATURATE;if((i===Xt||i===Yt||i===Zt||i===Jt)&&null!==(n=e.get("WEBGL_compressed_texture_s3tc"))){if(i===Xt)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===Yt)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===Zt)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===Jt)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((i===Kt||i===Qt||i===$t||i===te)&&null!==(n=e.get("WEBGL_compressed_texture_pvrtc"))){if(i===Kt)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===Qt)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===$t)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===te)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(i===ee&&null!==(n=e.get("WEBGL_compressed_texture_etc1")))return n.COMPRESSED_RGB_ETC1_WEBGL;if((i===U||i===F)&&null!==(n=e.get("EXT_blend_minmax"))){if(i===U)return n.MIN_EXT;if(i===F)return n.MAX_EXT}return i===Bt&&null!==(n=e.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:0}}}(p,b),x=new function(t,e,i){var n;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var a=void 0!==i.precision?i.precision:"highp",s=r(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);var o=!0===i.logarithmicDepthBuffer&&!!e.get("EXT_frag_depth"),l=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),h=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),c=t.getParameter(t.MAX_TEXTURE_SIZE),u=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),d=t.getParameter(t.MAX_VERTEX_ATTRIBS),f=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),p=t.getParameter(t.MAX_VARYING_VECTORS),m=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),g=h>0,v=!!e.get("OES_texture_float");return{getMaxAnisotropy:function(){if(void 0!==n)return n;var i=e.get("EXT_texture_filter_anisotropic");return n=null!==i?t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:o,maxTextures:l,maxVertexTextures:h,maxTextureSize:c,maxCubemapSize:u,maxAttributes:d,maxVertexUniforms:f,maxVaryings:p,maxFragmentUniforms:m,vertexTextures:g,floatFragmentTextures:v,floatVertexTextures:g&&v}}(p,b,t),(w=new function(t,e,i){var n=new function(){var e=!1,i=new Me,n=null,r=new Me(0,0,0,0);return{setMask:function(i){n===i||e||(t.colorMask(i,i,i,i),n=i)},setLocked:function(t){e=t},setClear:function(e,n,a,s,o){!0===o&&(e*=s,n*=s,a*=s),i.set(e,n,a,s),!1===r.equals(i)&&(t.clearColor(e,n,a,s),r.copy(i))},reset:function(){e=!1,n=null,r.set(-1,0,0,0)}}},r=new function(){var e=!1,i=null,n=null,r=null;return{setTest:function(e){e?q(t.DEPTH_TEST):X(t.DEPTH_TEST)},setMask:function(n){i===n||e||(t.depthMask(n),i=n)},setFunc:function(e){if(n!==e){if(e)switch(e){case J:t.depthFunc(t.NEVER);break;case K:t.depthFunc(t.ALWAYS);break;case Q:t.depthFunc(t.LESS);break;case $:t.depthFunc(t.LEQUAL);break;case tt:t.depthFunc(t.EQUAL);break;case et:t.depthFunc(t.GEQUAL);break;case it:t.depthFunc(t.GREATER);break;case nt:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}else t.depthFunc(t.LEQUAL);n=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,i=null,n=null,r=null}}},a=new function(){var e=!1,i=null,n=null,r=null,a=null,s=null,o=null,l=null,h=null;return{setTest:function(e){e?q(t.STENCIL_TEST):X(t.STENCIL_TEST)},setMask:function(n){i===n||e||(t.stencilMask(n),i=n)},setFunc:function(e,i,s){n===e&&r===i&&a===s||(t.stencilFunc(e,i,s),n=e,r=i,a=s)},setOp:function(e,i,n){s===e&&o===i&&l===n||(t.stencilOp(e,i,n),s=e,o=i,l=n)},setLocked:function(t){e=t},setClear:function(e){h!==e&&(t.clearStencil(e),h=e)},reset:function(){e=!1,i=null,n=null,r=null,a=null,s=null,o=null,l=null,h=null}}},s=t.getParameter(t.MAX_VERTEX_ATTRIBS),o=new Uint8Array(s),l=new Uint8Array(s),h=new Uint8Array(s),c={},u=null,d=null,f=null,p=null,m=null,y=null,b=null,x=null,w=null,T=!1,M=null,A=null,k=null,O=null,N=null,U=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),F=parseFloat(/^WebGL\ ([0-9])/.exec(t.getParameter(t.VERSION))[1]),B=parseFloat(F)>=1,z=null,H={},G=new Me,j=new Me;function V(e,i,n){var r=new Uint8Array(4),a=t.createTexture();t.bindTexture(e,a),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(var s=0;s<n;s++)t.texImage2D(i+s,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,r);return a}var W={};function q(e){!0!==c[e]&&(t.enable(e),c[e]=!0)}function X(e){!1!==c[e]&&(t.disable(e),c[e]=!1)}function Y(e,n,r,a,s,o,l,h){if(e!==I?q(t.BLEND):X(t.BLEND),e!==D){if(e!==f||h!==T)switch(e){case P:h?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE,t.ONE,t.ONE)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE));break;case R:h?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ZERO,t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.ONE_MINUS_SRC_COLOR));break;case L:h?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.SRC_COLOR));break;default:h?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA))}p=null,m=null,y=null,b=null,x=null,w=null}else s=s||n,o=o||r,l=l||a,n===p&&s===b||(t.blendEquationSeparate(i.convert(n),i.convert(s)),p=n,b=s),r===m&&a===y&&o===x&&l===w||(t.blendFuncSeparate(i.convert(r),i.convert(a),i.convert(o),i.convert(l)),m=r,y=a,x=o,w=l);f=e,T=h}function Z(e){M!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),M=e)}function rt(e){e!==g?(q(t.CULL_FACE),e!==A&&(e===v?t.cullFace(t.BACK):e===_?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):X(t.CULL_FACE),A=e}function at(e,i,n){e?(q(t.POLYGON_OFFSET_FILL),O===i&&N===n||(t.polygonOffset(i,n),O=i,N=n)):X(t.POLYGON_OFFSET_FILL)}function st(e){void 0===e&&(e=t.TEXTURE0+U-1),z!==e&&(t.activeTexture(e),z=e)}return W[t.TEXTURE_2D]=V(t.TEXTURE_2D,t.TEXTURE_2D,1),W[t.TEXTURE_CUBE_MAP]=V(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),n.setClear(0,0,0,1),r.setClear(1),a.setClear(0),q(t.DEPTH_TEST),r.setFunc($),Z(!1),rt(v),q(t.CULL_FACE),q(t.BLEND),Y(C),{buffers:{color:n,depth:r,stencil:a},initAttributes:function(){for(var t=0,e=o.length;t<e;t++)o[t]=0},enableAttribute:function(i){o[i]=1,0===l[i]&&(t.enableVertexAttribArray(i),l[i]=1),0!==h[i]&&(e.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(i,0),h[i]=0)},enableAttributeAndDivisor:function(i,n){o[i]=1,0===l[i]&&(t.enableVertexAttribArray(i),l[i]=1),h[i]!==n&&(e.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(i,n),h[i]=n)},disableUnusedAttributes:function(){for(var e=0,i=l.length;e!==i;++e)l[e]!==o[e]&&(t.disableVertexAttribArray(e),l[e]=0)},enable:q,disable:X,getCompressedTextureFormats:function(){if(null===u&&(u=[],e.get("WEBGL_compressed_texture_pvrtc")||e.get("WEBGL_compressed_texture_s3tc")||e.get("WEBGL_compressed_texture_etc1")))for(var i=t.getParameter(t.COMPRESSED_TEXTURE_FORMATS),n=0;n<i.length;n++)u.push(i[n]);return u},useProgram:function(e){return d!==e&&(t.useProgram(e),d=e,!0)},setBlending:Y,setMaterial:function(e){e.side===S?X(t.CULL_FACE):q(t.CULL_FACE),Z(e.side===E),!0===e.transparent?Y(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha):Y(I),r.setFunc(e.depthFunc),r.setTest(e.depthTest),r.setMask(e.depthWrite),n.setMask(e.colorWrite),at(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:Z,setCullFace:rt,setLineWidth:function(e){e!==k&&(B&&t.lineWidth(e),k=e)},setPolygonOffset:at,setScissorTest:function(e){e?q(t.SCISSOR_TEST):X(t.SCISSOR_TEST)},activeTexture:st,bindTexture:function(e,i){null===z&&st();var n=H[z];void 0===n&&(n={type:void 0,texture:void 0},H[z]=n),n.type===e&&n.texture===i||(t.bindTexture(e,i||W[e]),n.type=e,n.texture=i)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===G.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),G.copy(e))},viewport:function(e){!1===j.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),j.copy(e))},reset:function(){for(var e=0;e<l.length;e++)1===l[e]&&(t.disableVertexAttribArray(e),l[e]=0);c={},u=null,z=null,H={},d=null,f=null,M=null,A=null,n.reset(),r.reset(),a.reset()}}}(p,b,vt)).scissor(fe.copy(xe).multiplyScalar(ye)),w.viewport(de.copy(be).multiplyScalar(ye)),M=new function(){var t={};return{get:function(e){var i=e.uuid,n=t[i];return void 0===n&&(n={},t[i]=n),n},remove:function(e){delete t[e.uuid]},clear:function(){t={}}}},A=new lr(p,b,w,M,x,vt,De),rt=new Xi(p),at=new function(t,e,i){var n={},r={};function a(t){var s=t.target,o=n[s.id];for(var l in null!==o.index&&e.remove(o.index),o.attributes)e.remove(o.attributes[l]);s.removeEventListener("dispose",a),delete n[s.id];var h=r[s.id];h&&(e.remove(h),delete r[s.id]),(h=r[o.id])&&(e.remove(h),delete r[o.id]),i.geometries--}return{get:function(t,e){var r=n[e.id];return r||(e.addEventListener("dispose",a),e.isBufferGeometry?r=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new Rn).setFromObject(t)),r=e._bufferGeometry),n[e.id]=r,i.geometries++,r)},update:function(i){var n=i.index,r=i.attributes;for(var a in null!==n&&e.update(n,t.ELEMENT_ARRAY_BUFFER),r)e.update(r[a],t.ARRAY_BUFFER);var s=i.morphAttributes;for(var a in s)for(var o=s[a],l=0,h=o.length;l<h;l++)e.update(o[l],t.ARRAY_BUFFER)},getWireframeAttribute:function(i){var n=r[i.id];if(n)return n;var a,s=[],o=i.index,l=i.attributes;if(null!==o)for(var h=0,c=(a=o.array).length;h<c;h+=3){var u=a[h+0],d=a[h+1],f=a[h+2];s.push(u,d,d,f,f,u)}else for(h=0,c=(a=l.position.array).length/3-1;h<c;h+=3)u=h+0,d=h+1,f=h+2,s.push(u,d,d,f,f,u);return n=new(Pn(s)>65535?Mn:Sn)(s,1),e.update(n,t.ELEMENT_ARRAY_BUFFER),r[i.id]=n,n}}}(p,rt,De),st=new function(t,e){var i={};return{update:function(n){var r=e.frame,a=n.geometry,s=t.get(n,a);return i[s.id]!==r&&(a.isGeometry&&s.updateFromObject(n),t.update(s),i[s.id]=r),s},clear:function(){i={}}}}(at,ke),dt=new function(t){var e={},i=new Float32Array(8);return{update:function(n,r,a,s){var o=n.morphTargetInfluences,l=o.length,h=e[r.id];if(void 0===h){h=[];for(var c=0;c<l;c++)h[c]=[c,0];e[r.id]=h}var u=a.morphTargets&&r.morphAttributes.position,d=a.morphNormals&&r.morphAttributes.normal;for(c=0;c<l;c++)0!==(f=h[c])[1]&&(u&&r.removeAttribute("morphTarget"+c),d&&r.removeAttribute("morphNormal"+c));for(c=0;c<l;c++)(f=h[c])[0]=c,f[1]=o[c];for(h.sort(Vn),c=0;c<8;c++){var f;if(f=h[c]){var p=f[0],m=f[1];if(m){u&&r.addAttribute("morphTarget"+c,u[p]),d&&r.addAttribute("morphNormal"+c,d[p]),i[c]=m;continue}}i[c]=0}s.getUniforms().setValue(t,"morphTargetInfluences",i)}}}(p),ht=new or(_t,b,x),ot=new Wn,ct=new jn,ut=new function(t,e,i,n){var r,a,s,o=new bi(0),l=0;function h(t,i){e.buffers.color.setClear(t.r,t.g,t.b,i,n)}return{getClearColor:function(){return o},setClearColor:function(t,e){o.set(t),h(o,l=void 0!==e?e:1)},getClearAlpha:function(){return l},setClearAlpha:function(t){h(o,l=t)},render:function(e,n,c,u){var d=n.background;null===d?h(o,l):d&&d.isColor&&(h(d,1),u=!0),(t.autoClear||u)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),d&&d.isCubeTexture?(void 0===s&&((s=new zn(new Dn(1,1,1),new Fi({uniforms:Si.cube.uniforms,vertexShader:Si.cube.vertexShader,fragmentShader:Si.cube.fragmentShader,side:E,depthTest:!0,depthWrite:!1,polygonOffset:!0,fog:!1}))).geometry.removeAttribute("normal"),s.geometry.removeAttribute("uv"),s.onBeforeRender=function(t,e,i){var n=i.far;this.matrixWorld.makeScale(n,n,n),this.matrixWorld.copyPosition(i.matrixWorld),this.material.polygonOffsetUnits=10*n},i.update(s.geometry)),s.material.uniforms.tCube.value=d,e.push(s,s.geometry,s.material,0,null)):d&&d.isTexture&&(void 0===r&&(r=new rn(-1,1,1,-1,0,1),a=new zn(new On(2,2),new Nn({depthTest:!1,depthWrite:!1,fog:!1})),i.update(a.geometry)),a.material.map=d,t.renderBufferDirect(r,null,a.geometry,a.material,a,null))}}}(_t,w,at,o),ft=new function(t,e,i){var n;this.setMode=function(t){n=t},this.render=function(e,r){t.drawArrays(n,e,r),i.calls++,i.vertices+=r,n===t.TRIANGLES?i.faces+=r/3:n===t.POINTS&&(i.points+=r)},this.renderInstances=function(r,a,s){var o=e.get("ANGLE_instanced_arrays");if(null!==o){var l=r.attributes.position;l.isInterleavedBufferAttribute?(s=l.data.count,o.drawArraysInstancedANGLE(n,0,s,r.maxInstancedCount)):o.drawArraysInstancedANGLE(n,a,s,r.maxInstancedCount),i.calls++,i.vertices+=s*r.maxInstancedCount,n===t.TRIANGLES?i.faces+=r.maxInstancedCount*s/3:n===t.POINTS&&(i.points+=r.maxInstancedCount*s)}else console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}(p,b,ke),pt=new function(t,e,i){var n,r,a;this.setMode=function(t){n=t},this.setIndex=function(t){r=t.type,a=t.bytesPerElement},this.render=function(e,s){t.drawElements(n,s,r,e*a),i.calls++,i.vertices+=s,n===t.TRIANGLES?i.faces+=s/3:n===t.POINTS&&(i.points+=s)},this.renderInstances=function(s,o,l){var h=e.get("ANGLE_instanced_arrays");null!==h?(h.drawElementsInstancedANGLE(n,l,r,o*a,s.maxInstancedCount),i.calls++,i.vertices+=l*s.maxInstancedCount,n===t.TRIANGLES?i.faces+=s.maxInstancedCount*l/3:n===t.POINTS&&(i.points+=s.maxInstancedCount*l)):console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}(p,b,ke),mt=new Mi(_t,p,w,A,x),gt=new Ii(_t,p,w,A,x),_t.info.programs=ht.programs,_t.context=p,_t.capabilities=x,_t.extensions=b,_t.properties=M,_t.renderLists=ct,_t.state=w}Ue();var Fe=new function(t){var e=this,i=null,n=null;"VRFrameData"in window&&(n=new window.VRFrameData);var r=new Re,a=new Re,s=new Re,o=new an;o.bounds=new Me(0,0,.5,1),o.layers.enable(1);var l=new an;l.bounds=new Me(.5,0,.5,1),l.layers.enable(2);var h,c,u=new hr([o,l]);function d(){if(null!==i&&i.isPresenting){var n=i.getEyeParameters("left"),r=n.renderWidth,a=n.renderHeight;c=t.getPixelRatio(),h=t.getSize(),t.setDrawingBufferSize(2*r,a,1)}else e.enabled&&t.setDrawingBufferSize(h.width,h.height,c)}u.layers.enable(1),u.layers.enable(2),window.addEventListener("vrdisplaypresentchange",d,!1),this.enabled=!1,this.standing=!1,this.getDevice=function(){return i},this.setDevice=function(t){void 0!==t&&(i=t)},this.getCamera=function(t){if(null===i)return t;i.depthNear=t.near,i.depthFar=t.far,i.getFrameData(n);var e=n.pose;null!==e.position?t.position.fromArray(e.position):t.position.set(0,0,0),null!==e.orientation&&t.quaternion.fromArray(e.orientation),t.updateMatrixWorld();var h=i.stageParameters;if(this.standing&&h&&(a.fromArray(h.sittingToStandingTransform),s.getInverse(a),t.matrixWorld.multiply(a),t.matrixWorldInverse.multiply(s)),!1===i.isPresenting)return t;o.near=t.near,l.near=t.near,o.far=t.far,l.far=t.far,u.matrixWorld.copy(t.matrixWorld),u.matrixWorldInverse.copy(t.matrixWorldInverse),o.matrixWorldInverse.fromArray(n.leftViewMatrix),l.matrixWorldInverse.fromArray(n.rightViewMatrix),this.standing&&h&&(o.matrixWorldInverse.multiply(s),l.matrixWorldInverse.multiply(s));var c=t.parent;null!==c&&(r.getInverse(c.matrixWorld),o.matrixWorldInverse.multiply(r),l.matrixWorldInverse.multiply(r)),o.matrixWorld.getInverse(o.matrixWorldInverse),l.matrixWorld.getInverse(l.matrixWorldInverse),o.projectionMatrix.fromArray(n.leftProjectionMatrix),l.projectionMatrix.fromArray(n.rightProjectionMatrix),u.projectionMatrix.copy(o.projectionMatrix);var d=i.getLayers();if(d.length){var f=d[0];null!==f.leftBounds&&4===f.leftBounds.length&&o.bounds.fromArray(f.leftBounds),null!==f.rightBounds&&4===f.rightBounds.length&&l.bounds.fromArray(f.rightBounds)}return u},this.getStandingMatrix=function(){return a},this.submitFrame=function(){i&&i.isPresenting&&i.submitFrame()},this.dispose=function(){window.removeEventListener("vrdisplaypresentchange",d)}}(_t);this.vr=Fe;var Be=new qi(_t,st,x.maxTextureSize);function ze(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),ie=!0}function He(t){console.log("THREE.WebGLRenderer: Context Restored."),ie=!1,Ue()}function Ge(t){var e=t.target;e.removeEventListener("dispose",Ge),function(t){je(t),M.remove(t)}(e)}function je(t){var e=M.get(t).program;t.program=void 0,void 0!==e&&ht.releaseProgram(e)}this.shadowMap=Be,this.getContext=function(){return p},this.getContextAttributes=function(){return p.getContextAttributes()},this.forceContextLoss=function(){var t=b.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){var t=b.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return ye},this.setPixelRatio=function(t){void 0!==t&&(ye=t,this.setSize(ve,_e,!1))},this.getSize=function(){return{width:ve,height:_e}},this.setSize=function(t,i,n){var r=Fe.getDevice();r&&r.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(ve=t,_e=i,e.width=t*ye,e.height=i*ye,!1!==n&&(e.style.width=t+"px",e.style.height=i+"px"),this.setViewport(0,0,t,i))},this.getDrawingBufferSize=function(){return{width:ve*ye,height:_e*ye}},this.setDrawingBufferSize=function(t,i,n){ve=t,_e=i,ye=n,e.width=t*n,e.height=i*n,this.setViewport(0,0,t,i)},this.setViewport=function(t,e,i,n){be.set(t,_e-e-n,i,n),w.viewport(de.copy(be).multiplyScalar(ye))},this.setScissor=function(t,e,i,n){xe.set(t,_e-e-n,i,n),w.scissor(fe.copy(xe).multiplyScalar(ye))},this.setScissorTest=function(t){w.setScissorTest(we=t)},this.getClearColor=ut.getClearColor,this.setClearColor=ut.setClearColor,this.getClearAlpha=ut.getClearAlpha,this.setClearAlpha=ut.setClearAlpha,this.clear=function(t,e,i){var n=0;(void 0===t||t)&&(n|=p.COLOR_BUFFER_BIT),(void 0===e||e)&&(n|=p.DEPTH_BUFFER_BIT),(void 0===i||i)&&(n|=p.STENCIL_BUFFER_BIT),p.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(t,e,i,n){this.setRenderTarget(t),this.clear(e,i,n)},this.dispose=function(){e.removeEventListener("webglcontextlost",ze,!1),e.removeEventListener("webglcontextrestored",He,!1),ct.dispose(),Fe.dispose()},this.renderBufferImmediate=function(t,e,i){w.initAttributes();var n=M.get(t);t.hasPositions&&!n.position&&(n.position=p.createBuffer()),t.hasNormals&&!n.normal&&(n.normal=p.createBuffer()),t.hasUvs&&!n.uv&&(n.uv=p.createBuffer()),t.hasColors&&!n.color&&(n.color=p.createBuffer());var r=e.getAttributes();if(t.hasPositions&&(p.bindBuffer(p.ARRAY_BUFFER,n.position),p.bufferData(p.ARRAY_BUFFER,t.positionArray,p.DYNAMIC_DRAW),w.enableAttribute(r.position),p.vertexAttribPointer(r.position,3,p.FLOAT,!1,0,0)),t.hasNormals){if(p.bindBuffer(p.ARRAY_BUFFER,n.normal),!i.isMeshPhongMaterial&&!i.isMeshStandardMaterial&&!i.isMeshNormalMaterial&&!0===i.flatShading)for(var a=0,s=3*t.count;a<s;a+=9){var o=t.normalArray,l=(o[a+0]+o[a+3]+o[a+6])/3,h=(o[a+1]+o[a+4]+o[a+7])/3,c=(o[a+2]+o[a+5]+o[a+8])/3;o[a+0]=l,o[a+1]=h,o[a+2]=c,o[a+3]=l,o[a+4]=h,o[a+5]=c,o[a+6]=l,o[a+7]=h,o[a+8]=c}p.bufferData(p.ARRAY_BUFFER,t.normalArray,p.DYNAMIC_DRAW),w.enableAttribute(r.normal),p.vertexAttribPointer(r.normal,3,p.FLOAT,!1,0,0)}t.hasUvs&&i.map&&(p.bindBuffer(p.ARRAY_BUFFER,n.uv),p.bufferData(p.ARRAY_BUFFER,t.uvArray,p.DYNAMIC_DRAW),w.enableAttribute(r.uv),p.vertexAttribPointer(r.uv,2,p.FLOAT,!1,0,0)),t.hasColors&&i.vertexColors!==T&&(p.bindBuffer(p.ARRAY_BUFFER,n.color),p.bufferData(p.ARRAY_BUFFER,t.colorArray,p.DYNAMIC_DRAW),w.enableAttribute(r.color),p.vertexAttribPointer(r.color,3,p.FLOAT,!1,0,0)),w.disableUnusedAttributes(),p.drawArrays(p.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,i,n,r,a){w.setMaterial(n);var s=Ke(t,e,n,r),o=i.id+"_"+s.id+"_"+(!0===n.wireframe),l=!1;o!==he&&(he=o,l=!0),r.morphTargetInfluences&&(dt.update(r,i,n,s),l=!0);var h,c=i.index,u=i.attributes.position,d=1;!0===n.wireframe&&(c=at.getWireframeAttribute(i),d=2);var f=ft;null!==c&&(h=rt.get(c),(f=pt).setIndex(h)),l&&(!function(t,e,i,n){if(i&&i.isInstancedBufferGeometry&&null===b.get("ANGLE_instanced_arrays"))return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");void 0===n&&(n=0);w.initAttributes();var r=i.attributes,a=e.getAttributes(),s=t.defaultAttributeValues;for(var o in a){var l=a[o];if(l>=0){var h=r[o];if(void 0!==h){var c=h.normalized,u=h.itemSize,d=rt.get(h);if(void 0===d)continue;var f=d.buffer,m=d.type,g=d.bytesPerElement;if(h.isInterleavedBufferAttribute){var v=h.data,_=v.stride,y=h.offset;v&&v.isInstancedInterleavedBuffer?(w.enableAttributeAndDivisor(l,v.meshPerAttribute),void 0===i.maxInstancedCount&&(i.maxInstancedCount=v.meshPerAttribute*v.count)):w.enableAttribute(l),p.bindBuffer(p.ARRAY_BUFFER,f),p.vertexAttribPointer(l,u,m,c,_*g,(n*_+y)*g)}else h.isInstancedBufferAttribute?(w.enableAttributeAndDivisor(l,h.meshPerAttribute),void 0===i.maxInstancedCount&&(i.maxInstancedCount=h.meshPerAttribute*h.count)):w.enableAttribute(l),p.bindBuffer(p.ARRAY_BUFFER,f),p.vertexAttribPointer(l,u,m,c,0,n*u*g)}else if(void 0!==s){var x=s[o];if(void 0!==x)switch(x.length){case 2:p.vertexAttrib2fv(l,x);break;case 3:p.vertexAttrib3fv(l,x);break;case 4:p.vertexAttrib4fv(l,x);break;default:p.vertexAttrib1fv(l,x)}}}}w.disableUnusedAttributes()}(n,s,i),null!==c&&p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,h.buffer));var m=0;null!==c?m=c.count:void 0!==u&&(m=u.count);var g=i.drawRange.start*d,v=i.drawRange.count*d,_=null!==a?a.start*d:0,y=null!==a?a.count*d:1/0,x=Math.max(g,_),E=Math.min(m,g+v,_+y)-1,S=Math.max(0,E-x+1);if(0!==S){if(r.isMesh)if(!0===n.wireframe)w.setLineWidth(n.wireframeLinewidth*Oe()),f.setMode(p.LINES);else switch(r.drawMode){case re:f.setMode(p.TRIANGLES);break;case ae:f.setMode(p.TRIANGLE_STRIP);break;case se:f.setMode(p.TRIANGLE_FAN)}else if(r.isLine){var T=n.linewidth;void 0===T&&(T=1),w.setLineWidth(T*Oe()),r.isLineSegments?f.setMode(p.LINES):r.isLineLoop?f.setMode(p.LINE_LOOP):f.setMode(p.LINE_STRIP)}else r.isPoints&&f.setMode(p.POINTS);i&&i.isInstancedBufferGeometry?i.maxInstancedCount>0&&f.renderInstances(i,x,S):f.render(x,S)}},this.compile=function(t,e){h.length=0,c.length=0,t.traverse(function(t){t.isLight&&(h.push(t),t.castShadow&&c.push(t))}),ot.setup(h,c,e),t.traverse(function(e){if(e.material)if(Array.isArray(e.material))for(var i=0;i<e.material.length;i++)Je(e.material[i],t.fog,e);else Je(e.material,t.fog,e)})};var Ve,We=!1,qe=null;function Xe(t){null!==qe&&qe(t),(Fe.getDevice()||window).requestAnimationFrame(Xe)}function Ye(t,e,i,n){for(var r=0,a=t.length;r<a;r++){var s=t[r],o=s.object,l=s.geometry,h=void 0===n?s.material:n,c=s.group;if(i.isArrayCamera){ue=i;for(var u=i.cameras,d=0,f=u.length;d<f;d++){var p=u[d];if(o.layers.test(p.layers)){var m=p.bounds,g=m.x*ve,v=m.y*_e,_=m.z*ve,y=m.w*_e;w.viewport(de.set(g,v,_,y).multiplyScalar(ye)),Ze(o,e,p,l,h,c)}}}else ue=null,Ze(o,e,i,l,h,c)}}function Ze(t,e,i,n,r,a){if(t.onBeforeRender(_t,e,i,n,r,a),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){w.setMaterial(r);var s=Ke(i,e.fog,r,t);he="",function(t,e,i){t.render(function(t){_t.renderBufferImmediate(t,e,i)})}(t,s,r)}else _t.renderBufferDirect(i,e.fog,n,r,t,a);t.onAfterRender(_t,e,i,n,r,a)}function Je(t,e,i){var n=M.get(t),r=ht.getParameters(t,ot.state,c,e,Se.numPlanes,Se.numIntersection,i),a=ht.getProgramCode(t,r),s=n.program,o=!0;if(void 0===s)t.addEventListener("dispose",Ge);else if(s.code!==a)je(t);else{if(void 0!==r.shaderID)return;o=!1}if(o){if(r.shaderID){var l=Si[r.shaderID];n.shader={name:t.type,uniforms:wi.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}}else n.shader={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};t.onBeforeCompile(n.shader),s=ht.acquireProgram(t,n.shader,r,a),n.program=s,t.program=s}var h=s.getAttributes();if(t.morphTargets){t.numSupportedMorphTargets=0;for(var u=0;u<_t.maxMorphTargets;u++)h["morphTarget"+u]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals){t.numSupportedMorphNormals=0;for(u=0;u<_t.maxMorphNormals;u++)h["morphNormal"+u]>=0&&t.numSupportedMorphNormals++}var d=n.shader.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(n.numClippingPlanes=Se.numPlanes,n.numIntersection=Se.numIntersection,d.clippingPlanes=Se.uniform),n.fog=e,n.lightsHash=ot.state.hash,t.lights&&(d.ambientLightColor.value=ot.state.ambient,d.directionalLights.value=ot.state.directional,d.spotLights.value=ot.state.spot,d.rectAreaLights.value=ot.state.rectArea,d.pointLights.value=ot.state.point,d.hemisphereLights.value=ot.state.hemi,d.directionalShadowMap.value=ot.state.directionalShadowMap,d.directionalShadowMatrix.value=ot.state.directionalShadowMatrix,d.spotShadowMap.value=ot.state.spotShadowMap,d.spotShadowMatrix.value=ot.state.spotShadowMatrix,d.pointShadowMap.value=ot.state.pointShadowMap,d.pointShadowMatrix.value=ot.state.pointShadowMatrix);var f=n.program.getUniforms(),p=_i.seqWithValue(f.seq,d);n.uniformsList=p}function Ke(t,e,i,n){me=0;var r=M.get(i);if(Te&&(Ae||t!==ce)){var a=t===ce&&i.id===le;Se.setState(i.clippingPlanes,i.clipIntersection,i.clipShadows,t,r,a)}!1===i.needsUpdate&&(void 0===r.program?i.needsUpdate=!0:i.fog&&r.fog!==e?i.needsUpdate=!0:i.lights&&r.lightsHash!==ot.state.hash?i.needsUpdate=!0:void 0===r.numClippingPlanes||r.numClippingPlanes===Se.numPlanes&&r.numIntersection===Se.numIntersection||(i.needsUpdate=!0)),i.needsUpdate&&(Je(i,e,n),i.needsUpdate=!1);var s,o,l=!1,h=!1,c=!1,u=r.program,d=u.getUniforms(),f=r.shader.uniforms;if(w.useProgram(u.program)&&(l=!0,h=!0,c=!0),i.id!==le&&(le=i.id,h=!0),l||t!==ce){if(d.setValue(p,"projectionMatrix",t.projectionMatrix),x.logarithmicDepthBuffer&&d.setValue(p,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),ce!==(ue||t)&&(ce=ue||t,h=!0,c=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.envMap){var m=d.map.cameraPosition;void 0!==m&&m.setValue(p,Ce.setFromMatrixPosition(t.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.skinning)&&d.setValue(p,"viewMatrix",t.matrixWorldInverse)}if(i.skinning){d.setOptional(p,n,"bindMatrix"),d.setOptional(p,n,"bindMatrixInverse");var g=n.skeleton;if(g){var v=g.bones;if(x.floatVertexTextures){if(void 0===g.boneTexture){var _=Math.sqrt(4*v.length);_=ge.nextPowerOfTwo(Math.ceil(_)),_=Math.max(_,4);var y=new Float32Array(_*_*4);y.set(g.boneMatrices);var b=new Le(y,_,_,Gt,kt);g.boneMatrices=y,g.boneTexture=b,g.boneTextureSize=_}d.setValue(p,"boneTexture",g.boneTexture),d.setValue(p,"boneTextureSize",g.boneTextureSize)}else d.setOptional(p,g,"boneMatrices")}}return h&&(d.setValue(p,"toneMappingExposure",_t.toneMappingExposure),d.setValue(p,"toneMappingWhitePoint",_t.toneMappingWhitePoint),i.lights&&(o=c,(s=f).ambientLightColor.needsUpdate=o,s.directionalLights.needsUpdate=o,s.pointLights.needsUpdate=o,s.spotLights.needsUpdate=o,s.rectAreaLights.needsUpdate=o,s.hemisphereLights.needsUpdate=o),e&&i.fog&&function(t,e){t.fogColor.value=e.color,e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)}(f,e),i.isMeshBasicMaterial?Qe(f,i):i.isMeshLambertMaterial?(Qe(f,i),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(f,i)):i.isMeshPhongMaterial?(Qe(f,i),i.isMeshToonMaterial?function(t,e){$e(t,e),e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(f,i):$e(f,i)):i.isMeshStandardMaterial?(Qe(f,i),i.isMeshPhysicalMaterial?function(t,e){t.clearCoat.value=e.clearCoat,t.clearCoatRoughness.value=e.clearCoatRoughness,ti(t,e)}(f,i):ti(f,i)):i.isMeshDepthMaterial?(Qe(f,i),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(f,i)):i.isMeshDistanceMaterial?(Qe(f,i),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(f,i)):i.isMeshNormalMaterial?(Qe(f,i),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale);e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale));e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(f,i)):i.isLineBasicMaterial?(function(t,e){t.diffuse.value=e.color,t.opacity.value=e.opacity}(f,i),i.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(f,i)):i.isPointsMaterial?function(t,e){if(t.diffuse.value=e.color,t.opacity.value=e.opacity,t.size.value=e.size*ye,t.scale.value=.5*_e,t.map.value=e.map,null!==e.map){var i=e.map.offset,n=e.map.repeat;t.offsetRepeat.value.set(i.x,i.y,n.x,n.y)}}(f,i):i.isShadowMaterial&&(f.color.value=i.color,f.opacity.value=i.opacity),void 0!==f.ltcMat&&(f.ltcMat.value=xi.LTC_MAT_TEXTURE),void 0!==f.ltcMag&&(f.ltcMag.value=xi.LTC_MAG_TEXTURE),_i.upload(p,r.uniformsList,f,_t)),d.setValue(p,"modelViewMatrix",n.modelViewMatrix),d.setValue(p,"normalMatrix",n.normalMatrix),d.setValue(p,"modelMatrix",n.matrixWorld),u}function Qe(t,e){var i;if(t.opacity.value=e.opacity,e.color&&(t.diffuse.value=e.color),e.emissive&&t.emissive.value.copy(e.emissive).multiplyScalar(e.emissiveIntensity),e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.specularMap&&(t.specularMap.value=e.specularMap),e.envMap&&(t.envMap.value=e.envMap,t.flipEnvMap.value=e.envMap&&e.envMap.isCubeTexture?-1:1,t.reflectivity.value=e.reflectivity,t.refractionRatio.value=e.refractionRatio),e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity),e.aoMap&&(t.aoMap.value=e.aoMap,t.aoMapIntensity.value=e.aoMapIntensity),e.map?i=e.map:e.specularMap?i=e.specularMap:e.displacementMap?i=e.displacementMap:e.normalMap?i=e.normalMap:e.bumpMap?i=e.bumpMap:e.roughnessMap?i=e.roughnessMap:e.metalnessMap?i=e.metalnessMap:e.alphaMap?i=e.alphaMap:e.emissiveMap&&(i=e.emissiveMap),void 0!==i){i.isWebGLRenderTarget&&(i=i.texture);var n=i.offset,r=i.repeat;t.offsetRepeat.value.set(n.x,n.y,r.x,r.y)}}function $e(t,e){t.specular.value=e.specular,t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}function ti(t,e){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}this.animate=function(t){qe=t,We||(Fe.getDevice()||window).requestAnimationFrame(Xe)},this.render=function(t,e,i,n){if(e&&e.isCamera){if(!ie){he="",le=-1,ce=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),Fe.enabled&&(e=Fe.getCamera(e)),Ie.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),Ee.setFromMatrix(Ie),h.length=0,c.length=0,d.length=0,f.length=0,Ae=this.localClippingEnabled,Te=Se.init(this.clippingPlanes,Ae,e),(u=ct.get(t,e)).init(),function t(e,i,n){if(!e.visible)return;var r=e.layers.test(i.layers);if(r)if(e.isLight)h.push(e),e.castShadow&&c.push(e);else if(e.isSprite)e.frustumCulled&&!Ee.intersectsSprite(e)||d.push(e);else if(e.isLensFlare)f.push(e);else if(e.isImmediateRenderObject)n&&Ce.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Ie),u.push(e,null,e.material,Ce.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.update(),!e.frustumCulled||Ee.intersectsObject(e))){n&&Ce.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Ie);var a=st.update(e),s=e.material;if(Array.isArray(s))for(var o=a.groups,l=0,p=o.length;l<p;l++){var m=o[l],g=s[m.materialIndex];g&&g.visible&&u.push(e,a,g,Ce.z,m)}else s.visible&&u.push(e,a,s,Ce.z,null)}var v=e.children;for(var l=0,p=v.length;l<p;l++)t(v[l],i,n)}(t,e,_t.sortObjects),!0===_t.sortObjects&&u.sort(),Te&&Se.beginShadows(),Be.render(c,t,e),ot.setup(h,c,e),Te&&Se.endShadows(),ke.frame++,ke.calls=0,ke.vertices=0,ke.faces=0,ke.points=0,void 0===i&&(i=null),this.setRenderTarget(i),ut.render(u,t,e,n);var r=u.opaque,a=u.transparent;if(t.overrideMaterial){var s=t.overrideMaterial;r.length&&Ye(r,t,e,s),a.length&&Ye(a,t,e,s)}else r.length&&Ye(r,t,e),a.length&&Ye(a,t,e);gt.render(d,t,e),mt.render(f,t,e,de),i&&A.updateRenderTargetMipmap(i),w.buffers.depth.setTest(!0),w.buffers.depth.setMask(!0),w.buffers.color.setMask(!0),w.setPolygonOffset(!1),Fe.enabled&&Fe.submitFrame()}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFaceCulling=function(t,e){w.setCullFace(t),w.setFlipSided(e===y)},this.allocTextureUnit=function(){var t=me;return t>=x.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+t+" texture units while this GPU supports only "+x.maxTextures),me+=1,t},this.setTexture2D=(Ve=!1,function(t,e){t&&t.isWebGLRenderTarget&&(Ve||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),Ve=!0),t=t.texture),A.setTexture2D(t,e)}),this.setTexture=function(){var t=!1;return function(e,i){t||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),t=!0),A.setTexture2D(e,i)}}(),this.setTextureCube=function(){var t=!1;return function(e,i){e&&e.isWebGLRenderTargetCube&&(t||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),t=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?A.setTextureCube(e,i):A.setTextureCubeDynamic(e,i)}}(),this.getRenderTarget=function(){return ne},this.setRenderTarget=function(t){ne=t,t&&void 0===M.get(t).__webglFramebuffer&&A.setupRenderTarget(t);var e=null,i=!1;if(t){var n=M.get(t).__webglFramebuffer;t.isWebGLRenderTargetCube?(e=n[t.activeCubeFace],i=!0):e=n,de.copy(t.viewport),fe.copy(t.scissor),pe=t.scissorTest}else de.copy(be).multiplyScalar(ye),fe.copy(xe).multiplyScalar(ye),pe=we;if(oe!==e&&(p.bindFramebuffer(p.FRAMEBUFFER,e),oe=e),w.viewport(de),w.scissor(fe),w.setScissorTest(pe),i){var r=M.get(t.texture);p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_CUBE_MAP_POSITIVE_X+t.activeCubeFace,r.__webglTexture,t.activeMipMapLevel)}},this.readRenderTargetPixels=function(t,e,i,n,r,a){if(t&&t.isWebGLRenderTarget){var s=M.get(t).__webglFramebuffer;if(s){var o=!1;s!==oe&&(p.bindFramebuffer(p.FRAMEBUFFER,s),o=!0);try{var l=t.texture,h=l.format,c=l.type;if(h!==Gt&&vt.convert(h)!==p.getParameter(p.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(c===It||vt.convert(c)===p.getParameter(p.IMPLEMENTATION_COLOR_READ_TYPE)||c===kt&&(b.get("OES_texture_float")||b.get("WEBGL_color_buffer_float"))||c===Ot&&b.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");p.checkFramebufferStatus(p.FRAMEBUFFER)===p.FRAMEBUFFER_COMPLETE?e>=0&&e<=t.width-n&&i>=0&&i<=t.height-r&&p.readPixels(e,i,n,r,vt.convert(h),vt.convert(c),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{o&&p.bindFramebuffer(p.FRAMEBUFFER,oe)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")}}function ur(t,e){this.name="",this.color=new bi(t),this.density=void 0!==e?e:25e-5}function dr(t,e,i){this.name="",this.color=new bi(t),this.near=void 0!==e?e:1,this.far=void 0!==i?i:1e3}function fr(){en.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function pr(t,e,i,n,r){en.call(this),this.lensFlares=[],this.positionScreen=new Pe,this.customUpdateCallback=void 0,void 0!==t&&this.add(t,e,i,n,r)}function mr(t){Ui.call(this),this.type="SpriteMaterial",this.color=new bi(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(t)}function gr(t){en.call(this),this.type="Sprite",this.material=void 0!==t?t:new mr}function vr(){en.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function _r(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var i=0,n=this.bones.length;i<n;i++)this.boneInverses.push(new Re)}}function yr(){en.call(this),this.type="Bone"}function br(t,e){zn.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Re,this.bindMatrixInverse=new Re;var i=new _r(this.initBones());this.bind(i,this.matrixWorld),this.normalizeSkinWeights()}function xr(t){Ui.call(this),this.type="LineBasicMaterial",this.color=new bi(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(t)}function wr(t,e,i){if(1===i)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new Er(t,e);en.call(this),this.type="Line",this.geometry=void 0!==t?t:new Rn,this.material=void 0!==e?e:new xr({color:16777215*Math.random()})}function Er(t,e){wr.call(this,t,e),this.type="LineSegments"}function Sr(t,e){wr.call(this,t,e),this.type="LineLoop"}function Tr(t){Ui.call(this),this.type="PointsMaterial",this.color=new bi(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(t)}function Mr(t,e){en.call(this),this.type="Points",this.geometry=void 0!==t?t:new Rn,this.material=void 0!==e?e:new Tr({color:16777215*Math.random()})}function Ar(){en.call(this),this.type="Group"}function Ir(t,e,i,n,r,a,s,o,l){Te.call(this,t,e,i,n,r,a,s,o,l),this.generateMipmaps=!1;var h=this;!function e(){requestAnimationFrame(e),t.readyState>=t.HAVE_CURRENT_DATA&&(h.needsUpdate=!0)}()}function Cr(t,e,i,n,r,a,s,o,l,h,c,u){Te.call(this,null,a,s,o,l,h,n,r,c,u),this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function Pr(t,e,i,n,r,a,s,o,l,h){if((h=void 0!==h?h:Wt)!==Wt&&h!==qt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&h===Wt&&(i=Rt),void 0===i&&h===qt&&(i=Bt),Te.call(this,null,n,r,a,s,o,h,i,l),this.image={width:t,height:e},this.magFilter=void 0!==s?s:wt,this.minFilter=void 0!==o?o:wt,this.flipY=!1,this.generateMipmaps=!1}function Rr(t){Rn.call(this),this.type="WireframeGeometry";var e,i,n,r,a,s,o,l,h,c,u=[],d=[0,0],f={},p=["a","b","c"];if(t&&t.isGeometry){var m=t.faces;for(e=0,n=m.length;e<n;e++){var g=m[e];for(i=0;i<3;i++)o=g[p[i]],l=g[p[(i+1)%3]],d[0]=Math.min(o,l),d[1]=Math.max(o,l),void 0===f[h=d[0]+","+d[1]]&&(f[h]={index1:d[0],index2:d[1]})}for(h in f)s=f[h],c=t.vertices[s.index1],u.push(c.x,c.y,c.z),c=t.vertices[s.index2],u.push(c.x,c.y,c.z)}else if(t&&t.isBufferGeometry){var v,_,y,b,x,w,E;if(c=new Pe,null!==t.index){for(v=t.attributes.position,_=t.index,0===(y=t.groups).length&&(y=[{start:0,count:_.count,materialIndex:0}]),r=0,a=y.length;r<a;++r)for(e=x=(b=y[r]).start,n=x+b.count;e<n;e+=3)for(i=0;i<3;i++)o=_.getX(e+i),l=_.getX(e+(i+1)%3),d[0]=Math.min(o,l),d[1]=Math.max(o,l),void 0===f[h=d[0]+","+d[1]]&&(f[h]={index1:d[0],index2:d[1]});for(h in f)s=f[h],c.fromBufferAttribute(v,s.index1),u.push(c.x,c.y,c.z),c.fromBufferAttribute(v,s.index2),u.push(c.x,c.y,c.z)}else for(e=0,n=(v=t.attributes.position).count/3;e<n;e++)for(i=0;i<3;i++)w=3*e+i,c.fromBufferAttribute(v,w),u.push(c.x,c.y,c.z),E=3*e+(i+1)%3,c.fromBufferAttribute(v,E),u.push(c.x,c.y,c.z)}this.addAttribute("position",new An(u,3))}function Lr(t,e,i){_n.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:i},this.fromBufferGeometry(new Dr(t,e,i)),this.mergeVertices()}function Dr(t,e,i){Rn.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:i};var n,r,a=[],s=[],o=[],l=[],h=new Pe,c=new Pe,u=new Pe,d=new Pe,f=new Pe,p=e+1;for(n=0;n<=i;n++){var m=n/i;for(r=0;r<=e;r++){var g=r/e;c=t(g,m,c),s.push(c.x,c.y,c.z),g-1e-5>=0?(u=t(g-1e-5,m,u),d.subVectors(c,u)):(u=t(g+1e-5,m,u),d.subVectors(u,c)),m-1e-5>=0?(u=t(g,m-1e-5,u),f.subVectors(c,u)):(u=t(g,m+1e-5,u),f.subVectors(u,c)),h.crossVectors(d,f).normalize(),o.push(h.x,h.y,h.z),l.push(g,m)}}for(n=0;n<i;n++)for(r=0;r<e;r++){var v=n*p+r,_=n*p+r+1,y=(n+1)*p+r+1,b=(n+1)*p+r;a.push(v,_,b),a.push(_,y,b)}this.setIndex(a),this.addAttribute("position",new An(s,3)),this.addAttribute("normal",new An(o,3)),this.addAttribute("uv",new An(l,2))}function kr(t,e,i,n){_n.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:n},this.fromBufferGeometry(new Or(t,e,i,n)),this.mergeVertices()}function Or(t,e,i,n){Rn.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:n},i=i||1;var r=[],a=[];function s(t,e,i,n){var r,a,s=Math.pow(2,n),l=[];for(r=0;r<=s;r++){l[r]=[];var h=t.clone().lerp(i,r/s),c=e.clone().lerp(i,r/s),u=s-r;for(a=0;a<=u;a++)l[r][a]=0===a&&r===s?h:h.clone().lerp(c,a/u)}for(r=0;r<s;r++)for(a=0;a<2*(s-r)-1;a++){var d=Math.floor(a/2);a%2==0?(o(l[r][d+1]),o(l[r+1][d]),o(l[r][d])):(o(l[r][d+1]),o(l[r+1][d+1]),o(l[r+1][d]))}}function o(t){r.push(t.x,t.y,t.z)}function l(e,i){var n=3*e;i.x=t[n+0],i.y=t[n+1],i.z=t[n+2]}function h(t,e,i,n){n<0&&1===t.x&&(a[e]=t.x-1),0===i.x&&0===i.z&&(a[e]=n/2/Math.PI+.5)}function c(t){return Math.atan2(t.z,-t.x)}!function(t){for(var i=new Pe,n=new Pe,r=new Pe,a=0;a<e.length;a+=3)l(e[a+0],i),l(e[a+1],n),l(e[a+2],r),s(i,n,r,t)}(n=n||0),function(t){for(var e=new Pe,i=0;i<r.length;i+=3)e.x=r[i+0],e.y=r[i+1],e.z=r[i+2],e.normalize().multiplyScalar(t),r[i+0]=e.x,r[i+1]=e.y,r[i+2]=e.z}(i),function(){for(var t=new Pe,e=0;e<r.length;e+=3){t.x=r[e+0],t.y=r[e+1],t.z=r[e+2];var i=c(t)/2/Math.PI+.5,n=(s=t,Math.atan2(-s.y,Math.sqrt(s.x*s.x+s.z*s.z))/Math.PI+.5);a.push(i,1-n)}var s;(function(){for(var t=new Pe,e=new Pe,i=new Pe,n=new Pe,s=new ve,o=new ve,l=new ve,u=0,d=0;u<r.length;u+=9,d+=6){t.set(r[u+0],r[u+1],r[u+2]),e.set(r[u+3],r[u+4],r[u+5]),i.set(r[u+6],r[u+7],r[u+8]),s.set(a[d+0],a[d+1]),o.set(a[d+2],a[d+3]),l.set(a[d+4],a[d+5]),n.copy(t).add(e).add(i).divideScalar(3);var f=c(n);h(s,d+0,t,f),h(o,d+2,e,f),h(l,d+4,i,f)}})(),function(){for(var t=0;t<a.length;t+=6){var e=a[t+0],i=a[t+2],n=a[t+4],r=Math.max(e,i,n),s=Math.min(e,i,n);r>.9&&s<.1&&(e<.2&&(a[t+0]+=1),i<.2&&(a[t+2]+=1),n<.2&&(a[t+4]+=1))}}()}(),this.addAttribute("position",new An(r,3)),this.addAttribute("normal",new An(r.slice(),3)),this.addAttribute("uv",new An(a,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}function Nr(t,e){_n.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Ur(t,e)),this.mergeVertices()}function Ur(t,e){Or.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Fr(t,e){_n.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Br(t,e)),this.mergeVertices()}function Br(t,e){Or.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function zr(t,e){_n.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Hr(t,e)),this.mergeVertices()}function Hr(t,e){var i=(1+Math.sqrt(5))/2,n=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1];Or.call(this,n,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Gr(t,e){_n.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new jr(t,e)),this.mergeVertices()}function jr(t,e){var i=(1+Math.sqrt(5))/2,n=1/i,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n];Or.call(this,r,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Vr(t,e,i,n,r,a){_n.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:n,closed:r},void 0!==a&&console.warn("THREE.TubeGeometry: taper has been removed.");var s=new Wr(t,e,i,n,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals,this.fromBufferGeometry(s),this.mergeVertices()}function Wr(t,e,i,n,r){Rn.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:n,closed:r},e=e||64,i=i||1,n=n||8,r=r||!1;var a=t.computeFrenetFrames(e,r);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;var s,o,l=new Pe,h=new Pe,c=new ve,u=[],d=[],f=[],p=[];function m(r){var s=t.getPointAt(r/e),c=a.normals[r],f=a.binormals[r];for(o=0;o<=n;o++){var p=o/n*Math.PI*2,m=Math.sin(p),g=-Math.cos(p);h.x=g*c.x+m*f.x,h.y=g*c.y+m*f.y,h.z=g*c.z+m*f.z,h.normalize(),d.push(h.x,h.y,h.z),l.x=s.x+i*h.x,l.y=s.y+i*h.y,l.z=s.z+i*h.z,u.push(l.x,l.y,l.z)}}!function(){for(s=0;s<e;s++)m(s);m(!1===r?e:0),function(){for(s=0;s<=e;s++)for(o=0;o<=n;o++)c.x=s/e,c.y=o/n,f.push(c.x,c.y)}(),function(){for(o=1;o<=e;o++)for(s=1;s<=n;s++){var t=(n+1)*(o-1)+(s-1),i=(n+1)*o+(s-1),r=(n+1)*o+s,a=(n+1)*(o-1)+s;p.push(t,i,a),p.push(i,r,a)}}()}(),this.setIndex(p),this.addAttribute("position",new An(u,3)),this.addAttribute("normal",new An(d,3)),this.addAttribute("uv",new An(f,2))}function qr(t,e,i,n,r,a,s){_n.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:n,p:r,q:a},void 0!==s&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Xr(t,e,i,n,r,a)),this.mergeVertices()}function Xr(t,e,i,n,r,a){Rn.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:n,p:r,q:a},t=t||100,e=e||40,i=Math.floor(i)||64,n=Math.floor(n)||8,r=r||2,a=a||3;var s,o,l=[],h=[],c=[],u=[],d=new Pe,f=new Pe,p=new Pe,m=new Pe,g=new Pe,v=new Pe,_=new Pe;for(s=0;s<=i;++s){var y=s/i*r*Math.PI*2;for(A(y,r,a,t,p),A(y+.01,r,a,t,m),v.subVectors(m,p),_.addVectors(m,p),g.crossVectors(v,_),_.crossVectors(g,v),g.normalize(),_.normalize(),o=0;o<=n;++o){var b=o/n*Math.PI*2,x=-e*Math.cos(b),w=e*Math.sin(b);d.x=p.x+(x*_.x+w*g.x),d.y=p.y+(x*_.y+w*g.y),d.z=p.z+(x*_.z+w*g.z),h.push(d.x,d.y,d.z),f.subVectors(d,p).normalize(),c.push(f.x,f.y,f.z),u.push(s/i),u.push(o/n)}}for(o=1;o<=i;o++)for(s=1;s<=n;s++){var E=(n+1)*(o-1)+(s-1),S=(n+1)*o+(s-1),T=(n+1)*o+s,M=(n+1)*(o-1)+s;l.push(E,S,M),l.push(S,T,M)}function A(t,e,i,n,r){var a=Math.cos(t),s=Math.sin(t),o=i/e*t,l=Math.cos(o);r.x=n*(2+l)*.5*a,r.y=n*(2+l)*s*.5,r.z=n*Math.sin(o)*.5}this.setIndex(l),this.addAttribute("position",new An(h,3)),this.addAttribute("normal",new An(c,3)),this.addAttribute("uv",new An(u,2))}function Yr(t,e,i,n,r){_n.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:r},this.fromBufferGeometry(new Zr(t,e,i,n,r)),this.mergeVertices()}function Zr(t,e,i,n,r){Rn.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:r},t=t||100,e=e||40,i=Math.floor(i)||8,n=Math.floor(n)||6,r=r||2*Math.PI;var a,s,o=[],l=[],h=[],c=[],u=new Pe,d=new Pe,f=new Pe;for(a=0;a<=i;a++)for(s=0;s<=n;s++){var p=s/n*r,m=a/i*Math.PI*2;d.x=(t+e*Math.cos(m))*Math.cos(p),d.y=(t+e*Math.cos(m))*Math.sin(p),d.z=e*Math.sin(m),l.push(d.x,d.y,d.z),u.x=t*Math.cos(p),u.y=t*Math.sin(p),f.subVectors(d,u).normalize(),h.push(f.x,f.y,f.z),c.push(s/n),c.push(a/i)}for(a=1;a<=i;a++)for(s=1;s<=n;s++){var g=(n+1)*a+s-1,v=(n+1)*(a-1)+s-1,_=(n+1)*(a-1)+s,y=(n+1)*a+s;o.push(g,v,y),o.push(v,_,y)}this.setIndex(o),this.addAttribute("position",new An(l,3)),this.addAttribute("normal",new An(h,3)),this.addAttribute("uv",new An(c,2))}hr.prototype=Object.assign(Object.create(an.prototype),{constructor:hr,isArrayCamera:!0}),ur.prototype.isFogExp2=!0,ur.prototype.clone=function(){return new ur(this.color.getHex(),this.density)},ur.prototype.toJSON=function(t){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},dr.prototype.isFog=!0,dr.prototype.clone=function(){return new dr(this.color.getHex(),this.near,this.far)},dr.prototype.toJSON=function(t){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},fr.prototype=Object.assign(Object.create(en.prototype),{constructor:fr,copy:function(t,e){return en.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var e=en.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}),pr.prototype=Object.assign(Object.create(en.prototype),{constructor:pr,isLensFlare:!0,copy:function(t){en.prototype.copy.call(this,t),this.positionScreen.copy(t.positionScreen),this.customUpdateCallback=t.customUpdateCallback;for(var e=0,i=t.lensFlares.length;e<i;e++)this.lensFlares.push(t.lensFlares[e]);return this},add:function(t,e,i,n,r,a){void 0===e&&(e=-1),void 0===i&&(i=0),void 0===a&&(a=1),void 0===r&&(r=new bi(16777215)),void 0===n&&(n=C),i=Math.min(i,Math.max(0,i)),this.lensFlares.push({texture:t,size:e,distance:i,x:0,y:0,z:0,scale:1,rotation:0,opacity:a,color:r,blending:n})},updateLensFlares:function(){var t,e,i=this.lensFlares.length,n=2*-this.positionScreen.x,r=2*-this.positionScreen.y;for(t=0;t<i;t++)(e=this.lensFlares[t]).x=this.positionScreen.x+n*e.distance,e.y=this.positionScreen.y+r*e.distance,e.wantedRotation=e.x*Math.PI*.25,e.rotation+=.25*(e.wantedRotation-e.rotation)}}),mr.prototype=Object.create(Ui.prototype),mr.prototype.constructor=mr,mr.prototype.isSpriteMaterial=!0,mr.prototype.copy=function(t){return Ui.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.rotation=t.rotation,this},gr.prototype=Object.assign(Object.create(en.prototype),{constructor:gr,isSprite:!0,raycast:(Xn=new Pe,Yn=new Pe,Zn=new Pe,function(t,e){Yn.setFromMatrixPosition(this.matrixWorld),t.ray.closestPointToPoint(Yn,Xn),Zn.setFromMatrixScale(this.matrixWorld);var i=Zn.x*Zn.y/4;if(!(Yn.distanceToSquared(Xn)>i)){var n=t.ray.origin.distanceTo(Xn);n<t.near||n>t.far||e.push({distance:n,point:Xn.clone(),face:null,object:this})}}),clone:function(){return new this.constructor(this.material).copy(this)}}),vr.prototype=Object.assign(Object.create(en.prototype),{constructor:vr,copy:function(t){en.prototype.copy.call(this,t,!1);for(var e=t.levels,i=0,n=e.length;i<n;i++){var r=e[i];this.addLevel(r.object.clone(),r.distance)}return this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);for(var i=this.levels,n=0;n<i.length&&!(e<i[n].distance);n++);i.splice(n,0,{distance:e,object:t}),this.add(t)},getObjectForDistance:function(t){for(var e=this.levels,i=1,n=e.length;i<n&&!(t<e[i].distance);i++);return e[i-1].object},raycast:(Jn=new Pe,function(t,e){Jn.setFromMatrixPosition(this.matrixWorld);var i=t.ray.origin.distanceTo(Jn);this.getObjectForDistance(i).raycast(t,e)}),update:function(){var t=new Pe,e=new Pe;return function(i){var n=this.levels;if(n.length>1){t.setFromMatrixPosition(i.matrixWorld),e.setFromMatrixPosition(this.matrixWorld);var r=t.distanceTo(e);n[0].object.visible=!0;for(var a=1,s=n.length;a<s&&r>=n[a].distance;a++)n[a-1].object.visible=!1,n[a].object.visible=!0;for(;a<s;a++)n[a].object.visible=!1}}}(),toJSON:function(t){var e=en.prototype.toJSON.call(this,t);e.object.levels=[];for(var i=this.levels,n=0,r=i.length;n<r;n++){var a=i[n];e.object.levels.push({object:a.object.uuid,distance:a.distance})}return e}}),Object.assign(_r.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var i=new Re;this.bones[t]&&i.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(i)}},pose:function(){var t,e,i;for(e=0,i=this.bones.length;e<i;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,i=this.bones.length;e<i;e++)(t=this.bones[e])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:(Kn=new Re,Qn=new Re,function(){for(var t=this.bones,e=this.boneInverses,i=this.boneMatrices,n=this.boneTexture,r=0,a=t.length;r<a;r++){var s=t[r]?t[r].matrixWorld:Qn;Kn.multiplyMatrices(s,e[r]),Kn.toArray(i,16*r)}void 0!==n&&(n.needsUpdate=!0)}),clone:function(){return new _r(this.bones,this.boneInverses)}}),yr.prototype=Object.assign(Object.create(en.prototype),{constructor:yr,isBone:!0}),br.prototype=Object.assign(Object.create(zn.prototype),{constructor:br,isSkinnedMesh:!0,initBones:function(){var t,e,i,n,r=[];if(this.geometry&&void 0!==this.geometry.bones){for(i=0,n=this.geometry.bones.length;i<n;i++)e=this.geometry.bones[i],t=new yr,r.push(t),t.name=e.name,t.position.fromArray(e.pos),t.quaternion.fromArray(e.rotq),void 0!==e.scl&&t.scale.fromArray(e.scl);for(i=0,n=this.geometry.bones.length;i<n;i++)-1!==(e=this.geometry.bones[i]).parent&&null!==e.parent&&void 0!==r[e.parent]?r[e.parent].add(r[i]):this.add(r[i])}return this.updateMatrixWorld(!0),r},bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var t,e;if(this.geometry&&this.geometry.isGeometry)for(e=0;e<this.geometry.skinWeights.length;e++){var i=this.geometry.skinWeights[e];(t=1/i.lengthManhattan())!==1/0?i.multiplyScalar(t):i.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){var n=new Me,r=this.geometry.attributes.skinWeight;for(e=0;e<r.count;e++)n.x=r.getX(e),n.y=r.getY(e),n.z=r.getZ(e),n.w=r.getW(e),(t=1/n.lengthManhattan())!==1/0?n.multiplyScalar(t):n.set(1,0,0,0),r.setXYZW(e,n.x,n.y,n.z,n.w)}},updateMatrixWorld:function(t){zn.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),xr.prototype=Object.create(Ui.prototype),xr.prototype.constructor=xr,xr.prototype.isLineBasicMaterial=!0,xr.prototype.copy=function(t){return Ui.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this},wr.prototype=Object.assign(Object.create(en.prototype),{constructor:wr,isLine:!0,raycast:function(){var t=new Re,e=new Un,i=new Gi;return function(n,r){var a=n.linePrecision,s=a*a,o=this.geometry,l=this.matrixWorld;if(null===o.boundingSphere&&o.computeBoundingSphere(),i.copy(o.boundingSphere),i.applyMatrix4(l),!1!==n.ray.intersectsSphere(i)){t.getInverse(l),e.copy(n.ray).applyMatrix4(t);var h=new Pe,c=new Pe,u=new Pe,d=new Pe,f=this&&this.isLineSegments?2:1;if(o.isBufferGeometry){var p=o.index,m=o.attributes.position.array;if(null!==p)for(var g=p.array,v=0,_=g.length-1;v<_;v+=f){var y=g[v],b=g[v+1];if(h.fromArray(m,3*y),c.fromArray(m,3*b),!(e.distanceSqToSegment(h,c,d,u)>s))d.applyMatrix4(this.matrixWorld),(E=n.ray.origin.distanceTo(d))<n.near||E>n.far||r.push({distance:E,point:u.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}else for(v=0,_=m.length/3-1;v<_;v+=f){if(h.fromArray(m,3*v),c.fromArray(m,3*v+3),!(e.distanceSqToSegment(h,c,d,u)>s))d.applyMatrix4(this.matrixWorld),(E=n.ray.origin.distanceTo(d))<n.near||E>n.far||r.push({distance:E,point:u.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else if(o.isGeometry){var x=o.vertices,w=x.length;for(v=0;v<w-1;v+=f){var E;if(!(e.distanceSqToSegment(x[v],x[v+1],d,u)>s))d.applyMatrix4(this.matrixWorld),(E=n.ray.origin.distanceTo(d))<n.near||E>n.far||r.push({distance:E,point:u.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Er.prototype=Object.assign(Object.create(wr.prototype),{constructor:Er,isLineSegments:!0}),Sr.prototype=Object.assign(Object.create(wr.prototype),{constructor:Sr,isLineLoop:!0}),Tr.prototype=Object.create(Ui.prototype),Tr.prototype.constructor=Tr,Tr.prototype.isPointsMaterial=!0,Tr.prototype.copy=function(t){return Ui.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this},Mr.prototype=Object.assign(Object.create(en.prototype),{constructor:Mr,isPoints:!0,raycast:function(){var t=new Re,e=new Un,i=new Gi;return function(n,r){var a=this,s=this.geometry,o=this.matrixWorld,l=n.params.Points.threshold;if(null===s.boundingSphere&&s.computeBoundingSphere(),i.copy(s.boundingSphere),i.applyMatrix4(o),i.radius+=l,!1!==n.ray.intersectsSphere(i)){t.getInverse(o),e.copy(n.ray).applyMatrix4(t);var h=l/((this.scale.x+this.scale.y+this.scale.z)/3),c=h*h,u=new Pe;if(s.isBufferGeometry){var d=s.index,f=s.attributes.position.array;if(null!==d)for(var p=d.array,m=0,g=p.length;m<g;m++){var v=p[m];u.fromArray(f,3*v),b(u,v)}else{m=0;for(var _=f.length/3;m<_;m++)u.fromArray(f,3*m),b(u,m)}}else{var y=s.vertices;for(m=0,_=y.length;m<_;m++)b(y[m],m)}}function b(t,i){var s=e.distanceSqToPoint(t);if(s<c){var l=e.closestPointToPoint(t);l.applyMatrix4(o);var h=n.ray.origin.distanceTo(l);if(h<n.near||h>n.far)return;r.push({distance:h,distanceToRay:Math.sqrt(s),point:l.clone(),index:i,face:null,object:a})}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Ar.prototype=Object.assign(Object.create(en.prototype),{constructor:Ar}),Ir.prototype=Object.create(Te.prototype),Ir.prototype.constructor=Ir,Cr.prototype=Object.create(Te.prototype),Cr.prototype.constructor=Cr,Cr.prototype.isCompressedTexture=!0,Pr.prototype=Object.create(Te.prototype),Pr.prototype.constructor=Pr,Pr.prototype.isDepthTexture=!0,Rr.prototype=Object.create(Rn.prototype),Rr.prototype.constructor=Rr,Lr.prototype=Object.create(_n.prototype),Lr.prototype.constructor=Lr,Dr.prototype=Object.create(Rn.prototype),Dr.prototype.constructor=Dr,kr.prototype=Object.create(_n.prototype),kr.prototype.constructor=kr,Or.prototype=Object.create(Rn.prototype),Or.prototype.constructor=Or,Nr.prototype=Object.create(_n.prototype),Nr.prototype.constructor=Nr,Ur.prototype=Object.create(Or.prototype),Ur.prototype.constructor=Ur,Fr.prototype=Object.create(_n.prototype),Fr.prototype.constructor=Fr,Br.prototype=Object.create(Or.prototype),Br.prototype.constructor=Br,zr.prototype=Object.create(_n.prototype),zr.prototype.constructor=zr,Hr.prototype=Object.create(Or.prototype),Hr.prototype.constructor=Hr,Gr.prototype=Object.create(_n.prototype),Gr.prototype.constructor=Gr,jr.prototype=Object.create(Or.prototype),jr.prototype.constructor=jr,Vr.prototype=Object.create(_n.prototype),Vr.prototype.constructor=Vr,Wr.prototype=Object.create(Rn.prototype),Wr.prototype.constructor=Wr,qr.prototype=Object.create(_n.prototype),qr.prototype.constructor=qr,Xr.prototype=Object.create(Rn.prototype),Xr.prototype.constructor=Xr,Yr.prototype=Object.create(_n.prototype),Yr.prototype.constructor=Yr,Zr.prototype=Object.create(Rn.prototype),Zr.prototype.constructor=Zr;var Jr={area:function(t){for(var e=t.length,i=0,n=e-1,r=0;r<e;n=r++)i+=t[n].x*t[r].y-t[r].x*t[n].y;return.5*i},triangulate:function(){function t(t,e,i,n,r,a){var s,o,l,h,c,u,d,f,p,m,g,v,_,y,b,x,w;if(o=t[a[e]].x,l=t[a[e]].y,h=t[a[i]].x,c=t[a[i]].y,u=t[a[n]].x,(h-o)*((d=t[a[n]].y)-l)-(c-l)*(u-o)<=0)return!1;for(m=u-h,g=d-c,v=o-u,_=l-d,y=h-o,b=c-l,s=0;s<r;s++)if(f=t[a[s]].x,p=t[a[s]].y,!(f===o&&p===l||f===h&&p===c||f===u&&p===d)&&(x=y*(p-l)-b*(f-o),w=v*(p-d)-_*(f-u),m*(p-c)-g*(f-h)>=-Number.EPSILON&&w>=-Number.EPSILON&&x>=-Number.EPSILON))return!1;return!0}return function(e,i){var n=e.length;if(n<3)return null;var r,a,s,o=[],l=[],h=[];if(Jr.area(e)>0)for(a=0;a<n;a++)l[a]=a;else for(a=0;a<n;a++)l[a]=n-1-a;var c=n,u=2*c;for(a=c-1;c>2;){if(u--<=0)return console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()"),i?h:o;if(c<=(r=a)&&(r=0),c<=(a=r+1)&&(a=0),c<=(s=a+1)&&(s=0),t(e,r,a,s,c,l)){var d,f,p,m,g;for(d=l[r],f=l[a],p=l[s],o.push([e[d],e[f],e[p]]),h.push([l[r],l[a],l[s]]),m=a,g=a+1;g<c;m++,g++)l[m]=l[g];u=2*--c}}return i?h:o}}(),triangulateShape:function(t,e){function i(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function n(t,e,i){return t.x!==e.x?t.x<e.x?t.x<=i.x&&i.x<=e.x:e.x<=i.x&&i.x<=t.x:t.y<e.y?t.y<=i.y&&i.y<=e.y:e.y<=i.y&&i.y<=t.y}function r(t,e,i,r,a){var s=e.x-t.x,o=e.y-t.y,l=r.x-i.x,h=r.y-i.y,c=t.x-i.x,u=t.y-i.y,d=o*l-s*h,f=o*c-s*u;if(Math.abs(d)>Number.EPSILON){var p;if(d>0){if(f<0||f>d)return[];if((p=h*c-l*u)<0||p>d)return[]}else{if(f>0||f<d)return[];if((p=h*c-l*u)>0||p<d)return[]}if(0===p)return!a||0!==f&&f!==d?[t]:[];if(p===d)return!a||0!==f&&f!==d?[e]:[];if(0===f)return[i];if(f===d)return[r];var m=p/d;return[{x:t.x+m*s,y:t.y+m*o}]}if(0!==f||h*c!=l*u)return[];var g,v,_,y,b,x,w,E,S=0===s&&0===o,T=0===l&&0===h;return S&&T?t.x!==i.x||t.y!==i.y?[]:[t]:S?n(i,r,t)?[t]:[]:T?n(t,e,i)?[i]:[]:(0!==s?(t.x<e.x?(g=t,_=t.x,v=e,y=e.x):(g=e,_=e.x,v=t,y=t.x),i.x<r.x?(b=i,w=i.x,x=r,E=r.x):(b=r,w=r.x,x=i,E=i.x)):(t.y<e.y?(g=t,_=t.y,v=e,y=e.y):(g=e,_=e.y,v=t,y=t.y),i.y<r.y?(b=i,w=i.y,x=r,E=r.y):(b=r,w=r.y,x=i,E=i.y)),_<=w?y<w?[]:y===w?a?[]:[b]:y<=E?[b,v]:[b,x]:_>E?[]:_===E?a?[]:[g]:y<=E?[g,v]:[g,x])}function a(t,e,i,n){var r=e.x-t.x,a=e.y-t.y,s=i.x-t.x,o=i.y-t.y,l=n.x-t.x,h=n.y-t.y,c=r*o-a*s,u=r*h-a*l;if(Math.abs(c)>Number.EPSILON){var d=l*o-h*s;return c>0?u>=0&&d>=0:u>=0||d>=0}return u>0}i(t),e.forEach(i);for(var s,o,l,h,c,u,d={},f=t.concat(),p=0,m=e.length;p<m;p++)Array.prototype.push.apply(f,e[p]);for(s=0,o=f.length;s<o;s++)void 0!==d[c=f[s].x+":"+f[s].y]&&console.warn("THREE.ShapeUtils: Duplicate point",c,s),d[c]=s;var g=function(t,e){var i,n=t.concat();function s(t,e){var r=n.length-1,s=t-1;s<0&&(s=r);var o=t+1;o>r&&(o=0);var l=a(n[t],n[s],n[o],i[e]);if(!l)return!1;var h=i.length-1,c=e-1;c<0&&(c=h);var u=e+1;return u>h&&(u=0),!!(l=a(i[e],i[c],i[u],n[t]))}function o(t,e){var i,a;for(i=0;i<n.length;i++)if(a=i+1,a%=n.length,r(t,e,n[i],n[a],!0).length>0)return!0;return!1}var l=[];function h(t,i){var n,a,s,o;for(n=0;n<l.length;n++)for(a=e[l[n]],s=0;s<a.length;s++)if(o=s+1,o%=a.length,r(t,i,a[s],a[o],!0).length>0)return!0;return!1}for(var c,u,d,f,p,m,g,v,_,y,b=[],x=0,w=e.length;x<w;x++)l.push(x);for(var E=0,S=2*l.length;l.length>0;){if(--S<0){console.log('THREE.ShapeUtils: Infinite Loop! Holes left:" + indepHoles.length + ", Probably Hole outside Shape!');break}for(u=E;u<n.length;u++){for(d=n[u],c=-1,x=0;x<l.length;x++)if(p=l[x],void 0===b[m=d.x+":"+d.y+":"+p]){i=e[p];for(var T=0;T<i.length;T++)if(f=i[T],s(u,T)&&!o(d,f)&&!h(d,f)){c=T,l.splice(x,1),g=n.slice(0,u+1),v=n.slice(u),_=i.slice(c),y=i.slice(0,c+1),n=g.concat(_).concat(y).concat(v),E=u;break}if(c>=0)break;b[m]=!0}if(c>=0)break}}return n}(t,e),v=Jr.triangulate(g,!1);for(s=0,o=v.length;s<o;s++)for(h=v[s],l=0;l<3;l++)void 0!==(u=d[c=h[l].x+":"+h[l].y])&&(h[l]=u);return v.concat()},isClockWise:function(t){return Jr.area(t)<0}};function Kr(t,e){_n.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new Qr(t,e)),this.mergeVertices()}function Qr(t,e){void 0!==t&&(Rn.call(this),this.type="ExtrudeBufferGeometry",t=Array.isArray(t)?t:[t],this.addShapeList(t,e),this.computeVertexNormals())}function $r(t,e){_n.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new ta(t,e)),this.mergeVertices()}function ta(t,e){var i=(e=e||{}).font;if(!i||!i.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new _n;var n=i.generateShapes(t,e.size,e.curveSegments);e.amount=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),Qr.call(this,n,e),this.type="TextBufferGeometry"}function ea(t,e,i,n,r,a,s){_n.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new ia(t,e,i,n,r,a,s)),this.mergeVertices()}function ia(t,e,i,n,r,a,s){Rn.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:a,thetaLength:s},t=t||50,e=Math.max(3,Math.floor(e)||8),i=Math.max(2,Math.floor(i)||6),n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var o,l,h=(a=void 0!==a?a:0)+(s=void 0!==s?s:Math.PI),c=0,u=[],d=new Pe,f=new Pe,p=[],m=[],g=[],v=[];for(l=0;l<=i;l++){var _=[],y=l/i;for(o=0;o<=e;o++){var b=o/e;d.x=-t*Math.cos(n+b*r)*Math.sin(a+y*s),d.y=t*Math.cos(a+y*s),d.z=t*Math.sin(n+b*r)*Math.sin(a+y*s),m.push(d.x,d.y,d.z),f.set(d.x,d.y,d.z).normalize(),g.push(f.x,f.y,f.z),v.push(b,1-y),_.push(c++)}u.push(_)}for(l=0;l<i;l++)for(o=0;o<e;o++){var x=u[l][o+1],w=u[l][o],E=u[l+1][o],S=u[l+1][o+1];(0!==l||a>0)&&p.push(x,w,S),(l!==i-1||h<Math.PI)&&p.push(w,E,S)}this.setIndex(p),this.addAttribute("position",new An(m,3)),this.addAttribute("normal",new An(g,3)),this.addAttribute("uv",new An(v,2))}function na(t,e,i,n,r,a){_n.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:a},this.fromBufferGeometry(new ra(t,e,i,n,r,a)),this.mergeVertices()}function ra(t,e,i,n,r,a){Rn.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:a},t=t||20,e=e||50,r=void 0!==r?r:0,a=void 0!==a?a:2*Math.PI,i=void 0!==i?Math.max(3,i):8;var s,o,l,h=[],c=[],u=[],d=[],f=t,p=(e-t)/(n=void 0!==n?Math.max(1,n):1),m=new Pe,g=new ve;for(o=0;o<=n;o++){for(l=0;l<=i;l++)s=r+l/i*a,m.x=f*Math.cos(s),m.y=f*Math.sin(s),c.push(m.x,m.y,m.z),u.push(0,0,1),g.x=(m.x/e+1)/2,g.y=(m.y/e+1)/2,d.push(g.x,g.y);f+=p}for(o=0;o<n;o++){var v=o*(i+1);for(l=0;l<i;l++){var _=s=l+v,y=s+i+1,b=s+i+2,x=s+1;h.push(_,y,x),h.push(y,b,x)}}this.setIndex(h),this.addAttribute("position",new An(c,3)),this.addAttribute("normal",new An(u,3)),this.addAttribute("uv",new An(d,2))}function aa(t,e,i,n){_n.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:n},this.fromBufferGeometry(new sa(t,e,i,n)),this.mergeVertices()}function sa(t,e,i,n){Rn.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:n},e=Math.floor(e)||12,i=i||0,n=n||2*Math.PI,n=ge.clamp(n,0,2*Math.PI);var r,a,s,o=[],l=[],h=[],c=1/e,u=new Pe,d=new ve;for(a=0;a<=e;a++){var f=i+a*c*n,p=Math.sin(f),m=Math.cos(f);for(s=0;s<=t.length-1;s++)u.x=t[s].x*p,u.y=t[s].y,u.z=t[s].x*m,l.push(u.x,u.y,u.z),d.x=a/e,d.y=s/(t.length-1),h.push(d.x,d.y)}for(a=0;a<e;a++)for(s=0;s<t.length-1;s++){var g=r=s+a*t.length,v=r+t.length,_=r+t.length+1,y=r+1;o.push(g,v,y),o.push(v,_,y)}if(this.setIndex(o),this.addAttribute("position",new An(l,3)),this.addAttribute("uv",new An(h,2)),this.computeVertexNormals(),n===2*Math.PI){var b=this.attributes.normal.array,x=new Pe,w=new Pe,E=new Pe;for(r=e*t.length*3,a=0,s=0;a<t.length;a++,s+=3)x.x=b[s+0],x.y=b[s+1],x.z=b[s+2],w.x=b[r+s+0],w.y=b[r+s+1],w.z=b[r+s+2],E.addVectors(x,w).normalize(),b[s+0]=b[r+s+0]=E.x,b[s+1]=b[r+s+1]=E.y,b[s+2]=b[r+s+2]=E.z}}function oa(t,e){_n.call(this),this.type="ShapeGeometry","object"==typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new la(t,e)),this.mergeVertices()}function la(t,e){Rn.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;var i=[],n=[],r=[],a=[],s=0,o=0;if(!1===Array.isArray(t))h(t);else for(var l=0;l<t.length;l++)h(t[l]),this.addGroup(s,o,l),s+=o,o=0;function h(t){var s,l,h,c=n.length/3,u=t.extractPoints(e),d=u.shape,f=u.holes;if(!1===Jr.isClockWise(d))for(d=d.reverse(),s=0,l=f.length;s<l;s++)h=f[s],!0===Jr.isClockWise(h)&&(f[s]=h.reverse());var p=Jr.triangulateShape(d,f);for(s=0,l=f.length;s<l;s++)h=f[s],d=d.concat(h);for(s=0,l=d.length;s<l;s++){var m=d[s];n.push(m.x,m.y,0),r.push(0,0,1),a.push(m.x,m.y)}for(s=0,l=p.length;s<l;s++){var g=p[s],v=g[0]+c,_=g[1]+c,y=g[2]+c;i.push(v,_,y),o+=3}}this.setIndex(i),this.addAttribute("position",new An(n,3)),this.addAttribute("normal",new An(r,3)),this.addAttribute("uv",new An(a,2))}function ha(t,e){Rn.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1;var i,n,r,a,s=[],o=Math.cos(ge.DEG2RAD*e),l=[0,0],h={},c=["a","b","c"];t.isBufferGeometry?(a=new _n).fromBufferGeometry(t):a=t.clone(),a.mergeVertices(),a.computeFaceNormals();for(var u=a.vertices,d=a.faces,f=0,p=d.length;f<p;f++)for(var m=d[f],g=0;g<3;g++)i=m[c[g]],n=m[c[(g+1)%3]],l[0]=Math.min(i,n),l[1]=Math.max(i,n),void 0===h[r=l[0]+","+l[1]]?h[r]={index1:l[0],index2:l[1],face1:f,face2:void 0}:h[r].face2=f;for(r in h){var v=h[r];if(void 0===v.face2||d[v.face1].normal.dot(d[v.face2].normal)<=o){var _=u[v.index1];s.push(_.x,_.y,_.z),_=u[v.index2],s.push(_.x,_.y,_.z)}}this.addAttribute("position",new An(s,3))}function ca(t,e,i,n,r,a,s,o){_n.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:r,openEnded:a,thetaStart:s,thetaLength:o},this.fromBufferGeometry(new ua(t,e,i,n,r,a,s,o)),this.mergeVertices()}function ua(t,e,i,n,r,a,s,o){Rn.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:r,openEnded:a,thetaStart:s,thetaLength:o};var l=this;t=void 0!==t?t:20,e=void 0!==e?e:20,i=void 0!==i?i:100,n=Math.floor(n)||8,r=Math.floor(r)||1,a=void 0!==a&&a,s=void 0!==s?s:0,o=void 0!==o?o:2*Math.PI;var h=[],c=[],u=[],d=[],f=0,p=[],m=i/2,g=0;function v(i){var r,a,p,v=new ve,_=new Pe,y=0,b=!0===i?t:e,x=!0===i?1:-1;for(a=f,r=1;r<=n;r++)c.push(0,m*x,0),u.push(0,x,0),d.push(.5,.5),f++;for(p=f,r=0;r<=n;r++){var w=r/n*o+s,E=Math.cos(w),S=Math.sin(w);_.x=b*S,_.y=m*x,_.z=b*E,c.push(_.x,_.y,_.z),u.push(0,x,0),v.x=.5*E+.5,v.y=.5*S*x+.5,d.push(v.x,v.y),f++}for(r=0;r<n;r++){var T=a+r,M=p+r;!0===i?h.push(M,M+1,T):h.push(M+1,M,T),y+=3}l.addGroup(g,y,!0===i?1:2),g+=y}!function(){var a,v,_=new Pe,y=new Pe,b=0,x=(e-t)/i;for(v=0;v<=r;v++){var w=[],E=v/r,S=E*(e-t)+t;for(a=0;a<=n;a++){var T=a/n,M=T*o+s,A=Math.sin(M),I=Math.cos(M);y.x=S*A,y.y=-E*i+m,y.z=S*I,c.push(y.x,y.y,y.z),_.set(A,x,I).normalize(),u.push(_.x,_.y,_.z),d.push(T,1-E),w.push(f++)}p.push(w)}for(a=0;a<n;a++)for(v=0;v<r;v++){var C=p[v][a],P=p[v+1][a],R=p[v+1][a+1],L=p[v][a+1];h.push(C,P,L),h.push(P,R,L),b+=6}l.addGroup(g,b,0),g+=b}(),!1===a&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(h),this.addAttribute("position",new An(c,3)),this.addAttribute("normal",new An(u,3)),this.addAttribute("uv",new An(d,2))}function da(t,e,i,n,r,a,s){ca.call(this,0,t,e,i,n,r,a,s),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:a,thetaLength:s}}function fa(t,e,i,n,r,a,s){ua.call(this,0,t,e,i,n,r,a,s),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:a,thetaLength:s}}function pa(t,e,i,n){_n.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:n},this.fromBufferGeometry(new ma(t,e,i,n)),this.mergeVertices()}function ma(t,e,i,n){Rn.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:n},t=t||50,e=void 0!==e?Math.max(3,e):8,i=void 0!==i?i:0,n=void 0!==n?n:2*Math.PI;var r,a,s=[],o=[],l=[],h=[],c=new Pe,u=new ve;for(o.push(0,0,0),l.push(0,0,1),h.push(.5,.5),a=0,r=3;a<=e;a++,r+=3){var d=i+a/e*n;c.x=t*Math.cos(d),c.y=t*Math.sin(d),o.push(c.x,c.y,c.z),l.push(0,0,1),u.x=(o[r]/t+1)/2,u.y=(o[r+1]/t+1)/2,h.push(u.x,u.y)}for(r=1;r<=e;r++)s.push(r,r+1,0);this.setIndex(s),this.addAttribute("position",new An(o,3)),this.addAttribute("normal",new An(l,3)),this.addAttribute("uv",new An(h,2))}Kr.prototype=Object.create(_n.prototype),Kr.prototype.constructor=Kr,Qr.prototype=Object.create(Rn.prototype),Qr.prototype.constructor=Qr,Qr.prototype.getArrays=function(){var t=this.getAttribute("position"),e=t?Array.prototype.slice.call(t.array):[],i=this.getAttribute("uv"),n=i?Array.prototype.slice.call(i.array):[],r=this.index;return{position:e,uv:n,index:r?Array.prototype.slice.call(r.array):[]}},Qr.prototype.addShapeList=function(t,e){var i=t.length;e.arrays=this.getArrays();for(var n=0;n<i;n++){var r=t[n];this.addShape(r,e)}this.setIndex(e.arrays.index),this.addAttribute("position",new An(e.arrays.position,3)),this.addAttribute("uv",new An(e.arrays.uv,2))},Qr.prototype.addShape=function(t,e){var i,n,r,a,s,o,l,h,c=e.arrays?e.arrays:this.getArrays(),u=c.position,d=c.index,f=c.uv,p=[],m=void 0!==e.amount?e.amount:100,g=void 0!==e.bevelThickness?e.bevelThickness:6,v=void 0!==e.bevelSize?e.bevelSize:g-2,_=void 0!==e.bevelSegments?e.bevelSegments:3,y=void 0===e.bevelEnabled||e.bevelEnabled,b=void 0!==e.curveSegments?e.curveSegments:12,x=void 0!==e.steps?e.steps:1,w=e.extrudePath,E=!1,S=void 0!==e.UVGenerator?e.UVGenerator:Kr.WorldUVGenerator;w&&(i=w.getSpacedPoints(x),E=!0,y=!1,n=void 0!==e.frames?e.frames:w.computeFrenetFrames(x,!1),r=new Pe,a=new Pe,s=new Pe),y||(_=0,g=0,v=0);var T=this,M=t.extractPoints(b),A=M.shape,I=M.holes;if(!Jr.isClockWise(A))for(A=A.reverse(),l=0,h=I.length;l<h;l++)o=I[l],Jr.isClockWise(o)&&(I[l]=o.reverse());var C=Jr.triangulateShape(A,I),P=A;for(l=0,h=I.length;l<h;l++)o=I[l],A=A.concat(o);function R(t,e,i){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(i).add(t)}var L,D,k,O,N,U,F=A.length,B=C.length;function z(t,e,i){var n,r,a,s=t.x-e.x,o=t.y-e.y,l=i.x-t.x,h=i.y-t.y,c=s*s+o*o,u=s*h-o*l;if(Math.abs(u)>Number.EPSILON){var d=Math.sqrt(c),f=Math.sqrt(l*l+h*h),p=e.x-o/d,m=e.y+s/d,g=((i.x-h/f-p)*h-(i.y+l/f-m)*l)/(s*h-o*l),v=(n=p+s*g-t.x)*n+(r=m+o*g-t.y)*r;if(v<=2)return new ve(n,r);a=Math.sqrt(v/2)}else{var _=!1;s>Number.EPSILON?l>Number.EPSILON&&(_=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(_=!0):Math.sign(o)===Math.sign(h)&&(_=!0),_?(n=-o,r=s,a=Math.sqrt(c)):(n=s,r=o,a=Math.sqrt(c/2))}return new ve(n/a,r/a)}for(var H=[],G=0,j=P.length,V=j-1,W=G+1;G<j;G++,V++,W++)V===j&&(V=0),W===j&&(W=0),H[G]=z(P[G],P[V],P[W]);var q,X,Y=[],Z=H.concat();for(l=0,h=I.length;l<h;l++){for(o=I[l],q=[],G=0,V=(j=o.length)-1,W=G+1;G<j;G++,V++,W++)V===j&&(V=0),W===j&&(W=0),q[G]=z(o[G],o[V],o[W]);Y.push(q),Z=Z.concat(q)}for(L=0;L<_;L++){for(k=L/_,O=g*Math.cos(k*Math.PI/2),D=v*Math.sin(k*Math.PI/2),G=0,j=P.length;G<j;G++)K((N=R(P[G],H[G],D)).x,N.y,-O);for(l=0,h=I.length;l<h;l++)for(o=I[l],q=Y[l],G=0,j=o.length;G<j;G++)K((N=R(o[G],q[G],D)).x,N.y,-O)}for(D=v,G=0;G<F;G++)N=y?R(A[G],Z[G],D):A[G],E?(a.copy(n.normals[0]).multiplyScalar(N.x),r.copy(n.binormals[0]).multiplyScalar(N.y),s.copy(i[0]).add(a).add(r),K(s.x,s.y,s.z)):K(N.x,N.y,0);for(X=1;X<=x;X++)for(G=0;G<F;G++)N=y?R(A[G],Z[G],D):A[G],E?(a.copy(n.normals[X]).multiplyScalar(N.x),r.copy(n.binormals[X]).multiplyScalar(N.y),s.copy(i[X]).add(a).add(r),K(s.x,s.y,s.z)):K(N.x,N.y,m/x*X);for(L=_-1;L>=0;L--){for(k=L/_,O=g*Math.cos(k*Math.PI/2),D=v*Math.sin(k*Math.PI/2),G=0,j=P.length;G<j;G++)K((N=R(P[G],H[G],D)).x,N.y,m+O);for(l=0,h=I.length;l<h;l++)for(o=I[l],q=Y[l],G=0,j=o.length;G<j;G++)N=R(o[G],q[G],D),E?K(N.x,N.y+i[x-1].y,i[x-1].x+O):K(N.x,N.y,m+O)}function J(t,e){var i,n;for(G=t.length;--G>=0;){i=G,(n=G-1)<0&&(n=t.length-1);var r=0,a=x+2*_;for(r=0;r<a;r++){var s=F*r,o=F*(r+1);$(e+i+s,e+n+s,e+n+o,e+i+o,t,r,a,i,n)}}}function K(t,e,i){p.push(t),p.push(e),p.push(i)}function Q(t,e,i){tt(t),tt(e),tt(i);var n=u.length/3,r=S.generateTopUV(T,u,n-3,n-2,n-1);et(r[0]),et(r[1]),et(r[2])}function $(t,e,i,n,r,a,s,o,l){tt(t),tt(e),tt(n),tt(e),tt(i),tt(n);var h=u.length/3,c=S.generateSideWallUV(T,u,h-6,h-3,h-2,h-1);et(c[0]),et(c[1]),et(c[3]),et(c[1]),et(c[2]),et(c[3])}function tt(t){d.push(u.length/3),u.push(p[3*t+0]),u.push(p[3*t+1]),u.push(p[3*t+2])}function et(t){f.push(t.x),f.push(t.y)}!function(){var t=u.length/3;if(y){var i=0,n=F*i;for(G=0;G<B;G++)Q((U=C[G])[2]+n,U[1]+n,U[0]+n);for(n=F*(i=x+2*_),G=0;G<B;G++)Q((U=C[G])[0]+n,U[1]+n,U[2]+n)}else{for(G=0;G<B;G++)Q((U=C[G])[2],U[1],U[0]);for(G=0;G<B;G++)Q((U=C[G])[0]+F*x,U[1]+F*x,U[2]+F*x)}T.addGroup(t,u.length/3-t,void 0!==e.material?e.material:0)}(),function(){var t=u.length/3,i=0;for(J(P,i),i+=P.length,l=0,h=I.length;l<h;l++)J(o=I[l],i),i+=o.length;T.addGroup(t,u.length/3-t,void 0!==e.extrudeMaterial?e.extrudeMaterial:1)}(),e.arrays||(this.setIndex(d),this.addAttribute("position",new An(u,3)),this.addAttribute("uv",new An(e.arrays.uv,2)))},Kr.WorldUVGenerator={generateTopUV:function(t,e,i,n,r){var a=e[3*i],s=e[3*i+1],o=e[3*n],l=e[3*n+1],h=e[3*r],c=e[3*r+1];return[new ve(a,s),new ve(o,l),new ve(h,c)]},generateSideWallUV:function(t,e,i,n,r,a){var s=e[3*i],o=e[3*i+1],l=e[3*i+2],h=e[3*n],c=e[3*n+1],u=e[3*n+2],d=e[3*r],f=e[3*r+1],p=e[3*r+2],m=e[3*a],g=e[3*a+1],v=e[3*a+2];return Math.abs(o-c)<.01?[new ve(s,1-l),new ve(h,1-u),new ve(d,1-p),new ve(m,1-v)]:[new ve(o,1-l),new ve(c,1-u),new ve(f,1-p),new ve(g,1-v)]}},$r.prototype=Object.create(_n.prototype),$r.prototype.constructor=$r,ta.prototype=Object.create(Qr.prototype),ta.prototype.constructor=ta,ea.prototype=Object.create(_n.prototype),ea.prototype.constructor=ea,ia.prototype=Object.create(Rn.prototype),ia.prototype.constructor=ia,na.prototype=Object.create(_n.prototype),na.prototype.constructor=na,ra.prototype=Object.create(Rn.prototype),ra.prototype.constructor=ra,aa.prototype=Object.create(_n.prototype),aa.prototype.constructor=aa,sa.prototype=Object.create(Rn.prototype),sa.prototype.constructor=sa,oa.prototype=Object.create(_n.prototype),oa.prototype.constructor=oa,la.prototype=Object.create(Rn.prototype),la.prototype.constructor=la,ha.prototype=Object.create(Rn.prototype),ha.prototype.constructor=ha,ca.prototype=Object.create(_n.prototype),ca.prototype.constructor=ca,ua.prototype=Object.create(Rn.prototype),ua.prototype.constructor=ua,da.prototype=Object.create(ca.prototype),da.prototype.constructor=da,fa.prototype=Object.create(ua.prototype),fa.prototype.constructor=fa,pa.prototype=Object.create(_n.prototype),pa.prototype.constructor=pa,ma.prototype=Object.create(Rn.prototype),ma.prototype.constructor=ma;var ga=Object.freeze({WireframeGeometry:Rr,ParametricGeometry:Lr,ParametricBufferGeometry:Dr,TetrahedronGeometry:Nr,TetrahedronBufferGeometry:Ur,OctahedronGeometry:Fr,OctahedronBufferGeometry:Br,IcosahedronGeometry:zr,IcosahedronBufferGeometry:Hr,DodecahedronGeometry:Gr,DodecahedronBufferGeometry:jr,PolyhedronGeometry:kr,PolyhedronBufferGeometry:Or,TubeGeometry:Vr,TubeBufferGeometry:Wr,TorusKnotGeometry:qr,TorusKnotBufferGeometry:Xr,TorusGeometry:Yr,TorusBufferGeometry:Zr,TextGeometry:$r,TextBufferGeometry:ta,SphereGeometry:ea,SphereBufferGeometry:ia,RingGeometry:na,RingBufferGeometry:ra,PlaneGeometry:kn,PlaneBufferGeometry:On,LatheGeometry:aa,LatheBufferGeometry:sa,ShapeGeometry:oa,ShapeBufferGeometry:la,ExtrudeGeometry:Kr,ExtrudeBufferGeometry:Qr,EdgesGeometry:ha,ConeGeometry:da,ConeBufferGeometry:fa,CylinderGeometry:ca,CylinderBufferGeometry:ua,CircleGeometry:pa,CircleBufferGeometry:ma,BoxGeometry:Ln,BoxBufferGeometry:Dn});function va(t){Ui.call(this),this.type="ShadowMaterial",this.color=new bi(0),this.opacity=1,this.lights=!0,this.transparent=!0,this.setValues(t)}function _a(t){Fi.call(this,t),this.type="RawShaderMaterial"}function ya(t){Ui.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new bi(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new bi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new ve(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function ba(t){ya.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(t)}function xa(t){Ui.call(this),this.type="MeshPhongMaterial",this.color=new bi(16777215),this.specular=new bi(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new bi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new ve(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=rt,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function wa(t){xa.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(t)}function Ea(t){Ui.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new ve(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Sa(t){Ui.call(this),this.type="MeshLambertMaterial",this.color=new bi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new bi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=rt,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Ta(t){xr.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}va.prototype=Object.create(Ui.prototype),va.prototype.constructor=va,va.prototype.isShadowMaterial=!0,_a.prototype=Object.create(Fi.prototype),_a.prototype.constructor=_a,_a.prototype.isRawShaderMaterial=!0,ya.prototype=Object.create(Ui.prototype),ya.prototype.constructor=ya,ya.prototype.isMeshStandardMaterial=!0,ya.prototype.copy=function(t){return Ui.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},ba.prototype=Object.create(ya.prototype),ba.prototype.constructor=ba,ba.prototype.isMeshPhysicalMaterial=!0,ba.prototype.copy=function(t){return ya.prototype.copy.call(this,t),this.defines={PHYSICAL:""},this.reflectivity=t.reflectivity,this.clearCoat=t.clearCoat,this.clearCoatRoughness=t.clearCoatRoughness,this},xa.prototype=Object.create(Ui.prototype),xa.prototype.constructor=xa,xa.prototype.isMeshPhongMaterial=!0,xa.prototype.copy=function(t){return Ui.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},wa.prototype=Object.create(xa.prototype),wa.prototype.constructor=wa,wa.prototype.isMeshToonMaterial=!0,wa.prototype.copy=function(t){return xa.prototype.copy.call(this,t),this.gradientMap=t.gradientMap,this},Ea.prototype=Object.create(Ui.prototype),Ea.prototype.constructor=Ea,Ea.prototype.isMeshNormalMaterial=!0,Ea.prototype.copy=function(t){return Ui.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Sa.prototype=Object.create(Ui.prototype),Sa.prototype.constructor=Sa,Sa.prototype.isMeshLambertMaterial=!0,Sa.prototype.copy=function(t){return Ui.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Ta.prototype=Object.create(xr.prototype),Ta.prototype.constructor=Ta,Ta.prototype.isLineDashedMaterial=!0,Ta.prototype.copy=function(t){return xr.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var Ma=Object.freeze({ShadowMaterial:va,SpriteMaterial:mr,RawShaderMaterial:_a,ShaderMaterial:Fi,PointsMaterial:Tr,MeshPhysicalMaterial:ba,MeshStandardMaterial:ya,MeshPhongMaterial:xa,MeshToonMaterial:wa,MeshNormalMaterial:Ea,MeshLambertMaterial:Sa,MeshDepthMaterial:Bi,MeshDistanceMaterial:zi,MeshBasicMaterial:Nn,LineDashedMaterial:Ta,LineBasicMaterial:xr,Material:Ui}),Aa={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function Ia(t,e,i){var n=this,r=!1,a=0,s=0;this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){s++,!1===r&&void 0!==n.onStart&&n.onStart(t,a,s),r=!0},this.itemEnd=function(t){a++,void 0!==n.onProgress&&n.onProgress(t,a,s),a===s&&(r=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)}}var Ca=new Ia;function Pa(t){this.manager=void 0!==t?t:Ca}function Ra(t){this.manager=void 0!==t?t:Ca,this._parser=null}function La(t){this.manager=void 0!==t?t:Ca}function Da(t){this.manager=void 0!==t?t:Ca}function ka(t){this.manager=void 0!==t?t:Ca}function Oa(t,e){en.call(this),this.type="Light",this.color=new bi(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function Na(t,e,i){Oa.call(this,t,i),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(en.DefaultUp),this.updateMatrix(),this.groundColor=new bi(e)}function Ua(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new ve(512,512),this.map=null,this.matrix=new Re}function Fa(){Ua.call(this,new an(50,1,.5,500))}function Ba(t,e,i,n,r,a){Oa.call(this,t,e),this.type="SpotLight",this.position.copy(en.DefaultUp),this.updateMatrix(),this.target=new en,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==a?a:1,this.shadow=new Fa}function za(t,e,i,n){Oa.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==n?n:1,this.shadow=new Ua(new an(90,1,.5,500))}function Ha(){Ua.call(this,new rn(-5,5,5,-5,.5,500))}function Ga(t,e){Oa.call(this,t,e),this.type="DirectionalLight",this.position.copy(en.DefaultUp),this.updateMatrix(),this.target=new en,this.shadow=new Ha}function ja(t,e){Oa.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function Va(t,e,i,n){Oa.call(this,t,e),this.type="RectAreaLight",this.position.set(0,1,0),this.updateMatrix(),this.width=void 0!==i?i:10,this.height=void 0!==n?n:10}Object.assign(Pa.prototype,{load:function(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t);var r=this,a=Aa.get(t);if(void 0!==a)return r.manager.itemStart(t),setTimeout(function(){e&&e(a),r.manager.itemEnd(t)},0),a;var s=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(s){var o=s[1],l=!!s[2],h=s[3];h=window.decodeURIComponent(h),l&&(h=window.atob(h));try{var c,u=(this.responseType||"").toLowerCase();switch(u){case"arraybuffer":case"blob":c=new ArrayBuffer(h.length);for(var d=new Uint8Array(c),f=0;f<h.length;f++)d[f]=h.charCodeAt(f);"blob"===u&&(c=new Blob([c],{type:o}));break;case"document":var p=new DOMParser;c=p.parseFromString(h,o);break;case"json":c=JSON.parse(h);break;default:c=h}window.setTimeout(function(){e&&e(c),r.manager.itemEnd(t)},0)}catch(e){window.setTimeout(function(){n&&n(e),r.manager.itemEnd(t),r.manager.itemError(t)},0)}}else{var m=new XMLHttpRequest;for(var g in m.open("GET",t,!0),m.addEventListener("load",function(i){var a=i.target.response;Aa.add(t,a),200===this.status?(e&&e(a),r.manager.itemEnd(t)):0===this.status?(console.warn("THREE.FileLoader: HTTP Status 0 received."),e&&e(a),r.manager.itemEnd(t)):(n&&n(i),r.manager.itemEnd(t),r.manager.itemError(t))},!1),void 0!==i&&m.addEventListener("progress",function(t){i(t)},!1),m.addEventListener("error",function(e){n&&n(e),r.manager.itemEnd(t),r.manager.itemError(t)},!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(g,this.requestHeader[g]);m.send(null)}return r.manager.itemStart(t),m},setPath:function(t){return this.path=t,this},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}}),Object.assign(function(t){this.manager=void 0!==t?t:Ca,this._parser=null}.prototype,{load:function(t,e,i,n){var r=this,a=[],s=new Cr;s.image=a;var o=new Pa(this.manager);function l(l){o.load(t[l],function(t){var i=r._parser(t,!0);a[l]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},6===(h+=1)&&(1===i.mipmapCount&&(s.minFilter=Tt),s.format=i.format,s.needsUpdate=!0,e&&e(s))},i,n)}if(o.setPath(this.path),o.setResponseType("arraybuffer"),Array.isArray(t))for(var h=0,c=0,u=t.length;c<u;++c)l(c);else o.load(t,function(t){var i=r._parser(t,!0);if(i.isCubemap)for(var n=i.mipmaps.length/i.mipmapCount,o=0;o<n;o++){a[o]={mipmaps:[]};for(var l=0;l<i.mipmapCount;l++)a[o].mipmaps.push(i.mipmaps[o*i.mipmapCount+l]),a[o].format=i.format,a[o].width=i.width,a[o].height=i.height}else s.image.width=i.width,s.image.height=i.height,s.mipmaps=i.mipmaps;1===i.mipmapCount&&(s.minFilter=Tt),s.format=i.format,s.needsUpdate=!0,e&&e(s)},i,n);return s},setPath:function(t){return this.path=t,this}}),Object.assign(Ra.prototype,{load:function(t,e,i,n){var r=this,a=new Le,s=new Pa(this.manager);return s.setResponseType("arraybuffer"),s.load(t,function(t){var i=r._parser(t);i&&(void 0!==i.image?a.image=i.image:void 0!==i.data&&(a.image.width=i.width,a.image.height=i.height,a.image.data=i.data),a.wrapS=void 0!==i.wrapS?i.wrapS:bt,a.wrapT=void 0!==i.wrapT?i.wrapT:bt,a.magFilter=void 0!==i.magFilter?i.magFilter:Tt,a.minFilter=void 0!==i.minFilter?i.minFilter:At,a.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.format&&(a.format=i.format),void 0!==i.type&&(a.type=i.type),void 0!==i.mipmaps&&(a.mipmaps=i.mipmaps),1===i.mipmapCount&&(a.minFilter=Tt),a.needsUpdate=!0,e&&e(a,i))},i,n),a}}),Object.assign(La.prototype,{crossOrigin:"Anonymous",load:function(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t);var r=this,a=Aa.get(t);if(void 0!==a)return r.manager.itemStart(t),setTimeout(function(){e&&e(a),r.manager.itemEnd(t)},0),a;var s=document.createElementNS("http://www.w3.org/1999/xhtml","img");return s.addEventListener("load",function(){Aa.add(t,this),e&&e(this),r.manager.itemEnd(t)},!1),s.addEventListener("error",function(e){n&&n(e),r.manager.itemEnd(t),r.manager.itemError(t)},!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),r.manager.itemStart(t),s.src=t,s},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(Da.prototype,{crossOrigin:"Anonymous",load:function(t,e,i,n){var r=new De,a=new La(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var s=0;function o(i){a.load(t[i],function(t){r.images[i]=t,6===++s&&(r.needsUpdate=!0,e&&e(r))},void 0,n)}for(var l=0;l<t.length;++l)o(l);return r},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(ka.prototype,{crossOrigin:"Anonymous",load:function(t,e,i,n){var r=new La(this.manager);r.setCrossOrigin(this.crossOrigin),r.setPath(this.path);var a=new Te;return a.image=r.load(t,function(){var i=t.search(/\.(jpg|jpeg)$/)>0||0===t.search(/^data\:image\/jpeg/);a.format=i?Ht:Gt,a.needsUpdate=!0,void 0!==e&&e(a)},i,n),a},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Oa.prototype=Object.assign(Object.create(en.prototype),{constructor:Oa,isLight:!0,copy:function(t){return en.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){var e=en.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),Na.prototype=Object.assign(Object.create(Oa.prototype),{constructor:Na,isHemisphereLight:!0,copy:function(t){return Oa.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(Ua.prototype,{copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),Fa.prototype=Object.assign(Object.create(Ua.prototype),{constructor:Fa,isSpotLightShadow:!0,update:function(t){var e=this.camera,i=2*ge.RAD2DEG*t.angle,n=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;i===e.fov&&n===e.aspect&&r===e.far||(e.fov=i,e.aspect=n,e.far=r,e.updateProjectionMatrix())}}),Ba.prototype=Object.assign(Object.create(Oa.prototype),{constructor:Ba,isSpotLight:!0,copy:function(t){return Oa.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),za.prototype=Object.assign(Object.create(Oa.prototype),{constructor:za,isPointLight:!0,copy:function(t){return Oa.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),Ha.prototype=Object.assign(Object.create(Ua.prototype),{constructor:Ha}),Ga.prototype=Object.assign(Object.create(Oa.prototype),{constructor:Ga,isDirectionalLight:!0,copy:function(t){return Oa.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),ja.prototype=Object.assign(Object.create(Oa.prototype),{constructor:ja,isAmbientLight:!0}),Va.prototype=Object.assign(Object.create(Oa.prototype),{constructor:Va,isRectAreaLight:!0,copy:function(t){return Oa.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){var e=Oa.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}});var Wa,qa={arraySlice:function(t,e,i){return qa.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==i?i:t.length)):t.slice(e,i)},convertArray:function(t,e,i){return!t||!i&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,i=new Array(e),n=0;n!==e;++n)i[n]=n;return i.sort(function(e,i){return t[e]-t[i]}),i},sortedArray:function(t,e,i){for(var n=t.length,r=new t.constructor(n),a=0,s=0;s!==n;++a)for(var o=i[a]*e,l=0;l!==e;++l)r[s++]=t[o+l];return r},flattenJSON:function(t,e,i,n){for(var r=1,a=t[0];void 0!==a&&void 0===a[n];)a=t[r++];if(void 0!==a){var s=a[n];if(void 0!==s)if(Array.isArray(s))do{void 0!==(s=a[n])&&(e.push(a.time),i.push.apply(i,s)),a=t[r++]}while(void 0!==a);else if(void 0!==s.toArray)do{void 0!==(s=a[n])&&(e.push(a.time),s.toArray(i,i.length)),a=t[r++]}while(void 0!==a);else do{void 0!==(s=a[n])&&(e.push(a.time),i.push(s)),a=t[r++]}while(void 0!==a)}}};function Xa(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i}function Ya(t,e,i,n){Xa.call(this,t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Za(t,e,i,n){Xa.call(this,t,e,i,n)}function Ja(t,e,i,n){Xa.call(this,t,e,i,n)}function Ka(t,e,i,n){if(void 0===t)throw new Error("track name is undefined");if(void 0===e||0===e.length)throw new Error("no keyframes in track named "+t);this.name=t,this.times=qa.convertArray(e,this.TimeBufferType),this.values=qa.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation),this.validate(),this.optimize()}function Qa(t,e,i,n){Ka.call(this,t,e,i,n)}function $a(t,e,i,n){Xa.call(this,t,e,i,n)}function ts(t,e,i,n){Ka.call(this,t,e,i,n)}function es(t,e,i,n){Ka.call(this,t,e,i,n)}function is(t,e,i,n){Ka.call(this,t,e,i,n)}function ns(t,e,i){Ka.call(this,t,e,i)}function rs(t,e,i,n){Ka.call(this,t,e,i,n)}function as(t,e,i,n){Ka.apply(this,arguments)}function ss(t,e,i){this.name=t,this.tracks=i,this.duration=void 0!==e?e:-1,this.uuid=ge.generateUUID(),this.duration<0&&this.resetDuration(),this.optimize()}function os(t){this.manager=void 0!==t?t:Ca,this.textures={}}function ls(t){this.manager=void 0!==t?t:Ca}Object.assign(Xa.prototype,{evaluate:function(t){var e=this.parameterPositions,i=this._cachedIndex,n=e[i],r=e[i-1];t:{e:{var a;i:{n:if(!(t<n)){for(var s=i+2;;){if(void 0===n){if(t<r)break n;return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,t,r)}if(i===s)break;if(r=n,t<(n=e[++i]))break e}a=e.length;break i}if(t>=r)break t;var o=e[1];t<o&&(i=2,r=o);for(s=i-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(i===s)break;if(n=r,t>=(r=e[--i-1]))break e}a=i,i=0}for(;i<a;){var l=i+a>>>1;t<e[l]?a=l:i=l+1}if(n=e[i],void 0===(r=e[i-1]))return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,r,t)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,t,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=t*n,a=0;a!==n;++a)e[a]=i[r+a];return e},interpolate_:function(t,e,i,n){throw new Error("call to abstract method")},intervalChanged_:function(t,e,i){}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(Xa.prototype,{beforeStart_:Xa.prototype.copySampleValue_,afterEnd_:Xa.prototype.copySampleValue_}),Ya.prototype=Object.assign(Object.create(Xa.prototype),{constructor:Ya,DefaultSettings_:{endingStart:ne,endingEnd:ne},intervalChanged_:function(t,e,i){var n=this.parameterPositions,r=t-2,a=t+1,s=n[r],o=n[a];if(void 0===s)switch(this.getSettings_().endingStart){case 2401:r=t,s=2*e-i;break;case 2402:s=e+n[r=n.length-2]-n[r+1];break;default:r=t,s=i}if(void 0===o)switch(this.getSettings_().endingEnd){case 2401:a=t,o=2*i-e;break;case 2402:a=1,o=i+n[1]-n[0];break;default:a=t-1,o=e}var l=.5*(i-e),h=this.valueSize;this._weightPrev=l/(e-s),this._weightNext=l/(o-i),this._offsetPrev=r*h,this._offsetNext=a*h},interpolate_:function(t,e,i,n){for(var r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=t*s,l=o-s,h=this._offsetPrev,c=this._offsetNext,u=this._weightPrev,d=this._weightNext,f=(i-e)/(n-e),p=f*f,m=p*f,g=-u*m+2*u*p-u*f,v=(1+u)*m+(-1.5-2*u)*p+(-.5+u)*f+1,_=(-1-d)*m+(1.5+d)*p+.5*f,y=d*m-d*p,b=0;b!==s;++b)r[b]=g*a[h+b]+v*a[l+b]+_*a[o+b]+y*a[c+b];return r}}),Za.prototype=Object.assign(Object.create(Xa.prototype),{constructor:Za,interpolate_:function(t,e,i,n){for(var r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=t*s,l=o-s,h=(i-e)/(n-e),c=1-h,u=0;u!==s;++u)r[u]=a[l+u]*c+a[o+u]*h;return r}}),Ja.prototype=Object.assign(Object.create(Xa.prototype),{constructor:Ja,interpolate_:function(t,e,i,n){return this.copySampleValue_(t-1)}}),Wa={TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(t){return new Ja(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new Za(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new Ya(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case 2300:e=this.InterpolantFactoryMethodDiscrete;break;case 2301:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0!==e)this.createInterpolant=e;else{var i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}console.warn("THREE.KeyframeTrackPrototype:",i)}},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,i=0,n=e.length;i!==n;++i)e[i]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,i=0,n=e.length;i!==n;++i)e[i]*=t;return this},trim:function(t,e){for(var i=this.times,n=i.length,r=0,a=n-1;r!==n&&i[r]<t;)++r;for(;-1!==a&&i[a]>e;)--a;if(++a,0!==r||a!==n){r>=a&&(r=(a=Math.max(a,1))-1);var s=this.getValueSize();this.times=qa.arraySlice(i,r,a),this.values=qa.arraySlice(this.values,r*s,a*s)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrackPrototype: Invalid value size in track.",this),t=!1);var i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrackPrototype: Track is empty.",this),t=!1);for(var a=null,s=0;s!==r;s++){var o=i[s];if("number"==typeof o&&isNaN(o)){console.error("THREE.KeyframeTrackPrototype: Time is not a valid number.",this,s,o),t=!1;break}if(null!==a&&a>o){console.error("THREE.KeyframeTrackPrototype: Out of order keys.",this,s,o,a),t=!1;break}a=o}if(void 0!==n&&qa.isTypedArray(n)){s=0;for(var l=n.length;s!==l;++s){var h=n[s];if(isNaN(h)){console.error("THREE.KeyframeTrackPrototype: Value is not a valid number.",this,s,h),t=!1;break}}}return t},optimize:function(){for(var t=this.times,e=this.values,i=this.getValueSize(),n=2302===this.getInterpolation(),r=1,a=t.length-1,s=1;s<a;++s){var o=!1,l=t[s];if(l!==t[s+1]&&(1!==s||l!==l[0]))if(n)o=!0;else for(var h=s*i,c=h-i,u=h+i,d=0;d!==i;++d){var f=e[h+d];if(f!==e[c+d]||f!==e[u+d]){o=!0;break}}if(o){if(s!==r){t[r]=t[s];var p=s*i,m=r*i;for(d=0;d!==i;++d)e[m+d]=e[p+d]}++r}}if(a>0){t[r]=t[a];for(p=a*i,m=r*i,d=0;d!==i;++d)e[m+d]=e[p+d];++r}return r!==t.length&&(this.times=qa.arraySlice(t,0,r),this.values=qa.arraySlice(e,0,r*i)),this}},Qa.prototype=Object.assign(Object.create(Wa),{constructor:Qa,ValueTypeName:"vector"}),$a.prototype=Object.assign(Object.create(Xa.prototype),{constructor:$a,interpolate_:function(t,e,i,n){for(var r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=t*s,l=(i-e)/(n-e),h=o+s;o!==h;o+=4)Ce.slerpFlat(r,0,a,o-s,a,o,l);return r}}),ts.prototype=Object.assign(Object.create(Wa),{constructor:ts,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(t){return new $a(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),es.prototype=Object.assign(Object.create(Wa),{constructor:es,ValueTypeName:"number"}),is.prototype=Object.assign(Object.create(Wa),{constructor:is,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ns.prototype=Object.assign(Object.create(Wa),{constructor:ns,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),rs.prototype=Object.assign(Object.create(Wa),{constructor:rs,ValueTypeName:"color"}),as.prototype=Wa,Wa.constructor=as,Object.assign(as,{parse:function(t){if(void 0===t.type)throw new Error("track type undefined, can not parse");var e=as._getTrackTypeForValueTypeName(t.type);if(void 0===t.times){var i=[],n=[];qa.flattenJSON(t.keys,i,n,"value"),t.times=i,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)},toJSON:function(t){var e,i=t.constructor;if(void 0!==i.toJSON)e=i.toJSON(t);else{e={name:t.name,times:qa.convertArray(t.times,Array),values:qa.convertArray(t.values,Array)};var n=t.getInterpolation();n!==t.DefaultInterpolation&&(e.interpolation=n)}return e.type=t.ValueTypeName,e},_getTrackTypeForValueTypeName:function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return es;case"vector":case"vector2":case"vector3":case"vector4":return Qa;case"color":return rs;case"quaternion":return ts;case"bool":case"boolean":return ns;case"string":return is}throw new Error("Unsupported typeName: "+t)}}),Object.assign(ss,{parse:function(t){for(var e=[],i=t.tracks,n=1/(t.fps||1),r=0,a=i.length;r!==a;++r)e.push(as.parse(i[r]).scale(n));return new ss(t.name,t.duration,e)},toJSON:function(t){for(var e=[],i=t.tracks,n={name:t.name,duration:t.duration,tracks:e},r=0,a=i.length;r!==a;++r)e.push(as.toJSON(i[r]));return n},CreateFromMorphTargetSequence:function(t,e,i,n){for(var r=e.length,a=[],s=0;s<r;s++){var o=[],l=[];o.push((s+r-1)%r,s,(s+1)%r),l.push(0,1,0);var h=qa.getKeyframeOrder(o);o=qa.sortedArray(o,1,h),l=qa.sortedArray(l,1,h),n||0!==o[0]||(o.push(r),l.push(l[0])),a.push(new es(".morphTargetInfluences["+e[s].name+"]",o,l).scale(1/i))}return new ss(t,-1,a)},findByName:function(t,e){var i=t;if(!Array.isArray(t)){var n=t;i=n.geometry&&n.geometry.animations||n.animations}for(var r=0;r<i.length;r++)if(i[r].name===e)return i[r];return null},CreateClipsFromMorphTargetSequences:function(t,e,i){for(var n={},r=/^([\w-]*?)([\d]+)$/,a=0,s=t.length;a<s;a++){var o=t[a],l=o.name.match(r);if(l&&l.length>1){var h=n[u=l[1]];h||(n[u]=h=[]),h.push(o)}}var c=[];for(var u in n)c.push(ss.CreateFromMorphTargetSequence(u,n[u],e,i));return c},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var i=function(t,e,i,n,r){if(0!==i.length){var a=[],s=[];qa.flattenJSON(i,a,s,n),0!==a.length&&r.push(new t(e,a,s))}},n=[],r=t.name||"default",a=t.length||-1,s=t.fps||30,o=t.hierarchy||[],l=0;l<o.length;l++){var h=o[l].keys;if(h&&0!==h.length)if(h[0].morphTargets){for(var c={},u=0;u<h.length;u++)if(h[u].morphTargets)for(var d=0;d<h[u].morphTargets.length;d++)c[h[u].morphTargets[d]]=-1;for(var f in c){var p=[],m=[];for(d=0;d!==h[u].morphTargets.length;++d){var g=h[u];p.push(g.time),m.push(g.morphTarget===f?1:0)}n.push(new es(".morphTargetInfluence["+f+"]",p,m))}a=c.length*(s||1)}else{var v=".bones["+e[l].name+"]";i(Qa,v+".position",h,"pos",n),i(ts,v+".quaternion",h,"rot",n),i(Qa,v+".scale",h,"scl",n)}}return 0===n.length?null:new ss(r,a,n)}}),Object.assign(ss.prototype,{resetDuration:function(){for(var t=0,e=0,i=this.tracks.length;e!==i;++e){var n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}this.duration=t},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}}),Object.assign(os.prototype,{load:function(t,e,i,n){var r=this;new Pa(r.manager).load(t,function(t){e(r.parse(JSON.parse(t)))},i,n)},setTextures:function(t){this.textures=t},parse:function(t){var e=this.textures;function i(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}var n=new Ma[t.type];if(void 0!==t.uuid&&(n.uuid=t.uuid),void 0!==t.name&&(n.name=t.name),void 0!==t.color&&n.color.setHex(t.color),void 0!==t.roughness&&(n.roughness=t.roughness),void 0!==t.metalness&&(n.metalness=t.metalness),void 0!==t.emissive&&n.emissive.setHex(t.emissive),void 0!==t.specular&&n.specular.setHex(t.specular),void 0!==t.shininess&&(n.shininess=t.shininess),void 0!==t.clearCoat&&(n.clearCoat=t.clearCoat),void 0!==t.clearCoatRoughness&&(n.clearCoatRoughness=t.clearCoatRoughness),void 0!==t.uniforms&&(n.uniforms=t.uniforms),void 0!==t.vertexShader&&(n.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(n.fragmentShader=t.fragmentShader),void 0!==t.vertexColors&&(n.vertexColors=t.vertexColors),void 0!==t.fog&&(n.fog=t.fog),void 0!==t.flatShading&&(n.flatShading=t.flatShading),void 0!==t.blending&&(n.blending=t.blending),void 0!==t.side&&(n.side=t.side),void 0!==t.opacity&&(n.opacity=t.opacity),void 0!==t.transparent&&(n.transparent=t.transparent),void 0!==t.alphaTest&&(n.alphaTest=t.alphaTest),void 0!==t.depthTest&&(n.depthTest=t.depthTest),void 0!==t.depthWrite&&(n.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(n.colorWrite=t.colorWrite),void 0!==t.wireframe&&(n.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(n.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(n.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(n.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.skinning&&(n.skinning=t.skinning),void 0!==t.morphTargets&&(n.morphTargets=t.morphTargets),void 0!==t.dithering&&(n.dithering=t.dithering),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.shading&&(n.flatShading=1===t.shading),void 0!==t.size&&(n.size=t.size),void 0!==t.sizeAttenuation&&(n.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(n.map=i(t.map)),void 0!==t.alphaMap&&(n.alphaMap=i(t.alphaMap),n.transparent=!0),void 0!==t.bumpMap&&(n.bumpMap=i(t.bumpMap)),void 0!==t.bumpScale&&(n.bumpScale=t.bumpScale),void 0!==t.normalMap&&(n.normalMap=i(t.normalMap)),void 0!==t.normalScale){var r=t.normalScale;!1===Array.isArray(r)&&(r=[r,r]),n.normalScale=(new ve).fromArray(r)}return void 0!==t.displacementMap&&(n.displacementMap=i(t.displacementMap)),void 0!==t.displacementScale&&(n.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(n.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(n.roughnessMap=i(t.roughnessMap)),void 0!==t.metalnessMap&&(n.metalnessMap=i(t.metalnessMap)),void 0!==t.emissiveMap&&(n.emissiveMap=i(t.emissiveMap)),void 0!==t.emissiveIntensity&&(n.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(n.specularMap=i(t.specularMap)),void 0!==t.envMap&&(n.envMap=i(t.envMap)),void 0!==t.reflectivity&&(n.reflectivity=t.reflectivity),void 0!==t.lightMap&&(n.lightMap=i(t.lightMap)),void 0!==t.lightMapIntensity&&(n.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(n.aoMap=i(t.aoMap)),void 0!==t.aoMapIntensity&&(n.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(n.gradientMap=i(t.gradientMap)),n}}),Object.assign(ls.prototype,{load:function(t,e,i,n){var r=this;new Pa(r.manager).load(t,function(t){e(r.parse(JSON.parse(t)))},i,n)},parse:function(t){var e=new Rn,i=t.data.index;if(void 0!==i){var n=new fs[i.type](i.array);e.setIndex(new yn(n,1))}var r=t.data.attributes;for(var a in r){var s=r[a];n=new fs[s.type](s.array);e.addAttribute(a,new yn(n,s.itemSize,s.normalized))}var o=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==o)for(var l=0,h=o.length;l!==h;++l){var c=o[l];e.addGroup(c.start,c.count,c.materialIndex)}var u=t.data.boundingSphere;if(void 0!==u){var d=new Pe;void 0!==u.center&&d.fromArray(u.center),e.boundingSphere=new Gi(d,u.radius)}return e}});var hs,cs,us,ds,fs={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function ps(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}}function ms(t){"boolean"==typeof t&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),t=void 0),this.manager=void 0!==t?t:Ca,this.withCredentials=!1}ps.Handlers={handlers:[],add:function(t,e){this.handlers.push(t,e)},get:function(t){for(var e=this.handlers,i=0,n=e.length;i<n;i+=2){var r=e[i],a=e[i+1];if(r.test(t))return a}return null}},Object.assign(ps.prototype,{crossOrigin:void 0,extractUrlBase:function(t){var e=t.split("/");return 1===e.length?"./":(e.pop(),e.join("/")+"/")},initMaterials:function(t,e,i){for(var n=[],r=0;r<t.length;++r)n[r]=this.createMaterial(t[r],e,i);return n},createMaterial:(hs={NoBlending:I,NormalBlending:C,AdditiveBlending:P,SubtractiveBlending:R,MultiplyBlending:L,CustomBlending:D},cs=new bi,us=new ka,ds=new os,function(t,e,i){var n={};function r(t,r,a,s,o){var l,h=e+t,c=ps.Handlers.get(h);null!==c?l=c.load(h):(us.setCrossOrigin(i),l=us.load(h)),void 0!==r&&(l.repeat.fromArray(r),1!==r[0]&&(l.wrapS=yt),1!==r[1]&&(l.wrapT=yt)),void 0!==a&&l.offset.fromArray(a),void 0!==s&&("repeat"===s[0]&&(l.wrapS=yt),"mirror"===s[0]&&(l.wrapS=xt),"repeat"===s[1]&&(l.wrapT=yt),"mirror"===s[1]&&(l.wrapT=xt)),void 0!==o&&(l.anisotropy=o);var u=ge.generateUUID();return n[u]=l,u}var a={uuid:ge.generateUUID(),type:"MeshLambertMaterial"};for(var s in t){var o=t[s];switch(s){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":a.name=o;break;case"blending":a.blending=hs[o];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",s,"is no longer supported.");break;case"colorDiffuse":a.color=cs.fromArray(o).getHex();break;case"colorSpecular":a.specular=cs.fromArray(o).getHex();break;case"colorEmissive":a.emissive=cs.fromArray(o).getHex();break;case"specularCoef":a.shininess=o;break;case"shading":"basic"===o.toLowerCase()&&(a.type="MeshBasicMaterial"),"phong"===o.toLowerCase()&&(a.type="MeshPhongMaterial"),"standard"===o.toLowerCase()&&(a.type="MeshStandardMaterial");break;case"mapDiffuse":a.map=r(o,t.mapDiffuseRepeat,t.mapDiffuseOffset,t.mapDiffuseWrap,t.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":a.emissiveMap=r(o,t.mapEmissiveRepeat,t.mapEmissiveOffset,t.mapEmissiveWrap,t.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":a.lightMap=r(o,t.mapLightRepeat,t.mapLightOffset,t.mapLightWrap,t.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":a.aoMap=r(o,t.mapAORepeat,t.mapAOOffset,t.mapAOWrap,t.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":a.bumpMap=r(o,t.mapBumpRepeat,t.mapBumpOffset,t.mapBumpWrap,t.mapBumpAnisotropy);break;case"mapBumpScale":a.bumpScale=o;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":a.normalMap=r(o,t.mapNormalRepeat,t.mapNormalOffset,t.mapNormalWrap,t.mapNormalAnisotropy);break;case"mapNormalFactor":a.normalScale=[o,o];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":a.specularMap=r(o,t.mapSpecularRepeat,t.mapSpecularOffset,t.mapSpecularWrap,t.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":a.metalnessMap=r(o,t.mapMetalnessRepeat,t.mapMetalnessOffset,t.mapMetalnessWrap,t.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":a.roughnessMap=r(o,t.mapRoughnessRepeat,t.mapRoughnessOffset,t.mapRoughnessWrap,t.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":a.alphaMap=r(o,t.mapAlphaRepeat,t.mapAlphaOffset,t.mapAlphaWrap,t.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":a.side=E;break;case"doubleSided":a.side=S;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),a.opacity=o;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":a[s]=o;break;case"vertexColors":!0===o&&(a.vertexColors=A),"face"===o&&(a.vertexColors=M);break;default:console.error("THREE.Loader.createMaterial: Unsupported",s,o)}}return"MeshBasicMaterial"===a.type&&delete a.emissive,"MeshPhongMaterial"!==a.type&&delete a.specular,a.opacity<1&&(a.transparent=!0),ds.setTextures(n),ds.parse(a)})}),Object.assign(ms.prototype,{load:function(t,e,i,n){var r=this,a=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:ps.prototype.extractUrlBase(t),s=new Pa(this.manager);s.setWithCredentials(this.withCredentials),s.load(t,function(i){var n=JSON.parse(i),s=n.metadata;if(void 0!==s){var o=s.type;if(void 0!==o){if("object"===o.toLowerCase())return void console.error("THREE.JSONLoader: "+t+" should be loaded with THREE.ObjectLoader instead.");if("scene"===o.toLowerCase())return void console.error("THREE.JSONLoader: "+t+" should be loaded with THREE.SceneLoader instead.")}}var l=r.parse(n,a);e(l.geometry,l.materials)},i,n)},setTexturePath:function(t){this.texturePath=t},parse:function(){return function(t,e){void 0!==t.data&&(t=t.data),void 0!==t.scale?t.scale=1/t.scale:t.scale=1;var i=new _n;return function(t,e){function i(t,e){return t&1<<e}var n,r,a,s,o,l,h,c,u,d,f,p,m,g,v,_,y,b,x,w,E,S,T,M,A,I=t.faces,C=t.vertices,P=t.normals,R=t.colors,L=t.scale,D=0;if(void 0!==t.uvs){for(n=0;n<t.uvs.length;n++)t.uvs[n].length&&D++;for(n=0;n<D;n++)e.faceVertexUvs[n]=[]}for(s=0,o=C.length;s<o;)(b=new Pe).x=C[s++]*L,b.y=C[s++]*L,b.z=C[s++]*L,e.vertices.push(b);for(s=0,o=I.length;s<o;)if(f=i(d=I[s++],0),p=i(d,1),m=i(d,3),g=i(d,4),v=i(d,5),_=i(d,6),y=i(d,7),f){if((w=new sn).a=I[s],w.b=I[s+1],w.c=I[s+3],(E=new sn).a=I[s+1],E.b=I[s+2],E.c=I[s+3],s+=4,p&&(u=I[s++],w.materialIndex=u,E.materialIndex=u),a=e.faces.length,m)for(n=0;n<D;n++)for(M=t.uvs[n],e.faceVertexUvs[n][a]=[],e.faceVertexUvs[n][a+1]=[],r=0;r<4;r++)A=new ve(M[2*(c=I[s++])],M[2*c+1]),2!==r&&e.faceVertexUvs[n][a].push(A),0!==r&&e.faceVertexUvs[n][a+1].push(A);if(g&&(h=3*I[s++],w.normal.set(P[h++],P[h++],P[h]),E.normal.copy(w.normal)),v)for(n=0;n<4;n++)h=3*I[s++],T=new Pe(P[h++],P[h++],P[h]),2!==n&&w.vertexNormals.push(T),0!==n&&E.vertexNormals.push(T);if(_&&(S=R[l=I[s++]],w.color.setHex(S),E.color.setHex(S)),y)for(n=0;n<4;n++)S=R[l=I[s++]],2!==n&&w.vertexColors.push(new bi(S)),0!==n&&E.vertexColors.push(new bi(S));e.faces.push(w),e.faces.push(E)}else{if((x=new sn).a=I[s++],x.b=I[s++],x.c=I[s++],p&&(u=I[s++],x.materialIndex=u),a=e.faces.length,m)for(n=0;n<D;n++)for(M=t.uvs[n],e.faceVertexUvs[n][a]=[],r=0;r<3;r++)A=new ve(M[2*(c=I[s++])],M[2*c+1]),e.faceVertexUvs[n][a].push(A);if(g&&(h=3*I[s++],x.normal.set(P[h++],P[h++],P[h])),v)for(n=0;n<3;n++)h=3*I[s++],T=new Pe(P[h++],P[h++],P[h]),x.vertexNormals.push(T);if(_&&(l=I[s++],x.color.setHex(R[l])),y)for(n=0;n<3;n++)l=I[s++],x.vertexColors.push(new bi(R[l]));e.faces.push(x)}}(t,i),function(t,e){var i=void 0!==t.influencesPerVertex?t.influencesPerVertex:2;if(t.skinWeights)for(var n=0,r=t.skinWeights.length;n<r;n+=i){var a=t.skinWeights[n],s=i>1?t.skinWeights[n+1]:0,o=i>2?t.skinWeights[n+2]:0,l=i>3?t.skinWeights[n+3]:0;e.skinWeights.push(new Me(a,s,o,l))}if(t.skinIndices)for(n=0,r=t.skinIndices.length;n<r;n+=i){var h=t.skinIndices[n],c=i>1?t.skinIndices[n+1]:0,u=i>2?t.skinIndices[n+2]:0,d=i>3?t.skinIndices[n+3]:0;e.skinIndices.push(new Me(h,c,u,d))}e.bones=t.bones,e.bones&&e.bones.length>0&&(e.skinWeights.length!==e.skinIndices.length||e.skinIndices.length!==e.vertices.length)&&console.warn("When skinning, number of vertices ("+e.vertices.length+"), skinIndices ("+e.skinIndices.length+"), and skinWeights ("+e.skinWeights.length+") should match.")}(t,i),function(t,e){var i=t.scale;if(void 0!==t.morphTargets)for(var n=0,r=t.morphTargets.length;n<r;n++){e.morphTargets[n]={},e.morphTargets[n].name=t.morphTargets[n].name,e.morphTargets[n].vertices=[];for(var a=e.morphTargets[n].vertices,s=t.morphTargets[n].vertices,o=0,l=s.length;o<l;o+=3){var h=new Pe;h.x=s[o]*i,h.y=s[o+1]*i,h.z=s[o+2]*i,a.push(h)}}if(void 0!==t.morphColors&&t.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');var c=e.faces,u=t.morphColors[0].colors;for(n=0,r=c.length;n<r;n++)c[n].color.fromArray(u,3*n)}}(t,i),function(t,e){var i=[],n=[];void 0!==t.animation&&n.push(t.animation),void 0!==t.animations&&(t.animations.length?n=n.concat(t.animations):n.push(t.animations));for(var r=0;r<n.length;r++){var a=ss.parseAnimation(n[r],e.bones);a&&i.push(a)}if(e.morphTargets){var s=ss.CreateClipsFromMorphTargetSequences(e.morphTargets,10);i=i.concat(s)}i.length>0&&(e.animations=i)}(t,i),i.computeFaceNormals(),i.computeBoundingSphere(),void 0===t.materials||0===t.materials.length?{geometry:i}:{geometry:i,materials:ps.prototype.initMaterials(t.materials,e,this.crossOrigin)}}}()}),Object.assign(function(t){this.manager=void 0!==t?t:Ca,this.texturePath=""}.prototype,{load:function(t,e,i,n){""===this.texturePath&&(this.texturePath=t.substring(0,t.lastIndexOf("/")+1));var r=this;new Pa(r.manager).load(t,function(i){var a=null;try{a=JSON.parse(i)}catch(e){return void 0!==n&&n(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}var s=a.metadata;void 0!==s&&void 0!==s.type&&"geometry"!==s.type.toLowerCase()?r.parse(a,e):console.error("THREE.ObjectLoader: Can't load "+t+". Use THREE.JSONLoader instead.")},i,n)},setTexturePath:function(t){this.texturePath=t},setCrossOrigin:function(t){this.crossOrigin=t},parse:function(t,e){var i=this.parseGeometries(t.geometries),n=this.parseImages(t.images,function(){void 0!==e&&e(s)}),r=this.parseTextures(t.textures,n),a=this.parseMaterials(t.materials,r),s=this.parseObject(t.object,i,a);return t.animations&&(s.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(s),s},parseGeometries:function(t){var e={};if(void 0!==t)for(var i=new ms,n=new ls,r=0,a=t.length;r<a;r++){var s,o=t[r];switch(o.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new ga[o.type](o.width,o.height,o.widthSegments,o.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":s=new ga[o.type](o.width,o.height,o.depth,o.widthSegments,o.heightSegments,o.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new ga[o.type](o.radius,o.segments,o.thetaStart,o.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new ga[o.type](o.radiusTop,o.radiusBottom,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new ga[o.type](o.radius,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new ga[o.type](o.radius,o.widthSegments,o.heightSegments,o.phiStart,o.phiLength,o.thetaStart,o.thetaLength);break;case"DodecahedronGeometry":case"IcosahedronGeometry":case"OctahedronGeometry":case"TetrahedronGeometry":s=new ga[o.type](o.radius,o.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new ga[o.type](o.innerRadius,o.outerRadius,o.thetaSegments,o.phiSegments,o.thetaStart,o.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new ga[o.type](o.radius,o.tube,o.radialSegments,o.tubularSegments,o.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new ga[o.type](o.radius,o.tube,o.tubularSegments,o.radialSegments,o.p,o.q);break;case"LatheGeometry":case"LatheBufferGeometry":s=new ga[o.type](o.points,o.segments,o.phiStart,o.phiLength);break;case"BufferGeometry":s=n.parse(o);break;case"Geometry":s=i.parse(o,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+o.type+'"');continue}s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),e[o.uuid]=s}return e},parseMaterials:function(t,e){var i={};if(void 0!==t){var n=new os;n.setTextures(e);for(var r=0,a=t.length;r<a;r++){var s=t[r];if("MultiMaterial"===s.type){for(var o=[],l=0;l<s.materials.length;l++)o.push(n.parse(s.materials[l]));i[s.uuid]=o}else i[s.uuid]=n.parse(s)}}return i},parseAnimations:function(t){for(var e=[],i=0;i<t.length;i++){var n=ss.parse(t[i]);e.push(n)}return e},parseImages:function(t,e){var i=this,n={};function r(t){return i.manager.itemStart(t),a.load(t,function(){i.manager.itemEnd(t)},void 0,function(){i.manager.itemEnd(t),i.manager.itemError(t)})}if(void 0!==t&&t.length>0){var a=new La(new Ia(e));a.setCrossOrigin(this.crossOrigin);for(var s=0,o=t.length;s<o;s++){var l=t[s],h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:i.texturePath+l.url;n[l.uuid]=r(h)}}return n},parseTextures:function(t,e){function i(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}var n={};if(void 0!==t)for(var r=0,a=t.length;r<a;r++){var s=t[r];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);var o=new Te(e[s.image]);o.needsUpdate=!0,o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.mapping&&(o.mapping=i(s.mapping,gs)),void 0!==s.offset&&o.offset.fromArray(s.offset),void 0!==s.repeat&&o.repeat.fromArray(s.repeat),void 0!==s.wrap&&(o.wrapS=i(s.wrap[0],vs),o.wrapT=i(s.wrap[1],vs)),void 0!==s.minFilter&&(o.minFilter=i(s.minFilter,_s)),void 0!==s.magFilter&&(o.magFilter=i(s.magFilter,_s)),void 0!==s.anisotropy&&(o.anisotropy=s.anisotropy),void 0!==s.flipY&&(o.flipY=s.flipY),n[s.uuid]=o}return n},parseObject:function(){var t=new Re;return function(e,i,n){var r;function a(t){return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),i[t]}function s(t){if(void 0!==t){if(Array.isArray(t)){for(var e=[],i=0,r=t.length;i<r;i++){var a=t[i];void 0===n[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),e.push(n[a])}return e}return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}}switch(e.type){case"Scene":r=new fr,void 0!==e.background&&Number.isInteger(e.background)&&(r.background=new bi(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?r.fog=new dr(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(r.fog=new ur(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":r=new an(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(r.focus=e.focus),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.filmGauge&&(r.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(r.filmOffset=e.filmOffset),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"OrthographicCamera":r=new rn(e.left,e.right,e.top,e.bottom,e.near,e.far);break;case"AmbientLight":r=new ja(e.color,e.intensity);break;case"DirectionalLight":r=new Ga(e.color,e.intensity);break;case"PointLight":r=new za(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":r=new Va(e.color,e.intensity,e.width,e.height);break;case"SpotLight":r=new Ba(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":r=new Na(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var o=a(e.geometry),l=s(e.material);r=o.bones&&o.bones.length>0?new br(o,l):new zn(o,l);break;case"LOD":r=new vr;break;case"Line":r=new wr(a(e.geometry),s(e.material),e.mode);break;case"LineLoop":r=new Sr(a(e.geometry),s(e.material));break;case"LineSegments":r=new Er(a(e.geometry),s(e.material));break;case"PointCloud":case"Points":r=new Mr(a(e.geometry),s(e.material));break;case"Sprite":r=new gr(s(e.material));break;case"Group":r=new Ar;break;default:r=new en}if(r.uuid=e.uuid,void 0!==e.name&&(r.name=e.name),void 0!==e.matrix?(t.fromArray(e.matrix),t.decompose(r.position,r.quaternion,r.scale)):(void 0!==e.position&&r.position.fromArray(e.position),void 0!==e.rotation&&r.rotation.fromArray(e.rotation),void 0!==e.quaternion&&r.quaternion.fromArray(e.quaternion),void 0!==e.scale&&r.scale.fromArray(e.scale)),void 0!==e.castShadow&&(r.castShadow=e.castShadow),void 0!==e.receiveShadow&&(r.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(r.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(r.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&r.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(r.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.children)for(var h=e.children,c=0;c<h.length;c++)r.add(this.parseObject(h[c],i,n));if("LOD"===e.type)for(var u=e.levels,d=0;d<u.length;d++){var f=u[d],p=r.getObjectByProperty("uuid",f.object);void 0!==p&&r.addLevel(p,f.distance)}return r}}()});var gs={UVMapping:300,CubeReflectionMapping:dt,CubeRefractionMapping:ft,EquirectangularReflectionMapping:pt,EquirectangularRefractionMapping:mt,SphericalReflectionMapping:gt,CubeUVReflectionMapping:vt,CubeUVRefractionMapping:_t},vs={RepeatWrapping:yt,ClampToEdgeWrapping:bt,MirroredRepeatWrapping:xt},_s={NearestFilter:wt,NearestMipMapNearestFilter:Et,NearestMipMapLinearFilter:St,LinearFilter:Tt,LinearMipMapNearestFilter:Mt,LinearMipMapLinearFilter:At};function ys(t,e,i,n,r){var a=.5*(n-e),s=.5*(r-i),o=t*t;return(2*i-2*n+a+s)*(t*o)+(-3*i+3*n-2*a-s)*o+a*t+i}function bs(t,e,i,n){return function(t,e){var i=1-t;return i*i*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,i)+function(t,e){return t*t*e}(t,n)}function xs(t,e,i,n,r){return function(t,e){var i=1-t;return i*i*i*e}(t,e)+function(t,e){var i=1-t;return 3*i*i*t*e}(t,i)+function(t,e){return 3*(1-t)*t*t*e}(t,n)+function(t,e){return t*t*t*e}(t,r)}function ws(){this.arcLengthDivisions=200}function Es(t,e){ws.call(this),this.v1=t,this.v2=e}function Ss(){ws.call(this),this.curves=[],this.autoClose=!1}function Ts(t,e,i,n,r,a,s,o){ws.call(this),this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=a,this.aClockwise=s,this.aRotation=o||0}function Ms(t){ws.call(this),this.points=void 0===t?[]:t}function As(t,e,i,n){ws.call(this),this.v0=t,this.v1=e,this.v2=i,this.v3=n}function Is(t,e,i){ws.call(this),this.v0=t,this.v1=e,this.v2=i}Object.assign(ws.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t){var e=this.getUtoTmapping(t);return this.getPoint(e)},getPoints:function(t){void 0===t&&(t=5);for(var e=[],i=0;i<=t;i++)e.push(this.getPoint(i/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);for(var e=[],i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,i,n=[],r=this.getPoint(0),a=0;for(n.push(0),i=1;i<=t;i++)a+=(e=this.getPoint(i/t)).distanceTo(r),n.push(a),r=e;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var i,n=this.getLengths(),r=0,a=n.length;i=e||t*n[a-1];for(var s,o=0,l=a-1;o<=l;)if((s=n[r=Math.floor(o+(l-o)/2)]-i)<0)o=r+1;else{if(!(s>0)){l=r;break}l=r-1}if(n[r=l]===i)return r/(a-1);var h=n[r];return(r+(i-h)/(n[r+1]-h))/(a-1)},getTangent:function(t){var e=t-1e-4,i=t+1e-4;e<0&&(e=0),i>1&&(i=1);var n=this.getPoint(e);return this.getPoint(i).clone().sub(n).normalize()},getTangentAt:function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)},computeFrenetFrames:function(t,e){var i,n,r,a=new Pe,s=[],o=[],l=[],h=new Pe,c=new Re;for(i=0;i<=t;i++)n=i/t,s[i]=this.getTangentAt(n),s[i].normalize();o[0]=new Pe,l[0]=new Pe;var u=Number.MAX_VALUE,d=Math.abs(s[0].x),f=Math.abs(s[0].y),p=Math.abs(s[0].z);for(d<=u&&(u=d,a.set(1,0,0)),f<=u&&(u=f,a.set(0,1,0)),p<=u&&a.set(0,0,1),h.crossVectors(s[0],a).normalize(),o[0].crossVectors(s[0],h),l[0].crossVectors(s[0],o[0]),i=1;i<=t;i++)o[i]=o[i-1].clone(),l[i]=l[i-1].clone(),h.crossVectors(s[i-1],s[i]),h.length()>Number.EPSILON&&(h.normalize(),r=Math.acos(ge.clamp(s[i-1].dot(s[i]),-1,1)),o[i].applyMatrix4(c.makeRotationAxis(h,r))),l[i].crossVectors(s[i],o[i]);if(!0===e)for(r=Math.acos(ge.clamp(o[0].dot(o[t]),-1,1)),r/=t,s[0].dot(h.crossVectors(o[0],o[t]))>0&&(r=-r),i=1;i<=t;i++)o[i].applyMatrix4(c.makeRotationAxis(s[i],r*i)),l[i].crossVectors(s[i],o[i]);return{tangents:s,normals:o,binormals:l}}}),Es.prototype=Object.create(ws.prototype),Es.prototype.constructor=Es,Es.prototype.isLineCurve=!0,Es.prototype.getPoint=function(t){if(1===t)return this.v2.clone();var e=this.v2.clone().sub(this.v1);return e.multiplyScalar(t).add(this.v1),e},Es.prototype.getPointAt=function(t){return this.getPoint(t)},Es.prototype.getTangent=function(t){return this.v2.clone().sub(this.v1).normalize()},Ss.prototype=Object.assign(Object.create(ws.prototype),{constructor:Ss,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Es(e,t))},getPoint:function(t){for(var e=t*this.getLength(),i=this.getCurveLengths(),n=0;n<i.length;){if(i[n]>=e){var r=i[n]-e,a=this.curves[n],s=a.getLength(),o=0===s?0:1-r/s;return a.getPointAt(o)}n++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);for(var e=[],i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e,i=[],n=0,r=this.curves;n<r.length;n++)for(var a=r[n],s=a&&a.isEllipseCurve?2*t:a&&a.isLineCurve?1:a&&a.isSplineCurve?t*a.points.length:t,o=a.getPoints(s),l=0;l<o.length;l++){var h=o[l];e&&e.equals(h)||(i.push(h),e=h)}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i},createPointsGeometry:function(t){var e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){var e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){for(var e=new _n,i=0,n=t.length;i<n;i++){var r=t[i];e.vertices.push(new Pe(r.x,r.y,r.z||0))}return e}}),Ts.prototype=Object.create(ws.prototype),Ts.prototype.constructor=Ts,Ts.prototype.isEllipseCurve=!0,Ts.prototype.getPoint=function(t){for(var e=2*Math.PI,i=this.aEndAngle-this.aStartAngle,n=Math.abs(i)<Number.EPSILON;i<0;)i+=e;for(;i>e;)i-=e;i<Number.EPSILON&&(i=n?0:e),!0!==this.aClockwise||n||(i===e?i=-e:i-=e);var r=this.aStartAngle+t*i,a=this.aX+this.xRadius*Math.cos(r),s=this.aY+this.yRadius*Math.sin(r);if(0!==this.aRotation){var o=Math.cos(this.aRotation),l=Math.sin(this.aRotation),h=a-this.aX,c=s-this.aY;a=h*o-c*l+this.aX,s=h*l+c*o+this.aY}return new ve(a,s)},Ms.prototype=Object.create(ws.prototype),Ms.prototype.constructor=Ms,Ms.prototype.isSplineCurve=!0,Ms.prototype.getPoint=function(t){var e=this.points,i=(e.length-1)*t,n=Math.floor(i),r=i-n,a=e[0===n?n:n-1],s=e[n],o=e[n>e.length-2?e.length-1:n+1],l=e[n>e.length-3?e.length-1:n+2];return new ve(ys(r,a.x,s.x,o.x,l.x),ys(r,a.y,s.y,o.y,l.y))},As.prototype=Object.create(ws.prototype),As.prototype.constructor=As,As.prototype.getPoint=function(t){var e=this.v0,i=this.v1,n=this.v2,r=this.v3;return new ve(xs(t,e.x,i.x,n.x,r.x),xs(t,e.y,i.y,n.y,r.y))},Is.prototype=Object.create(ws.prototype),Is.prototype.constructor=Is,Is.prototype.getPoint=function(t){var e=this.v0,i=this.v1,n=this.v2;return new ve(bs(t,e.x,i.x,n.x),bs(t,e.y,i.y,n.y))};var Cs,Ps=Object.assign(Object.create(Ss.prototype),{fromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y)},moveTo:function(t,e){this.currentPoint.set(t,e)},lineTo:function(t,e){var i=new Es(this.currentPoint.clone(),new ve(t,e));this.curves.push(i),this.currentPoint.set(t,e)},quadraticCurveTo:function(t,e,i,n){var r=new Is(this.currentPoint.clone(),new ve(t,e),new ve(i,n));this.curves.push(r),this.currentPoint.set(i,n)},bezierCurveTo:function(t,e,i,n,r,a){var s=new As(this.currentPoint.clone(),new ve(t,e),new ve(i,n),new ve(r,a));this.curves.push(s),this.currentPoint.set(r,a)},splineThru:function(t){var e=new Ms([this.currentPoint.clone()].concat(t));this.curves.push(e),this.currentPoint.copy(t[t.length-1])},arc:function(t,e,i,n,r,a){var s=this.currentPoint.x,o=this.currentPoint.y;this.absarc(t+s,e+o,i,n,r,a)},absarc:function(t,e,i,n,r,a){this.absellipse(t,e,i,i,n,r,a)},ellipse:function(t,e,i,n,r,a,s,o){var l=this.currentPoint.x,h=this.currentPoint.y;this.absellipse(t+l,e+h,i,n,r,a,s,o)},absellipse:function(t,e,i,n,r,a,s,o){var l=new Ts(t,e,i,n,r,a,s,o);if(this.curves.length>0){var h=l.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(l);var c=l.getPoint(1);this.currentPoint.copy(c)}});function Rs(t){Ss.call(this),this.currentPoint=new ve,t&&this.fromPoints(t)}function Ls(){Rs.apply(this,arguments),this.holes=[]}function Ds(){this.subPaths=[],this.currentPath=null}function ks(t){this.data=t}Rs.prototype=Ps,Ps.constructor=Rs,Ls.prototype=Object.assign(Object.create(Ps),{constructor:Ls,getPointsHoles:function(t){for(var e=[],i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e},extractAllPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},extractPoints:function(t){return this.extractAllPoints(t)}}),Object.assign(Ds.prototype,{moveTo:function(t,e){this.currentPath=new Rs,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e)},lineTo:function(t,e){this.currentPath.lineTo(t,e)},quadraticCurveTo:function(t,e,i,n){this.currentPath.quadraticCurveTo(t,e,i,n)},bezierCurveTo:function(t,e,i,n,r,a){this.currentPath.bezierCurveTo(t,e,i,n,r,a)},splineThru:function(t){this.currentPath.splineThru(t)},toShapes:function(t,e){function i(t){for(var e=[],i=0,n=t.length;i<n;i++){var r=t[i],a=new Ls;a.curves=r.curves,e.push(a)}return e}function n(t,e){for(var i=e.length,n=!1,r=i-1,a=0;a<i;r=a++){var s=e[r],o=e[a],l=o.x-s.x,h=o.y-s.y;if(Math.abs(h)>Number.EPSILON){if(h<0&&(s=e[a],l=-l,o=e[r],h=-h),t.y<s.y||t.y>o.y)continue;if(t.y===s.y){if(t.x===s.x)return!0}else{var c=h*(t.x-s.x)-l*(t.y-s.y);if(0===c)return!0;if(c<0)continue;n=!n}}else{if(t.y!==s.y)continue;if(o.x<=t.x&&t.x<=s.x||s.x<=t.x&&t.x<=o.x)return!0}}return n}var r=Jr.isClockWise,a=this.subPaths;if(0===a.length)return[];if(!0===e)return i(a);var s,o,l,h=[];if(1===a.length)return o=a[0],(l=new Ls).curves=o.curves,h.push(l),h;var c=!r(a[0].getPoints());c=t?!c:c;var u,d,f=[],p=[],m=[],g=0;p[g]=void 0,m[g]=[];for(var v=0,_=a.length;v<_;v++)s=r(u=(o=a[v]).getPoints()),(s=t?!s:s)?(!c&&p[g]&&g++,p[g]={s:new Ls,p:u},p[g].s.curves=o.curves,c&&g++,m[g]=[]):m[g].push({h:o,p:u[0]});if(!p[0])return i(a);if(p.length>1){for(var y=!1,b=[],x=0,w=p.length;x<w;x++)f[x]=[];for(x=0,w=p.length;x<w;x++)for(var E=m[x],S=0;S<E.length;S++){for(var T=E[S],M=!0,A=0;A<p.length;A++)n(T.p,p[A].p)&&(x!==A&&b.push({froms:x,tos:A,hole:S}),M?(M=!1,f[A].push(T)):y=!0);M&&f[x].push(T)}b.length>0&&(y||(m=f))}v=0;for(var I=p.length;v<I;v++){l=p[v].s,h.push(l);for(var C=0,P=(d=m[v]).length;C<P;C++)l.holes.push(d[C].h)}return h}}),Object.assign(ks.prototype,{isFont:!0,generateShapes:function(t,e,i){function n(t,e,n,a){var s=r.glyphs[t]||r.glyphs["?"];if(s){var o,l,h,c,u,d,f,p,m,g,v,_=new Ds,y=[];if(s.o)for(var b=s._cachedOutline||(s._cachedOutline=s.o.split(" ")),x=0,w=b.length;x<w;){switch(b[x++]){case"m":o=b[x++]*e+n,l=b[x++]*e+a,_.moveTo(o,l);break;case"l":o=b[x++]*e+n,l=b[x++]*e+a,_.lineTo(o,l);break;case"q":if(h=b[x++]*e+n,c=b[x++]*e+a,f=b[x++]*e+n,p=b[x++]*e+a,_.quadraticCurveTo(f,p,h,c),v=y[y.length-1]){u=v.x,d=v.y;for(var E=1;E<=i;E++){bs(S=E/i,u,f,h),bs(S,d,p,c)}}break;case"b":if(h=b[x++]*e+n,c=b[x++]*e+a,f=b[x++]*e+n,p=b[x++]*e+a,m=b[x++]*e+n,g=b[x++]*e+a,_.bezierCurveTo(f,p,m,g,h,c),v=y[y.length-1]){u=v.x,d=v.y;for(E=1;E<=i;E++){var S;xs(S=E/i,u,f,m,h),xs(S,d,p,g,c)}}}}return{offsetX:s.ha*e,path:_}}}void 0===e&&(e=100),void 0===i&&(i=4);for(var r=this.data,a=function(t){for(var i=String(t).split(""),a=e/r.resolution,s=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*a,o=0,l=0,h=[],c=0;c<i.length;c++){var u=i[c];if("\n"===u)o=0,l-=s;else{var d=n(u,a,o,l);o+=d.offsetX,h.push(d.path)}}return h}(t),s=[],o=0,l=a.length;o<l;o++)Array.prototype.push.apply(s,a[o].toShapes());return s}}),Object.assign(function(t){this.manager=void 0!==t?t:Ca}.prototype,{load:function(t,e,i,n){var r=this;new Pa(this.manager).load(t,function(t){var i;try{i=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(t.substring(65,t.length-2))}var n=r.parse(i);e&&e(n)},i,n)},parse:function(t){return new ks(t)}});var Os,Ns,Us,Fs,Bs,zs,Hs,Gs,js,Vs,Ws,qs,Xs,Ys,Zs,Js,Ks={getContext:function(){return void 0===Cs&&(Cs=new(window.AudioContext||window.webkitAudioContext)),Cs},setContext:function(t){Cs=t}};function Qs(t){this.manager=void 0!==t?t:Ca}function $s(t,e,i){en.call(this),this.type="CubeCamera";var n=new an(90,1,t,e);n.up.set(0,-1,0),n.lookAt(new Pe(1,0,0)),this.add(n);var r=new an(90,1,t,e);r.up.set(0,-1,0),r.lookAt(new Pe(-1,0,0)),this.add(r);var a=new an(90,1,t,e);a.up.set(0,0,1),a.lookAt(new Pe(0,1,0)),this.add(a);var s=new an(90,1,t,e);s.up.set(0,0,-1),s.lookAt(new Pe(0,-1,0)),this.add(s);var o=new an(90,1,t,e);o.up.set(0,-1,0),o.lookAt(new Pe(0,0,1)),this.add(o);var l=new an(90,1,t,e);l.up.set(0,-1,0),l.lookAt(new Pe(0,0,-1)),this.add(l);var h={format:Ht,magFilter:Tt,minFilter:Tt};this.renderTarget=new Ie(i,i,h),this.renderTarget.texture.name="CubeCamera",this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();var i=this.renderTarget,h=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,i.activeCubeFace=0,t.render(e,n,i),i.activeCubeFace=1,t.render(e,r,i),i.activeCubeFace=2,t.render(e,a,i),i.activeCubeFace=3,t.render(e,s,i),i.activeCubeFace=4,t.render(e,o,i),i.texture.generateMipmaps=h,i.activeCubeFace=5,t.render(e,l,i),t.setRenderTarget(null)},this.clear=function(t,e,i,n){for(var r=this.renderTarget,a=0;a<6;a++)r.activeCubeFace=a,t.setRenderTarget(r),t.clear(e,i,n);t.setRenderTarget(null)}}function to(){en.call(this),this.type="AudioListener",this.context=Ks.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function eo(t){en.call(this),this.type="Audio",this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function io(t){eo.call(this,t),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function no(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}function ro(t,e,i){this.binding=t,this.valueSize=i;var n,r=Float64Array;switch(e){case"quaternion":n=this._slerp;break;case"string":case"bool":r=Array,n=this._select;break;default:n=this._lerp}this.buffer=new r(4*i),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function ao(t,e,i){var n=i||so.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}function so(t,e,i){this.path=e,this.parsedPath=i||so.parseTrackName(e),this.node=so.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function oo(t,e,i){this._mixer=t,this._clip=e,this._localRoot=i||null;for(var n=e.tracks,r=n.length,a=new Array(r),s={endingStart:ne,endingEnd:ne},o=0;o!==r;++o){var l=n[o].createInterpolant(null);a[o]=l,l.settings=s}this._interpolantSettings=s,this._interpolants=a,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=ie,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function lo(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}function ho(){Rn.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function co(t,e,i,n){this.uuid=ge.generateUUID(),this.data=t,this.itemSize=e,this.offset=i,this.normalized=!0===n}function uo(t,e){this.uuid=ge.generateUUID(),this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function fo(t,e,i){uo.call(this,t,e),this.meshPerAttribute=i||1}function po(t,e,i){yn.call(this,t,e),this.meshPerAttribute=i||1}function mo(t,e){return t.distance-e.distance}function go(t,e,i,n){if(!1!==t.visible&&(t.raycast(e,i),!0===n))for(var r=t.children,a=0,s=r.length;a<s;a++)go(r[a],e,i,!0)}function vo(t){en.call(this),this.material=t,this.render=function(t){}}function _o(t,e,i,n){this.object=t,this.size=void 0!==e?e:1;var r=void 0!==i?i:16711680,a=void 0!==n?n:1,s=0,o=this.object.geometry;o&&o.isGeometry?s=3*o.faces.length:o&&o.isBufferGeometry&&(s=o.attributes.normal.count);var l=new Rn,h=new An(2*s*3,3);l.addAttribute("position",h),Er.call(this,l,new xr({color:r,linewidth:a})),this.matrixAutoUpdate=!1,this.update()}function yo(t,e){en.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;for(var i=new Rn,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],r=0,a=1;r<32;r++,a++){var s=r/32*Math.PI*2,o=a/32*Math.PI*2;n.push(Math.cos(s),Math.sin(s),1,Math.cos(o),Math.sin(o),1)}i.addAttribute("position",new An(n,3));var l=new xr({fog:!1});this.cone=new Er(i,l),this.add(this.cone),this.update()}function bo(t){for(var e=function t(e){var i=[];e&&e.isBone&&i.push(e);for(var n=0;n<e.children.length;n++)i.push.apply(i,t(e.children[n]));return i}(t),i=new Rn,n=[],r=[],a=new bi(0,0,1),s=new bi(0,1,0),o=0;o<e.length;o++){var l=e[o];l.parent&&l.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(a.r,a.g,a.b),r.push(s.r,s.g,s.b))}i.addAttribute("position",new An(n,3)),i.addAttribute("color",new An(r,3));var h=new xr({vertexColors:A,depthTest:!1,depthWrite:!1,transparent:!0});Er.call(this,i,h),this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.onBeforeRender()}function xo(t,e,i){this.light=t,this.light.updateMatrixWorld(),this.color=i;var n=new ia(e,4,2),r=new Nn({wireframe:!0,fog:!1});zn.call(this,n,r),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function wo(t,e){en.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;var i=new xr({fog:!1}),n=new Rn;n.addAttribute("position",new yn(new Float32Array(15),3)),this.line=new wr(n,i),this.add(this.line),this.update()}function Eo(t,e,i){en.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;var n=new Br(e);n.rotateY(.5*Math.PI),this.material=new Nn({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=A);var r=n.getAttribute("position"),a=new Float32Array(3*r.count);n.addAttribute("color",new yn(a,3)),this.add(new zn(n,this.material)),this.update()}function So(t,e,i,n){t=t||10,e=e||10,i=new bi(void 0!==i?i:4473924),n=new bi(void 0!==n?n:8947848);for(var r=e/2,a=t/e,s=t/2,o=[],l=[],h=0,c=0,u=-s;h<=e;h++,u+=a){o.push(-s,0,u,s,0,u),o.push(u,0,-s,u,0,s);var d=h===r?i:n;d.toArray(l,c),c+=3,d.toArray(l,c),c+=3,d.toArray(l,c),c+=3,d.toArray(l,c),c+=3}var f=new Rn;f.addAttribute("position",new An(o,3)),f.addAttribute("color",new An(l,3));var p=new xr({vertexColors:A});Er.call(this,f,p)}function To(t,e,i,n,r,a){t=t||10,e=e||16,i=i||8,n=n||64,r=new bi(void 0!==r?r:4473924),a=new bi(void 0!==a?a:8947848);var s,o,l,h,c,u,d,f=[],p=[];for(h=0;h<=e;h++)l=h/e*(2*Math.PI),s=Math.sin(l)*t,o=Math.cos(l)*t,f.push(0,0,0),f.push(s,0,o),d=1&h?r:a,p.push(d.r,d.g,d.b),p.push(d.r,d.g,d.b);for(h=0;h<=i;h++)for(d=1&h?r:a,u=t-t/i*h,c=0;c<n;c++)l=c/n*(2*Math.PI),s=Math.sin(l)*u,o=Math.cos(l)*u,f.push(s,0,o),p.push(d.r,d.g,d.b),l=(c+1)/n*(2*Math.PI),s=Math.sin(l)*u,o=Math.cos(l)*u,f.push(s,0,o),p.push(d.r,d.g,d.b);var m=new Rn;m.addAttribute("position",new An(f,3)),m.addAttribute("color",new An(p,3));var g=new xr({vertexColors:A});Er.call(this,m,g)}function Mo(t,e,i,n){this.object=t,this.size=void 0!==e?e:1;var r=void 0!==i?i:16776960,a=void 0!==n?n:1,s=0,o=this.object.geometry;o&&o.isGeometry?s=o.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var l=new Rn,h=new An(2*s*3,3);l.addAttribute("position",h),Er.call(this,l,new xr({color:r,linewidth:a})),this.matrixAutoUpdate=!1,this.update()}function Ao(t,e,i){en.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===e&&(e=1);var n=new Rn;n.addAttribute("position",new An([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));var r=new xr({fog:!1});this.lightPlane=new wr(n,r),this.add(this.lightPlane),(n=new Rn).addAttribute("position",new An([0,0,0,0,0,1],3)),this.targetLine=new wr(n,r),this.add(this.targetLine),this.update()}function Io(t){var e=new Rn,i=new xr({color:16777215,vertexColors:M}),n=[],r=[],a={},s=new bi(16755200),o=new bi(16711680),l=new bi(43775),h=new bi(16777215),c=new bi(3355443);function u(t,e,i){d(t,i),d(e,i)}function d(t,e){n.push(0,0,0),r.push(e.r,e.g,e.b),void 0===a[t]&&(a[t]=[]),a[t].push(n.length/3-1)}u("n1","n2",s),u("n2","n4",s),u("n4","n3",s),u("n3","n1",s),u("f1","f2",s),u("f2","f4",s),u("f4","f3",s),u("f3","f1",s),u("n1","f1",s),u("n2","f2",s),u("n3","f3",s),u("n4","f4",s),u("p","n1",o),u("p","n2",o),u("p","n3",o),u("p","n4",o),u("u1","u2",l),u("u2","u3",l),u("u3","u1",l),u("c","t",h),u("p","c",c),u("cn1","cn2",c),u("cn3","cn4",c),u("cf1","cf2",c),u("cf3","cf4",c),e.addAttribute("position",new An(n,3)),e.addAttribute("color",new An(r,3)),Er.call(this,e,i),this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}function Co(t,e){this.object=t,void 0===e&&(e=16776960);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new Rn;r.setIndex(new yn(i,1)),r.addAttribute("position",new yn(n,3)),Er.call(this,r,new xr({color:e})),this.matrixAutoUpdate=!1,this.update()}function Po(t,e){this.type="Box3Helper",this.box=t;var i=void 0!==e?e:16776960,n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Rn;r.setIndex(new yn(n,1)),r.addAttribute("position",new An([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Er.call(this,r,new xr({color:i})),this.geometry.computeBoundingSphere(),this.onBeforeRender()}function Ro(t,e,i){this.type="PlaneHelper",this.plane=t,this.size=void 0===e?1:e;var n=void 0!==i?i:16776960,r=new Rn;r.addAttribute("position",new An([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),wr.call(this,r,new xr({color:n}));var a=new Rn;a.addAttribute("position",new An([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),a.computeBoundingSphere(),this.add(new zn(a,new Nn({color:n,opacity:.2,transparent:!0,depthWrite:!1}))),this.onBeforeRender()}function Lo(t,e,i,n,r,a){en.call(this),void 0===n&&(n=16776960),void 0===i&&(i=1),void 0===r&&(r=.2*i),void 0===a&&(a=.2*r),void 0===Xs&&((Xs=new Rn).addAttribute("position",new An([0,0,0,0,1,0],3)),(Ys=new ua(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(e),this.line=new wr(Xs,new xr({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new zn(Ys,new Nn({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,r,a)}function Do(t){var e=[0,0,0,t=t||1,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=new Rn;i.addAttribute("position",new An(e,3)),i.addAttribute("color",new An([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new xr({vertexColors:A});Er.call(this,i,n)}function ko(){var t=0,e=0,i=0,n=0;function r(r,a,s,o){t=r,e=s,i=-3*r+3*a-2*s-o,n=2*r-2*a+s+o}return{initCatmullRom:function(t,e,i,n,a){r(e,i,a*(i-t),a*(n-e))},initNonuniformCatmullRom:function(t,e,i,n,a,s,o){var l=(e-t)/a-(i-t)/(a+s)+(i-e)/s,h=(i-e)/s-(n-e)/(s+o)+(n-i)/o;r(e,i,l*=s,h*=s)},calc:function(r){var a=r*r;return t+e*r+i*a+n*(a*r)}}}Object.assign(Qs.prototype,{load:function(t,e,i,n){var r=new Pa(this.manager);r.setResponseType("arraybuffer"),r.load(t,function(t){Ks.getContext().decodeAudioData(t,function(t){e(t)})},i,n)}}),Object.assign(function(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new an,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new an,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}.prototype,{update:(js=new Re,Vs=new Re,function(t){if(Os!==this||Ns!==t.focus||Us!==t.fov||Fs!==t.aspect*this.aspect||Bs!==t.near||zs!==t.far||Hs!==t.zoom||Gs!==this.eyeSep){Os=this,Ns=t.focus,Us=t.fov,Fs=t.aspect*this.aspect,Bs=t.near,zs=t.far,Hs=t.zoom;var e,i,n=t.projectionMatrix.clone(),r=(Gs=this.eyeSep/2)*Bs/Ns,a=Bs*Math.tan(ge.DEG2RAD*Us*.5)/Hs;Vs.elements[12]=-Gs,js.elements[12]=Gs,e=-a*Fs+r,i=a*Fs+r,n.elements[0]=2*Bs/(i-e),n.elements[8]=(i+e)/(i-e),this.cameraL.projectionMatrix.copy(n),e=-a*Fs-r,i=a*Fs-r,n.elements[0]=2*Bs/(i-e),n.elements[8]=(i+e)/(i-e),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(Vs),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(js)})}),$s.prototype=Object.create(en.prototype),$s.prototype.constructor=$s,to.prototype=Object.assign(Object.create(en.prototype),{constructor:to,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(t){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){this.gain.gain.value=t},updateMatrixWorld:function(){var t=new Pe,e=new Ce,i=new Pe,n=new Pe;return function(r){en.prototype.updateMatrixWorld.call(this,r);var a=this.context.listener,s=this.up;this.matrixWorld.decompose(t,e,i),n.set(0,0,-1).applyQuaternion(e),a.positionX?(a.positionX.setValueAtTime(t.x,this.context.currentTime),a.positionY.setValueAtTime(t.y,this.context.currentTime),a.positionZ.setValueAtTime(t.z,this.context.currentTime),a.forwardX.setValueAtTime(n.x,this.context.currentTime),a.forwardY.setValueAtTime(n.y,this.context.currentTime),a.forwardZ.setValueAtTime(n.z,this.context.currentTime),a.upX.setValueAtTime(s.x,this.context.currentTime),a.upY.setValueAtTime(s.y,this.context.currentTime),a.upZ.setValueAtTime(s.z,this.context.currentTime)):(a.setPosition(t.x,t.y,t.z),a.setOrientation(n.x,n.y,n.z,s.x,s.y,s.z))}}()}),eo.prototype=Object.assign(Object.create(en.prototype),{constructor:eo,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.onended=this.onEnded.bind(this),t.playbackRate.setValueAtTime(this.playbackRate,this.startTime),t.start(0,this.startTime),this.isPlaying=!0,this.source=t,this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.startTime=this.context.currentTime,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.startTime=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.value=t,this}}),io.prototype=Object.assign(Object.create(eo.prototype),{constructor:io,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){this.panner.refDistance=t},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){this.panner.rolloffFactor=t},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){this.panner.distanceModel=t},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){this.panner.maxDistance=t},updateMatrixWorld:function(){var t=new Pe;return function(e){en.prototype.updateMatrixWorld.call(this,e),t.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(t.x,t.y,t.z)}}()}),Object.assign(no.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),i=0;i<e.length;i++)t+=e[i];return t/e.length}}),Object.assign(ro.prototype,{accumulate:function(t,e){var i=this.buffer,n=this.valueSize,r=t*n+n,a=this.cumulativeWeight;if(0===a){for(var s=0;s!==n;++s)i[r+s]=i[s];a=e}else{var o=e/(a+=e);this._mixBufferRegion(i,r,0,o,n)}this.cumulativeWeight=a},apply:function(t){var e=this.valueSize,i=this.buffer,n=t*e+e,r=this.cumulativeWeight,a=this.binding;if(this.cumulativeWeight=0,r<1){var s=3*e;this._mixBufferRegion(i,n,s,1-r,e)}for(var o=e,l=e+e;o!==l;++o)if(i[o]!==i[o+e]){a.setValue(i,n);break}},saveOriginalState:function(){var t=this.binding,e=this.buffer,i=this.valueSize,n=3*i;t.getValue(e,n);for(var r=i,a=n;r!==a;++r)e[r]=e[n+r%i];this.cumulativeWeight=0},restoreOriginalState:function(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_select:function(t,e,i,n,r){if(n>=.5)for(var a=0;a!==r;++a)t[e+a]=t[i+a]},_slerp:function(t,e,i,n){Ce.slerpFlat(t,e,t,e,t,i,n)},_lerp:function(t,e,i,n,r){for(var a=1-n,s=0;s!==r;++s){var o=e+s;t[o]=t[o]*a+t[i+s]*n}}}),Object.assign(ao.prototype,{getValue:function(t,e){this.bind();var i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(t,e)},setValue:function(t,e){for(var i=this._bindings,n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}}),Object.assign(so,{Composite:ao,create:function(t,e,i){return t&&t.isAnimationObjectGroup?new so.Composite(t,e,i):new so(t,e,i)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(/[^\w-]/g,"")},parseTrackName:(Ws=new RegExp("^"+/((?:[\w-]+[\/:])*)/.source+/([\w-\.]+)?/.source+/(?:\.([\w-]+)(?:\[(.+)\])?)?/.source+/\.([\w-]+)(?:\[(.+)\])?/.source+"$"),qs=["material","materials","bones"],function(t){var e=Ws.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var r=i.nodeName.substring(n+1);-1!==qs.indexOf(r)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=r)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}),findNode:function(t,e){if(!e||""===e||"root"===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var i=function(t){for(var i=0;i<t.bones.length;i++){var n=t.bones[i];if(n.name===e)return n}return null}(t.skeleton);if(i)return i}if(t.children){var n=function(t){for(var i=0;i<t.length;i++){var r=t[i];if(r.name===e||r.uuid===e)return r;var a=n(r.children);if(a)return a}return null},r=n(t.children);if(r)return r}return null}}),Object.assign(so.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)t[e++]=i[n]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.node[this.propertyName]=t[e]},function(t,e){this.node[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.node[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=t[e++]},function(t,e){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,i=e.objectName,n=e.propertyName,r=e.propertyIndex;if(t||(t=so.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(i){var a=e.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var s=0;s<t.length;s++)if(t[s].name===a){a=s;break}break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==a){if(void 0===t[a])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[a]}}var o=t[n];if(void 0!==o){var l=this.Versioning.None;void 0!==t.needsUpdate?(l=this.Versioning.NeedsUpdate,this.targetObject=t):void 0!==t.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=t);var h=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(s=0;s<this.node.geometry.morphAttributes.position.length;s++)if(t.geometry.morphAttributes.position[s].name===r){r=s;break}}else{if(!t.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(s=0;s<this.node.geometry.morphTargets.length;s++)if(t.geometry.morphTargets[s].name===r){r=s;break}}}h=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else void 0!==o.fromArray&&void 0!==o.toArray?(h=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(h=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=n;this.getValue=this.GetterByBindingType[h],this.setValue=this.SetterByBindingTypeAndVersioning[h][l]}else{var c=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+n+" but it wasn't found.",t)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(so.prototype,{_getValue_unbound:so.prototype.getValue,_setValue_unbound:so.prototype.setValue}),Object.assign(function(t){this.uuid=ge.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var i=0,n=arguments.length;i!==n;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}.prototype,{isAnimationObjectGroup:!0,add:function(t){for(var e=this._objects,i=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,a=this._paths,s=this._parsedPaths,o=this._bindings,l=o.length,h=0,c=arguments.length;h!==c;++h){var u=arguments[h],d=u.uuid,f=r[d],p=void 0;if(void 0===f){f=i++,r[d]=f,e.push(u);for(var m=0,g=l;m!==g;++m)o[m].push(new so(u,a[m],s[m]))}else if(f<n){p=e[f];var v=--n,_=e[v];r[_.uuid]=f,e[f]=_,r[d]=v,e[v]=u;for(m=0,g=l;m!==g;++m){var y=o[m],b=y[v],x=y[f];y[f]=b,void 0===x&&(x=new so(u,a[m],s[m])),y[v]=x}}else e[f]!==p&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n},remove:function(t){for(var e=this._objects,i=this.nCachedObjects_,n=this._indicesByUUID,r=this._bindings,a=r.length,s=0,o=arguments.length;s!==o;++s){var l=arguments[s],h=l.uuid,c=n[h];if(void 0!==c&&c>=i){var u=i++,d=e[u];n[d.uuid]=c,e[c]=d,n[h]=u,e[u]=l;for(var f=0,p=a;f!==p;++f){var m=r[f],g=m[u],v=m[c];m[c]=g,m[u]=v}}}this.nCachedObjects_=i},uncache:function(t){for(var e=this._objects,i=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,a=this._bindings,s=a.length,o=0,l=arguments.length;o!==l;++o){var h=arguments[o].uuid,c=r[h];if(void 0!==c)if(delete r[h],c<n){var u=--n,d=e[u],f=e[_=--i];r[d.uuid]=c,e[c]=d,r[f.uuid]=u,e[u]=f,e.pop();for(var p=0,m=s;p!==m;++p){var g=(y=a[p])[u],v=y[_];y[c]=g,y[u]=v,y.pop()}}else{var _;r[(f=e[_=--i]).uuid]=c,e[c]=f,e.pop();for(p=0,m=s;p!==m;++p){var y;(y=a[p])[c]=y[_],y.pop()}}}this.nCachedObjects_=n},subscribe_:function(t,e){var i=this._bindingsIndicesByPath,n=i[t],r=this._bindings;if(void 0!==n)return r[n];var a=this._paths,s=this._parsedPaths,o=this._objects,l=o.length,h=this.nCachedObjects_,c=new Array(l);n=r.length,i[t]=n,a.push(t),s.push(e),r.push(c);for(var u=h,d=o.length;u!==d;++u){var f=o[u];c[u]=new so(f,t,e)}return c},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,i=e[t];if(void 0!==i){var n=this._paths,r=this._parsedPaths,a=this._bindings,s=a.length-1,o=a[s];e[t[s]]=i,a[i]=o,a.pop(),r[i]=r[s],r.pop(),n[i]=n[s],n.pop()}}}),Object.assign(oo.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){var n=this._clip.duration,r=t._clip.duration,a=r/n,s=n/r;t.warp(1,a,e),this.warp(s,1,e)}return this},crossFadeTo:function(t,e,i){return t.crossFadeFrom(this,e,i)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,i){var n=this._mixer,r=n.time,a=this._timeScaleInterpolant,s=this.timeScale;null===a&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);var o=a.parameterPositions,l=a.sampleValues;return o[0]=r,o[1]=r+i,l[0]=t/s,l[1]=e/s,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,i,n){if(this.enabled){var r=this._startTime;if(null!==r){var a=(t-r)*i;if(a<0||0===i)return;this._startTime=null,e=i*a}e*=this._updateTimeScale(t);var s=this._updateTime(e),o=this._updateWeight(t);if(o>0)for(var l=this._interpolants,h=this._propertyBindings,c=0,u=l.length;c!==u;++c)l[c].evaluate(s),h[c].accumulate(n,o)}else this._updateWeight(t)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var i=this._weightInterpolant;if(null!==i){var n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var i=this._timeScaleInterpolant;if(null!==i)e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}return this._effectiveTimeScale=e,e},_updateTime:function(t){var e=this.time+t;if(0===t)return e;var i=this._clip.duration,n=this.loop,r=this._loopCount;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(e>=i)e=i;else{if(!(e<0))break t;e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{var a=2202===n;if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),e>=i||e<0){var s=Math.floor(e/i);e-=i*s,r+=Math.abs(s);var o=this.repetitions-r;if(o<0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=t>0?i:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(0===o){var l=t<0;this._setEndings(l,!l,a)}else this._setEndings(!1,!1,a);this._loopCount=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:s})}}if(a&&1==(1&r))return this.time=e,i-e}return this.time=e,e},_setEndings:function(t,e,i){var n=this._interpolantSettings;i?(n.endingStart=2401,n.endingEnd=2401):(n.endingStart=t?this.zeroSlopeAtStart?2401:ne:2402,n.endingEnd=e?this.zeroSlopeAtEnd?2401:ne:2402)},_scheduleFading:function(t,e,i){var n=this._mixer,r=n.time,a=this._weightInterpolant;null===a&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);var s=a.parameterPositions,o=a.sampleValues;return s[0]=r,o[0]=e,s[1]=r+t,o[1]=i,this}}),Object.assign(function(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}.prototype,l.prototype,{_bindAction:function(t,e){var i=t._localRoot||this._root,n=t._clip.tracks,r=n.length,a=t._propertyBindings,s=t._interpolants,o=i.uuid,l=this._bindingsByRootAndName,h=l[o];void 0===h&&(h={},l[o]=h);for(var c=0;c!==r;++c){var u=n[c],d=u.name,f=h[d];if(void 0!==f)a[c]=f;else{if(void 0!==(f=a[c])){null===f._cacheIndex&&(++f.referenceCount,this._addInactiveBinding(f,o,d));continue}var p=e&&e._propertyBindings[c].binding.parsedPath;++(f=new ro(so.create(i,d,p),u.ValueTypeName,u.getValueSize())).referenceCount,this._addInactiveBinding(f,o,d),a[c]=f}s[c].resultBuffer=f.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,i,e)}for(var r=t._propertyBindings,a=0,s=r.length;a!==s;++a){var o=r[a];0==o.useCount++&&(this._lendBinding(o),o.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,i=0,n=e.length;i!==n;++i){var r=e[i];0==--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,i){var n=this._actions,r=this._actionsByClip,a=r[e];if(void 0===a)a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=a;else{var s=a.knownActions;t._byClipCacheIndex=s.length,s.push(t)}t._cacheIndex=n.length,n.push(t),a.actionByRoot[i]=t},_removeInactiveAction:function(t){var e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n,e[n]=i,e.pop(),t._cacheIndex=null;var r=t._clip.uuid,a=this._actionsByClip,s=a[r],o=s.knownActions,l=o[o.length-1],h=t._byClipCacheIndex;l._byClipCacheIndex=h,o[h]=l,o.pop(),t._byClipCacheIndex=null,delete s.actionByRoot[(t._localRoot||this._root).uuid],0===o.length&&delete a[r],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=t._propertyBindings,i=0,n=e.length;i!==n;++i){var r=e[i];0==--r.referenceCount&&this._removeInactiveBinding(r)}},_lendAction:function(t){var e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r},_takeBackAction:function(t){var e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r},_addInactiveBinding:function(t,e,i){var n=this._bindingsByRootAndName,r=n[e],a=this._bindings;void 0===r&&(r={},n[e]=r),r[i]=t,t._cacheIndex=a.length,a.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,i=t.binding,n=i.rootNode.uuid,r=i.path,a=this._bindingsByRootAndName,s=a[n],o=e[e.length-1],l=t._cacheIndex;o._cacheIndex=l,e[l]=o,e.pop(),delete s[r];t:{for(var h in s)break t;delete a[n]}},_lendBinding:function(t){var e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r},_takeBackBinding:function(t){var e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,i=t[e];return void 0===i&&((i=new Za(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=i),i},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,r=e[n];t.__cacheIndex=n,e[n]=t,r.__cacheIndex=i,e[i]=r},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e){var i=e||this._root,n=i.uuid,r="string"==typeof t?ss.findByName(i,t):t,a=null!==r?r.uuid:t,s=this._actionsByClip[a],o=null;if(void 0!==s){var l=s.actionByRoot[n];if(void 0!==l)return l;o=s.knownActions[0],null===r&&(r=o._clip)}if(null===r)return null;var h=new oo(this,r,e);return this._bindAction(h,o),this._addInactiveAction(h,a,n),h},existingAction:function(t,e){var i=e||this._root,n=i.uuid,r="string"==typeof t?ss.findByName(i,t):t,a=r?r.uuid:t,s=this._actionsByClip[a];return void 0!==s&&s.actionByRoot[n]||null},stopAllAction:function(){var t=this._actions,e=this._nActiveActions,i=this._bindings,n=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var r=0;r!==e;++r)t[r].reset();for(r=0;r!==n;++r)i[r].useCount=0;return this},update:function(t){t*=this.timeScale;for(var e=this._actions,i=this._nActiveActions,n=this.time+=t,r=Math.sign(t),a=this._accuIndex^=1,s=0;s!==i;++s){e[s]._update(n,t,r,a)}var o=this._bindings,l=this._nActiveBindings;for(s=0;s!==l;++s)o[s].apply(a);return this},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions,i=t.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){for(var a=r.knownActions,s=0,o=a.length;s!==o;++s){var l=a[s];this._deactivateAction(l);var h=l._cacheIndex,c=e[e.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,c._cacheIndex=h,e[h]=c,e.pop(),this._removeInactiveBindingsForAction(l)}delete n[i]}},uncacheRoot:function(t){var e=t.uuid,i=this._actionsByClip;for(var n in i){var r=i[n].actionByRoot[e];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}var a=this._bindingsByRootAndName[e];if(void 0!==a)for(var s in a){var o=a[s];o.restoreOriginalState(),this._removeInactiveBinding(o)}},uncacheAction:function(t,e){var i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}),lo.prototype.clone=function(){return new lo(void 0===this.value.clone?this.value:this.value.clone())},ho.prototype=Object.assign(Object.create(Rn.prototype),{constructor:ho,isInstancedBufferGeometry:!0,addGroup:function(t,e,i){this.groups.push({start:t,count:e,materialIndex:i})},copy:function(t){var e=t.index;null!==e&&this.setIndex(e.clone());var i=t.attributes;for(var n in i){var r=i[n];this.addAttribute(n,r.clone())}for(var a=t.groups,s=0,o=a.length;s<o;s++){var l=a[s];this.addGroup(l.start,l.count,l.materialIndex)}return this}}),Object.defineProperties(co.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(co.prototype,{isInterleavedBufferAttribute:!0,setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this},setXYZ:function(t,e,i,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this},setXYZW:function(t,e,i,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=r,this}}),Object.defineProperty(uo.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(uo.prototype,{isInterleavedBuffer:!0,setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.stride:0,this.array=t},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.dynamic=t.dynamic,this},copyAt:function(t,e,i){t*=this.stride,i*=e.stride;for(var n=0,r=this.stride;n<r;n++)this.array[t+n]=e.array[i+n];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}}),fo.prototype=Object.assign(Object.create(uo.prototype),{constructor:fo,isInstancedInterleavedBuffer:!0,copy:function(t){return uo.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),po.prototype=Object.assign(Object.create(yn.prototype),{constructor:po,isInstancedBufferAttribute:!0,copy:function(t){return yn.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Object.assign(function(t,e,i,n){this.ray=new Un(t,e),this.near=i||0,this.far=n||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}.prototype,{linePrecision:1,set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize()):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e){var i=[];return go(t,this,i,e),i.sort(mo),i},intersectObjects:function(t,e){var i=[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var n=0,r=t.length;n<r;n++)go(t[n],this,i,e);return i.sort(mo),i}}),Object.assign(function(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}),Object.assign(function(t,e,i){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==i?i:0,this}.prototype,{set:function(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.radius=t.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(ge.clamp(t.y/this.radius,-1,1))),this}}),Object.assign(function(t,e,i){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==i?i:0,this}.prototype,{set:function(t,e,i){return this.radius=t,this.theta=e,this.y=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.radius=Math.sqrt(t.x*t.x+t.z*t.z),this.theta=Math.atan2(t.x,t.z),this.y=t.y,this}}),vo.prototype=Object.create(en.prototype),vo.prototype.constructor=vo,vo.prototype.isImmediateRenderObject=!0,_o.prototype=Object.create(Er.prototype),_o.prototype.constructor=_o,_o.prototype.update=function(){var t=new Pe,e=new Pe,i=new ji;return function(){var n=["a","b","c"];this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);var r=this.object.matrixWorld,a=this.geometry.attributes.position,s=this.object.geometry;if(s&&s.isGeometry)for(var o=s.vertices,l=s.faces,h=0,c=0,u=l.length;c<u;c++)for(var d=l[c],f=0,p=d.vertexNormals.length;f<p;f++){var m=o[d[n[f]]],g=d.vertexNormals[f];t.copy(m).applyMatrix4(r),e.copy(g).applyMatrix3(i).normalize().multiplyScalar(this.size).add(t),a.setXYZ(h,t.x,t.y,t.z),h+=1,a.setXYZ(h,e.x,e.y,e.z),h+=1}else if(s&&s.isBufferGeometry){var v=s.attributes.position,_=s.attributes.normal;for(h=0,f=0,p=v.count;f<p;f++)t.set(v.getX(f),v.getY(f),v.getZ(f)).applyMatrix4(r),e.set(_.getX(f),_.getY(f),_.getZ(f)),e.applyMatrix3(i).normalize().multiplyScalar(this.size).add(t),a.setXYZ(h,t.x,t.y,t.z),h+=1,a.setXYZ(h,e.x,e.y,e.z),h+=1}a.needsUpdate=!0}}(),yo.prototype=Object.create(en.prototype),yo.prototype.constructor=yo,yo.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},yo.prototype.update=function(){var t=new Pe,e=new Pe;return function(){this.light.updateMatrixWorld();var i=this.light.distance?this.light.distance:1e3,n=i*Math.tan(this.light.angle);this.cone.scale.set(n,n,i),t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(e.sub(t)),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),bo.prototype=Object.create(Er.prototype),bo.prototype.constructor=bo,bo.prototype.onBeforeRender=function(){var t=new Pe,e=new Re,i=new Re;return function(){var n=this.bones,r=this.geometry,a=r.getAttribute("position");i.getInverse(this.root.matrixWorld);for(var s=0,o=0;s<n.length;s++){var l=n[s];l.parent&&l.parent.isBone&&(e.multiplyMatrices(i,l.matrixWorld),t.setFromMatrixPosition(e),a.setXYZ(o,t.x,t.y,t.z),e.multiplyMatrices(i,l.parent.matrixWorld),t.setFromMatrixPosition(e),a.setXYZ(o+1,t.x,t.y,t.z),o+=2)}r.getAttribute("position").needsUpdate=!0}}(),xo.prototype=Object.create(zn.prototype),xo.prototype.constructor=xo,xo.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},xo.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},wo.prototype=Object.create(en.prototype),wo.prototype.constructor=wo,wo.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},wo.prototype.update=function(){var t=.5*this.light.width,e=.5*this.light.height,i=this.line.geometry.attributes.position,n=i.array;n[0]=t,n[1]=-e,n[2]=0,n[3]=t,n[4]=e,n[5]=0,n[6]=-t,n[7]=e,n[8]=0,n[9]=-t,n[10]=-e,n[11]=0,n[12]=t,n[13]=-e,n[14]=0,i.needsUpdate=!0,void 0!==this.color?this.line.material.color.set(this.color):this.line.material.color.copy(this.light.color)},Eo.prototype=Object.create(en.prototype),Eo.prototype.constructor=Eo,Eo.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Eo.prototype.update=function(){var t=new Pe,e=new bi,i=new bi;return function(){var n=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var r=n.geometry.getAttribute("color");e.copy(this.light.color),i.copy(this.light.groundColor);for(var a=0,s=r.count;a<s;a++){var o=a<s/2?e:i;r.setXYZ(a,o.r,o.g,o.b)}r.needsUpdate=!0}n.lookAt(t.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),So.prototype=Object.create(Er.prototype),So.prototype.constructor=So,To.prototype=Object.create(Er.prototype),To.prototype.constructor=To,Mo.prototype=Object.create(Er.prototype),Mo.prototype.constructor=Mo,Mo.prototype.update=function(){var t=new Pe,e=new Pe,i=new ji;return function(){this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);for(var n=this.object.matrixWorld,r=this.geometry.attributes.position,a=this.object.geometry,s=a.vertices,o=a.faces,l=0,h=0,c=o.length;h<c;h++){var u=o[h],d=u.normal;t.copy(s[u.a]).add(s[u.b]).add(s[u.c]).divideScalar(3).applyMatrix4(n),e.copy(d).applyMatrix3(i).normalize().multiplyScalar(this.size).add(t),r.setXYZ(l,t.x,t.y,t.z),l+=1,r.setXYZ(l,e.x,e.y,e.z),l+=1}r.needsUpdate=!0}}(),Ao.prototype=Object.create(en.prototype),Ao.prototype.constructor=Ao,Ao.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Ao.prototype.update=function(){var t=new Pe,e=new Pe,i=new Pe;return function(){t.setFromMatrixPosition(this.light.matrixWorld),e.setFromMatrixPosition(this.light.target.matrixWorld),i.subVectors(e,t),this.lightPlane.lookAt(i),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(i),this.targetLine.scale.z=i.length()}}(),Io.prototype=Object.create(Er.prototype),Io.prototype.constructor=Io,Io.prototype.update=function(){var t,e,i=new Pe,n=new nn;function r(r,a,s,o){i.set(a,s,o).unproject(n);var l=e[r];if(void 0!==l)for(var h=t.getAttribute("position"),c=0,u=l.length;c<u;c++)h.setXYZ(l[c],i.x,i.y,i.z)}return function(){t=this.geometry,e=this.pointMap;n.projectionMatrix.copy(this.camera.projectionMatrix),r("c",0,0,-1),r("t",0,0,1),r("n1",-1,-1,-1),r("n2",1,-1,-1),r("n3",-1,1,-1),r("n4",1,1,-1),r("f1",-1,-1,1),r("f2",1,-1,1),r("f3",-1,1,1),r("f4",1,1,1),r("u1",.7,1.1,-1),r("u2",-.7,1.1,-1),r("u3",0,2,-1),r("cf1",-1,0,1),r("cf2",1,0,1),r("cf3",0,-1,1),r("cf4",0,1,1),r("cn1",-1,0,-1),r("cn2",1,0,-1),r("cn3",0,-1,-1),r("cn4",0,1,-1),t.getAttribute("position").needsUpdate=!0}}(),Co.prototype=Object.create(Er.prototype),Co.prototype.constructor=Co,Co.prototype.update=function(){var t=new Hi;return function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&t.setFromObject(this.object),!t.isEmpty()){var i=t.min,n=t.max,r=this.geometry.attributes.position,a=r.array;a[0]=n.x,a[1]=n.y,a[2]=n.z,a[3]=i.x,a[4]=n.y,a[5]=n.z,a[6]=i.x,a[7]=i.y,a[8]=n.z,a[9]=n.x,a[10]=i.y,a[11]=n.z,a[12]=n.x,a[13]=n.y,a[14]=i.z,a[15]=i.x,a[16]=n.y,a[17]=i.z,a[18]=i.x,a[19]=i.y,a[20]=i.z,a[21]=n.x,a[22]=i.y,a[23]=i.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),Co.prototype.setFromObject=function(t){return this.object=t,this.update(),this},Po.prototype=Object.create(Er.prototype),Po.prototype.constructor=Po,Po.prototype.onBeforeRender=function(){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5))},Ro.prototype=Object.create(wr.prototype),Ro.prototype.constructor=Ro,Ro.prototype.onBeforeRender=function(){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.lookAt(this.plane.normal),this.updateMatrixWorld()},Lo.prototype=Object.create(en.prototype),Lo.prototype.constructor=Lo,Lo.prototype.setDirection=(Js=new Pe,function(t){t.y>.99999?this.quaternion.set(0,0,0,1):t.y<-.99999?this.quaternion.set(1,0,0,0):(Js.set(t.z,0,-t.x).normalize(),Zs=Math.acos(t.y),this.quaternion.setFromAxisAngle(Js,Zs))}),Lo.prototype.setLength=function(t,e,i){void 0===e&&(e=.2*t),void 0===i&&(i=.2*e),this.line.scale.set(1,Math.max(0,t-e),1),this.line.updateMatrix(),this.cone.scale.set(i,e,i),this.cone.position.y=t,this.cone.updateMatrix()},Lo.prototype.setColor=function(t){this.line.material.color.copy(t),this.cone.material.color.copy(t)},Do.prototype=Object.create(Er.prototype),Do.prototype.constructor=Do;var Oo=new Pe,No=new ko,Uo=new ko,Fo=new ko;function Bo(t){ws.call(this),t.length<2&&console.warn("THREE.CatmullRomCurve3: Points array needs at least two entries."),this.points=t||[],this.closed=!1}function zo(t,e,i,n){ws.call(this),this.v0=t,this.v1=e,this.v2=i,this.v3=n}function Ho(t,e,i){ws.call(this),this.v0=t,this.v1=e,this.v2=i}function Go(t,e){ws.call(this),this.v1=t,this.v2=e}function jo(t,e,i,n,r,a){Ts.call(this,t,e,i,i,n,r,a)}Bo.prototype=Object.create(ws.prototype),Bo.prototype.constructor=Bo,Bo.prototype.getPoint=function(t){var e,i,n,r,a=this.points,s=a.length,o=(s-(this.closed?0:1))*t,l=Math.floor(o),h=o-l;if(this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/a.length)+1)*a.length:0===h&&l===s-1&&(l=s-2,h=1),this.closed||l>0?e=a[(l-1)%s]:(Oo.subVectors(a[0],a[1]).add(a[0]),e=Oo),i=a[l%s],n=a[(l+1)%s],this.closed||l+2<s?r=a[(l+2)%s]:(Oo.subVectors(a[s-1],a[s-2]).add(a[s-1]),r=Oo),void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var c="chordal"===this.type?.5:.25,u=Math.pow(e.distanceToSquared(i),c),d=Math.pow(i.distanceToSquared(n),c),f=Math.pow(n.distanceToSquared(r),c);d<1e-4&&(d=1),u<1e-4&&(u=d),f<1e-4&&(f=d),No.initNonuniformCatmullRom(e.x,i.x,n.x,r.x,u,d,f),Uo.initNonuniformCatmullRom(e.y,i.y,n.y,r.y,u,d,f),Fo.initNonuniformCatmullRom(e.z,i.z,n.z,r.z,u,d,f)}else if("catmullrom"===this.type){var p=void 0!==this.tension?this.tension:.5;No.initCatmullRom(e.x,i.x,n.x,r.x,p),Uo.initCatmullRom(e.y,i.y,n.y,r.y,p),Fo.initCatmullRom(e.z,i.z,n.z,r.z,p)}return new Pe(No.calc(h),Uo.calc(h),Fo.calc(h))},zo.prototype=Object.create(ws.prototype),zo.prototype.constructor=zo,zo.prototype.getPoint=function(t){var e=this.v0,i=this.v1,n=this.v2,r=this.v3;return new Pe(xs(t,e.x,i.x,n.x,r.x),xs(t,e.y,i.y,n.y,r.y),xs(t,e.z,i.z,n.z,r.z))},Ho.prototype=Object.create(ws.prototype),Ho.prototype.constructor=Ho,Ho.prototype.getPoint=function(t){var e=this.v0,i=this.v1,n=this.v2;return new Pe(bs(t,e.x,i.x,n.x),bs(t,e.y,i.y,n.y),bs(t,e.z,i.z,n.z))},Go.prototype=Object.create(ws.prototype),Go.prototype.constructor=Go,Go.prototype.getPoint=function(t){if(1===t)return this.v2.clone();var e=new Pe;return e.subVectors(this.v2,this.v1),e.multiplyScalar(t),e.add(this.v1),e},jo.prototype=Object.create(Ts.prototype),jo.prototype.constructor=jo;function Vo(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Bo.call(this,t),this.type="catmullrom"}ws.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(ws.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.create(Bo.prototype),Object.create(Bo.prototype),Vo.prototype=Object.create(Bo.prototype),Object.assign(Vo.prototype,{initFromArray:function(t){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(t){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(t){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),So.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},bo.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Ti.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Hi.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Fn.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},ge.random16=function(){return console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead."),Math.random()},Object.assign(ji.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(t){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(t,e,i){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(t,e,i){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Re.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){var t;return function(){return void 0===t&&(t=new Pe),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),t.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(t){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(t,e,i){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(t,e,i){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,i,n,r,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,n,i,r,a)}}),Vi.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Ce.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Object.assign(Un.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(Ls.prototype,{extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Kr(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new oa(this,t)}}),Object.assign(ve.prototype,{fromAttribute:function(t,e,i){return console.error("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)}}),Object.assign(Pe.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,i){return console.error("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)}}),Object.assign(Me.prototype,{fromAttribute:function(t,e,i){return console.error("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)}}),_n.prototype.computeTangents=function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},Object.assign(en.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)}}),Object.defineProperties(en.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(vr.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(_r.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Object.defineProperty(ws.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),an.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(Oa.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(yn.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}}}),Object.assign(Rn.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addDrawCall:function(t,e,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(Rn.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(lo.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Ui.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new bi}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=t===THREE.FlatShading}}}),Object.defineProperties(xa.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Fi.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(cr.prototype,{getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}}),Object.defineProperties(cr.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."),this.shadowMap.cullFace=t}}}),Object.defineProperties(qi.prototype,{cullFace:{get:function(){return this.renderReverseSided?_:v},set:function(t){var e=t!==v;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+e+"."),this.renderReverseSided=e}}}),Object.defineProperties(Ae.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),eo.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var e=this;return(new Qs).load(t,function(t){e.setBuffer(t)}),this},no.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},$s.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)};const Wo=i("UZ5h");class qo{static bbox(t,e){if(!o.vector3(t)||!o.vector3(e))return window.console.log("Invalid center or plane halfDimensions."),!1;if(!(e.x>=0&&e.y>=0&&e.z>=0))return window.console.log("halfDimensions must be >= 0."),window.console.log(e),!1;return{min:t.clone().sub(e),max:t.clone().add(e)}}static minMax(t=[]){let e=[65535,-32768],i=t.length;for(let n=0;n<i;n++){let i=t[n];e[0]=Math.min(e[0],i),e[1]=Math.max(e[1],i)}return e}static isElement(t){try{return t instanceof HTMLElement}catch(e){return"object"==typeof t&&1===t.nodeType&&"object"==typeof t.style&&"object"==typeof t.ownerDocument}}static isString(t){return"string"==typeof t||t instanceof String}static parseUrl(t){const e={filename:"",extension:"",pathname:"",query:""};let i=Wo.parse(t);return e.pathname=i.pathname,e.query=i.query,e.query&&(e.filename=e.query.split("&").reduce((t,e)=>{let i=e.split("=");return i.length>0&&"filename"==i[0]&&(t=i[1]),t})),e.filename||(e.filename=e.pathname.split("/").pop()),e.filename.split(".").length<=1?e.extension="dicom":e.extension=e.filename.split(".").pop(),isNaN(e.extension)||(e.extension="dicom"),e.query&&e.query.includes("contentType=application%2Fdicom")&&(e.extension="dicom"),e}static ijk2LPS(t,e,i,n,r,a=new Re){const s=new Re;return s.set(t.x*n.y,e.x*n.x,i.x*n.z,r.x,t.y*n.y,e.y*n.x,i.y*n.z,r.y,t.z*n.y,e.z*n.x,i.z*n.z,r.z,0,0,0,1),s.premultiply(a),s}static aabb2LPS(t,e,i,n){const r=new Re;return r.set(t.x,e.x,i.x,n.x,t.y,e.y,i.y,n.y,t.z,e.z,i.z,n.z,0,0,0,1),r}static worldToData(t,e){let i=(new Pe).copy(e).applyMatrix4(t);return i.addScalar(.5).floor(),i}static value(t,e){console.warn("value is deprecated, please use getPixelData instead"),this.getPixelData(t,e)}static getPixelData(t,e){return e.z>=0&&e.z<t._frame.length?t._frame[e.z].getPixelData(e.x,e.y):null}static setPixelData(t,e,i){if(!(e.z>=0&&e.z<t._frame.length))return null;t._frame[e.z].setPixelData(e.x,e.y,i)}static rescaleSlopeIntercept(t,e,i){return t*e+i}}class Xo{constructor(t){this._container=t,this._modes={load:{name:"load",color:"#FFF56F"},parse:{name:"parse",color:"#2196F3"}},this.requestAnimationFrameID=null,this._mode=null,this._value=null,this._total=null,this.init()}free(){let t=this._container.getElementsByClassName("progress container");t.length>0&&t[0].parentNode.removeChild(t[0]),t=null,window.cancelAnimationFrame(this.requestAnimationFrameID)}init(){let t=this._domContainer();for(let e in this._modes)if(this._modes.hasOwnProperty(e)){let i=this._domBar(this._modes[e]);t.appendChild(i),i=null}this._container.appendChild(t),t=null,this.updateUI()}update(t,e,i){this._mode=i,this._value=t,0===e?(this._total=t,this._value=Math.random()*t):this._total=e}updateUI(){if(this.requestAnimationFrameID=requestAnimationFrame(()=>{this.updateUI()}),!(this._modes.hasOwnProperty(this._mode)&&this._modes[this._mode].hasOwnProperty("name")&&this._modes[this._mode].hasOwnProperty("color")))return!1;const t=Math.round(this._value/this._total*100),e=this._modes[this._mode].color;let i=this._container.getElementsByClassName("progress "+this._modes[this._mode].name);i.length>0&&(i[0].style.borderColor=e,i[0].style.width=t+"%"),i=null}_domContainer(){let t=document.createElement("div");return t.classList.add("progress"),t.classList.add("container"),t.style.width="100%",t.style.height="8px",t.style.position="absolute",t.style.backgroundColor="rgba(158, 158, 158, 0.5)",t.style.top="0",t.style.zIndex="1",t}_domBar(t){if(!t.hasOwnProperty("name")||!t.hasOwnProperty("color"))return window.console.log("Invalid mode provided."),window.console.log(t),!1;let e=document.createElement("div");return e.classList.add(t.name),e.classList.add("progress"),e.style.border="2px solid "+t.color,e.style.width="0%",e}}var Yo=i("vzCy"),Zo=i.n(Yo);class Jo extends Zo.a{constructor(t=null,e=Xo){super(),this._loaded=-1,this._totalLoaded=-1,this._parsed=-1,this._totalParsed=-1,this._data=[],this._container=t,this._progressBar=null,this._container&&e&&(this._progressBar=new e(this._container))}free(){this._container=null,this._progressBar&&(this._progressBar.free(),this._progressBar=null)}fetch(t){return new Promise((e,i)=>{const n=new XMLHttpRequest;n.open("GET",t),n.crossOrigin=!0,n.responseType="arraybuffer",n.onloadstart=(e=>{this.emit("fetch-start",{file:t,time:new Date})}),n.onload=(r=>{if(200===n.status){this._loaded=r.loaded,this._totalLoaded=r.total,this._progressBar&&this._progressBar.update(this._loaded,this._totalLoaded,"load");let i=n.response,a={url:t,buffer:i};this.emit("fetch-success",{file:t,time:new Date,totalLoaded:r.total}),e(a)}else i(n.statusText)}),n.onerror=(()=>{this.emit("fetch-error",{file:t,time:new Date}),i(n.statusText)}),n.onabort=(e=>{this.emit("fetch-abort",{file:t,time:new Date}),i(n.statusText)}),n.ontimeout=(()=>{this.emit("fetch-timeout",{file:t,time:new Date}),i(n.statusText)}),n.onprogress=(e=>{this._loaded=e.loaded,this._totalLoaded=e.total,this.emit("fetch-progress",{file:t,total:e.total,loaded:e.loaded,time:new Date}),this._progressBar&&this._progressBar.update(this._loaded,this._totalLoaded,"load")}),n.onloadend=(e=>{this.emit("fetch-end",{file:t,time:new Date})}),n.send()})}parse(t){return new Promise((e,i)=>{e(t)})}loadSequenceGroup(t){const e=[];return t.forEach(t=>{e.push(this.fetch(t))}),Promise.all(e).then(t=>this.parse(t)).then(t=>(this._data.push(t),t)).catch(function(t){window.console.log("oops... something went wrong..."),window.console.log(t)})}loadSequence(t){return this.fetch(t).then(t=>this.parse(t)).then(t=>(this._data.push(t),t)).catch(function(t){window.console.log("oops... something went wrong..."),window.console.log(t)})}load(t){Array.isArray(t)||(t=[t]),this.emit("load-start",{files:t,time:new Date});const e=[];return t.forEach(t=>{Array.isArray(t)?e.push(this.loadSequenceGroup(t)):e.push(this.loadSequence(t))}),Promise.all(e)}set data(t){this._data=t}get data(){return this._data}}class Ko{constructor(){this._id=-1}mergeModels(t,e){if(!this._validateModelArray(t)||!this._validateModelArray(e))return window.console.log("invalid inputs provided."),!1;for(let i=0;i<e.length;i++)for(let n=0;n<t.length&&!t[n].merge(e[i]);n++)n===t.length-1&&t.push(e[i]);return!0}merge(t){return!!this.validate(t)&&this._id===t._id}validate(t){return!(!t||null===t||"function"!=typeof t.merge)}_validateModelArray(t){if(null===t||Array!==t.constructor)return window.console.log("invalid model array provided."),!1;for(let e=0;e<t.length;e++)if(!t[e]||null===t[e]||"function"!=typeof t[e].validate||!t[e].validate(t[e]))return!1;return!0}}class Qo extends Ko{constructor(){super(),this._concatenationUID=-1,this._seriesInstanceUID=-1,this._transferSyntaxUID="",this._seriesNumber=-1,this._seriesDescription="",this._seriesDate="",this._studyDescription="",this._studyDate="",this._accessionNumber=-1,this._modality="Modality not set",this._dimensionIndexSequence=[],this._numberOfFrames=0,this._numberOfChannels=1,this._patientID="",this._patientName="",this._patientAge="",this._patientBirthdate="",this._patientSex="",this._segmentationType=null,this._segmentationSegments=[],this._stack=[]}validate(t){return!!(super.validate(t)&&"function"==typeof t.mergeSeries&&t.hasOwnProperty("_seriesInstanceUID")&&t.hasOwnProperty("_numberOfFrames")&&t.hasOwnProperty("_numberOfChannels")&&t.hasOwnProperty("_stack")&&void 0!==t._stack&&Array===t._stack.constructor)}merge(t){return!!this.validate(t)&&(this._seriesInstanceUID===t.seriesInstanceUID&&this.mergeModels(this._stack,t.stack))}mergeSeries(t){let e=[this];return this.mergeModels(e,t),e}set seriesInstanceUID(t){this._seriesInstanceUID=t}get seriesInstanceUID(){return this._seriesInstanceUID}set transferSyntaxUID(t){this._transferSyntaxUID=t}get transferSyntaxUID(){return this._transferSyntaxUID}get transferSyntaxUIDLabel(){switch(this._transferSyntaxUID){case"1.2.840.10008.1.2.4.90":return"JPEG 2000 Lossless";case"1.2.840.10008.1.2.4.91":return"JPEG 2000 Lossy";case"1.2.840.10008.1.2.4.57":return"JPEG Lossless, Nonhierarchical (Processes 14)";case"1.2.840.10008.1.2.4.70":return"JPEG Lossless, Nonhierarchical (Processes 14 [Selection 1])";case"1.2.840.10008.1.2.4.50":return"JPEG Baseline lossy process 1 (8 bit)";case"1.2.840.10008.1.2.4.51":return"JPEG Baseline lossy process 2 & 4 (12 bit)";case"1.2.840.10008.1.2":return"Implicit VR Little Endian";case"1.2.840.10008.1.2.1":return"Explicit VR Little Endian";case"1.2.840.10008.1.2.2":return"Explicit VR Big Endian";default:return`Unknown transfersyntax: ${this._transferSyntaxUID}`}}set studyDate(t){this._studyDate=t}get studyDate(){return this._studyDate}set studyDescription(t){this._studyDescription=t}get studyDescription(){return this._studyDescription}set seriesDate(t){this._seriesDate=t}get seriesDate(){return this._seriesDate}set seriesDescription(t){this._seriesDescription=t}get seriesDescription(){return this._seriesDescription}set patientID(t){this._patientID=t}get patientID(){return this._patientID}set patientName(t){this._patientName=t}get patientName(){return this._patientName}set patientAge(t){this._patientAge=t}get patientAge(){return this._patientAge}set patientBirthdate(t){this._patientBirthdate=t}get patientBirthdate(){return this._patientBirthdate}set patientSex(t){this._patientSex=t}get patientSex(){return this._patientSex}set numberOfFrames(t){this._numberOfFrames=t}get numberOfFrames(){return this._numberOfFrames}set numberOfChannels(t){this._numberOfChannels=t}get numberOfChannels(){return this._numberOfChannels}set stack(t){this._stack=t}get stack(){return this._stack}set modality(t){this._modality=t}get modality(){return this._modality}set segmentationType(t){this._segmentationType=t}get segmentationType(){return this._segmentationType}set segmentationSegments(t){this._segmentationSegments=t}get segmentationSegments(){return this._segmentationSegments}}class $o{static cielab2XYZ(t,e,i){let n=(t+16)/116,r=e/500+n,a=n-i/200;return n=Math.pow(n,3)>.008856?Math.pow(n,3):(n-16/116)/7.787,[95.047*(r=Math.pow(r,3)>.008856?Math.pow(r,3):(r-16/116)/7.787),100*n,108.883*(a=Math.pow(a,3)>.008856?Math.pow(a,3):(a-16/116)/7.787)]}static xyz2RGB(t,e,i){let n=3.2406*(t/=100)+-1.5372*(e/=100)+-.4986*(i/=100),r=-.9689*t+1.8758*e+.0415*i,a=.0557*t+-.204*e+1.057*i;return n>.0031308?n=1.055*Math.pow(n,1/2.4)-.055:n*=12.92,r>.0031308?r=1.055*Math.pow(r,1/2.4)-.055:r*=12.92,a>.0031308?a=1.055*Math.pow(a,1/2.4)-.055:a*=12.92,[n*=255,r*=255,a*=255]}static cielab2RGB(t=50,e=0,i=0){if(!(t>=0&&t<=100))return null;let n=this.cielab2XYZ(t,e,i);return this.xyz2RGB(...n)}}const tl=i("63tJ");class el extends Ko{constructor(){super(),this._uid=null,this._stackID=-1,this._frame=[],this._numberOfFrames=0,this._rows=0,this._columns=0,this._numberOfChannels=1,this._bitsAllocated=8,this._pixelType=0,this._pixelRepresentation=0,this._textureSize=4096,this._nbTextures=7,this._rawData=[],this._windowCenter=0,this._windowWidth=0,this._rescaleSlope=1,this._rescaleIntercept=0,this._minMax=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],this._regMatrix=new Re,this._ijk2LPS=null,this._lps2IJK=null,this._aabb2LPS=null,this._lps2AABB=null,this._dimensionsIJK=null,this._halfDimensionsIJK=null,this._spacing=new Pe(1,1,1),this._spacingBetweenSlices=0,this._sliceThickness=0,this._origin=null,this._rightHanded=!0,this._xCosine=new Pe(1,0,0),this._yCosine=new Pe(0,1,0),this._zCosine=new Pe(0,0,1),this._prepared=!1,this._packed=!1,this._packedPerPixel=1,this._modality="Modality not set",this._segmentationType=null,this._segmentationSegments=[],this._segmentationDefaultColor=[63,174,128],this._frameSegment=[],this._segmentationLUT=[],this._segmentationLUTO=[],this._invert=!1}prepareSegmentation(){this._frameSegment=this._frame;let t=[];this.computeCosines(),this._frame.map(this._computeDistanceArrayMap.bind(null,this._zCosine)),this._frame.sort(this._sortDistanceArraySort);let e=-1;for(let i=0;i<this._frame.length;i++){if(t[e]&&t[e]._dist==this._frame[i]._dist)for(let n=0;n<t[e]._rows*t[e]._columns;n++)t[e]._pixelData[n]+=this._frame[i].pixelData[n]*this._frame[i]._referencedSegmentNumber;else{t.push(this._frame[i]),e++;for(let n=0;n<t[e]._rows*t[e]._columns;n++)t[e]._pixelData[n]*=this._frame[i]._referencedSegmentNumber}t[e].minMax=qo.minMax(t[e]._pixelData)}let i={},n=0;for(let t=0;t<this._segmentationSegments.length;t++){n=Math.max(n,parseInt(this._segmentationSegments[t].segmentNumber,10));let e=this._segmentationSegments[t].recommendedDisplayCIELab;i[this._segmentationSegments[t].segmentNumber]=null===e?this._segmentationDefaultColor:$o.cielab2RGB(...e)}for(let t=0;t<=n;t++){let e=t/n,r=t?1:0,a=[0,0,0];i.hasOwnProperty(t.toString())&&(a=i[t.toString()]),a[0]/=255,a[1]/=255,a[2]/=255,this._segmentationLUT.push([e,...a]),this._segmentationLUTO.push([e,r])}this._frame=t}prepare(){if("SEG"===this._modality&&this.prepareSegmentation(),!(this._frame&&this._frame.length>0))return window.console.log("_frame doesn't contain anything...."),window.console.log(this._frame),!1;this._numberOfFrames=this._frame.length,this._rows=this._frame[0].rows,this._columns=this._frame[0].columns,this._dimensionsIJK=new Pe(this._columns,this._rows,this._numberOfFrames),this._halfDimensionsIJK=new Pe(this._dimensionsIJK.x/2,this._dimensionsIJK.y/2,this._dimensionsIJK.z/2),this._spacingBetweenSlices=this._frame[0].spacingBetweenSlices,this._sliceThickness=this._frame[0].sliceThickness,this.computeCosines(),this.orderFrames(),this.computeSpacing(),this._frame[0].imagePosition||(this._frame[0].imagePosition=[0,0,0]),this._frame[0].imageOrientation||(this._frame[0].imageOrientation=[1,0,0,0,1,0]),this._origin=this._arrayToVector3(this._frame[0].imagePosition,0),this.computeIJK2LPS(),this.computeLPS2AABB();const t=Math.floor(this._frame.length/2),e=this._frame[t];this._rescaleSlope=e.rescaleSlope||1,this._rescaleIntercept=e.rescaleIntercept||0,this.computeMinMaxIntensities(),this._minMax[0]=qo.rescaleSlopeIntercept(this._minMax[0],this._rescaleSlope,this._rescaleIntercept),this._minMax[1]=qo.rescaleSlopeIntercept(this._minMax[1],this._rescaleSlope,this._rescaleIntercept);let i=e.windowWidth*this._rescaleSlope||this._minMax[1]-this._minMax[0];this._windowWidth=i+this._rescaleIntercept;let n=e.windowCenter*this._rescaleSlope||this._minMax[0]+i/2;this._windowCenter=n+this._rescaleIntercept,this._bitsAllocated=e.bitsAllocated,this._prepared=!0}packEchos(){let t=[];for(let e=0;e<this._frame.length;e+=4){let i=this._frame[e];for(let t=0;t<this._rows*this._columns;t++){for(let n=1;n<4;n++)i.pixelData[t]+=this._frame[e+n].pixelData[t];i.pixelData[t]/=4}t.push(i)}this._frame=t,this._numberOfFrames=this._frame.length,this._dimensionsIJK=new Pe(this._columns,this._rows,this._numberOfFrames),this._halfDimensionsIJK=new Pe(this._dimensionsIJK.x/2,this._dimensionsIJK.y/2,this._dimensionsIJK.z/2)}computeCosines(){if(this._frame&&this._frame[0]){let t=this._frame[0].cosines();this._xCosine=t[0],this._yCosine=t[1],this._zCosine=t[2]}}orderFrames(){this._frame[0].dimensionIndexValues?this._frame.sort(this._orderFrameOnDimensionIndicesArraySort):this._frame[0].imagePosition&&this._frame[0].imageOrientation&&this._frame[1]&&this._frame[1].imagePosition&&this._frame[1].imageOrientation&&this._frame[0].imagePosition.join()!==this._frame[1].imagePosition.join()?(this._frame.map(this._computeDistanceArrayMap.bind(null,this._zCosine)),this._frame.sort(this._sortDistanceArraySort)):null!==this._frame[0].instanceNumber&&this._frame[1]&&null!==this._frame[1].instanceNumber&&this._frame[0].instanceNumber!==this._frame[1].instanceNumber?this._frame.sort(this._sortInstanceNumberArraySort):this._frame[0].sopInstanceUID&&this._frame[1]&&this._frame[1].sopInstanceUID&&this._frame[0].sopInstanceUID!==this._frame[1].sopInstanceUID?this._frame.sort(this._sortSopInstanceUIDArraySort):window.console.log("do not know how to order the frames...")}computeSpacing(){this.xySpacing(),this.zSpacing()}zSpacing(){this._numberOfFrames>1&&(this._frame[0].pixelSpacing&&this._frame[0].pixelSpacing[2]?this._spacing.z=this._frame[0].pixelSpacing[2]:(this._frame.map(this._computeDistanceArrayMap.bind(null,this._zCosine)),this._frame[1].dist!==this._frame[0].dist?(this._frame.sort(this._sortDistanceArraySort),this._spacing.z=this._frame[1].dist-this._frame[0].dist):this._spacingBetweenSlices?this._spacing.z=this._spacingBetweenSlices:this._frame[0].sliceThickness&&(this._spacing.z=this._frame[0].sliceThickness))),0===this._spacing.z&&(this._spacing.z=1)}xySpacing(){if(this._frame&&this._frame[0]){let t=this._frame[0].spacingXY();this._spacing.x=t[0],this._spacing.y=t[1]}}computeMinMaxIntensities(){for(let t=0;t<this._frame.length;t++){let e=this._frame[t].minMax[0];Number.isNaN(e)||(this._minMax[0]=Math.min(this._minMax[0],e));let i=this._frame[t].minMax[1];Number.isNaN(i)||(this._minMax[1]=Math.max(this._minMax[1],i))}}computeIJK2LPS(){this._ijk2LPS=qo.ijk2LPS(this._xCosine,this._yCosine,this._zCosine,this._spacing,this._origin,this._regMatrix),this._lps2IJK=new Re,this._lps2IJK.getInverse(this._ijk2LPS)}computeLPS2AABB(){this._aabb2LPS=qo.aabb2LPS(this._xCosine,this._yCosine,this._zCosine,this._origin),this._lps2AABB=new Re,this._lps2AABB.getInverse(this._aabb2LPS)}merge(t){return this._stackID===t.stackID&&this.mergeModels(this._frame,t.frame)}pack(){const t=this._dimensionsIJK.x*this._dimensionsIJK.y*this._dimensionsIJK.z;16===this._bitsAllocated&&1===this._numberOfChannels&&(this._packedPerPixel=2);const e=this._textureSize*this._textureSize,i=Math.ceil(t/(e*this._packedPerPixel));let n=0,r=this._packedPerPixel*e;r>t&&(r=t);for(let a=0;a<i;a++){let i=this._packTo8Bits(this._numberOfChannels,this._frame,this._textureSize,n,r);this._textureType=i.textureType,this._rawData.push(i.data),n+=this._packedPerPixel*e,(r+=this._packedPerPixel*e)>t&&(r=t)}this._packed=!0}_packTo8Bits(t,e,i,n,r){const a={textureType:null,data:null},s=e[0].bitsAllocated,o=e[0].pixelType;let l=0;this._minMax[0]<0&&(l-=this._minMax[0]);let h=0,c=0,u=0;const d=e[0].rows*e[0].columns;if(8===s&&1===t||1===s){let t=new Uint8Array(i*i*1);for(let i=n;i<r;i++){u=i%d;let n=e[c=~~(i/d)].pixelData[u]+=l;Number.isNaN(n)||(t[h]=n),h++}a.textureType=THREE.LuminanceFormat,a.data=t}else if(16===s&&1===t){let t=new Uint8Array(i*i*4),s=0,o=0;for(let i=n;i<r;i++){u=i%d;let n=e[c=~~(i/d)].pixelData[u]+l;Number.isNaN(n)||(t[4*s+2*o]=255&n,t[4*s+2*o+1]=n>>>8&255),h++,s=Math.floor(h/2),o=h%2}a.textureType=THREE.RGBAFormat,a.data=t}else if(32===s&&1===t&&0===o){let t=new Uint8Array(i*i*4);for(let i=n;i<r;i++){u=i%d;let n=e[c=~~(i/d)].pixelData[u]+l;Number.isNaN(n)||(t[4*h]=255&n,t[4*h+1]=n>>>8&255,t[4*h+2]=n>>>16&255,t[4*h+3]=n>>>24&255),h++}a.textureType=THREE.RGBAFormat,a.data=t}else if(32===s&&1===t&&1===o){let t=new Uint8Array(i*i*4);for(let i=n;i<r;i++){u=i%d;let n=e[c=~~(i/d)].pixelData[u]+l;if(!Number.isNaN(n)){let e=tl(n).match(/.{1,8}/g);t[4*h]=parseInt(e[0],2),t[4*h+1]=parseInt(e[1],2),t[4*h+2]=parseInt(e[2],2),t[4*h+3]=parseInt(e[3],2)}h++}a.textureType=THREE.RGBAFormat,a.data=t}else if(8===s&&3===t){let t=new Uint8Array(i*i*3);for(let i=n;i<r;i++)c=~~(i/d),u=i%d,t[3*h]=e[c].pixelData[3*u],t[3*h+1]=e[c].pixelData[3*u+1],t[3*h+2]=e[c].pixelData[3*u+2],h++;a.textureType=THREE.RGBFormat,a.data=t}return a}worldCenter(){return this._halfDimensionsIJK.clone().addScalar(-.5).applyMatrix4(this._ijk2LPS)}worldBoundingBox(){let t=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];const e=this._dimensionsIJK;for(let i=0;i<=e.x;i+=e.x)for(let n=0;n<=e.y;n+=e.y)for(let r=0;r<=e.z;r+=e.z){let e=new Pe(i,n,r).applyMatrix4(this._ijk2LPS);t=[Math.min(t[0],e.x),Math.max(t[1],e.x),Math.min(t[2],e.y),Math.max(t[3],e.y),Math.min(t[4],e.z),Math.max(t[5],e.z)]}return t}AABBox(){let t=(new Pe).addScalar(-.5).applyMatrix4(this._ijk2LPS).applyMatrix4(this._lps2AABB),e=this._dimensionsIJK.clone().addScalar(-.5).applyMatrix4(this._ijk2LPS).applyMatrix4(this._lps2AABB);return new Pe(Math.abs(t.x-e.x),Math.abs(t.y-e.y),Math.abs(t.z-e.z))}centerAABBox(){let t=this.worldCenter();return t.applyMatrix4(this._lps2AABB),t}static indexInDimensions(t,e){return t.x>=0&&t.y>=0&&t.z>=0&&t.x<e.x&&t.y<e.y&&t.z<e.z}_arrayToVector3(t,e){return new Pe(t[e],t[e+1],t[e+2])}_orderFrameOnDimensionIndicesArraySort(t,e){if("dimensionIndexValues"in t&&"[object Array]"===Object.prototype.toString.call(t.dimensionIndexValues)&&"dimensionIndexValues"in e&&"[object Array]"===Object.prototype.toString.call(e.dimensionIndexValues))for(let i=0;i<t.dimensionIndexValues.length;i++){if(parseInt(t.dimensionIndexValues[i],10)>parseInt(e.dimensionIndexValues[i],10))return 1;if(parseInt(t.dimensionIndexValues[i],10)<parseInt(e.dimensionIndexValues[i],10))return-1}else window.console.log("One of the frames doesn't have a dimensionIndexValues array."),window.console.log(t),window.console.log(e);return 0}_computeDistanceArrayMap(t,e){return e.dist=e.imagePosition[0]*t.x+e.imagePosition[1]*t.y+e.imagePosition[2]*t.z,e}_sortDistanceArraySort(t,e){return t.dist-e.dist}_sortInstanceNumberArraySort(t,e){return t.instanceNumber-e.instanceNumber}_sortSopInstanceUIDArraySort(t,e){return t.sopInstanceUID-e.sopInstanceUID}set numberOfChannels(t){this._numberOfChannels=t}get numberOfChannels(){return this._numberOfChannels}set frame(t){this._frame=t}get frame(){return this._frame}set prepared(t){this._prepared=t}get prepared(){return this._prepared}set packed(t){this._packed=t}get packed(){return this._packed}set packedPerPixel(t){this._packedPerPixel=t}get packedPerPixel(){return this._packedPerPixel}set dimensionsIJK(t){this._dimensionsIJK=t}get dimensionsIJK(){return this._dimensionsIJK}set halfDimensionsIJK(t){this._halfDimensionsIJK=t}get halfDimensionsIJK(){return this._halfDimensionsIJK}set regMatrix(t){this._regMatrix=t}get regMatrix(){return this._regMatrix}set ijk2LPS(t){this._ijk2LPS=t}get ijk2LPS(){return this._ijk2LPS}set lps2IJK(t){this._lps2IJK=t}get lps2IJK(){return this._lps2IJK}set lps2AABB(t){this._lps2AABB=t}get lps2AABB(){return this._lps2AABB}set textureSize(t){this._textureSize=t}get textureSize(){return this._textureSize}set textureType(t){this._textureType=t}get textureType(){return this._textureType}set bitsAllocated(t){this._bitsAllocated=t}get bitsAllocated(){return this._bitsAllocated}set rawData(t){this._rawData=t}get rawData(){return this._rawData}get windowWidth(){return this._windowWidth}set windowWidth(t){this._windowWidth=t}get windowCenter(){return this._windowCenter}set windowCenter(t){this._windowCenter=t}get rescaleSlope(){return this._rescaleSlope}set rescaleSlope(t){this._rescaleSlope=t}get rescaleIntercept(){return this._rescaleIntercept}set rescaleIntercept(t){this._rescaleIntercept=t}get xCosine(){return this._xCosine}set xCosine(t){this._xCosine=t}get yCosine(){return this._yCosine}set yCosine(t){this._yCosine=t}get zCosine(){return this._zCosine}set zCosine(t){this._zCosine=t}get minMax(){return this._minMax}set minMax(t){this._minMax=t}get stackID(){return this._stackID}set stackID(t){this._stackID=t}get pixelType(){return this._pixelType}set pixelType(t){this._pixelType=t}get pixelRepresentation(){return this._pixelRepresentation}set pixelRepresentation(t){this._pixelRepresentation=t}set invert(t){this._invert=t}get invert(){return this._invert}set modality(t){this._modality=t}get modality(){return this._modality}get rightHanded(){return this._rightHanded}set rightHanded(t){this._rightHanded=t}get spacingBetweenSlices(){return this._spacingBetweenSlices}set spacingBetweenSlices(t){this._spacingBetweenSlices=t}set segmentationSegments(t){this._segmentationSegments=t}get segmentationSegments(){return this._segmentationSegments}set segmentationType(t){this._segmentationType=t}get segmentationType(){return this._segmentationType}set segmentationLUT(t){this._segmentationLUT=t}get segmentationLUT(){return this._segmentationLUT}set segmentationLUTO(t){this._segmentationLUTO=t}get segmentationLUTO(){return this._segmentationLUTO}static value(t,e){return console.warn("models.stack.value is deprecated.\n       Please use core.utils.value instead."),qo.value(t,e)}static valueRescaleSlopeIntercept(t,e,i){return console.warn("models.stack.valueRescaleSlopeIntercept is deprecated.\n       Please use core.utils.rescaleSlopeIntercept instead."),qo.rescaleSlopeIntercept(t,e,i)}static worldToData(t,e){return console.warn("models.stack.worldToData is deprecated.\n       Please use core.utils.worldToData instead."),qo.worldToData(t._lps2IJK,e)}}class il extends Ko{constructor(){super(),this._sopInstanceUID=null,this._url=null,this._stackID=-1,this._rows=0,this._columns=0,this._dimensionIndexValues=[],this._imagePosition=null,this._imageOrientation=null,this._rightHanded=!0,this._sliceThickness=1,this._spacingBetweenSlices=null,this._pixelRepresentation=0,this._pixelType=0,this._pixelSpacing=null,this._pixelAspectRatio=null,this._pixelData=null,this._instanceNumber=null,this._windowCenter=null,this._windowWidth=null,this._rescaleSlope=null,this._rescaleIntercept=null,this._bitsAllocated=8,this._minMax=null,this._dist=null,this._index=-1,this._referencedSegmentNumber=-1}validate(t){return!!(super.validate(t)&&"function"==typeof t.cosines&&"function"==typeof t.spacingXY&&t.hasOwnProperty("_sopInstanceUID")&&t.hasOwnProperty("_dimensionIndexValues")&&t.hasOwnProperty("_imageOrientation")&&t.hasOwnProperty("_imagePosition"))}merge(t){return!!this.validate(t)&&!!(this._compareArrays(this._dimensionIndexValues,t.dimensionIndexValues)&&this._compareArrays(this._imageOrientation,t.imageOrientation)&&this._compareArrays(this._imagePosition,t.imagePosition)&&this._instanceNumber===t.instanceNumber&&this._sopInstanceUID===t.sopInstanceUID)}cosines(){let t=[new Pe(1,0,0),new Pe(0,1,0),new Pe(0,0,1)];if(this._imageOrientation&&6===this._imageOrientation.length){let e=new Pe(this._imageOrientation[0],this._imageOrientation[1],this._imageOrientation[2]),i=new Pe(this._imageOrientation[3],this._imageOrientation[4],this._imageOrientation[5]);e.length()>0&&i.length()>0&&(t[0]=e,t[1]=i,t[2]=new Pe(0,0,0).crossVectors(t[0],t[1]).normalize())}else window.console.log("No valid image orientation for frame"),window.console.log(this),window.console.log("Returning default orientation.");return this._rightHanded||t[2].negate(),t}spacingXY(){let t=[1,1];return this.pixelSpacing?(t[0]=this.pixelSpacing[0],t[1]=this.pixelSpacing[1]):this.pixelAspectRatio&&(t[0]=1,t[1]=1*this.pixelAspectRatio[1]/this.pixelAspectRatio[0]),t}getPixelData(t,e){return this.pixelData[t+this._columns*e]}setPixelData(t,e,i){this.pixelData[t+this._columns*e]=i}_compareArrays(t,e){return t===e||!(!t||!e||t.join()!==e.join())}get rows(){return this._rows}set rows(t){this._rows=t}get columns(){return this._columns}set columns(t){this._columns=t}get spacingBetweenSlices(){return this._spacingBetweenSlices}set spacingBetweenSlices(t){this._spacingBetweenSlices=t}get sliceThickness(){return this._sliceThickness}set sliceThickness(t){this._sliceThickness=t}get imagePosition(){return this._imagePosition}set imagePosition(t){this._imagePosition=t}get imageOrientation(){return this._imageOrientation}set imageOrientation(t){this._imageOrientation=t}get windowWidth(){return this._windowWidth}set windowWidth(t){this._windowWidth=t}get windowCenter(){return this._windowCenter}set windowCenter(t){this._windowCenter=t}get rescaleSlope(){return this._rescaleSlope}set rescaleSlope(t){this._rescaleSlope=t}get rescaleIntercept(){return this._rescaleIntercept}set rescaleIntercept(t){this._rescaleIntercept=t}get bitsAllocated(){return this._bitsAllocated}set bitsAllocated(t){this._bitsAllocated=t}get dist(){return this._dist}set dist(t){this._dist=t}get pixelSpacing(){return this._pixelSpacing}set pixelSpacing(t){this._pixelSpacing=t}get pixelAspectRatio(){return this._pixelAspectRatio}set pixelAspectRatio(t){this._pixelAspectRatio=t}get minMax(){return this._minMax}set minMax(t){this._minMax=t}get dimensionIndexValues(){return this._dimensionIndexValues}set dimensionIndexValues(t){this._dimensionIndexValues=t}get instanceNumber(){return this._instanceNumber}set instanceNumber(t){this._instanceNumber=t}get pixelData(){return this._pixelData}set pixelData(t){this._pixelData=t}set sopInstanceUID(t){this._sopInstanceUID=t}get sopInstanceUID(){return this._sopInstanceUID}get pixelRepresentation(){return this._pixelRepresentation}set pixelRepresentation(t){this._pixelRepresentation=t}get pixelType(){return this._pixelType}set pixelType(t){this._pixelType=t}get url(){return this._url}set url(t){this._url=t}get referencedSegmentNumber(){return this._referencedSegmentNumber}set referencedSegmentNumber(t){this._referencedSegmentNumber=t}get rightHanded(){return this._rightHanded}set rightHanded(t){this._rightHanded=t}get index(){return this._index}set index(t){this._index=t}}class nl{constructor(){this._rightHanded=!0}pixelRepresentation(){return 0}modality(){return"unknown"}segmentationType(){return"unknown"}segmentationSegments(){return[]}referencedSegmentNumber(t){return-1}rightHanded(){return this._rightHanded}spacingBetweenSlices(){return null}numberOfChannels(){return 1}sliceThickness(){return null}dimensionIndexValues(t=0){return null}instanceNumber(t=0){return t}windowCenter(t=0){return null}windowWidth(t=0){return null}rescaleSlope(t=0){return 1}rescaleIntercept(t=0){return 0}_decompressUncompressed(){}_swap16(t){return(255&t)<<8|t>>8&255}_swap32(t){return(255&t)<<24|(65280&t)<<8|t>>8&65280|t>>24&255}invert(){return!1}transferSyntaxUID(){return"no value provided"}studyDate(){return"no value provided"}studyDescription(){return"no value provided"}seriesDate(){return"no value provided"}seriesDescription(){return"no value provided"}patientID(){return"no value provided"}patientName(){return"no value provided"}patientAge(){return"no value provided"}patientBirthdate(){return"no value provided"}patientSex(){return"no value provided"}minMaxPixelData(t=[]){let e=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],i=t.length;for(let n=0;n<i;n++){let i=t[n];e[0]=Math.min(e[0],i),e[1]=Math.max(e[1],i)}return e}}let rl=i("5Xl1"),al=i("jCpJ"),sl=i("wg/6"),ol=i("KyNI");class ll extends nl{constructor(t,e){super(),this._id=e,this._arrayBuffer=t.buffer;let i=new Uint8Array(this._arrayBuffer);this._dataSet=null;try{this._dataSet=rl.parseDicom(i)}catch(t){throw window.console.log(t),"parsers.dicom could not parse the file"}}seriesInstanceUID(){return this._dataSet.string("x0020000e")}studyInstanceUID(){return this._dataSet.string("x0020000d")}modality(){return this._dataSet.string("x00080060")}segmentationType(){return this._dataSet.string("x00620001")}segmentationSegments(){let t=[],e=this._dataSet.elements.x00620002;if(!e)return t;for(let i=0;i<e.items.length;i++){let n=this._recommendedDisplayCIELab(e.items[i]),r=this._segmentationCode(e.items[i]),a=e.items[i].dataSet.uint16("x00620004"),s=e.items[i].dataSet.string("x00620005"),o=e.items[i].dataSet.string("x00620008");t.push({recommendedDisplayCIELab:n,segmentationCodeDesignator:r.segmentationCodeDesignator,segmentationCodeValue:r.segmentationCodeValue,segmentationCodeMeaning:r.segmentationCodeMeaning,segmentNumber:a,segmentLabel:s,segmentAlgorithmType:o})}return t}_segmentationCode(t){let e="unknown",i="unknown",n="unknown",r=t.dataSet.elements.x00082218;return r&&r.items&&r.items.length>0&&(e=r.items[0].dataSet.string("x00080102"),i=r.items[0].dataSet.string("x00080100"),n=r.items[0].dataSet.string("x00080104")),{segmentationCodeDesignator:e,segmentationCodeValue:i,segmentationCodeMeaning:n}}_recommendedDisplayCIELab(t){if(!t.dataSet.elements.x0062000d)return null;let e=t.dataSet.elements.x0062000d.dataOffset,i=t.dataSet.elements.x0062000d.length,n=t.dataSet.byteArray.slice(e,e+i),r=new Uint16Array(i/2);for(let t=0;t<i/2;t++)r[t]=(n[2*t+1]<<8)+n[2*t];return[r[0]/65535*100,r[1]/65535*255-128,r[2]/65535*255-128]}sopInstanceUID(t=0){return this._findStringEverywhere("x2005140f","x00080018",t)}transferSyntaxUID(){return this._dataSet.string("x00020010")}studyDate(){return this._dataSet.string("x00080020")}studyDescription(){return this._dataSet.string("x00081030")}seriesDate(){return this._dataSet.string("x00080021")}seriesDescription(){return this._dataSet.string("x0008103e")}patientName(){return this._dataSet.string("x00100010")}patientID(){return this._dataSet.string("x00100020")}patientBirthdate(){return this._dataSet.string("x00100030")}patientSex(){return this._dataSet.string("x00100040")}patientAge(){return this._dataSet.string("x00101010")}photometricInterpretation(){return this._dataSet.string("x00280004")}planarConfiguration(){let t=this._dataSet.uint16("x00280006");return void 0===t&&(t=null),t}samplesPerPixel(){return this._dataSet.uint16("x00280002")}numberOfFrames(){let t=this._dataSet.intString("x00280008");return void 0===t&&(t=null),t}numberOfChannels(){let t=1,e=this.photometricInterpretation();return"RGB"!==e&&"PALETTE COLOR"!==e&&"YBR_FULL"!==e&&"YBR_FULL_422"!==e&&"YBR_PARTIAL_422"!==e&&"YBR_PARTIAL_420"!==e&&"YBR_RCT"!==e||(t=3),t}invert(){return"MONOCHROME1"===this.photometricInterpretation()}imageOrientation(t=0){let e=this._findStringEverywhere("x00209116","x00200037",t);return e&&(e=e.split("\\").map(Number)),e}referencedSegmentNumber(t=0){let e=-1,i=this._findInGroupSequence("x52009230","x0062000a",t);return null!==i&&(e=i.uint16("x0062000b")),e}pixelAspectRatio(){let t=[this._dataSet.intString("x00280034",0),this._dataSet.intString("x00280034",1)];return void 0===t[0]&&(t=null),t}imagePosition(t=0){let e=this._findStringEverywhere("x00209113","x00200032",t);return e&&(e=e.split("\\").map(Number)),e}instanceNumber(t=0){let e=null,i=this._dataSet.elements.x52009230;if(void 0!==i)if(i.items[t].dataSet.elements.x2005140f){e=i.items[t].dataSet.elements.x2005140f.items[0].dataSet.intString("x00200013")}else void 0===(e=this._dataSet.intString("x00200013"))&&(e=null);else void 0===(e=this._dataSet.intString("x00200013"))&&(e=null);return e}pixelSpacing(t=0){let e=this._findStringEverywhere("x00289110","x00280030",t);return e&&(e=e.split("\\").map(Number)),e}rows(t=0){let e=this._dataSet.uint16("x00280010");return void 0===e&&(e=null),e}columns(t=0){let e=this._dataSet.uint16("x00280011");return void 0===e&&(e=null),e}pixelType(t=0){return 0}pixelRepresentation(t=0){return this._dataSet.uint16("x00280103")}bitsAllocated(t=0){return this._dataSet.uint16("x00280100")}highBit(t=0){return this._dataSet.uint16("x00280102")}rescaleIntercept(t=0){return this._findFloatStringInFrameGroupSequence("x00289145","x00281052",t)}rescaleSlope(t=0){return this._findFloatStringInFrameGroupSequence("x00289145","x00281053",t)}windowCenter(t=0){return this._findFloatStringInFrameGroupSequence("x00289132","x00281050",t)}windowWidth(t=0){return this._findFloatStringInFrameGroupSequence("x00289132","x00281051",t)}sliceThickness(t=0){return this._findFloatStringInFrameGroupSequence("x00289110","x00180050",t)}spacingBetweenSlices(t=0){let e=this._dataSet.intString("x00180088");return void 0===e&&(e=null),e}dimensionIndexValues(t=0){let e=null,i=this._dataSet.elements.x52009230;if(void 0!==i){let n=i.items[t].dataSet.elements.x00209111;if(void 0!==n&&null!==n){let t=(n=n.items[0].dataSet).elements.x00209157;if(void 0!==t&&null!==t){let i=t.length/4;e=[];for(let t=0;t<i;t++)e.push(n.uint32("x00209157",t))}}}return e}inStackPositionNumber(t=0){let e=null,i=this._dataSet.elements.x52009230;if(void 0!==i){e=i.items[t].dataSet.elements.x00209111.items[0].dataSet.uint32("x00209057")}else e=null;return console.log(`instack position ${e}`),e}stackID(t=0){let e=null,i=this._dataSet.elements.x52009230;if(void 0!==i){e=i.items[t].dataSet.elements.x00209111.items[0].dataSet.intString("x00209056")}else e=null;return e}extractPixelData(t=0){let e=this._decodePixelData(t);return this.numberOfChannels()>1?this._convertColorSpace(e):e}_findInGroupSequence(t,e,i){let n=this._dataSet.elements[t];if(void 0!==n){let t=n.items[i].dataSet.elements[e];if(void 0!==t)return t.items[0].dataSet}return null}_findStringInGroupSequence(t,e,i,n){let r=this._findInGroupSequence(t,e,n);return null!==r?r.string(i):null}_findStringInFrameGroupSequence(t,e,i){return this._findStringInGroupSequence("x52009229",t,e,0)||this._findStringInGroupSequence("x52009230",t,e,i)}_findStringEverywhere(t,e,i){let n=this._findStringInFrameGroupSequence(t,e,i);return null===n&&(n=this._dataSet.string(e)),void 0===n&&(n=null),n}_findFloatStringInGroupSequence(t,e,i,n){let r=this._dataSet.floatString(i);return void 0===r?null!==(r=this._findInGroupSequence(t,e,n))?r.floatString(i):null:r}_findFloatStringInFrameGroupSequence(t,e,i){return this._findFloatStringInGroupSequence("x52009229",t,e,0)||this._findFloatStringInGroupSequence("x52009230",t,e,i)}_decodePixelData(t=0){let e=this.transferSyntaxUID();if("1.2.840.10008.1.2.4.90"===e||"1.2.840.10008.1.2.4.91"===e)return this._decodeJ2K(t);if("1.2.840.10008.1.2.4.57"===e||"1.2.840.10008.1.2.4.70"===e)return this._decodeJPEGLossless(t);if("1.2.840.10008.1.2.4.50"===e||"1.2.840.10008.1.2.4.51"===e)return this._decodeJPEGBaseline(t);if("1.2.840.10008.1.2"===e||"1.2.840.10008.1.2.1"===e)return this._decodeUncompressed(t);if("1.2.840.10008.1.2.2"===e){let e=this._decodeUncompressed(t);return this._swapFrame(e)}throw{error:`no decoder for transfer syntax ${e}`}}framesAreFragmented(t){return t.intString("x00280008")!==t.elements.x7fe00010.fragments.length}_decodeJ2K(t=0){let e=null;if(this._dataSet.elements.x7fe00010.basicOffsetTable.length)e=rl.readEncapsulatedImageFrame(this._dataSet,this._dataSet.elements.x7fe00010,t);else if(this.framesAreFragmented(this._dataSet)){const i=rl.createJPEGBasicOffsetTable(this._dataSet,this._dataSet.elements.x7fe00010);e=rl.readEncapsulatedImageFrame(this._dataSet,this._dataSet.elements.x7fe00010,t,i)}else e=rl.readEncapsulatedPixelDataFromFragments(this._dataSet,this._dataSet.elements.x7fe00010,t);let i=new ol;if(i.parse(e),1!==i.componentsCount)throw"JPEG2000 decoder returned a componentCount of ${componentsCount}, when 1 is expected";if(1!==i.tiles.length)throw"JPEG2000 decoder returned a tileCount of ${tileCount}, when 1 is expected";return i.tiles[0].items}_decodeJPEGLossless(t=0){let e=rl.readEncapsulatedPixelData(this._dataSet,this._dataSet.elements.x7fe00010,t),i=this.pixelRepresentation(t),n=this.bitsAllocated(t)<=8?1:2,r=(new al.lossless.Decoder).decode(e.buffer,e.byteOffset,e.length,n);return 0===i?2===n?new Uint16Array(r.buffer):new Uint8Array(r.buffer):new Int16Array(r.buffer)}_decodeJPEGBaseline(t=0){let e=rl.readEncapsulatedPixelData(this._dataSet,this._dataSet.elements.x7fe00010,t),i=this.rows(t),n=this.columns(t),r=this.bitsAllocated(t),a=new sl;return a.parse(e),8===r?a.getData(n,i):16===r?a.getData16(n,i):void 0}_decodeUncompressed(t=0){let e=this.pixelRepresentation(t),i=this.bitsAllocated(t),n=this._dataSet.elements.x7fe00010.dataOffset,r=this.numberOfChannels(),a=this.rows(t)*this.columns(t)*r,s=0,o=this._dataSet.byteArray.buffer;if(0===e&&8===i)return s=n+t*a,new Uint8Array(o,s,a);if(0===e&&16===i)return s=n+t*a*2,new Uint16Array(o,s,a);if(1===e&&16===i)return s=n+t*a*2,new Int16Array(o,s,a);if(0===e&&32===i)return s=n+t*a*4,new Uint32Array(o,s,a);if(0===e&&1===i){let e=new ArrayBuffer(a),i=new Uint8Array(e);s=n+t*a;let r=0,l=t*a,h=t*a+a,c=Math.floor(l/8),u=l-8*c,d=Math.ceil(h/8),f=new Uint8Array(o,n);for(let t=c;t<=d;t++){for(;u<8;){switch(u){case 0:i[r]=1&f[t];break;case 1:i[r]=f[t]>>>1&1;break;case 2:i[r]=f[t]>>>2&1;break;case 3:i[r]=f[t]>>>3&1;break;case 4:i[r]=f[t]>>>4&1;break;case 5:i[r]=f[t]>>>5&1;break;case 6:i[r]=f[t]>>>6&1;break;case 7:i[r]=f[t]>>>7&1}if(u++,++r>=a)return i}u=0}}}_convertColorSpace(t){let e=null,i=this.photometricInterpretation(),n=this.planarConfiguration();if("RGB"===i&&0===n)e=t;else if("RGB"===i&&1===n){if(t instanceof Int8Array)e=new Int8Array(t.length);else if(t instanceof Uint8Array)e=new Uint8Array(t.length);else if(t instanceof Int16Array)e=new Int16Array(t.length);else{if(!(t instanceof Uint16Array))throw"unsuported typed array: ${uncompressedData}";e=new Uint16Array(t.length)}let i=t.length/3,n=0,r=0,a=i,s=2*i;for(let o=0;o<i;o++)e[n++]=t[r++],e[n++]=t[a++],e[n++]=t[s++]}else{if("YBR_FULL"!==i)throw"photometric interpolation not supported: ${photometricInterpretation}";{if(t instanceof Int8Array)e=new Int8Array(t.length);else if(t instanceof Uint8Array)e=new Uint8Array(t.length);else if(t instanceof Int16Array)e=new Int16Array(t.length);else{if(!(t instanceof Uint16Array))throw"unsuported typed array: ${uncompressedData}";e=new Uint16Array(t.length)}let i=t.length/3,n=0,r=0;for(let a=0;a<i;a++){let i=t[n++],a=t[n++],s=t[n++];e[r++]=i+1.402*(s-128),e[r++]=i-.34414*(a-128)-.71414*(s-128),e[r++]=i+1.772*(a-128)}}}return e}_swapFrame(t){let e=this.bitsAllocated();if(16===e)for(let e=0;e<t.length;e++)t[e]=this._swap16(t[e]);else if(32===e)for(let e=0;e<t.length;e++)t[e]=this._swap32(t[e]);return t}}class hl extends nl{constructor(t,e){super(),this._id=e,this._url=t.url,this._header={},this._buffer=null;try{(new TextDecoder).decode(t.mhdBuffer).split("\n").forEach(t=>{let e=t.split("=");2===e.length&&(this._header[e[0].trim()]=e[1].trim())}),this._header.DimSize=this._header.DimSize.split(" "),this._header.ElementSpacing=this._header.ElementSpacing.split(" "),this._header.TransformMatrix=this._header.TransformMatrix.split(" "),this._header.Offset=this._header.Offset.split(" "),this._buffer=t.rawBuffer}catch(t){window.console.log("ooops... :(")}}rightHanded(){let t=this._header.AnatomicalOrientation;return this._rightHanded="RAS"===t||"RPI"===t||"LPS"===t||"LAI"===t,this._rightHanded}seriesInstanceUID(){return this._url}numberOfFrames(){return parseInt(this._header.DimSize[2],10)}sopInstanceUID(t=0){return t}rows(t=0){return parseInt(this._header.DimSize[1],10)}columns(t=0){return parseInt(this._header.DimSize[0],10)}pixelType(t=0){return 0}bitsAllocated(t=0){let e=1;return"MET_UCHAR"===this._header.ElementType||"MET_CHAR"===this._header.ElementType?e=8:"MET_USHORT"===this._header.ElementType||"MET_SHORT"===this._header.ElementType?e=16:"MET_UFLOAT"!==this._header.ElementType&&"MET_FLOAT"!==this._header.ElementType||(e=32),e}pixelSpacing(t=0){return[parseFloat(this._header.ElementSpacing[1],10),parseFloat(this._header.ElementSpacing[0],10),parseFloat(this._header.ElementSpacing[2],10)]}imageOrientation(t=0){let e=this._header.AnatomicalOrientation.match(/L/)?-1:1,i=this._header.AnatomicalOrientation.match(/P/)?-1:1,n=new Pe(parseFloat(this._header.TransformMatrix[0])*e,parseFloat(this._header.TransformMatrix[1])*i,parseFloat(this._header.TransformMatrix[2]));n.normalize();let r=new Pe(parseFloat(this._header.TransformMatrix[3])*e,parseFloat(this._header.TransformMatrix[4])*i,parseFloat(this._header.TransformMatrix[5]));return r.normalize(),[n.x,n.y,n.z,r.x,r.y,r.z]}imagePosition(t=0){return[parseFloat(this._header.Offset[0]),parseFloat(this._header.Offset[1]),parseFloat(this._header.Offset[2])]}extractPixelData(t=0){return this._decompressUncompressed(t)}_decompressUncompressed(t=0){let e=this._buffer,i=this.numberOfChannels(),n=this.rows(t)*this.columns(t)*i;this.rightHanded()||(t=this.numberOfFrames()-1-t);let r=t*n;return"MET_CHAR"===this._header.ElementType?(r=r,new Int8Array(e,r,n)):"MET_UCHAR"===this._header.ElementType?(r=r,new Uint8Array(e,r,n)):"MET_SHORT"===this._header.ElementType?(r*=2,new Int16Array(e,r,n)):"MET_USHORT"===this._header.ElementType?(r*=2,new Uint16Array(e,r,n)):"MET_FLOAT"===this._header.ElementType?(r*=4,new Float32Array(e,r,n)):void 0}}let cl=i("UdOt");class ul extends nl{constructor(t,e){if(super(),this._id=e,this._arrayBuffer=t.buffer,this._url=t.url,this._dataSet=null,this._niftiHeader=null,this._niftiImage=null,this._ordered=!0,this._orderedData=null,this._qfac=1,!cl.isNIFTI(this._arrayBuffer))throw"parsers.nifti could not parse the file";this._dataSet=cl.readHeader(this._arrayBuffer),this._niftiImage=cl.readImage(this._dataSet,this._arrayBuffer)}seriesInstanceUID(){return this._url}numberOfFrames(){return this._dataSet.dims[3]}numberOfChannels(){let t=1;return this._dataSet.dims[0]>=5?(t=this._dataSet.dims[5],this._ordered=!1):128===this._dataSet.datatypeCode?t=3:2304===this._dataSet.datatypeCode&&(t=4),t}sopInstanceUID(t=0){return t}rows(t=0){return this._dataSet.dims[2]}columns(t=0){return this._dataSet.dims[1]}pixelType(t=0){let e=0;return 16!==this._dataSet.datatypeCode&&64!==this._dataSet.datatypeCode&&1536!==this._dataSet.datatypeCode||(e=1),e}bitsAllocated(t=0){return this._dataSet.numBitsPerVoxel}pixelSpacing(t=0){return[this._dataSet.pixDims[1],this._dataSet.pixDims[2],this._dataSet.pixDims[3]]}sliceThickness(){return null}imageOrientation(t=0){if(this._dataSet.qform_code>0){let t=0,e=this._dataSet.quatern_b,i=this._dataSet.quatern_c,n=this._dataSet.quatern_d;return(t=1-(e*e+i*i+n*n))<1e-7?(e*=t=1/Math.sqrt(e*e+i*i+n*n),i*=t,n*=t,t=0):t=Math.sqrt(t),this._dataSet.pixDims[0]<0&&(this._rightHanded=!1),[-(t*t+e*e-i*i-n*n),-2*(e*i+t*n),2*(e*n-t*i),-2*(e*i-t*n),-(t*t+i*i-e*e-n*n),2*(i*n+t*e)]}if(this._dataSet.sform_code>0){console.log("sform > 0");this._dataSet.srow_x,this._dataSet.srow_y,this._dataSet.srow_z}else 0===this._dataSet.qform_code&&console.log("qform === 0");return[1,0,0,0,1,0]}imagePosition(t=0){return[-this._dataSet.qoffset_x,-this._dataSet.qoffset_y,this._dataSet.qoffset_z]}dimensionIndexValues(t=0){return null}instanceNumber(t=0){return t}windowCenter(t=0){return null}windowWidth(t=0){return null}rescaleSlope(t=0){return this._dataSet.scl_slope}rescaleIntercept(t=0){return this._dataSet.scl_intercept}extractPixelData(t=0){return this._decompressUncompressed(t)}_decompressUncompressed(t=0){let e=this.numberOfChannels(),i=this.rows(t)*this.columns(t)*e,n=t*i,r=this._niftiImage;return this._ordered||null!==this._orderedData||this._reorderData(),null!==this._orderedData?this._orderedData.slice(n,n+i):2===this._dataSet.datatypeCode?new Uint8Array(r,n,i):256===this._dataSet.datatypeCode?new Int8Array(r,n,i):512===this._dataSet.datatypeCode?(n*=2,new Uint16Array(r,n,i)):4===this._dataSet.datatypeCode?(n*=2,new Int16Array(r,n,i)):8===this._dataSet.datatypeCode?(n*=4,new Int32Array(r,n,i)):16===this._dataSet.datatypeCode?(n*=4,new Float32Array(r,n,i)):void console.log(`Unknown data type: datatypeCode : ${this._dataSet.datatypeCode}`)}_reorderData(){window.console.log("re-order");let t=this.numberOfChannels(),e=this.rows()*this.columns()*t,i=this._niftiImage,n=e*this.numberOfFrames(),r=null;this._orderedData=null,2===this._dataSet.datatypeCode?(r=new Uint8Array(i,0,n),this._orderedData=new Uint8Array(r.length)):256===this._dataSet.datatypeCode?(r=new Int8Array(i,0,n),this._orderedData=new Int8Array(r.length)):512===this._dataSet.datatypeCode?(r=new Uint16Array(i,0,n),this._orderedData=new Uint16Array(r.length)):4===this._dataSet.datatypeCode?(r=new Int16Array(i,0,n),this._orderedData=new Int16Array(r.length)):16===this._dataSet.datatypeCode&&(r=new Float32Array(i,0,n),this._orderedData=new Float32Array(r.length));let a=r.length/3,s=0,o=0,l=a,h=2*a;for(let t=0;t<a;t++)this._orderedData[s++]=r[o++],this._orderedData[s++]=r[l++],this._orderedData[s++]=r[h++];this._ordered=!0}}let dl=i("iAY5"),fl=i("rRpN");class pl extends nl{constructor(t,e){super(),this._id=e,this._arrayBuffer=t.buffer,this._url=t.url,this._dataSet=null,this._unpackedData=null;try{this._dataSet=fl.parse(this._arrayBuffer)}catch(t){window.console.log("ooops... :(")}window.console.log(this._dataSet)}rightHanded(){return this._dataSet.space.match(/^right-anterior-superior/)||this._dataSet.space.match(/^left-posterior-superior/)?this._rightHanded=!0:this._rightHanded=!1,this._rightHanded}seriesInstanceUID(){return this._url}numberOfFrames(){return this._dataSet.sizes[2]}numberOfChannels(){return 1}sopInstanceUID(t=0){return t}rows(t=0){return this._dataSet.sizes[1]}columns(t=0){return this._dataSet.sizes[0]}pixelType(t=0){let e=0;return"float"===this._dataSet.type&&(e=1),e}bitsAllocated(t=0){let e=1;return"int8"===this._dataSet.type||"uint8"===this._dataSet.type||"char"===this._dataSet.type?e=8:"int16"===this._dataSet.type||"uint16"===this._dataSet.type||"short"===this._dataSet.type?e=16:"int32"!==this._dataSet.type&&"uint32"!==this._dataSet.type&&"float"!==this._dataSet.type||(e=32),e}pixelSpacing(t=0){const e=new Pe(this._dataSet.spaceDirections[1][0],this._dataSet.spaceDirections[1][1],this._dataSet.spaceDirections[1][2]),i=new Pe(this._dataSet.spaceDirections[2][0],this._dataSet.spaceDirections[2][1],this._dataSet.spaceDirections[2][2]),n=new Pe(this._dataSet.spaceDirections[2][0],this._dataSet.spaceDirections[2][1],this._dataSet.spaceDirections[2][2]);return[e.length(),i.length(),n.length()]}imageOrientation(t=0){let e=this._dataSet.space.match(/right/)?-1:1,i=this._dataSet.space.match(/anterior/)?-1:1,n=new Pe(this._dataSet.spaceDirections[0][0]*e,this._dataSet.spaceDirections[0][1]*i,this._dataSet.spaceDirections[0][2]);n.normalize();let r=new Pe(this._dataSet.spaceDirections[1][0]*e,this._dataSet.spaceDirections[1][1]*i,this._dataSet.spaceDirections[1][2]);return r.normalize(),[n.x,n.y,n.z,r.x,r.y,r.z]}imagePosition(t=0){return[this._dataSet.spaceOrigin[0],this._dataSet.spaceOrigin[1],this._dataSet.spaceOrigin[2]]}extractPixelData(t=0){return this._decompressUncompressed(t)}_decompressUncompressed(t=0){let e=this._dataSet.buffer;const i=this.numberOfChannels(),n=this.rows(t)*this.columns(t)*i;this.rightHanded()||(t=this.numberOfFrames()-1-t);let r=t*n;if(null===this._unpackedData&&"gzip"===this._dataSet.encoding){let t=dl.inflate(this._dataSet.buffer);this._unpackedData=t.buffer,e=this._unpackedData}else"gzip"===this._dataSet.encoding&&(e=this._unpackedData);return"int8"===this._dataSet.type||"char"===this._dataSet.type?(r=r,new Int8Array(e,r,n)):"uint8"===this._dataSet.type?(r=r,new Uint8Array(e,r,n)):"int16"===this._dataSet.type||"short"===this._dataSet.type?(r*=2,new Int16Array(e,r,n)):"uint16"===this._dataSet.type?(r*=2,new Uint16Array(e,r,n)):"int32"===this._dataSet.type?(r*=4,new Int32Array(e,r,n)):"uint32"===this._dataSet.type?(r*=4,new Uint32Array(e,r,n)):"float"===this._dataSet.type?(r*=4,new Float32Array(e,r,n)):void 0}}const ml=i("iAY5");class gl extends THREE.Object3D{constructor(t){super(),this._helpersSlice=t,this._visible=!0,this._color=16711680,this._material=null,this._geometry=null,this._mesh=null,this._create()}set helpersSlice(t){this._helpersSlice=t,this._update()}get helpersSlice(){return this._helpersSlice}set visible(t){this._visible=t,this._mesh&&(this._mesh.visible=this._visible)}get visible(){return this._visible}set color(t){this._color=t,this._material&&this._material.color.set(this._color)}get color(){return this._color}_create(){if(this._material||(this._material=new THREE.LineBasicMaterial({color:this._color,linewidth:1})),this._helpersSlice.geometry.vertices){this._geometry=new THREE.Geometry;for(let t=0;t<this._helpersSlice.geometry.vertices.length;t++)this._geometry.vertices.push(this._helpersSlice.geometry.vertices[t]);this._geometry.vertices.push(this._helpersSlice.geometry.vertices[0]),this._mesh=new THREE.Line(this._geometry,this._material),"IJK"===this._helpersSlice.aabbSpace&&this._mesh.applyMatrix(this._helpersSlice.stack.ijk2LPS),this._mesh.visible=this._visible,this.add(this._mesh)}}_update(){this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh=null),this._create()}dispose(){this._mesh.material.dispose(),this._mesh.material=null,this._geometry.dispose(),this._geometry=null,this._material.dispose(),this._material=null}}class vl extends THREE.Object3D{constructor(t){super(),this._stack=t,this._visible=!0,this._color=16777215,this._material=null,this._geometry=null,this._mesh=null,this._meshStack=null,this._create()}set visible(t){this._visible=t,this._mesh&&(this._mesh.visible=this._visible)}get visible(){return this._visible}set color(t){this._color=t,this._material&&this._material.color.set(this._color)}get color(){return this._color}_create(){const t=this._stack.dimensionsIJK,e=this._stack.halfDimensionsIJK,i=new Pe(-.5,-.5,-.5),n=new THREE.BoxGeometry(t.x,t.y,t.z);n.applyMatrix((new Re).makeTranslation(e.x+i.x,e.y+i.y,e.z+i.z)),this._geometry=n,this._material=new THREE.MeshBasicMaterial({wireframe:!0});const r=new THREE.Mesh(this._geometry,null);r.applyMatrix(this._stack.ijk2LPS),r.visible=this._visible,this._meshStack=r,this._mesh=new THREE.BoxHelper(this._meshStack,this._color),this._material=this._mesh.material,this.add(this._mesh)}_update(){this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh.material.dispose(),this._mesh.material=null,this._mesh=null),this._create()}dispose(){this._mesh.material.dispose(),this._mesh.material=null,this._geometry.dispose(),this._geometry=null,this._material.dispose(),this._material=null}}class _l{static aabbPlane(t,e){let i=[];if(!this.validateAabb(t)||!this.validatePlane(e))return window.console.log("Invalid aabb or plane provided."),!1;let n=new Re;n.getInverse(t.toAABB);let r=e.direction.clone().applyMatrix4(t.toAABB),a=new Pe(0,0,0).applyMatrix4(t.toAABB),s=this.posdir(e.position.clone().applyMatrix4(t.toAABB),new Pe(r.x-a.x,r.y-a.y,r.z-a.z).normalize()),o=qo.bbox(t.center,t.halfDimensions),l=new Pe(new Pe(1,0,0),new Pe(0,1,0),new Pe(0,0,1)),h=this.posdir(new Pe(t.center.x-t.halfDimensions.x,t.center.y-t.halfDimensions.y,t.center.z-t.halfDimensions.z),l.x);this.rayPlaneInBBox(h,s,o,i),h.direction=l.y,this.rayPlaneInBBox(h,s,o,i),h.direction=l.z,this.rayPlaneInBBox(h,s,o,i);let c=this.posdir(new Pe(t.center.x+t.halfDimensions.x,t.center.y+t.halfDimensions.y,t.center.z+t.halfDimensions.z),l.x);this.rayPlaneInBBox(c,s,o,i),c.direction=l.y,this.rayPlaneInBBox(c,s,o,i),c.direction=l.z,this.rayPlaneInBBox(c,s,o,i);let u=this.posdir(new Pe(t.center.x+t.halfDimensions.x,t.center.y-t.halfDimensions.y,t.center.z-t.halfDimensions.z),l.y);this.rayPlaneInBBox(u,s,o,i),u.direction=l.z,this.rayPlaneInBBox(u,s,o,i);let d=this.posdir(new Pe(t.center.x-t.halfDimensions.x,t.center.y+t.halfDimensions.y,t.center.z-t.halfDimensions.z),l.x);this.rayPlaneInBBox(d,s,o,i),d.direction=l.z,this.rayPlaneInBBox(d,s,o,i);let f=this.posdir(new Pe(t.center.x-t.halfDimensions.x,t.center.y-t.halfDimensions.y,t.center.z+t.halfDimensions.z),l.x);return this.rayPlaneInBBox(f,s,o,i),f.direction=l.y,this.rayPlaneInBBox(f,s,o,i),i.map(function(t){return t.applyMatrix4(n)}),i}static rayPlane(t,e){if(0!==t.direction.dot(e.direction)){let i=(e.direction.x*(e.position.x-t.position.x)+e.direction.y*(e.position.y-t.position.y)+e.direction.z*(e.position.z-t.position.z))/(e.direction.x*t.direction.x+e.direction.y*t.direction.y+e.direction.z*t.direction.z);return new Pe(t.position.x+i*t.direction.x,t.position.y+i*t.direction.y,t.position.z+i*t.direction.z)}return null}static rayBox(t,e){let i=[],n=qo.bbox(e.center,e.halfDimensions),r=this.posdir(new Pe(n.min.x,e.center.y,e.center.z),new Pe(-1,0,0));return this.rayPlaneInBBox(t,r,n,i),r=this.posdir(new Pe(n.max.x,e.center.y,e.center.z),new Pe(1,0,0)),this.rayPlaneInBBox(t,r,n,i),r=this.posdir(new Pe(e.center.x,n.min.y,e.center.z),new Pe(0,-1,0)),this.rayPlaneInBBox(t,r,n,i),r=this.posdir(new Pe(e.center.x,n.max.y,e.center.z),new Pe(0,1,0)),this.rayPlaneInBBox(t,r,n,i),r=this.posdir(new Pe(e.center.x,e.center.y,n.min.z),new Pe(0,0,-1)),this.rayPlaneInBBox(t,r,n,i),r=this.posdir(new Pe(e.center.x,e.center.y,n.max.z),new Pe(0,0,1)),this.rayPlaneInBBox(t,r,n,i),i}static rayPlaneInBBox(t,e,i,n){let r=this.rayPlane(t,e);r&&this.inBBox(r,i)&&(n.find(this.findIntersection(r))||n.push(r))}static findIntersection(t){return function(e,i,n){return t.x===e.x&&t.y===e.y&&t.z===e.z}}static inBBox(t,e){return!!(t&&t.x>=e.min.x-1e-4&&t.y>=e.min.y-1e-4&&t.z>=e.min.z-1e-4&&t.x<=e.max.x+1e-4&&t.y<=e.max.y+1e-4&&t.z<=e.max.z+1e-4)}static posdir(t,e){return{position:t,direction:e}}static validatePlane(t){return null===t?(window.console.log("Invalid plane."),window.console.log(t),!1):o.vector3(t.position)?!!o.vector3(t.direction)||(window.console.log("Invalid plane.direction."),window.console.log(t.direction),!1):(window.console.log("Invalid plane.position."),window.console.log(t.position),!1)}static validateAabb(t){return null===t?(window.console.log("Invalid aabb."),window.console.log(t),!1):o.matrix4(t.toAABB)?o.vector3(t.center)?!!(o.vector3(t.halfDimensions)&&t.halfDimensions.x>=0&&t.halfDimensions.y>=0&&t.halfDimensions.z>=0)||(window.console.log("Invalid aabb.halfDimensions."),window.console.log(t.halfDimensions),!1):(window.console.log("Invalid aabb.center."),window.console.log(t.center),!1):(window.console.log("Invalid aabb.toAABB: "),window.console.log(t.toAABB),!1)}}class yl extends THREE.ShapeGeometry{constructor(t,e,i,n,r=new Re){let a={halfDimensions:t,center:e,toAABB:r},s={position:i,direction:n},o=_l.aabbPlane(a,s);if(o.length<3)throw window.console.log("WARNING: Less than 3 intersections between AABB and Plane."),window.console.log("AABB"),window.console.log(a),window.console.log("Plane"),window.console.log(s),window.console.log("exiting..."),"geometries.slice has less than 3 intersections, can not create a valid geometry.";let l=yl.orderIntersections(o,n);super(yl.shape(l)),this.type="SliceGeometry",this.vertices=l,this.verticesNeedUpdate=!0}static shape(t){let e=new THREE.Shape;e.moveTo(t[0].xy.x,t[0].xy.y);for(let i=1;i<t.length;i++)e.lineTo(t[i].xy.x,t[i].xy.y);return e.lineTo(t[0].xy.x,t[0].xy.y),e}static centerOfMass(t){let e=new Pe(0,0,0);for(let i=0;i<t.length;i++)e.x+=t[i].x,e.y+=t[i].y,e.z+=t[i].z;return e.divideScalar(t.length),e}static orderIntersections(t,e){let i=yl.centerOfMass(t),n=new Pe(t[0].x-i.x,t[0].y-i.y,t[0].z-i.z).normalize(),r=new Pe(0,0,0).crossVectors(n,e).normalize(),a=[];for(let e=0;e<t.length;e++){let s=new Pe(t[e].x,t[e].y,t[e].z);s.direction=new Pe(t[e].x-i.x,t[e].y-i.y,t[e].z-i.z).normalize();let o=n.dot(s.direction),l=r.dot(s.direction);s.xy={x:o,y:l};let h=Math.atan2(l,o)*(180/Math.PI);s.angle=h,a.push(s)}a.sort(function(t,e){return t.angle-e.angle});let s=[a[0]];for(let t=1;t<a.length;t++)Math.abs(a[t-1].angle-a[t].angle)>1e-4&&s.push(a[t]);return s}}class bl{static uniforms(){return{uTextureSize:{type:"i",value:0,typeGLSL:"int"},uTextureContainer:{type:"tv",value:[],typeGLSL:"sampler2D",length:7},uDataDimensions:{type:"iv",value:[0,0,0],typeGLSL:"ivec3"},uWorldToData:{type:"m4",value:new Re,typeGLSL:"mat4"},uWindowCenterWidth:{type:"fv1",value:[0,0],typeGLSL:"float",length:2},uRescaleSlopeIntercept:{type:"fv1",value:[0,0],typeGLSL:"float",length:2},uNumberOfChannels:{type:"i",value:1,typeGLSL:"int"},uBitsAllocated:{type:"i",value:8,typeGLSL:"int"},uInvert:{type:"i",value:0,typeGLSL:"int"},uLut:{type:"i",value:0,typeGLSL:"int"},uTextureLUT:{type:"t",value:[],typeGLSL:"sampler2D"},uLutSegmentation:{type:"i",value:0,typeGLSL:"int"},uTextureLUTSegmentation:{type:"t",value:[],typeGLSL:"sampler2D"},uPixelType:{type:"i",value:0,typeGLSL:"int"},uPackedPerPixel:{type:"i",value:1,typeGLSL:"int"},uInterpolation:{type:"i",value:1,typeGLSL:"int"},uCanvasWidth:{type:"f",value:0,typeGLSL:"float"},uCanvasHeight:{type:"f",value:0,typeGLSL:"float"},uBorderColor:{type:"v3",value:[1,0,.5],typeGLSL:"vec3"},uBorderWidth:{type:"f",value:2,typeGLSL:"float"},uBorderMargin:{type:"f",value:2,typeGLSL:"float"},uBorderDashLength:{type:"f",value:10,typeGLSL:"float"}}}}class xl{compute(){return"\nvarying vec4 vPos;\n\n//\n// main\n//\nvoid main() {\n\n  vPos = modelMatrix * vec4(position, 1.0 );\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );\n\n}\n        "}}class wl{constructor(){this._name="shadersBase",this._base={_functions:{},_uniforms:{}},this._definition=""}get name(){return this._name}set name(t){this._name=t}}var El=new class extends wl{constructor(){super(),this.name="unpack",this._packedData="packedData",this._offset="offset",this._unpackedData="unpackedData",this._base._uniforms={uNumberOfChannels:{value:1},uBitsAllocated:{value:16},uPixelType:{value:0}}}api(t=this._base,e=this._packedData,i=this._offset,n=this._unpackedData){return this._base=t,this.compute(e,i,n)}compute(t,e,i){return this.computeDefinition(),this._base._functions[this._name]=this._definition,`${this._name}(${t}, ${e}, ${i});`}computeDefinition(){let t="";if(1===this._base._uniforms.uNumberOfChannels.value)switch(this._base._uniforms.uBitsAllocated.value){case 1:case 8:t=this.upack8();break;case 16:t=this.upack16();break;case 32:t=this.upack32();break;default:t=this.upackDefault()}else t=this.upackIdentity();this._definition=`\nvoid ${this._name}(in vec4 packedData, in int offset, out vec4 unpackedData){\n\n${t}\n\n}  \n    `}upack8(){return this._base._functions.uInt8=this.uInt8(),"\nuInt8(\n  packedData.r,\n  unpackedData.x);\n    "}upack16(){return this._base._functions.uInt16=this.uInt16(),"\nuInt16(\n  packedData.r * float( 1 - offset) + packedData.b * float(offset),\n  packedData.g * float( 1 - offset) + packedData.a * float(offset),\n  unpackedData.x);\n    "}upack32(){return 0===this._base._uniforms.uPixelType.value?(this._base._functions.uInt32=this.uInt32(),"\nuInt32(\n  packedData.r,\n  packedData.g,\n  packedData.b,\n  packedData.a,\n  unpackedData.x);\n      "):(this._base._functions.uFloat32=this.uFloat32(),"\nuFloat32(\n  packedData.r,\n  packedData.g,\n  packedData.b,\n  packedData.a,\n  unpackedData.x);\n      ")}upackIdentity(){return"\nunpackedData = packedData;\n      "}uInt8(){return"\nvoid uInt8(in float r, out float value){\n  value = r * 255.;\n}\n    "}uInt16(){return"\nvoid uInt16(in float r, in float a, out float value){\n  value = r * 255. + a * 255. * 256.;\n}\n    "}uInt32(){return"\nvoid uInt32(in float r, in float g, in float b, in float a, out float value){\n  value = r * 255. + g * 255. * 256. + b * 255. * 256. * 256. + a * 255. * 256. * 256. * 256.;\n  // value = r * 255. + g * 65025. + b * 16581375. + a * 4228250625.;\n}\n    "}uFloat32(){return"\nvoid uFloat32(in float r, in float g, in float b, in float a, out float value){\n\n  // create arrays containing bits for rgba values\n  // value between 0 and 255\n  value = r * 255.;\n  int bytemeR[8];\n  bytemeR[0] = int(floor(value / 128.));\n  value -= float(bytemeR[0] * 128);\n  bytemeR[1] = int(floor(value / 64.));\n  value -= float(bytemeR[1] * 64);\n  bytemeR[2] = int(floor(value / 32.));\n  value -= float(bytemeR[2] * 32);\n  bytemeR[3] = int(floor(value / 16.));\n  value -= float(bytemeR[3] * 16);\n  bytemeR[4] = int(floor(value / 8.));\n  value -= float(bytemeR[4] * 8);\n  bytemeR[5] = int(floor(value / 4.));\n  value -= float(bytemeR[5] * 4);\n  bytemeR[6] = int(floor(value / 2.));\n  value -= float(bytemeR[6] * 2);\n  bytemeR[7] = int(floor(value));\n\n  value = g * 255.;\n  int bytemeG[8];\n  bytemeG[0] = int(floor(value / 128.));\n  value -= float(bytemeG[0] * 128);\n  bytemeG[1] = int(floor(value / 64.));\n  value -= float(bytemeG[1] * 64);\n  bytemeG[2] = int(floor(value / 32.));\n  value -= float(bytemeG[2] * 32);\n  bytemeG[3] = int(floor(value / 16.));\n  value -= float(bytemeG[3] * 16);\n  bytemeG[4] = int(floor(value / 8.));\n  value -= float(bytemeG[4] * 8);\n  bytemeG[5] = int(floor(value / 4.));\n  value -= float(bytemeG[5] * 4);\n  bytemeG[6] = int(floor(value / 2.));\n  value -= float(bytemeG[6] * 2);\n  bytemeG[7] = int(floor(value));\n\n  value = b * 255.;\n  int bytemeB[8];\n  bytemeB[0] = int(floor(value / 128.));\n  value -= float(bytemeB[0] * 128);\n  bytemeB[1] = int(floor(value / 64.));\n  value -= float(bytemeB[1] * 64);\n  bytemeB[2] = int(floor(value / 32.));\n  value -= float(bytemeB[2] * 32);\n  bytemeB[3] = int(floor(value / 16.));\n  value -= float(bytemeB[3] * 16);\n  bytemeB[4] = int(floor(value / 8.));\n  value -= float(bytemeB[4] * 8);\n  bytemeB[5] = int(floor(value / 4.));\n  value -= float(bytemeB[5] * 4);\n  bytemeB[6] = int(floor(value / 2.));\n  value -= float(bytemeB[6] * 2);\n  bytemeB[7] = int(floor(value));\n\n  value = a * 255.;\n  int bytemeA[8];\n  bytemeA[0] = int(floor(value / 128.));\n  value -= float(bytemeA[0] * 128);\n  bytemeA[1] = int(floor(value / 64.));\n  value -= float(bytemeA[1] * 64);\n  bytemeA[2] = int(floor(value / 32.));\n  value -= float(bytemeA[2] * 32);\n  bytemeA[3] = int(floor(value / 16.));\n  value -= float(bytemeA[3] * 16);\n  bytemeA[4] = int(floor(value / 8.));\n  value -= float(bytemeA[4] * 8);\n  bytemeA[5] = int(floor(value / 4.));\n  value -= float(bytemeA[5] * 4);\n  bytemeA[6] = int(floor(value / 2.));\n  value -= float(bytemeA[6] * 2);\n  bytemeA[7] = int(floor(value));\n\n  // compute float32 value from bit arrays\n\n  // sign\n  int issigned = 1 - 2 * bytemeR[0];\n  //   issigned = int(pow(-1., float(bytemeR[0])));\n\n  // exponent\n  int exponent = 0;\n\n  exponent += bytemeR[1] * int(pow(2., 7.));\n  exponent += bytemeR[2] * int(pow(2., 6.));\n  exponent += bytemeR[3] * int(pow(2., 5.));\n  exponent += bytemeR[4] * int(pow(2., 4.));\n  exponent += bytemeR[5] * int(pow(2., 3.));\n  exponent += bytemeR[6] * int(pow(2., 2.));\n  exponent += bytemeR[7] * int(pow(2., 1.));\n\n  exponent += bytemeG[0];\n\n\n  // fraction\n  float fraction = 0.;\n\n  fraction = float(bytemeG[1]) * pow(2., -1.);\n  fraction += float(bytemeG[2]) * pow(2., -2.);\n  fraction += float(bytemeG[3]) * pow(2., -3.);\n  fraction += float(bytemeG[4]) * pow(2., -4.);\n  fraction += float(bytemeG[5]) * pow(2., -5.);\n  fraction += float(bytemeG[6]) * pow(2., -6.);\n  fraction += float(bytemeG[7]) * pow(2., -7.);\n\n  fraction += float(bytemeB[0]) * pow(2., -8.);\n  fraction += float(bytemeB[1]) * pow(2., -9.);\n  fraction += float(bytemeB[2]) * pow(2., -10.);\n  fraction += float(bytemeB[3]) * pow(2., -11.);\n  fraction += float(bytemeB[4]) * pow(2., -12.);\n  fraction += float(bytemeB[5]) * pow(2., -13.);\n  fraction += float(bytemeB[6]) * pow(2., -14.);\n  fraction += float(bytemeB[7]) * pow(2., -15.);\n\n  fraction += float(bytemeA[0]) * pow(2., -16.);\n  fraction += float(bytemeA[1]) * pow(2., -17.);\n  fraction += float(bytemeA[2]) * pow(2., -18.);\n  fraction += float(bytemeA[3]) * pow(2., -19.);\n  fraction += float(bytemeA[4]) * pow(2., -20.);\n  fraction += float(bytemeA[5]) * pow(2., -21.);\n  fraction += float(bytemeA[6]) * pow(2., -22.);\n  fraction += float(bytemeA[7]) * pow(2., -23.);\n\n  value = float(issigned) * pow( 2., float(exponent - 127)) * (1. + fraction);\n}\n    "}};var Sl=new class extends wl{constructor(){super(),this.name="texture3d",this._dataCoordinates="dataCoordinates",this._dataValue="dataValue",this._offset="offset"}api(t=this._base,e=this._dataCoordinates,i=this._dataValue,n=this._offset){return this._base=t,this.compute(e,i,n)}compute(t,e,i){return this.computeDefinition(),this._base._functions[this._name]=this._definition,`${this._name}(${t}, ${e}, ${i});`}computeDefinition(){this._definition=`\nvoid ${this._name}(in ivec3 dataCoordinates, out vec4 dataValue, out int offset){\n    \n  int index = dataCoordinates.x\n            + dataCoordinates.y * uDataDimensions.x\n            + dataCoordinates.z * uDataDimensions.y * uDataDimensions.x;\n  int indexP = int(index/uPackedPerPixel);\n  offset = index - 2*indexP;\n\n  // Map data index to right sampler2D texture\n  int voxelsPerTexture = uTextureSize*uTextureSize;\n  int textureIndex = int(floor(float(indexP) / float(voxelsPerTexture)));\n  // modulo seems incorrect sometimes...\n  // int inTextureIndex = int(mod(float(index), float(textureSize*textureSize)));\n  int inTextureIndex = indexP - voxelsPerTexture*textureIndex;\n\n  // Get row and column in the texture\n  int colIndex = int(mod(float(inTextureIndex), float(uTextureSize)));\n  int rowIndex = int(floor(float(inTextureIndex)/float(uTextureSize)));\n\n  // Map row and column to uv\n  vec2 uv = vec2(0,0);\n  uv.x = (0.5 + float(colIndex)) / float(uTextureSize);\n  uv.y = 1. - (0.5 + float(rowIndex)) / float(uTextureSize);\n\n  //\n  if(textureIndex == 0){ dataValue = texture2D(uTextureContainer[0], uv); }\n  else if(textureIndex == 1){dataValue = texture2D(uTextureContainer[1], uv);}\n  else if(textureIndex == 2){ dataValue = texture2D(uTextureContainer[2], uv); }\n  else if(textureIndex == 3){ dataValue = texture2D(uTextureContainer[3], uv); }\n  else if(textureIndex == 4){ dataValue = texture2D(uTextureContainer[4], uv); }\n  else if(textureIndex == 5){ dataValue = texture2D(uTextureContainer[5], uv); }\n  else if(textureIndex == 6){ dataValue = texture2D(uTextureContainer[6], uv); }\n\n}\n    `}};var Tl=new class extends wl{constructor(){super(),this.name="interpolationIdentity",this._currentVoxel="currentVoxel",this._dataValue="dataValue"}api(t=this._base,e=this._currentVoxel,i=this._dataValue){return this._base=t,this.compute(e,i)}compute(t,e){return this.computeDefinition(),this._base._functions[this._name]=this._definition,`${this._name}(${t}, ${e});`}computeDefinition(){this._definition=`\nvoid ${this._name}(in vec3 currentVoxel, out vec4 dataValue){\n  // lower bound\n  vec3 rcurrentVoxel = vec3(floor(currentVoxel.x + 0.5 ), floor(currentVoxel.y + 0.5 ), floor(currentVoxel.z + 0.5 ));\n  ivec3 voxel = ivec3(int(rcurrentVoxel.x), int(rcurrentVoxel.y), int(rcurrentVoxel.z));\n\n  vec4 tmp = vec4(0., 0., 0., 0.);\n  int offset = 0;\n\n  ${Sl.api(this._base,"voxel","tmp","offset")}\n  ${El.api(this._base,"tmp","offset","dataValue")}\n}\n    `}};var Ml=new class extends wl{constructor(){super(),this.name="interpolationTrilinear",this._currentVoxel="currentVoxel",this._dataValue="dataValue",this._gradient="gradient"}api(t=this._base,e=this._currentVoxel,i=this._dataValue,n=this._gradient){return this._base=t,this.compute(e,i,n)}compute(t,e,i){return this.computeDefinition(),this._base._functions[this._name]=this._definition,`${this._name}(${t}, ${e}, ${i});`}computeDefinition(){this._definition=`\nvoid ${this._name}(in vec3 currentVoxel, out vec4 dataValue, out vec3 gradient){\n\n  // https://en.wikipedia.org/wiki/Trilinear_interpolation\n  vec3 lower_bound = vec3(floor(currentVoxel.x), floor(currentVoxel.y), floor(currentVoxel.z));\n  if(lower_bound.x < 0.){\n    lower_bound.x = 0.;\n  }\n  if(lower_bound.y < 0.){\n    lower_bound.y = 0.;\n  }\n  if(lower_bound.z < 0.){\n    lower_bound.z = 0.;\n  }\n  \n  vec3 higher_bound = lower_bound + vec3(1);\n\n  float xd = ( currentVoxel.x - lower_bound.x ) / ( higher_bound.x - lower_bound.x );\n  float yd = ( currentVoxel.y - lower_bound.y ) / ( higher_bound.y - lower_bound.y );\n  float zd = ( currentVoxel.z - lower_bound.z ) / ( higher_bound.z - lower_bound.z );\n\n  //\n  // c00\n  //\n\n  //\n\n  vec4 v000 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c000 = vec3(lower_bound.x, lower_bound.y, lower_bound.z);\n  ${Tl.api(this._base,"c000","v000")}\n  vec3 g000 = v000.r * vec3(-1., -1., -1.);\n\n  //\n\n  vec4 v100 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c100 = vec3(higher_bound.x, lower_bound.y, lower_bound.z);\n  ${Tl.api(this._base,"c100","v100")}\n  vec3 g100 = v100.r * vec3(1., -1., -1.);\n\n  vec4 c00 = v000 * ( 1.0 - xd ) + v100 * xd;\n\n  //\n  // c01\n  //\n  vec4 v001 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c001 = vec3(lower_bound.x, lower_bound.y, higher_bound.z);\n  ${Tl.api(this._base,"c001","v001")}\n  vec3 g001 = v001.r * vec3(-1., -1., 1.);\n\n  vec4 v101 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c101 = vec3(higher_bound.x, lower_bound.y, higher_bound.z);\n  ${Tl.api(this._base,"c101","v101")}\n  vec3 g101 = v101.r * vec3(1., -1., 1.);\n\n  vec4 c01 = v001 * ( 1.0 - xd ) + v101 * xd;\n\n  //\n  // c10\n  //\n  vec4 v010 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c010 = vec3(lower_bound.x, higher_bound.y, lower_bound.z);\n  ${Tl.api(this._base,"c010","v010")}\n  vec3 g010 = v010.r * vec3(-1., 1., -1.);\n\n  vec4 v110 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c110 = vec3(higher_bound.x, higher_bound.y, lower_bound.z);\n  ${Tl.api(this._base,"c110","v110")}\n  vec3 g110 = v110.r * vec3(1., 1., -1.);\n\n  vec4 c10 = v010 * ( 1.0 - xd ) + v110 * xd;\n\n  //\n  // c11\n  //\n  vec4 v011 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c011 = vec3(lower_bound.x, higher_bound.y, higher_bound.z);\n  ${Tl.api(this._base,"c011","v011")}\n  vec3 g011 = v011.r * vec3(-1., 1., 1.);\n\n  vec4 v111 = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 c111 = vec3(higher_bound.x, higher_bound.y, higher_bound.z);\n  ${Tl.api(this._base,"c111","v111")}\n  vec3 g111 = v111.r * vec3(1., 1., 1.);\n\n  vec4 c11 = v011 * ( 1.0 - xd ) + v111 * xd;\n\n  // c0 and c1\n  vec4 c0 = c00 * ( 1.0 - yd) + c10 * yd;\n  vec4 c1 = c01 * ( 1.0 - yd) + c11 * yd;\n\n  // c\n  vec4 c = c0 * ( 1.0 - zd) + c1 * zd;\n  dataValue = c;\n\n  // compute gradient\n  gradient = g000 + g100 + g010 + g110 + g011 + g111 + g110 + g011;\n  // gradientMagnitude = length(gradient);\n  // // https://en.wikipedia.org/wiki/Normal_(geometry)#Transforming_normals\n  // vec3 localNormal = (-1. / gradientMagnitude) * gradient;\n  // normal = normalize(normalPixelToPatient${this.id} * localNormal);\n  //normal = gradient;\n\n}\n    `}};var Al=function(t,e,i,n){switch(t._uniforms.uInterpolation.value){case 0:return Tl.api(t,e,i);case 1:return Ml.api(t,e,i,n);default:return Tl.api(t,e,i)}};class Il{constructor(t){this._uniforms=t,this._functions={},this._main=""}functions(){""===this._main&&this.main();let t="";for(let e in this._functions)t+=this._functions[e]+"\n";return t}uniforms(){let t="";for(let e in this._uniforms){let i=this._uniforms[e];t+=`uniform ${i.typeGLSL} ${e}`,i&&i.length&&(t+=`[${i.length}]`),t+=";\n"}return t}main(){this._main=`\nvoid main(void) {\n\n  // draw border if slice is cropped\n  // float uBorderDashLength = 10.;\n\n  if( uCanvasWidth > 0. &&\n      ((gl_FragCoord.x > uBorderMargin && (gl_FragCoord.x - uBorderMargin) < uBorderWidth) ||\n       (gl_FragCoord.x < (uCanvasWidth - uBorderMargin) && (gl_FragCoord.x + uBorderMargin) > (uCanvasWidth - uBorderWidth) ))){\n    float valueY = mod(gl_FragCoord.y, 2. * uBorderDashLength);\n    if( valueY < uBorderDashLength && gl_FragCoord.y > uBorderMargin && gl_FragCoord.y < (uCanvasHeight - uBorderMargin) ){\n      gl_FragColor = vec4(uBorderColor, 1.);\n      return;\n    }\n  }\n\n  if( uCanvasHeight > 0. &&\n      ((gl_FragCoord.y > uBorderMargin && (gl_FragCoord.y - uBorderMargin) < uBorderWidth) ||\n       (gl_FragCoord.y < (uCanvasHeight - uBorderMargin) && (gl_FragCoord.y + uBorderMargin) > (uCanvasHeight - uBorderWidth) ))){\n    float valueX = mod(gl_FragCoord.x, 2. * uBorderDashLength);\n    if( valueX < uBorderDashLength && gl_FragCoord.x > uBorderMargin && gl_FragCoord.x < (uCanvasWidth - uBorderMargin) ){\n      gl_FragColor = vec4(uBorderColor, 1.);\n      return;\n    }\n  }\n\n  // get texture coordinates of current pixel\n  vec4 dataCoordinates = uWorldToData * vPos;\n  vec3 currentVoxel = dataCoordinates.xyz;\n  vec4 dataValue = vec4(0., 0., 0., 0.);\n  vec3 gradient = vec3(0., 0., 0.);\n  ${Al(this,"currentVoxel","dataValue","gradient")}\n\n  // how do we deal wil more than 1 channel?\n  float intensity = dataValue.r;\n  if(uNumberOfChannels == 1){\n    float normalizedIntensity = dataValue.r;\n\n    // rescale/slope\n    normalizedIntensity =\n      normalizedIntensity*uRescaleSlopeIntercept[0] + uRescaleSlopeIntercept[1];\n\n    float windowMin = uWindowCenterWidth[0] - uWindowCenterWidth[1] * 0.5;\n    float windowMax = uWindowCenterWidth[0] + uWindowCenterWidth[1] * 0.5;\n    normalizedIntensity =\n      ( normalizedIntensity - windowMin ) / uWindowCenterWidth[1];\n\n    dataValue.r = dataValue.g = dataValue.b = normalizedIntensity;\n    dataValue.a = 1.0;\n  }\n\n  // Apply LUT table...\n  //\n  if(uLut == 1){\n    // should opacity be grabbed there?\n    dataValue = texture2D( uTextureLUT, vec2( dataValue.r , 1.0) );\n  }\n\n  if(uLutSegmentation == 1){\n    // should opacity be grabbed there?\n    //\n    float textureWidth = 256.;\n    float textureHeight = 128.;\n    float min = 0.;\n    // start at 0!\n    int adjustedIntensity = int(floor(intensity + 0.5));\n\n    // Get row and column in the texture\n    int colIndex = int(mod(float(adjustedIntensity), textureWidth));\n    int rowIndex = int(floor(float(adjustedIntensity)/textureWidth));\n\n    float texWidth = 1./textureWidth;\n    float texHeight = 1./textureHeight;\n  \n    // Map row and column to uv\n    vec2 uv = vec2(0,0);\n    uv.x = 0.5 * texWidth + (texWidth * float(colIndex));\n    uv.y = 1. - (0.5 * texHeight + float(rowIndex) * texHeight);\n\n    dataValue = texture2D( uTextureLUTSegmentation, uv );\n    // uv.x = (0.5 + float(colIndex)) / textureWidth;\n    // uv.y = 1. - (0.5 + float(rowIndex)) / textureHeight;\n    // dataValue = texture2D( uTextureLUTSegmentation, uv );\n  }\n\n  if(uInvert == 1){\n    dataValue = vec4(1.) - dataValue;\n    // how do we deal with that and opacity?\n    dataValue.a = 1.;\n  }\n\n  gl_FragColor = dataValue;\n\n    // if on edge, draw line\n  // float xPos = gl_FragCoord.x/512.;\n  // float yPos = gl_FragCoord.y/512.;\n  // if( xPos < 0.05 || xPos > .95 || yPos < 0.05 || yPos > .95){\n  //   gl_FragColor = vec4(xPos, yPos, 0., 1.);//dataValue;\n  //   //return;\n  // }\n\n}\n   `}compute(){return`\n// uniforms\n${this.uniforms()}\n\n// varying (should fetch it from vertex directly)\nvarying vec4      vPos;\n\n// tailored functions\n${this.functions()}\n\n// main loop\n${this._main}\n      `}}var Cl=t=>(class extends t{_createMaterial(t){let e=new this._shadersFragment(this._uniforms),i=new this._shadersVertex,n={uniforms:this._uniforms,vertexShader:i.compute(),fragmentShader:e.compute()},r=Object.assign(t,n);this._material=new THREE.ShaderMaterial(r),this._material.needsUpdate=!0}_updateMaterial(){let t=new this._shadersFragment(this._uniforms),e=new this._shadersVertex;this._material.vertexShader=e.compute(),this._material.fragmentShader=t.compute(),this._material.needsUpdate=!0}_prepareTexture(){this._textures=[];for(let t=0;t<this._stack._rawData.length;t++){let e=new THREE.DataTexture(this._stack.rawData[t],this._stack.textureSize,this._stack.textureSize,this._stack.textureType,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter);e.needsUpdate=!0,e.flipY=!0,this._textures.push(e)}}});class Pl extends(Cl(THREE.Object3D)){constructor(t,e=0,i=new Pe(0,0,0),n=new Pe(0,0,1),r="IJK"){super(),this._stack=t,this._invert=this._stack.invert,this._lut="none",this._lutTexture=null,this._intensityAuto=!0,this._interpolation=1,this._index=e,this._windowWidth=null,this._windowCenter=null,this._rescaleSlope=null,this._rescaleIntercept=null,this._canvasWidth=0,this._canvasHeight=0,this._borderColor=null,this._planePosition=i,this._planeDirection=n,this._aaBBspace=r,this._material=null,this._textures=[],this._shadersFragment=Il,this._shadersVertex=xl,this._uniforms=bl.uniforms(),this._geometry=null,this._mesh=null,this._visible=!0,this._init(),this._create()}get stack(){return this._stack}set stack(t){this._stack=t}get windowWidth(){return this._windowWidth}set windowWidth(t){this._windowWidth=t,this.updateIntensitySettingsUniforms()}get windowCenter(){return this._windowCenter}set windowCenter(t){this._windowCenter=t,this.updateIntensitySettingsUniforms()}get rescaleSlope(){return this._rescaleSlope}set rescaleSlope(t){this._rescaleSlope=t,this.updateIntensitySettingsUniforms()}get rescaleIntercept(){return this._rescaleIntercept}set rescaleIntercept(t){this._rescaleIntercept=t,this.updateIntensitySettingsUniforms()}get invert(){return this._invert}set invert(t){this._invert=t,this.updateIntensitySettingsUniforms()}get lut(){return this._lut}set lut(t){this._lut=t}get lutTexture(){return this._lutTexture}set lutTexture(t){this._lutTexture=t,this.updateIntensitySettingsUniforms()}get intensityAuto(){return this._intensityAuto}set intensityAuto(t){this._intensityAuto=t,this.updateIntensitySettings(),this.updateIntensitySettingsUniforms()}get interpolation(){return this._interpolation}set interpolation(t){this._interpolation=t,this.updateIntensitySettingsUniforms(),this._updateMaterial()}get index(){return this._index}set index(t){this._index=t,this._update()}set planePosition(t){this._planePosition=t,this._update()}get planePosition(){return this._planePosition}set planeDirection(t){this._planeDirection=t,this._update()}get planeDirection(){return this._planeDirection}set halfDimensions(t){this._halfDimensions=t}get halfDimensions(){return this._halfDimensions}set center(t){this._center=t}get center(){return this._center}set aabbSpace(t){this._aaBBspace=t,this._init()}get aabbSpace(){return this._aaBBspace}set mesh(t){this._mesh=t}get mesh(){return this._mesh}set geometry(t){this._geometry=t}get geometry(){return this._geometry}set canvasWidth(t){this._canvasWidth=t,this._uniforms.uCanvasWidth.value=this._canvasWidth}get canvasWidth(){return this._canvasWidth}set canvasHeight(t){this._canvasHeight=t,this._uniforms.uCanvasHeight.value=this._canvasHeight}get canvasHeight(){return this._canvasHeight}set borderColor(t){this._borderColor=t,this._uniforms.uBorderColor.value=new bi(t)}get borderColor(){return this._borderColor}_init(){if(this._stack&&this._stack._prepared&&this._stack._packed)if("IJK"===this._aaBBspace)this._halfDimensions=this._stack.halfDimensionsIJK,this._center=new Pe(this._stack.halfDimensionsIJK.x-.5,this._stack.halfDimensionsIJK.y-.5,this._stack.halfDimensionsIJK.z-.5),this._toAABB=new Re;else{let t=this._stack.AABBox();this._halfDimensions=t.clone().multiplyScalar(.5),this._center=this._stack.centerAABBox(),this._toAABB=this._stack.lps2AABB}}_create(){if(this._stack&&this._stack.prepared&&this._stack.packed){try{this._geometry=new yl(this._halfDimensions,this._center,this._planePosition,this._planeDirection,this._toAABB)}catch(t){return window.console.log(t),void window.console.log("invalid slice geometry - exiting...")}this._geometry.vertices&&(this._material||(this._uniforms.uTextureSize.value=this._stack.textureSize,this._uniforms.uDataDimensions.value=[this._stack.dimensionsIJK.x,this._stack.dimensionsIJK.y,this._stack.dimensionsIJK.z],this._uniforms.uWorldToData.value=this._stack.lps2IJK,this._uniforms.uNumberOfChannels.value=this._stack.numberOfChannels,this._uniforms.uPixelType.value=this._stack.pixelType,this._uniforms.uBitsAllocated.value=this._stack.bitsAllocated,this._uniforms.uPackedPerPixel.value=this._stack.packedPerPixel,this._prepareTexture(),this._uniforms.uTextureContainer.value=this._textures,this._createMaterial({side:THREE.DoubleSide})),this.updateIntensitySettings(),this.updateIntensitySettingsUniforms(),this._mesh=new THREE.Mesh(this._geometry,this._material),"IJK"===this._aaBBspace&&this._mesh.applyMatrix(this._stack.ijk2LPS),this._mesh.visible=this._visible,this.add(this._mesh))}}updateIntensitySettings(){this._intensityAuto?(this.updateIntensitySetting("windowCenter"),this.updateIntensitySetting("windowWidth"),this.updateIntensitySetting("rescaleSlope"),this.updateIntensitySetting("rescaleIntercept")):(null===this._windowCenter&&(this._windowCenter=this._stack.windowCenter),null===this.__windowWidth&&(this._windowWidth=this._stack.windowWidth),null===this._rescaleSlope&&(this._rescaleSlope=this._stack.rescaleSlope),null===this._rescaleIntercept&&(this._rescaleIntercept=this._stack.rescaleIntercept))}updateIntensitySettingsUniforms(){let t=0;this._stack._minMax[0]<0&&(t-=this._stack._minMax[0]),this._uniforms.uRescaleSlopeIntercept.value=[this._rescaleSlope,this._rescaleIntercept],this._uniforms.uWindowCenterWidth.value=[t+this._windowCenter,this._windowWidth],this._uniforms.uInvert.value=!0===this._invert?1:0,this._uniforms.uInterpolation.value=this._interpolation,"none"===this._lut?this._uniforms.uLut.value=0:(this._uniforms.uLut.value=1,this._uniforms.uTextureLUT.value=this._lutTexture)}updateIntensitySetting(t){this._stack.frame[this._index]&&this._stack.frame[this._index][t]?this["_"+t]=this._stack.frame[this._index][t]:this["_"+t]=this._stack[t]}_update(){this._mesh&&(this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh=null),this._create()}dispose(){for(let t=0;t<this._textures.length;t++)this._textures[t].dispose(),this._textures[t]=null;this._textures=null,this._shadersFragment=null,this._shadersVertex=null,this._uniforms=null,this.remove(this._mesh),this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh.material.dispose(),this._mesh.material=null,this._mesh=null,this._geometry.dispose(),this._geometry=null,this._material.vertexShader=null,this._material.fragmentShader=null,this._material.uniforms=null,this._material.dispose(),this._material=null,this._stack=null}cartesianEquation(){if(!this._geometry||!this._geometry.vertices||this._geometry.vertices.length<3)return new Me;let t=this._geometry.vertices,e=this._stack.ijk2LPS,i=new Pe(t[0].x,t[0].y,t[0].z).applyMatrix4(e),n=new Pe(t[1].x,t[1].y,t[1].z).applyMatrix4(e),r=new Pe(t[2].x,t[2].y,t[2].z).applyMatrix4(e),a=new Pe,s=new Pe,o=a.subVectors(r,n).cross(s.subVectors(i,n)).normalize();return new Me(o.x,o.y,o.z,-o.dot(i))}}class Rl{constructor(t,e="default",i="linear",n=[[0,0,0,0],[1,1,1,1]],r=[[0,0],[1,1]],a=!1){qo.isString(t)?this._dom=document.getElementById(t):this._dom=t,this._discrete=a,this._color=n,this._lut=e,this._luts={[e]:n},this._opacity=r,this._lutO=i,this._lutsO={[i]:r},this.initCanvas(),this.paintCanvas()}initCanvas(){this._canvasContainer=this.initCanvasContainer(this._dom),this._canvasBg=this.createCanvas(),this._canvasContainer.appendChild(this._canvasBg),this._canvas=this.createCanvas(),this._canvasContainer.appendChild(this._canvas)}initCanvasContainer(t){let e=t;return e.style.width="256 px",e.style.height="128 px",e.style.border="1px solid #F9F9F9",e}createCanvas(){let t=document.createElement("canvas");return t.height=16,t.width=256,t}paintCanvas(){let t=this._canvas.getContext("2d");if(t.clearRect(0,0,this._canvas.width,this._canvas.height),t.globalCompositeOperation="source-over",this._discrete){t.lineWidth=2*this._canvas.height;for(let e=0;e<this._color.length;e++){let i=this._color[e][0],n=1;e<this._color.length-1&&(n=this._color[e+1][0]);let r=0;e>0&&(r=this._color[e-1][0]);let a=r+(i-r)/2,s=i+(n-i)/2,o=this._color[e],l=this._opacity[e]?this._opacity[e][1]:1;t.beginPath(),t.strokeStyle=`rgba( ${Math.round(255*o[1])}, ${Math.round(255*o[2])}, ${Math.round(255*o[3])}, ${l})`,t.moveTo(a*this._canvas.width,0),t.lineTo(s*this._canvas.width,0),t.stroke(),t.closePath()}}else{let e=t.createLinearGradient(0,0,this._canvas.width,this._canvas.height);for(let t=0;t<this._color.length;t++)e.addColorStop(this._color[t][0],`rgba( ${Math.round(255*this._color[t][1])}, ${Math.round(255*this._color[t][2])}, ${Math.round(255*this._color[t][3])}, 1)`);t.fillStyle=e,t.fillRect(0,0,this._canvas.width,this._canvas.height)}if(!this._discrete){t.globalCompositeOperation="destination-in";let e=t.createLinearGradient(0,0,this._canvas.width,this._canvas.height);for(let t=0;t<this._opacity.length;t++)e.addColorStop(this._opacity[t][0],"rgba(255, 255, 255, "+this._opacity[t][1]+")");t.fillStyle=e,t.fillRect(0,0,this._canvas.width,this._canvas.height)}}get texture(){let t=new THREE.Texture(this._canvas);return t.mapping=THREE.UVMapping,t.wrapS=t.wrapT=THREE.ClampToEdgeWrapping,t.magFilter=t.minFilter=THREE.NearestFilter,t.premultiplyAlpha=!0,t.needsUpdate=!0,t}set lut(t){this._color=this._luts[t],this._lut=t,this.paintCanvas()}get lut(){return this._lut}set luts(t){this._luts=t}get luts(){return this._luts}set lutO(t){this._opacity=this._lutsO[t],this._lutO=t,this.paintCanvas()}get lutO(){return this._lutO}set lutsO(t){this._lutsO=t}get lutsO(){return this._lutsO}set discrete(t){this._discrete=t,this.paintCanvas()}get discrete(){return this._discrete}lutsAvailable(t="color"){let e=[],i=this._luts;"color"!==t&&(i=this._lutsO);for(let t in i)e.push(t);return e}static presetLuts(){return{default:[[0,0,0,0],[1,1,1,1]],spectrum:[[0,0,0,0],[.1,0,0,1],[.33,0,1,1],[.5,0,1,0],[.66,1,1,0],[.9,1,0,0],[1,1,1,1]],hot_and_cold:[[0,0,0,1],[.15,0,1,1],[.3,0,1,0],[.45,0,0,0],[.5,0,0,0],[.55,0,0,0],[.7,1,1,0],[.85,1,0,0],[1,1,1,1]],gold:[[0,0,0,0],[.13,.19,.03,0],[.25,.39,.12,0],[.38,.59,.26,0],[.5,.8,.46,.08],[.63,.99,.71,.21],[.75,.99,.88,.34],[.88,.99,.99,.48],[1,.9,.95,.61]],red:[[0,.75,0,0],[.5,1,.5,0],[.95,1,1,0],[1,1,1,1]],green:[[0,0,.75,0],[.5,.5,1,0],[.95,1,1,0],[1,1,1,1]],blue:[[0,0,0,1],[.5,0,.5,1],[.95,0,1,1],[1,1,1,1]],walking_dead:[[0,.1,1,1],[1,1,1,1]],random:[[0,0,0,0],[.27,.18,.18,.18],[.41,1,1,1],[.7,1,0,0],[1,1,1,1]]}}static presetLutsO(){return{linear:[[0,0],[1,1]],lowpass:[[0,.8],[.2,.6],[.3,.1],[1,0]],bandpass:[[0,0],[.4,.8],[.6,.8],[1,0]],highpass:[[0,0],[.7,.1],[.8,.6],[1,.8]],flat:[[0,.7],[1,1]],random:[[0,0],[.38,0],[.55,1],[.72,1],[1,.05]]}}}var Ll={name:"viewers-upload",data:function(){return{animateId:0,controls:null,renderer:null,scene:null,camera:null,threeD:null,lut:null,ctrlDown:!1,drag:{start:{x:null,y:null}},camUtils:{invertRows:!1,invertColumns:!1,rotate:!1,orientation:"default",convention:"radio"},loader:null,seriesContainer:[],stackHelper:null}},created:function(){var t=this;console.log("created"),this.$nextTick(function(){t.start()})},beforeDestroy:function(){this.animateId&&cancelAnimationFrame(this.animateId)},computed:{fileLoaded:function(){return 0!=this.seriesContainer.length}},methods:{start:function(){this.init(),this.loader=new class extends Jo{parse(t){return this.emit("parse-start",{file:t.url,time:new Date}),this._progressBar&&this._progressBar.update(0,100,"parse"),new Promise((e,i)=>{window.setTimeout(()=>{e(new Promise((e,i)=>{let n=t;if(Array.isArray(n)||(n=[n]),n.forEach(t=>{this._preprocess(t)}),1===n.length)n=n[0];else{let t=n.filter(this._filterByExtension.bind(null,"MHD")),e=n.filter(this._filterByExtension.bind(null,"RAW"));2===n.length&&1===t.length&&1===e.length&&(n.url=t[0].url,n.extension=t[0].extension,n.mhdBuffer=t[0].buffer,n.rawBuffer=e[0].buffer)}let r=this._parser(n.extension);r||(this.emit("parse-error",{file:t.url,time:new Date,error:n.filename+"can not be parsed."}),i(n.filename+" can not be parsed."));let a=null;try{a=new r(n,0)}catch(e){window.console.log(e),this.emit("parse-error",{file:t.url,time:new Date,error:e}),i(e)}let s=new Qo;s.seriesInstanceUID=a.seriesInstanceUID(),s.transferSyntaxUID=a.transferSyntaxUID(),s.seriesDate=a.seriesDate(),s.seriesDescription=a.seriesDescription(),s.studyDate=a.studyDate(),s.studyDescription=a.studyDescription(),s.numberOfFrames=a.numberOfFrames(),s.numberOfFrames||(s.numberOfFrames=1),s.numberOfChannels=a.numberOfChannels(),s.modality=a.modality(),"SEG"===s.modality&&(s.segmentationType=a.segmentationType(),s.segmentationSegments=a.segmentationSegments()),s.patientID=a.patientID(),s.patientName=a.patientName(),s.patientAge=a.patientAge(),s.patientBirthdate=a.patientBirthdate(),s.patientSex=a.patientSex();let o=new el;o.numberOfChannels=a.numberOfChannels(),o.pixelRepresentation=a.pixelRepresentation(),o.pixelType=a.pixelType(),o.invert=a.invert(),o.spacingBetweenSlices=a.spacingBetweenSlices(),o.modality=s.modality,"SEG"===o.modality&&(o.segmentationType=s.segmentationType,o.segmentationSegments=s.segmentationSegments),s.stack.push(o),setTimeout(this.parseFrame(s,o,t.url,0,a,e,i),0)}))},10)})}parseFrame(t,e,i,n,r,a,s){let o=new il;o.sopInstanceUID=r.sopInstanceUID(n),o.url=i,o.index=n,o.rows=r.rows(n),o.columns=r.columns(n),o.numberOfChannels=e.numberOfChannels,o.pixelRepresentation=e.pixelRepresentation,o.pixelType=e.pixelType,o.pixelData=r.extractPixelData(n),o.pixelSpacing=r.pixelSpacing(n),o.spacingBetweenSlices=r.spacingBetweenSlices(n),o.sliceThickness=r.sliceThickness(n),o.imageOrientation=r.imageOrientation(n),o.rightHanded=r.rightHanded(),e.rightHanded=o.rightHanded,null===o.imageOrientation&&(o.imageOrientation=[1,0,0,0,1,0]),o.imagePosition=r.imagePosition(n),null===o.imagePosition&&(o.imagePosition=[0,0,n]),o.dimensionIndexValues=r.dimensionIndexValues(n),o.bitsAllocated=r.bitsAllocated(n),o.instanceNumber=r.instanceNumber(n),o.windowCenter=r.windowCenter(n),o.windowWidth=r.windowWidth(n),o.rescaleSlope=r.rescaleSlope(n),o.rescaleIntercept=r.rescaleIntercept(n),o.minMax=r.minMaxPixelData(o.pixelData),"SEG"===t.modality&&(o.referencedSegmentNumber=r.referencedSegmentNumber(n)),e.frame.push(o),this._parsed=n+1,this._totalParsed=t.numberOfFrames,this._progressBar&&this._progressBar.update(this._parsed,this._totalParsed,"parse"),this.emit("parsing",{file:i,total:this._totalParsed,parsed:this._parsed,time:new Date}),this._parsed===this._totalParsed?(this.emit("parse-success",{file:i,total:this._totalParsed,parsed:this._parsed,time:new Date}),a(t)):setTimeout(this.parseFrame(t,e,i,this._parsed,r,a,s),0)}_parser(t){let e=null;switch(t.toUpperCase()){case"NII":case"NII_":e=ul;break;case"DCM":case"DICOM":case"IMA":case"":e=ll;break;case"MHD":e=hl;break;case"NRRD":e=pl;break;default:return window.console.log("unsupported extension: "+t),!1}return e}_preprocess(t){const e=qo.parseUrl(t.url);if(t.filename=e.filename,t.extension=e.extension,t.pathname=e.pathname,t.query=e.query,"gz"===t.extension){t.gzcompressed=!0,t.extension=t.filename.split(".gz").shift().split(".").pop();let e=ml.inflate(t.buffer);t.buffer=e.buffer}else t.gzcompressed=!1}_filterByExtension(t,e){return e.extension.toUpperCase()===t.toUpperCase()}}(this.threeD)},animate:function(){this.controls.update(),this.renderer.render(this.scene,this.camera),this.animateId=requestAnimationFrame(this.animate)},init:function(){this.threeD=this.$refs.r3d,this.renderer=new s.WebGLRenderer({antialias:!0}),this.renderer.setSize(this.threeD.clientWidth,this.threeD.clientHeight),this.renderer.setClearColor(2171169,1),this.threeD.appendChild(this.renderer.domElement),this.scene=new s.Scene,this.camera=new class extends THREE.OrthographicCamera{constructor(t,e,i,n,r,a){super(t,e,i,n,r,a),this._front=null,this._back=null,this._directions=[new Pe(1,0,0),new Pe(0,1,0),new Pe(0,0,1)],this._directionsLabel=["A","P","L","R","I","S"],this._orientation="default",this._convention="radio",this._stackOrientation=0,this._right=null,this._up=null,this._direction=null,this._controls=null,this._box=null,this._canvas={width:null,height:null},this._fromFront=!0,this._angle=0}init(t,e,i,n,r,a){if(console.warn("cameras.orthographic.init(...) is deprecated.\n      Use .cosines, .controls, .box and .canvas instead."),!(o.vector3(t)&&o.vector3(e)&&o.vector3(i)&&o.box(r)&&n))return window.console.log("Invalid input provided."),!1;this._right=t,this._up=this._adjustTopDirection(t,e),this._direction=(new Pe).crossVectors(this._right,this._up),this._controls=n,this._box=r,this._canvas=a;let s={position:this._box.center,direction:this._direction},l=this._orderIntersections(_l.rayBox(s,this._box),this._direction);this._front=l[0],this._back=l[1],this.up.set(this._up.x,this._up.y,this._up.z),this._updateCanvas(),this._updatePositionAndTarget(this._front,this._back),this._updateMatrices(),this._updateDirections()}update(){if("default"===this._orientation)switch(this._getMaxIndex(this._directions[2])){case 0:this._orientation="sagittal";break;case 1:this._orientation="coronal";break;case 2:this._orientation="axial";break;default:this._orientation="free"}if("free"===this._orientation)this._right=this._directions[0],this._up=this._directions[1],this._direction=this._directions[2];else{let t=this.leftDirection(),e=this._directions[t],i=this.posteriorDirection(),n=this._directions[i],r=this.superiorDirection(),a=this._directions[r];if("radio"===this._convention)switch(this._orientation){case"axial":n.y>0&&n.negate(),a.z<0&&a.negate(),this._right=e,this._up=n,this._direction=a;break;case"coronal":a.z<0&&a.negate(),n.y<0&&n.negate(),this._right=e,this._up=a,this._direction=n;break;case"sagittal":a.z<0&&a.negate(),e.x>0&&e.negate(),this._right=n,this._up=a,this._direction=e;break;default:console.warn(`"${this._orientation}" orientation is not valid.\n                (choices: axial, coronal, sagittal)`)}else if("neuro"===this._convention)switch(this._orientation){case"axial":n.y>0&&n.negate(),a.z>0&&a.negate(),this._right=e,this._up=n,this._direction=a;break;case"coronal":a.z<0&&a.negate(),n.y>0&&n.negate(),this._right=e,this._up=a,this._direction=n;break;case"sagittal":a.z<0&&a.negate(),e.x>0&&e.negate(),this._right=n,this._up=a,this._direction=e;break;default:console.warn(`"${this._orientation}" orientation is not valid.\n                (choices: axial, coronal, sagittal)`)}else console.warn(`${this._convention} is not valid (choices: radio, neuro)`)}let t={position:this._box.center,direction:this._direction},e=this._orderIntersections(_l.rayBox(t,this._box),this._direction);this._front=e[0],this._back=e[1],this.up.set(this._up.x,this._up.y,this._up.z),this._updateCanvas(),this._updatePositionAndTarget(this._front,this._back),this._updateMatrices(),this._updateDirections()}leftDirection(){return this._findMaxIndex(this._directions,0)}posteriorDirection(){return this._findMaxIndex(this._directions,1)}superiorDirection(){return this._findMaxIndex(this._directions,2)}invertRows(){this.up.multiplyScalar(-1),this.invertColumns(),this._updateDirections()}invertColumns(){this.center();let t=this._oppositePosition(this.position);this._updatePositionAndTarget(t,this.position.clone()),this._updateMatrices(),this._fromFront=!this._fromFront,this._angle%=360,this._angle=360-this._angle,this._updateDirections()}center(){this._fromFront?this._updatePositionAndTarget(this._front,this._back):this._updatePositionAndTarget(this._back,this._front),this._updateMatrices(),this._updateDirections()}rotate(t=null){this.center();let e=90,i=1;this._fromFront||(i=-1),null===t?(e*=-i,this._angle+=90):(e=360-i*(t-this._angle),this._angle=t),this._angle%=360;let n=(new Re).makeRotationAxis(this._direction,e*Math.PI/180);this.up.applyMatrix4(n),this._updateMatrices(),this._updateDirections()}fitBox(t=0,e=1.5){let i=1;switch(t){case 0:i=e*this._computeZoom(this._canvas.width,this._right);break;case 1:i=e*this._computeZoom(this._canvas.height,this._up);break;case 2:i=e*Math.min(this._computeZoom(this._canvas.width,this._right),this._computeZoom(this._canvas.height,this._up))}if(!i)return!1;this.zoom=i,this.center()}_adjustTopDirection(t,e){const i=this._getMaxIndex(e);return(2===i&&e.getComponent(i)<0||1===i&&e.getComponent(i)>0||0===i&&e.getComponent(i)>0)&&e.negate(),e}_getMaxIndex(t){let e=Math.abs(t.x),i=0;return Math.abs(t.y)>e&&(e=Math.abs(t.y),i=1),Math.abs(t.z)>e&&(i=2),i}_findMaxIndex(t,e){let i=this._getMaxIndices(t);for(let t=0;t<i.length;t++)if(i[t]===e)return t}_getMaxIndices(t){let e=[];return e.push(this._getMaxIndex(t[0])),e.push(this._getMaxIndex(t[1])),e.push(this._getMaxIndex(t[2])),e}_orderIntersections(t,e){return t[0].dot(e)<t[1].dot(e)?t:[t[1],t[0]]}_updateCanvas(){this.left=-this._canvas.width/2,this.right=this._canvas.width/2,this.top=this._canvas.height/2,this.bottom=-this._canvas.height/2,this._updateMatrices(),this.controls.handleResize()}_oppositePosition(t){let e=t.clone();e.sub(this._box.center);let i=(new Re).makeRotationAxis(this.up,Math.PI);return e.applyMatrix4(i),e.add(this._box.center),e}_computeZoom(t,e){if(!(t&&t>0))return window.console.log("Invalid dimension provided."),window.console.log(t),!1;let i={position:this._box.center.clone(),direction:e},n=_l.rayBox(i,this._box);return n.length<2?(window.console.log("Can not adjust the camera ( < 2 intersections)."),window.console.log(i),window.console.log(this._box),!1):t/n[0].distanceTo(n[1])}_updatePositionAndTarget(t,e){this.position.set(t.x,t.y,t.z),this.lookAt(e.x,e.y,e.z),this._controls.target.set(e.x,e.y,e.z)}_updateMatrices(){this._controls.update(),this.updateProjectionMatrix(),this.updateMatrixWorld()}_updateLabels(){this._directionsLabel=[this._vector2Label(this._up),this._vector2Label(this._up.clone().negate()),this._vector2Label(this._right),this._vector2Label(this._right.clone().negate()),this._vector2Label(this._direction),this._vector2Label(this._direction.clone().negate())]}_vector2Label(t){const e=this._getMaxIndex(t),i=t.clone().divideScalar(Math.abs(t.getComponent(e)));let n="";for(let t=0;t<3;t++)0===t&&(i.getComponent(t)+.2>=1?n+="L":i.getComponent(t)-.2<=-1&&(n+="R")),1===t&&(i.getComponent(t)+.2>=1?n+="P":i.getComponent(t)-.2<=-1&&(n+="A")),2===t&&(i.getComponent(t)+.2>=1?n+="S":i.getComponent(t)-.2<=-1&&(n+="I"));return n}_updateDirections(){this._up=this.up.clone();let t=new Pe(0,0,-1).applyMatrix4(this.matrixWorld);this._direction=t.sub(this.position).normalize(),this._right=(new Pe).crossVectors(this._direction,this.up),this._updateLabels()}set controls(t){this._controls=t}get controls(){return this._controls}set box(t){this._box=t}get box(){return this._box}set canvas(t){this._canvas=t,this._updateCanvas()}get canvas(){return this._canvas}set angle(t){this.rotate(t)}get angle(){return this._angle}set directions(t){this._directions=t}get directions(){return this._directions}set convention(t){this._convention=t}get convention(){return this._convention}set orientation(t){this._orientation=t}get orientation(){return this._orientation}set directionsLabel(t){this._directionsLabel=t}get directionsLabel(){return this._directionsLabel}set stackOrientation(t){if(this._stackOrientation=t,0===this._stackOrientation)this._orientation="default";else{const t=this._getMaxIndex(this._directions[(this._stackOrientation+2)%3]);0===t?this._orientation="sagittal":1===t?this._orientation="coronal":2===t&&(this._orientation="axial")}}get stackOrientation(){if("default"===this._orientation)this._stackOrientation=0;else{let t=this._getMaxIndex(this._direction);t===this._getMaxIndex(this._directions[2])?this._stackOrientation=0:t===this._getMaxIndex(this._directions[0])?this._stackOrientation=1:t===this._getMaxIndex(this._directions[1])&&(this._stackOrientation=2)}return this._stackOrientation}}(this.threeD.clientWidth/-2,this.threeD.clientWidth/2,this.threeD.clientHeight/2,this.threeD.clientHeight/-2,.1,1e4),this.controls=new class extends l{constructor(t,e,i={NONE:-1,ROTATE:1,ZOOM:2,PAN:0,SCROLL:4,TOUCH_ROTATE:4,TOUCH_ZOOM_PAN:5}){super();let n=this,r=i;this.object=t,this.domElement=void 0!==e?e:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.radius=0,this.zoomSpeed=1.2,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.keys=[65,83,68],this.target=new Pe;let a=!0,s=r.NONE,o=r.NONE,l=new Pe,h=new ve,c=new ve,u=0,d=0,f=new ve,p=new ve;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom;let m={type:"change"},g={type:"start"},v={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{let t=this.domElement.getBoundingClientRect(),e=this.domElement.ownerDocument.documentElement;this.screen.left=t.left+window.pageXOffset-e.clientLeft,this.screen.top=t.top+window.pageYOffset-e.clientTop,this.screen.width=t.width,this.screen.height=t.height}this.radius=.5*Math.min(this.screen.width,this.screen.height),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom},this.handleEvent=function(t){"function"==typeof this[t.type]&&this[t.type](t)};let _=function(){let t=new ve;return function(e,i){return t.set((e-n.screen.left)/n.screen.width,(i-n.screen.top)/n.screen.height),t}}();function y(t){!1!==n.enabled&&(window.removeEventListener("keydown",y),o=s,s===r.NONE&&(t.keyCode!==n.keys[r.ROTATE]||n.noRotate?t.keyCode!==n.keys[r.ZOOM]||n.noZoom?t.keyCode!==n.keys[r.PAN]||n.noPan||(s=r.PAN):s=r.ZOOM:s=r.ROTATE))}function b(t){!1!==n.enabled&&(s=o,window.addEventListener("keydown",y,!1))}function x(t){!1!==n.enabled&&(t.preventDefault(),t.stopPropagation(),s===r.NONE&&(s=t.button),(s!==r.ROTATE||n.noRotate)&&(s!==r.ZOOM||n.noZoom?s!==r.PAN||n.noPan||(f.copy(_(t.pageX,t.pageY)),p.copy(f)):(h.copy(_(t.pageX,t.pageY)),c.copy(h))),document.addEventListener("mousemove",w,!1),document.addEventListener("mouseup",E,!1),n.dispatchEvent(g))}function w(t){!1!==n.enabled&&(t.preventDefault(),t.stopPropagation(),(s!==r.ROTATE||n.noRotate)&&(s!==r.ZOOM||n.noZoom?s!==r.PAN||n.noPan||p.copy(_(t.pageX,t.pageY)):c.copy(_(t.pageX,t.pageY))))}function E(t){!1!==n.enabled&&(t.preventDefault(),t.stopPropagation(),s=r.NONE,document.removeEventListener("mousemove",w),document.removeEventListener("mouseup",E),n.dispatchEvent(v))}function S(t){if(!1===n.enabled)return;t.preventDefault(),t.stopPropagation();let e=0;t.wheelDelta?e=t.wheelDelta/40:t.detail&&(e=-t.detail/3),n.dispatchEvent({type:"OnScroll",delta:e}),n.dispatchEvent(g),n.dispatchEvent(v)}function T(t){if(!1!==n.enabled){switch(t.touches.length){case 1:s=r.TOUCH_ROTATE;break;case 2:s=r.TOUCH_ZOOM_PAN;var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY;d=u=Math.sqrt(e*e+i*i);var a=(t.touches[0].pageX+t.touches[1].pageX)/2,o=(t.touches[0].pageY+t.touches[1].pageY)/2;f.copy(_(a,o)),p.copy(f);break;default:s=r.NONE}n.dispatchEvent(g)}}function M(t){if(!1!==n.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:break;case 2:var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY;d=Math.sqrt(e*e+i*i);var a=(t.touches[0].pageX+t.touches[1].pageX)/2,o=(t.touches[0].pageY+t.touches[1].pageY)/2;p.copy(_(a,o));break;default:s=r.NONE}}function A(t){if(!1!==n.enabled){switch(t.touches.length){case 1:break;case 2:u=d=0;var e=(t.touches[0].pageX+t.touches[1].pageX)/2,i=(t.touches[0].pageY+t.touches[1].pageY)/2;p.copy(_(e,i)),f.copy(p)}s=r.NONE,n.dispatchEvent(v)}}function I(t){t.preventDefault()}this.zoomCamera=function(){if(s===r.TOUCH_ZOOM_PAN){var t=d/u;u=d,n.object.zoom*=t,a=!0}else t=1+(c.y-h.y)*n.zoomSpeed,Math.abs(t-1)>1e-6&&t>0&&(n.object.zoom/=t,n.staticMoving?h.copy(c):h.y+=(c.y-h.y)*this.dynamicDampingFactor,a=!0)},this.panCamera=function(){let t=new ve,e=new Pe,i=new Pe;return function(){if(t.copy(p).sub(f),t.lengthSq()){let r=(n.object.right-n.object.left)/n.object.zoom,s=(n.object.top-n.object.bottom)/n.object.zoom;t.x*=r,t.y*=s,i.copy(l).cross(n.object.up).setLength(t.x),i.add(e.copy(n.object.up).setLength(t.y)),n.object.position.add(i),n.target.add(i),n.staticMoving?f.copy(p):f.add(t.subVectors(p,f).multiplyScalar(n.dynamicDampingFactor)),a=!0}}}(),this.update=function(){l.subVectors(n.object.position,n.target),n.noZoom||(n.zoomCamera(),a&&n.object.updateProjectionMatrix()),n.noPan||n.panCamera(),n.object.position.addVectors(n.target,l),n.object.lookAt(n.target),a&&(n.dispatchEvent(m),a=!1)},this.reset=function(){s=r.NONE,o=r.NONE,n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.up.copy(n.up0),l.subVectors(n.object.position,n.target),n.object.left=n.left0,n.object.right=n.right0,n.object.top=n.top0,n.object.bottom=n.bottom0,n.object.lookAt(n.target),n.dispatchEvent(m),a=!1},this.dispose=function(){this.domElement.removeEventListener("contextmenu",I,!1),this.domElement.removeEventListener("mousedown",x,!1),this.domElement.removeEventListener("mousewheel",S,!1),this.domElement.removeEventListener("MozMousePixelScroll",S,!1),this.domElement.removeEventListener("touchstart",T,!1),this.domElement.removeEventListener("touchend",A,!1),this.domElement.removeEventListener("touchmove",M,!1),document.removeEventListener("mousemove",w,!1),document.removeEventListener("mouseup",E,!1),window.removeEventListener("keydown",y,!1),window.removeEventListener("keyup",b,!1)},this.domElement.addEventListener("contextmenu",I,!1),this.domElement.addEventListener("mousedown",x,!1),this.domElement.addEventListener("mousewheel",S,!1),this.domElement.addEventListener("MozMousePixelScroll",S,!1),this.domElement.addEventListener("touchstart",T,!1),this.domElement.addEventListener("touchend",A,!1),this.domElement.addEventListener("touchmove",M,!1),window.addEventListener("keydown",y,!1),window.addEventListener("keyup",b,!1),this.handleResize(),this.update()}}(this.camera,this.threeD),this.controls.staticMoving=!0,this.controls.noRotate=!0,this.camera.controls=this.controls,this.animate()},updateLabels:function(t,e){"CR"!==e&&"DX"!==e&&(this.$refs.top.innerHTML=t[0],this.$refs.bottom.innerHTML=t[1],this.$refs.right.innerHTML=t[2],this.$refs.left.innerHTML=t[3])},buildGUI:function(t){var e=this,i=t._stack,n=new a.GUI({autoPlace:!1});this.$refs.myGuiContainer.appendChild(n.domElement);var r=n.addFolder("Stack");r.add(t.slice,"windowWidth",1,i.minMax[1]-i.minMax[0]).step(1).listen(),r.add(t.slice,"windowCenter",i.minMax[0],i.minMax[1]).step(1).listen(),r.add(t.slice,"intensityAuto").listen(),r.add(t.slice,"invert"),r.add(t.slice,"interpolation",0,1).step(1).listen(),this.lut=new Rl(this.$refs.myLutCanvases,"default","linear",[[0,0,0,0],[1,1,1,1]],[[0,1],[1,1]]),this.lut.luts=Rl.presetLuts(),r.add(t.slice,"lut",this.lut.lutsAvailable()).onChange(function(i){e.lut.lut=i,t.slice.lutTexture=e.lut.texture}),r.add(this.lut,"discrete",!1).onChange(function(i){e.lut.discrete=i,t.slice.lutTexture=e.lut.texture});var s=r.add(t,"index",0,i.dimensionsIJK.z-1).step(1).listen();r.open();var o=n.addFolder("Camera");o.add(this.camUtils,"invertRows").onChange(function(){e.camera.invertRows(),e.updateLabels(e.camera.directionsLabel,i.modality)}),o.add(this.camUtils,"invertColumns").onChange(function(){e.camera.invertColumns(),e.updateLabels(e.camera.directionsLabel,i.modality)}),o.add(this.camera,"angle",0,360).step(1).listen().onChange(function(){e.updateLabels(e.camera.directionsLabel,i.modality)}),o.add(this.camUtils,"rotate").onChange(function(){e.camera.rotate(),e.updateLabels(e.camera.directionsLabel,i.modality)}),o.add(this.camUtils,"orientation",["default","axial","coronal","sagittal"]).onChange(function(n){e.camera.orientation=n,e.camera.update(),e.camera.fitBox(2),t.orientation=e.camera.stackOrientation,e.updateLabels(e.camera.directionsLabel,i.modality),s.__max=t.orientationMaxIndex,t.index=Math.floor(s.__max/2)}),o.add(this.camUtils,"convention",["radio","neuro"]).onChange(function(t){e.camera.convention=t,e.camera.update(),e.camera.fitBox(2),e.updateLabels(e.camera.directionsLabel,i.modality)})},hookCallbacks:function(t){t._stack;this.controls.addEventListener("OnScroll",function(e){if(e.delta>0){if(t.index>=t.orientationMaxIndex-1)return!1;t.index+=1}else{if(t.index<=0)return!1;t.index-=1}}),this.onWindowResize()},onWindowResize:function(){if(this.fileLoaded){var t=this.$refs.r3d;this.camera.canvas={width:t.clientWidth,height:t.clientHeight},this.camera.fitBox(2),this.renderer.setSize(t.clientWidth,t.clientHeight),this.stackHelper.slice.canvasWidth=t.clientWidth,this.stackHelper.slice.canvasHeight=t.clientHeight}},onWindowKeyPressed:function(t){this.fileLoaded&&(this.ctrlDown=t.ctrlKey,this.ctrlDown||(this.drag.start.x=null,this.drag.start.y=null))},onMouseMove:function(t){if(this.fileLoaded&&this.ctrlDown){null===this.drag.start.x&&(this.drag.start.x=t.clientX,this.drag.start.y=t.clientY);this.stackHelper.slice.intensityAuto=!1;var e=stack.minMax[1]-stack.minMax[0];e/=this.threeD.clientWidth,Math.abs(t.clientX-this.drag.start.x)>15&&(this.stackHelper.slice.windowWidth+=e*(t.clientX-this.drag.start.x),this.drag.start.x=t.clientX),Math.abs(t.clientY-this.drag.start.y)>15&&(this.stackHelper.slice.windowCenter-=e*(t.clientY-this.drag.start.y),this.drag.start.y=t.clientY)}},handleSeries:function(t){this.loader.free(),this.loader=null;var e=t[0].mergeSeries(t)[0].stack[0];this.stackHelper=new class extends THREE.Object3D{constructor(t){super(),this._stack=t,this._bBox=null,this._slice=null,this._border=null,this._dummy=null,this._orientation=0,this._index=0,this._uniforms=null,this._autoWindowLevel=!1,this._outOfBounds=!1,this._orientationMaxIndex=0,this._canvasWidth=0,this._canvasHeight=0,this._borderColor=null,this._create()}get stack(){return this._stack}set stack(t){this._stack=t}get bbox(){return this._bBox}get slice(){return this._slice}get border(){return this._border}get index(){return this._index}set index(t){this._index=t,this._slice.index=t;let e=this._stack.halfDimensionsIJK;this._slice.planePosition=this._prepareSlicePosition(e,this._index),this._border.helpersSlice=this._slice,this._isIndexOutOfBounds()}set orientation(t){this._orientation=t,this._computeOrientationMaxIndex(),this._slice.planeDirection=this._prepareDirection(this._orientation),this._border.helpersSlice=this._slice}get orientation(){return this._orientation}set outOfBounds(t){this._outOfBounds=t}get outOfBounds(){return this._outOfBounds}set orientationMaxIndex(t){this._orientationMaxIndex=t}get orientationMaxIndex(){return this._orientationMaxIndex}set canvasWidth(t){this._canvasWidth=t,this._slice.canvasWidth=this._canvasWidth}get canvasWidth(){return this._canvasWidth}set canvasHeight(t){this._canvasHeight=t,this._slice.canvasHeight=this._canvasHeight}get canvasHeight(){return this._canvasHeight}set borderColor(t){this._borderColor=t,this._border.color=t,this._slice.borderColor=this._borderColor}get borderColor(){return this._borderColor}_create(){this._stack?(this._prepareStack(),this._prepareBBox(),this._prepareSlice(),this._prepareBorder()):window.console.log("no stack to be prepared...")}_computeOrientationMaxIndex(){let t=this._stack.dimensionsIJK;switch(this._orientationMaxIndex=0,this._orientation){case 0:this._orientationMaxIndex=t.z-1;break;case 1:this._orientationMaxIndex=t.x-1;break;case 2:this._orientationMaxIndex=t.y-1}}_isIndexOutOfBounds(){this._computeOrientationMaxIndex(),this._index>=this._orientationMaxIndex||this._index<0?this._outOfBounds=!0:this._outOfBounds=!1}_prepareStack(){this._stack.prepared||this._stack.prepare(),this._stack.packed||this._stack.pack()}_prepareBBox(){this._bBox=new vl(this._stack),this.add(this._bBox)}_prepareBorder(){this._border=new gl(this._slice),this.add(this._border)}_prepareSlice(){let t=this._stack.halfDimensionsIJK;this._index=this._prepareSliceIndex(t);let e=this._prepareSlicePosition(t,this._index),i=this._prepareDirection(this._orientation);this._slice=new Pl(this._stack,this._index,e,i),this.add(this._slice)}_prepareSliceIndex(t){let e=0;switch(this._orientation){case 0:e=Math.floor(t.z);break;case 1:e=Math.floor(t.x);break;case 2:e=Math.floor(t.y)}return e}_prepareSlicePosition(t,e){let i=new Pe(0,0,0);switch(this._orientation){case 0:i=new Pe(Math.floor(t.x),Math.floor(t.y),e);break;case 1:i=new Pe(e,Math.floor(t.y),Math.floor(t.z));break;case 2:i=new Pe(Math.floor(t.x),e,Math.floor(t.z))}return i}_prepareDirection(t){let e=new Pe(0,0,1);switch(t){case 0:e=new Pe(0,0,1);break;case 1:e=new Pe(1,0,0);break;case 2:e=new Pe(0,1,0)}return e}dispose(){this.remove(this._slice),this._slice.dispose(),this._slice=null,this._bBox.dispose(),this._bBox=null,this._border.dispose(),this._border=null}}(e),this.stackHelper.bbox.visible=!1,this.stackHelper.borderColor="#2196F3",this.stackHelper.border.visible=!1,this.scene.add(this.stackHelper);var i=e.worldBoundingBox(),n=new s.Vector3((i[1]-i[0])/2,(i[3]-i[2])/2,(i[5]-i[4])/2),r={center:e.worldCenter().clone(),halfDimensions:new s.Vector3(n.x+10,n.y+10,n.z+10)},a={width:this.threeD.clientWidth,height:this.threeD.clientHeight};this.camera.directions=[e.xCosine,e.yCosine,e.zCosine],this.camera.box=r,this.camera.canvas=a,this.camera.update(),this.camera.fitBox(2),this.updateLabels(this.camera.directionsLabel,e.modality),this.buildGUI(this.stackHelper),this.hookCallbacks(this.stackHelper)},buttoninputClick:function(){this.$refs.filesinput.click()},_filterByExtension:function(t,e){return e.extension.toUpperCase()===t.toUpperCase()},filesinputChange:function(t){var e=this;t.target.files.length&&(this.$refs.homeContainer.style.display="none");for(var i=function(t,i){return r.a.resolve().then(function(){return new r.a(function(e,n){var r=new FileReader;r.addEventListener("load",function(t){e(t.target.result)}),r.readAsArrayBuffer(i[t])})}).then(function(n){return e.loader.parse({url:i[t].name,buffer:n})}).then(function(t){e.seriesContainer.push(t)}).catch(function(t){window.console.log("oops... something went wrong..."),window.console.log(t)})},n=[],a=[],s=[],o=0;o<t.target.files.length;o++){var l=qo.parseUrl(t.target.files[o].name);"MHD"===l.extension.toUpperCase()||"RAW"===l.extension.toUpperCase()||"ZRAW"===l.extension.toUpperCase()?s.push({file:t.target.files[o],extension:l.extension.toUpperCase()}):a.push(t.target.files[o])}if(2===s.length){var h=s.filter(this._filterByExtension.bind(null,"MHD")),c=s.filter(this._filterByExtension.bind(null,"RAW")),u=s.filter(this._filterByExtension.bind(null,"ZRAW"));1!==h.length||1!==c.length&&1!==u.length||n.push(function(t){for(var i=[],n=function(e){i.push(new r.a(function(i,n){var r=new FileReader;r.addEventListener("load",function(t){i(t.target.result)}),r.readAsArrayBuffer(t[e].file)}).then(function(i){return{url:t[e].file.name,buffer:i}}))},a=0;a<t.length;a++)n(a);return r.a.all(i).then(function(t){return e.loader.parse(t)}).then(function(t){this.seriesContainer.push(t)}).catch(function(t){window.console.log("oops... something went wrong..."),window.console.log(t)})}(s))}for(var d=0;d<a.length;d++)n.push(i(d,a));r.a.all(n).then(function(){e.handleSeries(e.seriesContainer)}).catch(function(t){window.console.log("oops... something went wrong..."),window.console.log(t)})}}},Dl={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"component-viewers-upload flex-layout",on:{keydown:t.onWindowKeyPressed,keyup:t.onWindowKeyPressed,mousemove:t.onMouseMove}},[i("div",{staticClass:"flex-none"},[t._v("\r\n        viewers-upload\r\n    ")]),t._v(" "),i("div",{staticClass:"flex-auto prelative"},[i("div",{ref:"homeContainer",staticClass:"home-container"},[i("div",{ref:"buttons",staticClass:"buttons"},[i("button",{ref:"buttoninput",staticClass:"buttoninput",attrs:{type:"button"},on:{click:t.buttoninputClick}},[t._v("\r\n                    Dicom"),i("br"),t._v("Mgh/z"),i("br"),t._v("Nifti"),i("br"),t._v("Nrrd\r\n                ")]),t._v(" "),i("input",{ref:"filesinput",staticClass:"filesinput",attrs:{type:"file",multiple:""},on:{change:t.filesinputChange}})])]),t._v(" "),i("div",{ref:"myGuiContainer",staticClass:"my-gui-container"}),t._v(" "),i("div",{ref:"myLutContainer",staticClass:"my-lut-container"},[i("div",{ref:"myLutCanvases",staticClass:"my-lut-canvases"})]),t._v(" "),i("div",{ref:"viewer",staticClass:"viewer"},[i("div",{ref:"orientation",staticClass:"orientation"},[i("div",{ref:"top",staticClass:"direction top"}),t._v(" "),i("div",{ref:"bottom",staticClass:"direction bottom"}),t._v(" "),i("div",{ref:"left",staticClass:"direction left"}),t._v(" "),i("div",{ref:"right",staticClass:"direction right"})]),t._v(" "),i("div",{directives:[{name:"resize",rawName:"v-resize:throttle.10",value:t.onWindowResize,expression:"onWindowResize",arg:"throttle",modifiers:{10:!0}}],ref:"r3d",staticClass:"r3d"})]),t._v(" "),i("div",{staticStyle:{"background-color":"#f9f9f9",width:"0",height:"0"}})])])},staticRenderFns:[]};var kl=i("VU/8")(Ll,Dl,!1,function(t){i("U2Z7")},"data-v-2ad1bb97",null);e.default=kl.exports},ZjIE:function(t,e,i){"use strict";var n=i("gt5T"),r=4,a=0,s=1,o=2;function l(t){for(var e=t.length;--e>=0;)t[e]=0}var h=0,c=1,u=2,d=29,f=256,p=f+1+d,m=30,g=19,v=2*p+1,_=15,y=16,b=7,x=256,w=16,E=17,S=18,T=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],I=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],C=new Array(2*(p+2));l(C);var P=new Array(2*m);l(P);var R=new Array(512);l(R);var L=new Array(256);l(L);var D=new Array(d);l(D);var k,O,N,U=new Array(m);function F(t,e,i,n,r){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=n,this.max_length=r,this.has_stree=t&&t.length}function B(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function z(t){return t<256?R[t]:R[256+(t>>>7)]}function H(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function G(t,e,i){t.bi_valid>y-i?(t.bi_buf|=e<<t.bi_valid&65535,H(t,t.bi_buf),t.bi_buf=e>>y-t.bi_valid,t.bi_valid+=i-y):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)}function j(t,e,i){G(t,i[2*e],i[2*e+1])}function V(t,e){var i=0;do{i|=1&t,t>>>=1,i<<=1}while(--e>0);return i>>>1}function W(t,e,i){var n,r,a=new Array(_+1),s=0;for(n=1;n<=_;n++)a[n]=s=s+i[n-1]<<1;for(r=0;r<=e;r++){var o=t[2*r+1];0!==o&&(t[2*r]=V(a[o]++,o))}}function q(t){var e;for(e=0;e<p;e++)t.dyn_ltree[2*e]=0;for(e=0;e<m;e++)t.dyn_dtree[2*e]=0;for(e=0;e<g;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*x]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function X(t){t.bi_valid>8?H(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function Y(t,e,i,n){var r=2*e,a=2*i;return t[r]<t[a]||t[r]===t[a]&&n[e]<=n[i]}function Z(t,e,i){for(var n=t.heap[i],r=i<<1;r<=t.heap_len&&(r<t.heap_len&&Y(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!Y(e,n,t.heap[r],t.depth));)t.heap[i]=t.heap[r],i=r,r<<=1;t.heap[i]=n}function J(t,e,i){var n,r,a,s,o=0;if(0!==t.last_lit)do{n=t.pending_buf[t.d_buf+2*o]<<8|t.pending_buf[t.d_buf+2*o+1],r=t.pending_buf[t.l_buf+o],o++,0===n?j(t,r,e):(j(t,(a=L[r])+f+1,e),0!==(s=T[a])&&G(t,r-=D[a],s),j(t,a=z(--n),i),0!==(s=M[a])&&G(t,n-=U[a],s))}while(o<t.last_lit);j(t,x,e)}function K(t,e){var i,n,r,a=e.dyn_tree,s=e.stat_desc.static_tree,o=e.stat_desc.has_stree,l=e.stat_desc.elems,h=-1;for(t.heap_len=0,t.heap_max=v,i=0;i<l;i++)0!==a[2*i]?(t.heap[++t.heap_len]=h=i,t.depth[i]=0):a[2*i+1]=0;for(;t.heap_len<2;)a[2*(r=t.heap[++t.heap_len]=h<2?++h:0)]=1,t.depth[r]=0,t.opt_len--,o&&(t.static_len-=s[2*r+1]);for(e.max_code=h,i=t.heap_len>>1;i>=1;i--)Z(t,a,i);r=l;do{i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Z(t,a,1),n=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=n,a[2*r]=a[2*i]+a[2*n],t.depth[r]=(t.depth[i]>=t.depth[n]?t.depth[i]:t.depth[n])+1,a[2*i+1]=a[2*n+1]=r,t.heap[1]=r++,Z(t,a,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var i,n,r,a,s,o,l=e.dyn_tree,h=e.max_code,c=e.stat_desc.static_tree,u=e.stat_desc.has_stree,d=e.stat_desc.extra_bits,f=e.stat_desc.extra_base,p=e.stat_desc.max_length,m=0;for(a=0;a<=_;a++)t.bl_count[a]=0;for(l[2*t.heap[t.heap_max]+1]=0,i=t.heap_max+1;i<v;i++)(a=l[2*l[2*(n=t.heap[i])+1]+1]+1)>p&&(a=p,m++),l[2*n+1]=a,n>h||(t.bl_count[a]++,s=0,n>=f&&(s=d[n-f]),o=l[2*n],t.opt_len+=o*(a+s),u&&(t.static_len+=o*(c[2*n+1]+s)));if(0!==m){do{for(a=p-1;0===t.bl_count[a];)a--;t.bl_count[a]--,t.bl_count[a+1]+=2,t.bl_count[p]--,m-=2}while(m>0);for(a=p;0!==a;a--)for(n=t.bl_count[a];0!==n;)(r=t.heap[--i])>h||(l[2*r+1]!==a&&(t.opt_len+=(a-l[2*r+1])*l[2*r],l[2*r+1]=a),n--)}}(t,e),W(a,h,t.bl_count)}function Q(t,e,i){var n,r,a=-1,s=e[1],o=0,l=7,h=4;for(0===s&&(l=138,h=3),e[2*(i+1)+1]=65535,n=0;n<=i;n++)r=s,s=e[2*(n+1)+1],++o<l&&r===s||(o<h?t.bl_tree[2*r]+=o:0!==r?(r!==a&&t.bl_tree[2*r]++,t.bl_tree[2*w]++):o<=10?t.bl_tree[2*E]++:t.bl_tree[2*S]++,o=0,a=r,0===s?(l=138,h=3):r===s?(l=6,h=3):(l=7,h=4))}function $(t,e,i){var n,r,a=-1,s=e[1],o=0,l=7,h=4;for(0===s&&(l=138,h=3),n=0;n<=i;n++)if(r=s,s=e[2*(n+1)+1],!(++o<l&&r===s)){if(o<h)do{j(t,r,t.bl_tree)}while(0!=--o);else 0!==r?(r!==a&&(j(t,r,t.bl_tree),o--),j(t,w,t.bl_tree),G(t,o-3,2)):o<=10?(j(t,E,t.bl_tree),G(t,o-3,3)):(j(t,S,t.bl_tree),G(t,o-11,7));o=0,a=r,0===s?(l=138,h=3):r===s?(l=6,h=3):(l=7,h=4)}}l(U);var tt=!1;function et(t,e,i,r){G(t,(h<<1)+(r?1:0),3),function(t,e,i,r){X(t),r&&(H(t,i),H(t,~i)),n.arraySet(t.pending_buf,t.window,e,i,t.pending),t.pending+=i}(t,e,i,!0)}e._tr_init=function(t){tt||(function(){var t,e,i,n,r,a=new Array(_+1);for(i=0,n=0;n<d-1;n++)for(D[n]=i,t=0;t<1<<T[n];t++)L[i++]=n;for(L[i-1]=n,r=0,n=0;n<16;n++)for(U[n]=r,t=0;t<1<<M[n];t++)R[r++]=n;for(r>>=7;n<m;n++)for(U[n]=r<<7,t=0;t<1<<M[n]-7;t++)R[256+r++]=n;for(e=0;e<=_;e++)a[e]=0;for(t=0;t<=143;)C[2*t+1]=8,t++,a[8]++;for(;t<=255;)C[2*t+1]=9,t++,a[9]++;for(;t<=279;)C[2*t+1]=7,t++,a[7]++;for(;t<=287;)C[2*t+1]=8,t++,a[8]++;for(W(C,p+1,a),t=0;t<m;t++)P[2*t+1]=5,P[2*t]=V(t,5);k=new F(C,T,f+1,p,_),O=new F(P,M,0,m,_),N=new F(new Array(0),A,0,g,b)}(),tt=!0),t.l_desc=new B(t.dyn_ltree,k),t.d_desc=new B(t.dyn_dtree,O),t.bl_desc=new B(t.bl_tree,N),t.bi_buf=0,t.bi_valid=0,q(t)},e._tr_stored_block=et,e._tr_flush_block=function(t,e,i,n){var l,h,d=0;t.level>0?(t.strm.data_type===o&&(t.strm.data_type=function(t){var e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return a;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return s;for(e=32;e<f;e++)if(0!==t.dyn_ltree[2*e])return s;return a}(t)),K(t,t.l_desc),K(t,t.d_desc),d=function(t){var e;for(Q(t,t.dyn_ltree,t.l_desc.max_code),Q(t,t.dyn_dtree,t.d_desc.max_code),K(t,t.bl_desc),e=g-1;e>=3&&0===t.bl_tree[2*I[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),l=t.opt_len+3+7>>>3,(h=t.static_len+3+7>>>3)<=l&&(l=h)):l=h=i+5,i+4<=l&&-1!==e?et(t,e,i,n):t.strategy===r||h===l?(G(t,(c<<1)+(n?1:0),3),J(t,C,P)):(G(t,(u<<1)+(n?1:0),3),function(t,e,i,n){var r;for(G(t,e-257,5),G(t,i-1,5),G(t,n-4,4),r=0;r<n;r++)G(t,t.bl_tree[2*I[r]+1],3);$(t,t.dyn_ltree,e-1),$(t,t.dyn_dtree,i-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,d+1),J(t,t.dyn_ltree,t.dyn_dtree)),q(t),n&&X(t)},e._tr_tally=function(t,e,i){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(L[i]+f+1)]++,t.dyn_dtree[2*z(e)]++),t.last_lit===t.lit_bufsize-1},e._tr_align=function(t){G(t,c<<1,3),j(t,x,C),function(t){16===t.bi_valid?(H(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},cSWu:function(t,e,i){(e=t.exports=i("Rt1F")).Stream=e,e.Readable=e,e.Writable=i("7dSG"),e.Duplex=i("DsFX"),e.Transform=i("D1Va"),e.PassThrough=i("f48b")},d1sp:function(t,e,i){"use strict";var n=i("3mCb"),r=i("x+d4"),a=i("Ytp1"),s=i("6akE"),o=i("5Ek+"),l=Object.prototype.toString,h=0,c=-1,u=0,d=8;function f(t){if(!(this instanceof f))return new f(t);this.options=r.assign({level:c,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var i=n.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(i!==h)throw new Error(s[i]);if(e.header&&n.deflateSetHeader(this.strm,e.header),e.dictionary){var p;if(p="string"==typeof e.dictionary?a.string2buf(e.dictionary):"[object ArrayBuffer]"===l.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(i=n.deflateSetDictionary(this.strm,p))!==h)throw new Error(s[i]);this._dict_set=!0}}function p(t,e){var i=new f(e);if(i.push(t,!0),i.err)throw i.msg;return i.result}f.prototype.push=function(t,e){var i,s,o=this.strm,c=this.options.chunkSize;if(this.ended)return!1;s=e===~~e?e:!0===e?4:0,"string"==typeof t?o.input=a.string2buf(t):"[object ArrayBuffer]"===l.call(t)?o.input=new Uint8Array(t):o.input=t,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new r.Buf8(c),o.next_out=0,o.avail_out=c),1!==(i=n.deflate(o,s))&&i!==h)return this.onEnd(i),this.ended=!0,!1;0!==o.avail_out&&(0!==o.avail_in||4!==s&&2!==s)||("string"===this.options.to?this.onData(a.buf2binstring(r.shrinkBuf(o.output,o.next_out))):this.onData(r.shrinkBuf(o.output,o.next_out)))}while((o.avail_in>0||0===o.avail_out)&&1!==i);return 4===s?(i=n.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===h):2!==s||(this.onEnd(h),o.avail_out=0,!0)},f.prototype.onData=function(t){this.chunks.push(t)},f.prototype.onEnd=function(t){t===h&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Deflate=f,e.deflate=p,e.deflateRaw=function(t,e){return(e=e||{}).raw=!0,p(t,e)},e.gzip=function(t,e){return(e=e||{}).gzip=!0,p(t,e)}},ds5T:function(t,e,i){"use strict";var n=i("GA34"),r=i("eBA+"),a=i("Ul2F"),s=i("EOWi"),o=9007199254740991;t.exports=function(t,e,i){var l,h;if(!n(t))throw new TypeError("invalid input argument. First argument must be a string. Value: `"+t+"`.");if(!r(e))throw new TypeError("invalid input argument. Second argument must be a nonnegative integer. Value: `"+e+"`.");if(arguments.length>2){if(!n(h=i))throw new TypeError("invalid input argument. Third argument must be a string. Value: `"+h+"`.");if(0===h.length)throw new RangeError("invalid input argument. Pad string must not be an empty string.")}else h=" ";if(e>o)throw new RangeError("invalid input argument. Output string length exceeds maximum allowed string length.");return(l=(e-t.length)/h.length)<=0?t:(l=a(l),t+s(h,l))}},e94L:function(t,e,i){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.DataStream=n.lossless.DataStream||i("NuSx"),n.lossless.Utils=n.lossless.Utils||i("Ixlh"),n.lossless.HuffmanTable=n.lossless.HuffmanTable||function(){this.l=n.lossless.Utils.createArray(4,2,16),this.th=[],this.v=n.lossless.Utils.createArray(4,2,16,200),this.tc=n.lossless.Utils.createArray(4,2),this.tc[0][0]=0,this.tc[1][0]=0,this.tc[2][0]=0,this.tc[3][0]=0,this.tc[0][1]=0,this.tc[1][1]=0,this.tc[2][1]=0,this.tc[3][1]=0,this.th[0]=0,this.th[1]=0,this.th[2]=0,this.th[3]=0},n.lossless.HuffmanTable.MSB=2147483648,n.lossless.HuffmanTable.prototype.read=function(t,e){var i,n,r,a,s,o,l=0;for(i=t.get16(),l+=2;l<i;){if(l+=1,(r=15&(n=t.get8()))>3)throw new Error("ERROR: Huffman table ID > 3");if((a=n>>4)>2)throw new Error("ERROR: Huffman table [Table class > 2 ]");for(this.th[r]=1,this.tc[r][a]=1,s=0;s<16;s+=1)this.l[r][a][s]=t.get8(),l+=1;for(s=0;s<16;s+=1)for(o=0;o<this.l[r][a][s];o+=1){if(l>i)throw new Error("ERROR: Huffman table format error [count>Lh]");this.v[r][a][s][o]=t.get8(),l+=1}}if(l!==i)throw new Error("ERROR: Huffman table format error [count!=Lf]");for(s=0;s<4;s+=1)for(o=0;o<2;o+=1)0!==this.tc[s][o]&&this.buildHuffTable(e[s][o],this.l[s][o],this.v[s][o]);return 1},n.lossless.HuffmanTable.prototype.buildHuffTable=function(t,e,i){var r,a,s,o,l;for(256,a=0,s=0;s<8;s+=1)for(o=0;o<e[s];o+=1)for(l=0;l<256>>s+1;l+=1)t[a]=i[s][o]|s+1<<8,a+=1;for(s=1;a<256;s+=1,a+=1)t[a]=s|n.lossless.HuffmanTable.MSB;for(r=1,a=0,s=8;s<16;s+=1)for(o=0;o<e[s];o+=1){for(l=0;l<256>>s-7;l+=1)t[256*r+a]=i[s][o]|s+1<<8,a+=1;if(a>=256){if(a>256)throw new Error("ERROR: Huffman table error(1)!");a=0,r+=1}}},"undefined"!==typeof t&&t.exports&&(t.exports=n.lossless.HuffmanTable)},"eBA+":function(t,e,i){"use strict";var n=i("6iCK");t.exports=function(t){return n(t)&&t>=0}},f48b:function(t,e,i){"use strict";t.exports=a;var n=i("D1Va"),r=Object.create(i("jOgh"));function a(t){if(!(this instanceof a))return new a(t);n.call(this,t)}r.inherits=i("LC74"),r.inherits(a,n),a.prototype._transform=function(t,e,i){i(null,t)}},fC4T:function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},fkix:function(t,e,i){"use strict";var n=i("gt5T"),r=i("KpjM"),a=i("2WCG"),s=i("Un+M"),o=i("K0S7"),l=0,h=1,c=2,u=4,d=5,f=6,p=0,m=1,g=2,v=-2,_=-3,y=-4,b=-5,x=8,w=1,E=2,S=3,T=4,M=5,A=6,I=7,C=8,P=9,R=10,L=11,D=12,k=13,O=14,N=15,U=16,F=17,B=18,z=19,H=20,G=21,j=22,V=23,W=24,q=25,X=26,Y=27,Z=28,J=29,K=30,Q=31,$=32,tt=852,et=592,it=15;function nt(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function rt(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=w,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new n.Buf32(tt),e.distcode=e.distdyn=new n.Buf32(et),e.sane=1,e.back=-1,p):v}function at(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,rt(t)):v}function st(t,e){var i,n;return t&&t.state?(n=t.state,e<0?(i=0,e=-e):(i=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?v:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=i,n.wbits=e,at(t))):v}function ot(t,e){var i,r;return t?(r=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},t.state=r,r.window=null,(i=st(t,e))!==p&&(t.state=null),i):v}var lt,ht,ct=!0;function ut(t){if(ct){var e;for(lt=new n.Buf32(512),ht=new n.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(o(h,t.lens,0,288,lt,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;o(c,t.lens,0,32,ht,0,t.work,{bits:5}),ct=!1}t.lencode=lt,t.lenbits=9,t.distcode=ht,t.distbits=5}function dt(t,e,i,r){var a,s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new n.Buf8(s.wsize)),r>=s.wsize?(n.arraySet(s.window,e,i-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):((a=s.wsize-s.wnext)>r&&(a=r),n.arraySet(s.window,e,i-r,a,s.wnext),(r-=a)?(n.arraySet(s.window,e,i-r,r,0),s.wnext=r,s.whave=s.wsize):(s.wnext+=a,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=a))),0}e.inflateReset=at,e.inflateReset2=st,e.inflateResetKeep=rt,e.inflateInit=function(t){return ot(t,it)},e.inflateInit2=ot,e.inflate=function(t,e){var i,tt,et,it,rt,at,st,ot,lt,ht,ct,ft,pt,mt,gt,vt,_t,yt,bt,xt,wt,Et,St,Tt,Mt=0,At=new n.Buf8(4),It=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return v;(i=t.state).mode===D&&(i.mode=k),rt=t.next_out,et=t.output,st=t.avail_out,it=t.next_in,tt=t.input,at=t.avail_in,ot=i.hold,lt=i.bits,ht=at,ct=st,Et=p;t:for(;;)switch(i.mode){case w:if(0===i.wrap){i.mode=k;break}for(;lt<16;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(2&i.wrap&&35615===ot){i.check=0,At[0]=255&ot,At[1]=ot>>>8&255,i.check=a(i.check,At,2,0),ot=0,lt=0,i.mode=E;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&ot)<<8)+(ot>>8))%31){t.msg="incorrect header check",i.mode=K;break}if((15&ot)!==x){t.msg="unknown compression method",i.mode=K;break}if(lt-=4,wt=8+(15&(ot>>>=4)),0===i.wbits)i.wbits=wt;else if(wt>i.wbits){t.msg="invalid window size",i.mode=K;break}i.dmax=1<<wt,t.adler=i.check=1,i.mode=512&ot?R:D,ot=0,lt=0;break;case E:for(;lt<16;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(i.flags=ot,(255&i.flags)!==x){t.msg="unknown compression method",i.mode=K;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=K;break}i.head&&(i.head.text=ot>>8&1),512&i.flags&&(At[0]=255&ot,At[1]=ot>>>8&255,i.check=a(i.check,At,2,0)),ot=0,lt=0,i.mode=S;case S:for(;lt<32;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}i.head&&(i.head.time=ot),512&i.flags&&(At[0]=255&ot,At[1]=ot>>>8&255,At[2]=ot>>>16&255,At[3]=ot>>>24&255,i.check=a(i.check,At,4,0)),ot=0,lt=0,i.mode=T;case T:for(;lt<16;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}i.head&&(i.head.xflags=255&ot,i.head.os=ot>>8),512&i.flags&&(At[0]=255&ot,At[1]=ot>>>8&255,i.check=a(i.check,At,2,0)),ot=0,lt=0,i.mode=M;case M:if(1024&i.flags){for(;lt<16;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}i.length=ot,i.head&&(i.head.extra_len=ot),512&i.flags&&(At[0]=255&ot,At[1]=ot>>>8&255,i.check=a(i.check,At,2,0)),ot=0,lt=0}else i.head&&(i.head.extra=null);i.mode=A;case A:if(1024&i.flags&&((ft=i.length)>at&&(ft=at),ft&&(i.head&&(wt=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),n.arraySet(i.head.extra,tt,it,ft,wt)),512&i.flags&&(i.check=a(i.check,tt,ft,it)),at-=ft,it+=ft,i.length-=ft),i.length))break t;i.length=0,i.mode=I;case I:if(2048&i.flags){if(0===at)break t;ft=0;do{wt=tt[it+ft++],i.head&&wt&&i.length<65536&&(i.head.name+=String.fromCharCode(wt))}while(wt&&ft<at);if(512&i.flags&&(i.check=a(i.check,tt,ft,it)),at-=ft,it+=ft,wt)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=C;case C:if(4096&i.flags){if(0===at)break t;ft=0;do{wt=tt[it+ft++],i.head&&wt&&i.length<65536&&(i.head.comment+=String.fromCharCode(wt))}while(wt&&ft<at);if(512&i.flags&&(i.check=a(i.check,tt,ft,it)),at-=ft,it+=ft,wt)break t}else i.head&&(i.head.comment=null);i.mode=P;case P:if(512&i.flags){for(;lt<16;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(ot!==(65535&i.check)){t.msg="header crc mismatch",i.mode=K;break}ot=0,lt=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=D;break;case R:for(;lt<32;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}t.adler=i.check=nt(ot),ot=0,lt=0,i.mode=L;case L:if(0===i.havedict)return t.next_out=rt,t.avail_out=st,t.next_in=it,t.avail_in=at,i.hold=ot,i.bits=lt,g;t.adler=i.check=1,i.mode=D;case D:if(e===d||e===f)break t;case k:if(i.last){ot>>>=7&lt,lt-=7&lt,i.mode=Y;break}for(;lt<3;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}switch(i.last=1&ot,lt-=1,3&(ot>>>=1)){case 0:i.mode=O;break;case 1:if(ut(i),i.mode=H,e===f){ot>>>=2,lt-=2;break t}break;case 2:i.mode=F;break;case 3:t.msg="invalid block type",i.mode=K}ot>>>=2,lt-=2;break;case O:for(ot>>>=7&lt,lt-=7&lt;lt<32;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if((65535&ot)!=(ot>>>16^65535)){t.msg="invalid stored block lengths",i.mode=K;break}if(i.length=65535&ot,ot=0,lt=0,i.mode=N,e===f)break t;case N:i.mode=U;case U:if(ft=i.length){if(ft>at&&(ft=at),ft>st&&(ft=st),0===ft)break t;n.arraySet(et,tt,it,ft,rt),at-=ft,it+=ft,st-=ft,rt+=ft,i.length-=ft;break}i.mode=D;break;case F:for(;lt<14;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(i.nlen=257+(31&ot),ot>>>=5,lt-=5,i.ndist=1+(31&ot),ot>>>=5,lt-=5,i.ncode=4+(15&ot),ot>>>=4,lt-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=K;break}i.have=0,i.mode=B;case B:for(;i.have<i.ncode;){for(;lt<3;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}i.lens[It[i.have++]]=7&ot,ot>>>=3,lt-=3}for(;i.have<19;)i.lens[It[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,St={bits:i.lenbits},Et=o(l,i.lens,0,19,i.lencode,0,i.work,St),i.lenbits=St.bits,Et){t.msg="invalid code lengths set",i.mode=K;break}i.have=0,i.mode=z;case z:for(;i.have<i.nlen+i.ndist;){for(;vt=(Mt=i.lencode[ot&(1<<i.lenbits)-1])>>>16&255,_t=65535&Mt,!((gt=Mt>>>24)<=lt);){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(_t<16)ot>>>=gt,lt-=gt,i.lens[i.have++]=_t;else{if(16===_t){for(Tt=gt+2;lt<Tt;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(ot>>>=gt,lt-=gt,0===i.have){t.msg="invalid bit length repeat",i.mode=K;break}wt=i.lens[i.have-1],ft=3+(3&ot),ot>>>=2,lt-=2}else if(17===_t){for(Tt=gt+3;lt<Tt;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}lt-=gt,wt=0,ft=3+(7&(ot>>>=gt)),ot>>>=3,lt-=3}else{for(Tt=gt+7;lt<Tt;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}lt-=gt,wt=0,ft=11+(127&(ot>>>=gt)),ot>>>=7,lt-=7}if(i.have+ft>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=K;break}for(;ft--;)i.lens[i.have++]=wt}}if(i.mode===K)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=K;break}if(i.lenbits=9,St={bits:i.lenbits},Et=o(h,i.lens,0,i.nlen,i.lencode,0,i.work,St),i.lenbits=St.bits,Et){t.msg="invalid literal/lengths set",i.mode=K;break}if(i.distbits=6,i.distcode=i.distdyn,St={bits:i.distbits},Et=o(c,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,St),i.distbits=St.bits,Et){t.msg="invalid distances set",i.mode=K;break}if(i.mode=H,e===f)break t;case H:i.mode=G;case G:if(at>=6&&st>=258){t.next_out=rt,t.avail_out=st,t.next_in=it,t.avail_in=at,i.hold=ot,i.bits=lt,s(t,ct),rt=t.next_out,et=t.output,st=t.avail_out,it=t.next_in,tt=t.input,at=t.avail_in,ot=i.hold,lt=i.bits,i.mode===D&&(i.back=-1);break}for(i.back=0;vt=(Mt=i.lencode[ot&(1<<i.lenbits)-1])>>>16&255,_t=65535&Mt,!((gt=Mt>>>24)<=lt);){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(vt&&0==(240&vt)){for(yt=gt,bt=vt,xt=_t;vt=(Mt=i.lencode[xt+((ot&(1<<yt+bt)-1)>>yt)])>>>16&255,_t=65535&Mt,!(yt+(gt=Mt>>>24)<=lt);){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}ot>>>=yt,lt-=yt,i.back+=yt}if(ot>>>=gt,lt-=gt,i.back+=gt,i.length=_t,0===vt){i.mode=X;break}if(32&vt){i.back=-1,i.mode=D;break}if(64&vt){t.msg="invalid literal/length code",i.mode=K;break}i.extra=15&vt,i.mode=j;case j:if(i.extra){for(Tt=i.extra;lt<Tt;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}i.length+=ot&(1<<i.extra)-1,ot>>>=i.extra,lt-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=V;case V:for(;vt=(Mt=i.distcode[ot&(1<<i.distbits)-1])>>>16&255,_t=65535&Mt,!((gt=Mt>>>24)<=lt);){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(0==(240&vt)){for(yt=gt,bt=vt,xt=_t;vt=(Mt=i.distcode[xt+((ot&(1<<yt+bt)-1)>>yt)])>>>16&255,_t=65535&Mt,!(yt+(gt=Mt>>>24)<=lt);){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}ot>>>=yt,lt-=yt,i.back+=yt}if(ot>>>=gt,lt-=gt,i.back+=gt,64&vt){t.msg="invalid distance code",i.mode=K;break}i.offset=_t,i.extra=15&vt,i.mode=W;case W:if(i.extra){for(Tt=i.extra;lt<Tt;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}i.offset+=ot&(1<<i.extra)-1,ot>>>=i.extra,lt-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=K;break}i.mode=q;case q:if(0===st)break t;if(ft=ct-st,i.offset>ft){if((ft=i.offset-ft)>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=K;break}ft>i.wnext?(ft-=i.wnext,pt=i.wsize-ft):pt=i.wnext-ft,ft>i.length&&(ft=i.length),mt=i.window}else mt=et,pt=rt-i.offset,ft=i.length;ft>st&&(ft=st),st-=ft,i.length-=ft;do{et[rt++]=mt[pt++]}while(--ft);0===i.length&&(i.mode=G);break;case X:if(0===st)break t;et[rt++]=i.length,st--,i.mode=G;break;case Y:if(i.wrap){for(;lt<32;){if(0===at)break t;at--,ot|=tt[it++]<<lt,lt+=8}if(ct-=st,t.total_out+=ct,i.total+=ct,ct&&(t.adler=i.check=i.flags?a(i.check,et,ct,rt-ct):r(i.check,et,ct,rt-ct)),ct=st,(i.flags?ot:nt(ot))!==i.check){t.msg="incorrect data check",i.mode=K;break}ot=0,lt=0}i.mode=Z;case Z:if(i.wrap&&i.flags){for(;lt<32;){if(0===at)break t;at--,ot+=tt[it++]<<lt,lt+=8}if(ot!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=K;break}ot=0,lt=0}i.mode=J;case J:Et=m;break t;case K:Et=_;break t;case Q:return y;case $:default:return v}return t.next_out=rt,t.avail_out=st,t.next_in=it,t.avail_in=at,i.hold=ot,i.bits=lt,(i.wsize||ct!==t.avail_out&&i.mode<K&&(i.mode<Y||e!==u))&&dt(t,t.output,t.next_out,ct-t.avail_out)?(i.mode=Q,y):(ht-=t.avail_in,ct-=t.avail_out,t.total_in+=ht,t.total_out+=ct,i.total+=ct,i.wrap&&ct&&(t.adler=i.check=i.flags?a(i.check,et,ct,t.next_out-ct):r(i.check,et,ct,t.next_out-ct)),t.data_type=i.bits+(i.last?64:0)+(i.mode===D?128:0)+(i.mode===H||i.mode===N?256:0),(0===ht&&0===ct||e===u)&&Et===p&&(Et=b),Et)},e.inflateEnd=function(t){if(!t||!t.state)return v;var e=t.state;return e.window&&(e.window=null),t.state=null,p},e.inflateGetHeader=function(t,e){var i;return t&&t.state?0==(2&(i=t.state).wrap)?v:(i.head=e,e.done=!1,p):v},e.inflateSetDictionary=function(t,e){var i,n=e.length;return t&&t.state?0!==(i=t.state).wrap&&i.mode!==L?v:i.mode===L&&r(1,e,n,0)!==i.check?_:dt(t,e,n,n)?(i.mode=Q,y):(i.havedict=1,p):v},e.inflateInfo="pako inflate (from Nodeca project)"},fxPE:function(t,e,i){"use strict";var n=i("+kkw");t.exports=function(t){for(var e,i="";t>0;)i=(e=t/2)===(t=n(e))?"0"+i:"1"+i;return i}},gt5T:function(t,e,i){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var n in i)r(i,n)&&(t[n]=i[n])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var a={arraySet:function(t,e,i,n,r){if(e.subarray&&t.subarray)t.set(e.subarray(i,i+n),r);else for(var a=0;a<n;a++)t[r+a]=e[i+a]},flattenChunks:function(t){var e,i,n,r,a,s;for(n=0,e=0,i=t.length;e<i;e++)n+=t[e].length;for(s=new Uint8Array(n),r=0,e=0,i=t.length;e<i;e++)a=t[e],s.set(a,r),r+=a.length;return s}},s={arraySet:function(t,e,i,n,r){for(var a=0;a<n;a++)t[r+a]=e[i+a]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,a)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,s))},e.setTyped(n)},h95s:function(t,e,i){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},iAY5:function(t,e,i){"use strict";var n={};(0,i("x+d4").assign)(n,i("d1sp"),i("4Tar"),i("JNao")),t.exports=n},iP15:function(t,e,i){(function(e){function i(t){try{if(!e.localStorage)return!1}catch(t){return!1}var i=e.localStorage[t];return null!=i&&"true"===String(i).toLowerCase()}t.exports=function(t,e){if(i("noDeprecation"))return t;var n=!1;return function(){if(!n){if(i("throwDeprecation"))throw new Error(e);i("traceDeprecation")?console.trace(e):console.warn(e),n=!0}return t.apply(this,arguments)}}}).call(e,i("DuR2"))},jCpJ:function(t,e,i){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.ComponentSpec=n.lossless.ComponentSpec||i("wN8F"),n.lossless.DataStream=n.lossless.DataStream||i("NuSx"),n.lossless.Decoder=n.lossless.Decoder||i("v01y"),n.lossless.FrameHeader=n.lossless.FrameHeader||i("wd9Z"),n.lossless.HuffmanTable=n.lossless.HuffmanTable||i("e94L"),n.lossless.QuantizationTable=n.lossless.QuantizationTable||i("BYXA"),n.lossless.ScanComponent=n.lossless.ScanComponent||i("zdxh"),n.lossless.ScanHeader=n.lossless.ScanHeader||i("pPW6"),n.lossless.Utils=n.lossless.Utils||i("Ixlh"),"undefined"!==typeof t&&t.exports&&(t.exports=n)},jOgh:function(t,e,i){(function(t){function i(t){return Object.prototype.toString.call(t)}e.isArray=function(t){return Array.isArray?Array.isArray(t):"[object Array]"===i(t)},e.isBoolean=function(t){return"boolean"==typeof t},e.isNull=function(t){return null===t},e.isNullOrUndefined=function(t){return null==t},e.isNumber=function(t){return"number"==typeof t},e.isString=function(t){return"string"==typeof t},e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=function(t){return void 0===t},e.isRegExp=function(t){return"[object RegExp]"===i(t)},e.isObject=function(t){return"object"==typeof t&&null!==t},e.isDate=function(t){return"[object Date]"===i(t)},e.isError=function(t){return"[object Error]"===i(t)||t instanceof Error},e.isFunction=function(t){return"function"==typeof t},e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=t.isBuffer}).call(e,i("EuP9").Buffer)},kLuP:function(t,e,i){"use strict";var n=n||{};n.Utils=n.Utils||{},n.Utils.crcTable=null,n.Utils.GUNZIP_MAGIC_COOKIE1=31,n.Utils.GUNZIP_MAGIC_COOKIE2=139,n.Utils.getStringAt=function(t,e,i){var n,r,a="";for(n=e;n<i;n+=1)0!==(r=t.getUint8(n))&&(a+=String.fromCharCode(r));return a},n.Utils.getByteAt=function(t,e){return t.getInt8(e)},n.Utils.getShortAt=function(t,e,i){return t.getInt16(e,i)},n.Utils.getIntAt=function(t,e,i){return t.getInt32(e,i)},n.Utils.getFloatAt=function(t,e,i){return t.getFloat32(e,i)},n.Utils.getDoubleAt=function(t,e,i){return t.getFloat64(e,i)},n.Utils.getLongAt=function(t,e,i){var r,a=[],s=0;for(r=0;r<8;r+=1)a[r]=n.Utils.getByteAt(t,e+r,i);for(r=a.length-1;r>=0;r--)s=256*s+a[r];return s},n.Utils.toArrayBuffer=function(t){var e,i,n;for(e=new ArrayBuffer(t.length),i=new Uint8Array(e),n=0;n<t.length;n+=1)i[n]=t[n];return e},n.Utils.isString=function(t){return"string"==typeof t||t instanceof String},n.Utils.formatNumber=function(t,e){var i=0;return i=n.Utils.isString(t)?Number(t):t,i=e?i.toPrecision(5):i.toPrecision(7),parseFloat(i)},n.Utils.makeCRCTable=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e},n.Utils.crc32=function(t){for(var e=n.Utils.crcTable||(n.Utils.crcTable=n.Utils.makeCRCTable()),i=-1,r=0;r<t.byteLength;r++)i=i>>>8^e[255&(i^t.getUint8(r))];return(-1^i)>>>0},"undefined"!==typeof t&&t.exports&&(t.exports=n.Utils)},kMPS:function(t,e,i){"use strict";function n(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,e,i,a){e=e||"&",i=i||"=";var s={};if("string"!=typeof t||0===t.length)return s;var o=/\+/g;t=t.split(e);var l=1e3;a&&"number"==typeof a.maxKeys&&(l=a.maxKeys);var h=t.length;l>0&&h>l&&(h=l);for(var c=0;c<h;++c){var u,d,f,p,m=t[c].replace(o,"%20"),g=m.indexOf(i);g>=0?(u=m.substr(0,g),d=m.substr(g+1)):(u=m,d=""),f=decodeURIComponent(u),p=decodeURIComponent(d),n(s,f)?r(s[f])?s[f].push(p):s[f]=[s[f],p]:s[f]=p}return s};var r=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},kkc6:function(t,e,i){var n=i("EuP9"),r=n.Buffer;function a(t,e){for(var i in t)e[i]=t[i]}function s(t,e,i){return r(t,e,i)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=n:(a(n,e),e.Buffer=s),a(r,s),s.from=function(t,e,i){if("number"==typeof t)throw new TypeError("Argument must not be a number");return r(t,e,i)},s.alloc=function(t,e,i){if("number"!=typeof t)throw new TypeError("Argument must be a number");var n=r(t);return void 0!==e?"string"==typeof i?n.fill(e,i):n.fill(e):n.fill(0),n},s.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return r(t)},s.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n.SlowBuffer(t)}},lKw5:function(t,e,i){"use strict";var n=new Float32Array(1);new Uint32Array(n.buffer)[0]=2139095040,t.exports=n[0]},nhZT:function(t,e,i){"use strict";t.exports=function(t){return t<0?-t:0===t?0:t}},pPW6:function(t,e,i){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.DataStream=n.lossless.DataStream||i("NuSx"),n.lossless.ScanComponent=n.lossless.ScanComponent||i("zdxh"),n.lossless.ScanHeader=n.lossless.ScanHeader||function(){this.ah=0,this.al=0,this.numComp=0,this.selection=0,this.spectralEnd=0,this.components=[]},n.lossless.ScanHeader.prototype.read=function(t){var e,i,r,a=0;for(e=t.get16(),a+=2,this.numComp=t.get8(),a+=1,i=0;i<this.numComp;i+=1){if(this.components[i]=new n.lossless.ScanComponent,a>e)throw new Error("ERROR: scan header format error");this.components[i].scanCompSel=t.get8(),a+=1,r=t.get8(),a+=1,this.components[i].dcTabSel=r>>4,this.components[i].acTabSel=15&r}if(this.selection=t.get8(),a+=1,this.spectralEnd=t.get8(),a+=1,r=t.get8(),this.ah=r>>4,this.al=15&r,(a+=1)!==e)throw new Error("ERROR: scan header format error [count!=Ns]");return 1},"undefined"!==typeof t&&t.exports&&(t.exports=n.lossless.ScanHeader)},qOJP:function(t,e,i){"use strict";t.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},rRpN:function(t,e,i){"use strict";var n=i("N+Om"),r=/[ \f\t\v]*\r?\n/,a=/^NRRD\d{4}$/,s=/^([^:]*)(:[ =])(.*)$/,o=/^LIST(?: (\d+))?$/;function l(t,e,i,r){var a,s,o=(s=t)in u?u[s]:s;switch(t){case"data":case"buffer":case"keys":case"version":break;case"content":case"number":case"sampleUnits":case"space":a=o+": "+e;break;case"blockSize":case"lineSkip":case"byteSkip":case"dimension":case"spaceDimension":n("number"==typeof e||e instanceof Number,"Field "+t+" should at least contain a number!"),a=o+": "+e;break;case"min":case"max":case"oldMin":case"oldMax":n("number"==typeof e||e instanceof Number,"Field "+t+" should contain a number!"),a=o+": "+e;break;case"spaceOrigin":n(e.length===r,"Field "+t+" should be a list with length equal to the space dimension!"),e.forEach(function(e){n("number"==typeof e||e instanceof Number,"Field "+t+" should be a list of numbers!")}),a=o+": ("+e.join(",")+")";break;case"labels":case"units":case"spaceUnits":n(void 0!==e.length&&e.length==i,"Field "+t+" should be a list with length equal to the dimension!"),e.forEach(function(e){n("string"==typeof e||e instanceof String,"Field "+t+" should be a list of numbers!")}),a=o+": "+e.map(v).join(" ");break;case"sizes":n(void 0!==e.length&&e.length==i,"Field "+t+" should be a list with length equal to the dimension!"),e.forEach(function(e){n("number"==typeof e||e instanceof Number,"Field "+t+" should be a list of numbers!")}),a=o+": "+e.join(" ");break;case"spacings":case"thicknesses":case"axisMins":case"axisMaxs":n(void 0!==e.length&&e.length==i,"Field "+t+" should be a list with length equal to the dimension!"),e.forEach(function(e){n("number"==typeof e||e instanceof Number,"Field "+t+" should be a list of numbers!")}),a=o+": "+e.join(" ");break;case"spaceDirections":n(void 0!==e.length&&e.length===i,"Field "+t+" should be a list with length equal to the dimension!"),e.forEach(function(e){n(null===e||void 0!==e.length&&e.length===r,"The elements of field "+t+" should be lists with length equal to the space dimension!"),null!==e&&e.forEach(function(e){n("number"==typeof e||e instanceof Number,"The elements of field "+t+" should be lists of numbers!")})}),a=o+": "+e.map(function(t){return null===t?"none":"("+t.join(",")+")"}).join(" ");break;case"measurementFrame":n(void 0!==e.length&&e.length===r,"Field "+t+" should be a list with length equal to the space dimension!"),e.forEach(function(e){n(null===e||void 0!==e.length&&e.length===r,"The elements of field "+t+" should be lists with length equal to the space dimension!"),null!==e&&e.forEach(function(e){n("number"==typeof e||e instanceof Number,"The elements of field "+t+" should be lists of numbers!")})}),a=o+": "+e.map(function(t){return null===t?"none":"("+t.join(",")+")"}).join(" ");break;case"type":case"encoding":case"endian":n("string"==typeof e||e instanceof String,"Field "+t+" should contain a string!"),a=o+": "+e;break;case"dataFile":e.length||e.files&&"subdim"in e||(a=o+": "+function(t){if("string"==typeof t||t instanceof String)return t;if("format"in t&&"min"in t&&"max"in t&&"step"in t)return"subdim"in t?t.format+" "+t.min+" "+t.max+" "+t.step+" "+t.subdim:t.format+" "+t.min+" "+t.max+" "+t.step;throw new Error("Unrecognized data file format!")}(e));break;case"centers":case"kinds":n(void 0!==e.length&&e.length==i,"Field "+t+" should be a list with length equal to the dimension!"),a=o+": "+e.map(A).join(" ");break;default:console.warn("Unrecognized NRRD field: "+t+", skipping.")}return a}function h(t,e){switch(t){case"content":case"number":case"sampleUnits":break;case"dimension":case"blockSize":case"lineSkip":case"byteSkip":case"spaceDimension":e=f(e);break;case"min":case"max":case"oldMin":case"oldMax":e=p(e);break;case"spaceOrigin":e=m(e);break;case"labels":case"units":case"spaceUnits":e=y(e,g);break;case"sizes":e=y(e,f);break;case"spacings":case"thicknesses":case"axisMins":case"axisMaxs":e=y(e,p);break;case"spaceDirections":case"measurementFrame":e=y(e,m);break;case"type":e=b(e);break;case"encoding":e=x(e);break;case"endian":e=w(e);break;case"dataFile":i=e,e=(n=E.exec(i))?5==n.length&&n[4]?{format:i.substring(0,n.index),min:f(n[1]),max:f(n[2]),step:f(n[3]),subdim:f(n[4])}:{format:i.substring(0,n.index),min:f(n[1]),max:f(n[2]),step:f(n[3])}:i;break;case"centers":e=y(e,S);break;case"kinds":e=y(e,M);break;case"space":e=function(t){switch(t.toLowerCase()){case"right-anterior-superior":case"ras":return"right-anterior-superior";case"left-anterior-superior":case"las":return"left-anterior-superior";case"left-posterior-superior":case"lps":return"left-posterior-superior";case"right-anterior-superior-time":case"rast":return"right-anterior-superior-time";case"left-anterior-superior-time":case"last":return"left-anterior-superior-time";case"left-posterior-superior-time":case"lpst":return"left-posterior-superior-time";case"scanner-xyz":return"scanner-xyz";case"scanner-xyz-time":return"scanner-xyz-time";case"3d-right-handed":return"3D-right-handed";case"3d-left-handed":return"3D-left-handed";case"3d-right-handed-time":return"3D-right-handed-time";case"3d-left-handed-time":return"3D-left-handed-time";default:return console.warn("Unrecognized space: "+t),t}}(e);break;default:console.warn("Unrecognized NRRD field: "+t)}var i,n;return e}t.exports.serialize=function(t){var e,i,n,r,a,s,o,h,c,u,d=1,f={},p=[];for(r in t)f[r]=t[r];if(void 0===f.sizes)throw new Error("Sizes missing from NRRD file!");if(void 0===f.dimension&&(f.dimension=f.sizes.length),f.data instanceof Int8Array?a="int8":f.data instanceof Uint8Array?a="uint8":f.data instanceof Int16Array?a="int16":f.data instanceof Uint16Array?a="uint16":f.data instanceof Int32Array?a="int32":f.data instanceof Uint32Array?a="uint32":f.data instanceof Float32Array?a="float":f.data instanceof Float64Array&&(a="double"),void 0===f.type&&void 0!==a)f.type=a;else{if(void 0===f.type)throw new Error("Type of data is not given and cannot be inferred!");("string"==typeof f.type||f.type instanceof String)&&(f.type=b(f.type))}void 0===f.encoding?f.encoding="raw":("string"==typeof f.encoding||f.encoding instanceof String)&&(f.encoding=x(f.encoding)),f.data&&"block"!=f.type&&"int8"!=f.type&&"uint8"!=f.type&&"ascii"!=f.encoding?f.endian=R:"block"==f.type||"int8"==f.type||"uint8"==f.type||"ascii"==f.encoding?f.endian=void 0:("string"==typeof f.endian||f.endian instanceof String)&&(f.endian=w(f.endian));var m=void 0;if(void 0!==f.spaceDimension)m=f.spaceDimension;else if(void 0!==f.space)switch(f.space){case"right-anterior-superior":case"RAS":m=3;break;case"left-anterior-superior":case"LAS":m=3;break;case"left-posterior-superior":case"LPS":m=3;break;case"right-anterior-superior-time":case"RAST":m=4;break;case"left-anterior-superior-time":case"LAST":m=4;break;case"left-posterior-superior-time":case"LPST":m=4;break;case"scanner-xyz":m=3;break;case"scanner-xyz-time":m=4;break;case"3D-right-handed":case"3D-left-handed":m=3;break;case"3D-right-handed-time":case"3D-left-handed-time":m=4;break;default:console.warn("Unrecognized space: "+f.space)}for(k(f),e=0;e<f.sizes.length;e++){if(f.sizes[e]<=0)throw new Error("Sizes should be a list of positive (>0) integers!");d*=f.sizes[e]}if(f.data){if(f.data.length<d)throw new Error("Missing data to serialize!")}else if(f.buffer){if("raw"==f.encoding&&(s="block"==f.type&&void 0!==f.blockSize?f.blockSize:D(f.type),f.buffer.byteLength<d*s))throw new Error("Missing data to serialize!")}else if(!f.dataFile)throw new Error("Will not serialize an empty NRRD file!");if(f.data)switch(f.encoding){case"raw":o=f.type==a&&f.endian==R?f.data.buffer.slice(f.data.byteOffset,f.data.byteOffset+f.data.byteLength):f.endian==R?(o=O(f.data,f.type)).buffer.slice(o.byteOffset,o.byteOffset+o.byteLength):function(t,e,i){var n,r,a,s=D(e),o=new ArrayBuffer(t.length*s);switch(i){case"big":r=!1;break;case"little":r=!0;break;default:return void console.warn("Unsupported endianness in NRRD file: "+i)}switch(a=new DataView(o),e){case"int8":for(n=0;n<t.length;n++)a.setInt8(n,t[n],r);return o;case"uint8":for(n=0;n<t.length;n++)a.setUint8(n,t[n],r);return o;case"int16":for(n=0;n<t.length;n++)a.setInt16(2*n,t[n],r);return o;case"uint16":for(n=0;n<t.length;n++)a.setUint16(2*n,t[n],r);return o;case"int32":for(n=0;n<t.length;n++)a.setInt32(4*n,t[n],r);return o;case"uint32":for(n=0;n<t.length;n++)a.setUint32(4*n,t[n],r);return o;case"float":for(n=0;n<t.length;n++)a.setFloat32(4*n,t[n],r);return o;case"double":for(n=0;n<t.length;n++)a.setFloat64(8*n,t[n],r);return o;default:return void console.warn("Cannot serialize NRRD type: "+e+".")}}(f.data,f.type,f.endian);break;case"ascii":o=f.type==a?N(f.data):N(O(f.data,f.type));break;default:throw new Error("Unsupported NRRD encoding: "+f.encoding)}else f.buffer&&(o=f.buffer);p.push("NRRD0005"),p.push("# Generated by nrrd-js");var g=["dimension","spaceDimension","space"];for(e=0;e<g.length;e++)void 0!==f[r=g[e]]&&void 0!==(c=l(r,f[r],f.dimension,m))&&p.push(c);for(r in f)void 0!==f[r]&&(g.indexOf(r)>=0||void 0!==(c=l(r,f[r],f.dimension,m))&&p.push(c));if(f.keys)for(r in f.keys){if(r.indexOf(":=")>=0)throw new Error("The combination ':=' is not allowed in an NRRD key!");p.push(r+":="+f[r].replace("\\","\\\\").replace("\n","\\n"))}if(f.dataFile&&f.dataFile.length?(p.push("data file: LIST"),Array.prototype.push.apply(p,f.dataFile)):f.dataFile&&f.dataFile.files&&"subdim"in f.dataFile&&(p.push("data file: LIST "+f.dataFile.subdim),Array.prototype.push.apply(p,f.dataFile.files)),!o||"dataFile"in f)for(p.push(""),u=p.join("\n"),i=new ArrayBuffer(u.length),n=new Uint8Array(i),e=0;e<u.length;e++)n[e]=u.charCodeAt(e);else{for(p.push(""),p.push(""),u=p.join("\n"),i=new ArrayBuffer(u.length+o.byteLength),n=new Uint8Array(i),e=0;e<u.length;e++)n[e]=u.charCodeAt(e);h=new Uint8Array(o),n.set(h,u.length)}return i},t.exports.parse=function(t){var e,i,n,l,c,u,m={data:void 0,buffer:void 0,keys:{},version:void 0},g=new Uint8Array(t);for(g.buffer!==t&&(t=g.buffer),e=2;e<g.length;)if(10==g[e]){if(10==g[e-1]||13==g[e-1]&&10==g[e-2]){n=e+1;break}e++}else 13==g[e]?e++:e+=2;if(void 0===n?i=String.fromCharCode.apply(null,g):(i=String.fromCharCode.apply(null,g.subarray(0,n)),m.buffer=t.slice(n)),l=(l=i.split(r)).filter(function(t){return t.length>0&&"#"!=t[0]}),!a.test(l[0]))throw new Error("File is not an NRRD file!");for(m.version=parseInt(l[0].substring(4,8),10),m.version>5&&console.warn("Reading an unsupported version of the NRRD format; things may go haywire."),e=1;e<l.length;e++)if(c=s.exec(l[e]))if(": "==c[2])c[1]=d(c[1]),"dataFile"==c[1]&&(u=o.exec(c[3]))?(2==u.length&&u[1]?m[c[1]]={files:l.slice(e+1),subdim:f(u[1])}:m[c[1]]=l.slice(e+1),l.length=e):m[c[1]]=h(c[1],c[3]);else{if(":="!=c[2])throw new Error("Logic error in NRRD parser.");m.keys[c[1]]=c[3].split("\\\\").map(function(t){return t.replace("\\n","\n")}).join("\\")}else console.warn("Unrecognized line in NRRD header: "+l[e]);if(k(m),"dataFile"in m)console.warn("No support for external data yet!");else switch(m.encoding){case"raw":m.data=function(t,e,i,n){var r,a,s,o=1;for(r=0;r<i.length;r++){if(i[r]<=0)throw new Error("Sizes should be a list of positive (>0) integers!");o*=i[r]}if("block"==e)return t.slice(0,o*n.blockSize);if("int8"==e||"uint8"==e||n.endian==R)switch(e){case"int8":return l(1),new Int8Array(t.slice(0,o));case"uint8":return l(1),new Uint8Array(t.slice(0,o));case"int16":return l(2),new Int16Array(t.slice(0,2*o));case"uint16":return l(2),new Uint16Array(t.slice(0,2*o));case"int32":return l(4),new Int32Array(t.slice(0,4*o));case"uint32":return l(4),new Uint32Array(t.slice(0,4*o));case"float":return l(4),new Float32Array(t.slice(0,4*o));case"double":return l(8),new Float64Array(t.slice(0,8*o));default:return void console.warn("Unsupported NRRD type: "+e+", returning raw buffer.")}else{switch(n.endian){case"big":!1;break;case"little":!0;break;default:return void console.warn("Unsupported endianness in NRRD file: "+n.endian)}switch(s=new DataView(t),e){case"int8":for(a=new Int8Array(o),r=0;r<o;r++)a[r]=s.getInt8(r);return a;case"uint8":for(a=new Uint8Array(o),r=0;r<o;r++)a[r]=s.getUint8(r);return a;case"int16":for(a=new Int16Array(o),r=0;r<o;r++)a[r]=s.getInt16(2*r);return a;case"uint16":for(a=new Uint16Array(o),r=0;r<o;r++)a[r]=s.getUint16(2*r);return a;case"int32":for(a=new Int32Array(o),r=0;r<o;r++)a[r]=s.getInt32(4*r);return a;case"uint32":for(a=new Uint32Array(o),r=0;r<o;r++)a[r]=s.getUint32(4*r);return a;case"float":for(a=new Float32Array(o),r=0;r<o;r++)a[r]=s.getFloat32(4*r);return a;case"double":for(a=new Float64Array(o),r=0;r<o;r++)a[r]=s.getFloat64(8*r);return a;default:return void console.warn("Unsupported NRRD type: "+e+", returning raw buffer.")}}function l(e){if(t.byteLength<o*e)throw new Error("NRRD file does not contain enough data!")}}(m.buffer,m.type,m.sizes,{endian:m.endian,blockSize:m.blockSize});break;case"ascii":m.data=function(t,e,i){var n,r,a,s,o=1;for(n=0;n<i.length;n++){if(i[n]<=0)throw new Error("Sizes should be a list of positive (>0) integers!");o*=i[n]}if(r=new Uint8Array(t),a=String.fromCharCode.apply(null,r),(s=a.split(L)).length<o)throw new Error("Not enough data in NRRD file!");s.length>o&&(""===s[0]&&(s=s.slice(1)),s=s.slice(0,o));switch(e){case"int8":return new Int8Array(s.map(f));case"uint8":return new Uint8Array(s.map(f));case"int16":return new Int16Array(s.map(f));case"uint16":return new Uint16Array(s.map(f));case"int32":return new Int32Array(s.map(f));case"uint32":return new Uint32Array(s.map(f));case"float":return new Float32Array(s.map(p));case"double":return new Float64Array(s.map(p));default:return void console.warn("Unsupported NRRD type: "+e+".")}}(m.buffer,m.type,m.sizes);break;default:console.warn("Unsupported NRRD encoding: "+m.encoding)}return m};var c={"block size":"blockSize",blocksize:"blockSize","old min":"oldMin",oldmin:"oldMin","old max":"oldMax",oldmax:"oldMax","data file":"dataFile",datafile:"dataFile","line skip":"lineSkip",lineskip:"lineSkip","byte skip":"byteSkip",byteskip:"byteSkip","sample units":"sampleUnits",sampleunits:"sampleUnits","axis mins":"axisMins","axis maxs":"axisMaxs",centers:"centers",centerings:"centers","space dimension":"spaceDimension","space units":"spaceUnits","space origin":"spaceOrigin","space directions":"spaceDirections","measurement frame":"measurementFrame"},u=function(){var t,e={};for(t in c)e[c[t]]=t;return e}();function d(t){return(t=t.toLowerCase())in c?c[t]:t}function f(t){var e=parseInt(t,10);if(Number.isNaN(e))throw new Error("Malformed NRRD integer: "+t);return e}function p(t){if((t=t.toLowerCase()).indexOf("nan")>=0)return NaN;if(t.indexOf("-inf")>=0)return-1/0;if(t.indexOf("inf")>=0)return 1/0;var e=parseFloat(t);if(Number.isNaN(e))throw new Error("Malformed NRRD float: "+t);return e}function m(t){if("none"==t)return null;if(t.length<2||"("!==t[0]||")"!==t[t.length-1])throw new Error("Malformed NRRD vector: "+t);return t.slice(1,-1).split(",").map(p)}function g(t){if(length<2||'"'!=t[0]||'"'!=t[t.length-1])throw new Error("Invalid NRRD quoted string: "+t);return t.slice(1,-1).replace('\\"','"')}function v(t){return'"'+t.replace('"','\\"')+'"'}var _=/[ \t]+/;function y(t,e){return t.split(_).map(e)}function b(t){switch(t.toLowerCase()){case"signed char":case"int8":case"int8_t":return"int8";case"uchar":case"unsigned char":case"uint8":case"uint8_t":return"uint8";case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":return"int16";case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":return"uint16";case"int":case"signed int":case"int32":case"int32_t":return"int32";case"uint":case"unsigned int":case"uint32":case"uint32_t":return"uint32";case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":return"int64";case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":return"uint64";case"float":return"float";case"double":return"double";case"block":return"block";default:return console.warn("Unrecognized NRRD type: "+t),t}}function x(t){switch(t.toLowerCase()){case"raw":return"raw";case"txt":case"text":case"ascii":return"ascii";case"hex":return"hex";case"gz":case"gzip":return"gzip";case"bz2":case"bzip2":return"bzip2";default:return console.warn("Unrecognized NRRD encoding: "+t),t}}function w(t){switch(t.toLowerCase()){case"little":return"little";case"big":return"big";default:return console.warn("Unrecognized NRRD endianness: "+t),t}}var E=/ (-?\d+) (-?\d+) (-?\d+)(?: (\d+))?$/;function S(t){switch(t.toLowerCase()){case"cell":return"cell";case"node":return"node";case"???":case"none":return null;default:return console.warn("Unrecognized NRRD center: "+t),t}}var T={domain:"domain",space:"space",time:"time",list:"list",point:"point",vector:"vector","covariant-vector":"covariant-vector",normal:"normal",stub:"stub",scalar:"scalar",complex:"complex","2-vector":"2-vector","3-color":"3-color","rgb-color":"RGB-color","hsv-color":"HSV-color","xyz-color":"XYZ-color","4-color":"4-color","rgba-color":"RGBA-color","3-vector":"3-vector","3-gradient":"3-gradient","3-normal":"3-normal","4-vector":"4-vector",quaternion:"quaternion","2d-symmetric-matrix":"2D-symmetric-matrix","2d-masked-symmetric-matrix":"2D-masked-symmetric-matrix","2d-matrix":"2D-matrix","2d-masked-matrix":"2D-masked-matrix","3d-symmetric-matrix":"3D-symmetric-matrix","3d-masked-symmetric-matrix":"3D-masked-symmetric-matrix","3d-matrix":"3D-matrix","3d-masked-matrix":"3D-masked-matrix","???":null,none:null};function M(t){var e=t.toLowerCase();return e in T?T[e]:(console.warn("Unrecognized NRRD kind: "+t),t)}function A(t){return null===t?"???":t}var I,C,P,R=(I=new ArrayBuffer(4),C=new Uint32Array(I),P=new Uint8Array(I),C[0]=16909060,1==P[0]&&2==P[1]&&3==P[2]&&4==P[3]?"big":4==P[0]&&3==P[1]&&2==P[2]&&1==P[3]?"little":void console.warn("Unrecognized system endianness!"));var L=/[ \t\n\r\v\f]+/;function D(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":return 4;case"int64":case"uint64":return 8;case"float":return 4;case"double":return 8;default:throw new Error("Do not know the size of NRRD type: "+t)}}function k(t){if(void 0===t.dimension)throw new Error("Dimension missing from NRRD file!");if(void 0===t.type)throw new Error("Type missing from NRRD file!");if(void 0===t.encoding)throw new Error("Encoding missing from NRRD file!");if(void 0===t.sizes)throw new Error("Sizes missing from NRRD file!");if("block"!=t.type&&"int8"!=t.type&&"uint8"!=t.type&&"ascii"!=t.encoding&&void 0===t.endian)throw new Error("Endianness missing from NRRD file!");if("block"==t.type&&void 0===t.blockSize)throw new Error("Missing block size in NRRD file!");if(0===t.dimension)throw new Error("Zero-dimensional NRRD file?");if(t.dimension!=t.sizes.length)throw new Error("Length of 'sizes' is different from 'dimension' in an NRRD file!");if(t.spacings&&t.dimension!=t.spacings.length)throw new Error("Length of 'spacings' is different from 'dimension' in an NRRD file!");if(t.thicknesses&&t.dimension!=t.thicknesses.length)throw new Error("Length of 'thicknesses' is different from 'dimension' in an NRRD file!");if(t.axisMins&&t.dimension!=t.axisMins.length)throw new Error("Length of 'axis mins' is different from 'dimension' in an NRRD file!");if(t.axisMaxs&&t.dimension!=t.axisMaxs.length)throw new Error("Length of 'axis maxs' is different from 'dimension' in an NRRD file!");if(t.centers&&t.dimension!=t.centers.length)throw new Error("Length of 'centers' is different from 'dimension' in an NRRD file!");if(t.labels&&t.dimension!=t.labels.length)throw new Error("Length of 'labels' is different from 'dimension' in an NRRD file!");if(t.units&&t.dimension!=t.units.length)throw new Error("Length of 'units' is different from 'dimension' in an NRRD file!");if(t.kinds&&t.dimension!=t.kinds.length)throw new Error("Length of 'kinds' is different from 'dimension' in an NRRD file!");if(!(void 0!==t.data&&0!==t.data.length||void 0!==t.buffer&&0!==t.buffer.byteLength||void 0!==t.dataFile))throw new Error("NRRD file has neither inline or external data!")}function O(t,e){switch(e){case"int8":return new Int8Array(t);case"uint8":return new Uint8Array(t);case"int16":return new Int16Array(t);case"uint16":return new Uint16Array(t);case"int32":return new Int32Array(t);case"uint32":return new Uint32Array(t);case"float":return new Float32Array(t);case"double":return new Float64Array(t);default:throw new Error("Cannot cast to NRRD type: "+e)}}function N(t){var e,i,n,r,a=new Array(t.length);for(e=0;e<t.length;e++)a[e]=""+t[e];for(i=a.join(" "),n=new ArrayBuffer(i.length),r=new Uint8Array(n),e=0;e<r.length;e++)r[e]=i.charCodeAt(e);return n}},sOR5:function(t,e){var i={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==i.call(t)}},"sv+W":function(t,e,i){"use strict";var n=149,r=24;t.exports=function(t){var e,i,a,s;if(e="",0===t)return e;for(s=n,a=0;a<n&&((i=2*t)>=1?(t=i-1,e+="1",s===n&&(s=a)):(t=i,e+="0"),!(1===i||a-s>r));a++);return e}},tmYD:function(t,e,i){"use strict";var n=i("VOug"),r=i("gt5T"),a=i("LjBA"),s=i("2A+V"),o=i("h95s"),l=Object.prototype.toString,h=0,c=-1,u=0,d=8;function f(t){if(!(this instanceof f))return new f(t);this.options=r.assign({level:c,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var i=n.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(i!==h)throw new Error(s[i]);if(e.header&&n.deflateSetHeader(this.strm,e.header),e.dictionary){var p;if(p="string"==typeof e.dictionary?a.string2buf(e.dictionary):"[object ArrayBuffer]"===l.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(i=n.deflateSetDictionary(this.strm,p))!==h)throw new Error(s[i]);this._dict_set=!0}}function p(t,e){var i=new f(e);if(i.push(t,!0),i.err)throw i.msg||s[i.err];return i.result}f.prototype.push=function(t,e){var i,s,o=this.strm,c=this.options.chunkSize;if(this.ended)return!1;s=e===~~e?e:!0===e?4:0,"string"==typeof t?o.input=a.string2buf(t):"[object ArrayBuffer]"===l.call(t)?o.input=new Uint8Array(t):o.input=t,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new r.Buf8(c),o.next_out=0,o.avail_out=c),1!==(i=n.deflate(o,s))&&i!==h)return this.onEnd(i),this.ended=!0,!1;0!==o.avail_out&&(0!==o.avail_in||4!==s&&2!==s)||("string"===this.options.to?this.onData(a.buf2binstring(r.shrinkBuf(o.output,o.next_out))):this.onData(r.shrinkBuf(o.output,o.next_out)))}while((o.avail_in>0||0===o.avail_out)&&1!==i);return 4===s?(i=n.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===h):2!==s||(this.onEnd(h),o.avail_out=0,!0)},f.prototype.onData=function(t){this.chunks.push(t)},f.prototype.onEnd=function(t){t===h&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Deflate=f,e.deflate=p,e.deflateRaw=function(t,e){return(e=e||{}).raw=!0,p(t,e)},e.gzip=function(t,e){return(e=e||{}).gzip=!0,p(t,e)}},ujcs:function(t,e){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
e.read=function(t,e,i,n,r){var a,s,o=8*r-n-1,l=(1<<o)-1,h=l>>1,c=-7,u=i?r-1:0,d=i?-1:1,f=t[e+u];for(u+=d,a=f&(1<<-c)-1,f>>=-c,c+=o;c>0;a=256*a+t[e+u],u+=d,c-=8);for(s=a&(1<<-c)-1,a>>=-c,c+=n;c>0;s=256*s+t[e+u],u+=d,c-=8);if(0===a)a=1-h;else{if(a===l)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,n),a-=h}return(f?-1:1)*s*Math.pow(2,a-n)},e.write=function(t,e,i,n,r,a){var s,o,l,h=8*a-r-1,c=(1<<h)-1,u=c>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:a-1,p=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,s=c):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+u>=1?d/l:d*Math.pow(2,1-u))*l>=2&&(s++,l/=2),s+u>=c?(o=0,s=c):s+u>=1?(o=(e*l-1)*Math.pow(2,r),s+=u):(o=e*Math.pow(2,u-1)*Math.pow(2,r),s=0));r>=8;t[i+f]=255&o,f+=p,o/=256,r-=8);for(s=s<<r|o,h+=r;h>0;t[i+f]=255&s,f+=p,s/=256,h-=8);t[i+f-p]|=128*m}},v01y:function(t,e,i){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.DataStream=n.lossless.DataStream||i("NuSx"),n.lossless.HuffmanTable=n.lossless.HuffmanTable||i("e94L"),n.lossless.QuantizationTable=n.lossless.QuantizationTable||i("BYXA"),n.lossless.ScanHeader=n.lossless.ScanHeader||i("pPW6"),n.lossless.FrameHeader=n.lossless.FrameHeader||i("wd9Z"),n.lossless.Utils=n.lossless.Utils||i("Ixlh"),n.lossless.Decoder=n.lossless.Decoder||function(t,e){this.buffer=t,this.frame=new n.lossless.FrameHeader,this.huffTable=new n.lossless.HuffmanTable,this.quantTable=new n.lossless.QuantizationTable,this.scan=new n.lossless.ScanHeader,this.DU=n.lossless.Utils.createArray(10,4,64),this.HuffTab=n.lossless.Utils.createArray(4,2,12800),this.IDCT_Source=[],this.nBlock=[],this.acTab=n.lossless.Utils.createArray(10,1),this.dcTab=n.lossless.Utils.createArray(10,1),this.qTab=n.lossless.Utils.createArray(10,1),this.marker=0,this.markerIndex=0,this.numComp=0,this.restartInterval=0,this.selection=0,this.xDim=0,this.yDim=0,this.xLoc=0,this.yLoc=0,this.numBytes=0,this.outputData=null,this.restarting=!1,this.mask=0,void 0!==e&&(this.numBytes=e)},n.lossless.Decoder.IDCT_P=[0,5,40,16,45,2,7,42,21,56,8,61,18,47,1,4,41,23,58,13,32,24,37,10,63,17,44,3,6,43,20,57,15,34,29,48,53,26,39,9,60,19,46,22,59,12,33,31,50,55,25,36,11,62,14,35,28,49,52,27,38,30,51,54],n.lossless.Decoder.TABLE=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],n.lossless.Decoder.MAX_HUFFMAN_SUBTREE=50,n.lossless.Decoder.MSB=2147483648,n.lossless.Decoder.RESTART_MARKER_BEGIN=65488,n.lossless.Decoder.RESTART_MARKER_END=65495,n.lossless.Decoder.prototype.decompress=function(t,e,i){return this.decode(t,e,i).buffer},n.lossless.Decoder.prototype.decode=function(t,e,i,r){var a,s,o,l,h=0,c=[],u=[],d=[];if(void 0!==t&&(this.buffer=t),void 0!==r&&(this.numBytes=r),this.stream=new n.lossless.DataStream(this.buffer,e,i),this.buffer=null,this.xLoc=0,this.yLoc=0,65496!==(a=this.stream.get16()))throw new Error("Not a JPEG file");for(a=this.stream.get16();a>>4!=4092||65476===a;){switch(a){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,n.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if(a>>8!=255)throw new Error("ERROR: format throw new IOException! (decode)")}a=this.stream.get16()}if(a<65472||a>65479)throw new Error("ERROR: could not handle arithmetic code!");this.frame.read(this.stream),a=this.stream.get16();do{for(;65498!==a;){switch(a){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,n.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if(a>>8!=255)throw new Error("ERROR: format throw new IOException! (Parser.decode)")}a=this.stream.get16()}switch(this.precision=this.frame.precision,this.components=this.frame.components,this.numBytes||(this.numBytes=parseInt(Math.ceil(this.precision/8))),1==this.numBytes?this.mask=255:this.mask=65535,this.scan.read(this.stream),this.numComp=this.scan.numComp,this.selection=this.scan.selection,1===this.numBytes?3===this.numComp?(this.getter=this.getValueRGB,this.setter=this.setValueRGB,this.output=this.outputRGB):(this.getter=this.getValue8,this.setter=this.setValue8,this.output=this.outputSingle):(this.getter=this.getValue16,this.setter=this.setValue16,this.output=this.outputSingle),this.selection){case 2:this.selector=this.select2;break;case 3:this.selector=this.select3;break;case 4:this.selector=this.select4;break;case 5:this.selector=this.select5;break;case 6:this.selector=this.select6;break;case 7:this.selector=this.select7;break;default:this.selector=this.select1}for(this.scanComps=this.scan.components,this.quantTables=this.quantTable.quantTables,s=0;s<this.numComp;s+=1)o=this.scanComps[s].scanCompSel,this.qTab[s]=this.quantTables[this.components[o].quantTableSel],this.nBlock[s]=this.components[o].vSamp*this.components[o].hSamp,this.dcTab[s]=this.HuffTab[this.scanComps[s].dcTabSel][0],this.acTab[s]=this.HuffTab[this.scanComps[s].acTabSel][1];for(this.xDim=this.frame.dimX,this.yDim=this.frame.dimY,this.outputData=new DataView(new ArrayBuffer(this.xDim*this.yDim*this.numBytes*this.numComp)),h+=1;;){for(u[0]=0,d[0]=0,s=0;s<10;s+=1)c[s]=1<<this.precision-1;if(0===this.restartInterval){for(a=this.decodeUnit(c,u,d);0===a&&this.xLoc<this.xDim&&this.yLoc<this.yDim;)this.output(c),a=this.decodeUnit(c,u,d);break}for(l=0;l<this.restartInterval&&(this.restarting=0==l,a=this.decodeUnit(c,u,d),this.output(c),0===a);l+=1);if(0===a&&(0!==this.markerIndex?(a=65280|this.marker,this.markerIndex=0):a=this.stream.get16()),!(a>=n.lossless.Decoder.RESTART_MARKER_BEGIN&&a<=n.lossless.Decoder.RESTART_MARKER_END))break}65500===a&&1===h&&(this.readNumber(),a=this.stream.get16())}while(65497!==a&&this.xLoc<this.xDim&&this.yLoc<this.yDim&&0===h);return this.outputData},n.lossless.Decoder.prototype.decodeUnit=function(t,e,i){return 1==this.numComp?this.decodeSingle(t,e,i):3==this.numComp?this.decodeRGB(t,e,i):-1},n.lossless.Decoder.prototype.select1=function(t){return this.getPreviousX(t)},n.lossless.Decoder.prototype.select2=function(t){return this.getPreviousY(t)},n.lossless.Decoder.prototype.select3=function(t){return this.getPreviousXY(t)},n.lossless.Decoder.prototype.select4=function(t){return this.getPreviousX(t)+this.getPreviousY(t)-this.getPreviousXY(t)},n.lossless.Decoder.prototype.select5=function(t){return this.getPreviousX(t)+(this.getPreviousY(t)-this.getPreviousXY(t)>>1)},n.lossless.Decoder.prototype.select6=function(t){return this.getPreviousY(t)+(this.getPreviousX(t)-this.getPreviousXY(t)>>1)},n.lossless.Decoder.prototype.select7=function(t){return(this.getPreviousX(t)+this.getPreviousY(t))/2},n.lossless.Decoder.prototype.decodeRGB=function(t,e,i){var r,a,s,o,l,h,c,u;for(t[0]=this.selector(0),t[1]=this.selector(1),t[2]=this.selector(2),l=0;l<this.numComp;l+=1)for(o=this.qTab[l],a=this.acTab[l],s=this.dcTab[l],h=0;h<this.nBlock[l];h+=1){for(c=0;c<this.IDCT_Source.length;c+=1)this.IDCT_Source[c]=0;if((r=this.getHuffmanValue(s,e,i))>=65280)return r;for(t[l]=this.IDCT_Source[0]=t[l]+this.getn(i,r,e,i),this.IDCT_Source[0]*=o[0],u=1;u<64;u+=1){if((r=this.getHuffmanValue(a,e,i))>=65280)return r;if(u+=r>>4,0==(15&r)){if(r>>4==0)break}else this.IDCT_Source[n.lossless.Decoder.IDCT_P[u]]=this.getn(i,15&r,e,i)*o[u]}}return 0},n.lossless.Decoder.prototype.decodeSingle=function(t,e,i){var r,a,s,o;for(this.restarting?(this.restarting=!1,t[0]=1<<this.frame.precision-1):t[0]=this.selector(),a=0;a<this.nBlock[0];a+=1){if((r=this.getHuffmanValue(this.dcTab[0],e,i))>=65280)return r;if((o=(s=this.getn(t,r,e,i))>>8)>=n.lossless.Decoder.RESTART_MARKER_BEGIN&&o<=n.lossless.Decoder.RESTART_MARKER_END)return o;t[0]+=s}return 0},n.lossless.Decoder.prototype.getHuffmanValue=function(t,e,i){var r,a;if(65535,i[0]<8?(e[0]<<=8,255===(a=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),e[0]|=a):i[0]-=8,0!=((r=t[e[0]>>i[0]])&n.lossless.Decoder.MSB)){if(0!==this.markerIndex)return this.markerIndex=0,65280|this.marker;e[0]&=65535>>16-i[0],e[0]<<=8,255===(a=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),e[0]|=a,r=t[256*(255&r)+(e[0]>>i[0])],i[0]+=8}if(i[0]+=8-(r>>8),i[0]<0)throw new Error("index="+i[0]+" temp="+e[0]+" code="+r+" in HuffmanValue()");return i[0]<this.markerIndex?(this.markerIndex=0,65280|this.marker):(e[0]&=65535>>16-i[0],255&r)},n.lossless.Decoder.prototype.getn=function(t,e,i,n){var r,a;if(1,-1,65535,0===e)return 0;if(16===e)return t[0]>=0?-32768:32768;if(n[0]-=e,n[0]>=0){if(n[0]<this.markerIndex&&!this.isLastPixel())return this.markerIndex=0,(65280|this.marker)<<8;r=i[0]>>n[0],i[0]&=65535>>16-n[0]}else{if(i[0]<<=8,255===(a=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),i[0]|=a,n[0]+=8,n[0]<0){if(0!==this.markerIndex)return this.markerIndex=0,(65280|this.marker)<<8;i[0]<<=8,255===(a=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),i[0]|=a,n[0]+=8}if(n[0]<0)throw new Error("index="+n[0]+" in getn()");if(n[0]<this.markerIndex)return this.markerIndex=0,(65280|this.marker)<<8;r=i[0]>>n[0],i[0]&=65535>>16-n[0]}return r<1<<e-1&&(r+=1+(-1<<e)),r},n.lossless.Decoder.prototype.getPreviousX=function(t){return this.xLoc>0?this.getter(this.yLoc*this.xDim+this.xLoc-1,t):this.yLoc>0?this.getPreviousY(t):1<<this.frame.precision-1},n.lossless.Decoder.prototype.getPreviousXY=function(t){return this.xLoc>0&&this.yLoc>0?this.getter((this.yLoc-1)*this.xDim+this.xLoc-1,t):this.getPreviousY(t)},n.lossless.Decoder.prototype.getPreviousY=function(t){return this.yLoc>0?this.getter((this.yLoc-1)*this.xDim+this.xLoc,t):this.getPreviousX(t)},n.lossless.Decoder.prototype.isLastPixel=function(){return this.xLoc===this.xDim-1&&this.yLoc===this.yDim-1},n.lossless.Decoder.prototype.outputSingle=function(t){this.xLoc<this.xDim&&this.yLoc<this.yDim&&(this.setter(this.yLoc*this.xDim+this.xLoc,this.mask&t[0]),this.xLoc+=1,this.xLoc>=this.xDim&&(this.yLoc+=1,this.xLoc=0))},n.lossless.Decoder.prototype.outputRGB=function(t){var e=this.yLoc*this.xDim+this.xLoc;this.xLoc<this.xDim&&this.yLoc<this.yDim&&(this.setter(e,t[0],0),this.setter(e,t[1],1),this.setter(e,t[2],2),this.xLoc+=1,this.xLoc>=this.xDim&&(this.yLoc+=1,this.xLoc=0))},n.lossless.Decoder.prototype.setValue16=function(t,e){this.outputData.setInt16(2*t,e,!0)},n.lossless.Decoder.prototype.getValue16=function(t){return this.outputData.getInt16(2*t,!0)},n.lossless.Decoder.prototype.setValue8=function(t,e){this.outputData.setInt8(t,e)},n.lossless.Decoder.prototype.getValue8=function(t){return this.outputData.getInt8(t)},n.lossless.Decoder.prototype.setValueRGB=function(t,e,i){this.outputData.setUint8(3*t+i,e)},n.lossless.Decoder.prototype.getValueRGB=function(t,e){return this.outputData.getUint8(3*t+e)},n.lossless.Decoder.prototype.readApp=function(){var t=0,e=this.stream.get16();for(t+=2;t<e;)this.stream.get8(),t+=1;return e},n.lossless.Decoder.prototype.readComment=function(){var t,e="",i=0;for(t=this.stream.get16(),i+=2;i<t;)e+=this.stream.get8(),i+=1;return e},n.lossless.Decoder.prototype.readNumber=function(){if(4!==this.stream.get16())throw new Error("ERROR: Define number format throw new IOException [Ld!=4]");return this.stream.get16()},"undefined"!==typeof t&&t.exports&&(t.exports=n.lossless.Decoder)},vzCy:function(t,e,i){"use strict";var n,r="object"==typeof Reflect?Reflect:null,a=r&&"function"==typeof r.apply?r.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)};n=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var s=Number.isNaN||function(t){return t!=t};function o(){o.init.call(this)}t.exports=o,t.exports.once=function(t,e){return new Promise(function(i,n){function r(){void 0!==a&&t.removeListener("error",a),i([].slice.call(arguments))}var a;"error"!==e&&(a=function(i){t.removeListener(e,r),n(i)},t.once("error",a)),t.once(e,r)})},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var l=10;function h(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function c(t){return void 0===t._maxListeners?o.defaultMaxListeners:t._maxListeners}function u(t,e,i,n){var r,a,s,o;if(h(i),void 0===(a=t._events)?(a=t._events=Object.create(null),t._eventsCount=0):(void 0!==a.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),a=t._events),s=a[e]),void 0===s)s=a[e]=i,++t._eventsCount;else if("function"==typeof s?s=a[e]=n?[i,s]:[s,i]:n?s.unshift(i):s.push(i),(r=c(t))>0&&s.length>r&&!s.warned){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=s.length,o=l,console&&console.warn&&console.warn(o)}return t}function d(t,e,i){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},r=function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}.bind(n);return r.listener=i,n.wrapFn=r,r}function f(t,e,i){var n=t._events;if(void 0===n)return[];var r=n[e];return void 0===r?[]:"function"==typeof r?i?[r.listener||r]:[r]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(r):m(r,r.length)}function p(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function m(t,e){for(var i=new Array(e),n=0;n<e;++n)i[n]=t[n];return i}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(t){if("number"!=typeof t||t<0||s(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");l=t}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||s(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var n="error"===t,r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var l=r[t];if(void 0===l)return!1;if("function"==typeof l)a(l,this,e);else{var h=l.length,c=m(l,h);for(i=0;i<h;++i)a(c[i],this,e)}return!0},o.prototype.addListener=function(t,e){return u(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return u(this,t,e,!0)},o.prototype.once=function(t,e){return h(e),this.on(t,d(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){return h(e),this.prependListener(t,d(this,t,e)),this},o.prototype.removeListener=function(t,e){var i,n,r,a,s;if(h(e),void 0===(n=this._events))return this;if(void 0===(i=n[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(r=-1,a=i.length-1;a>=0;a--)if(i[a]===e||i[a].listener===e){s=i[a].listener,r=a;break}if(r<0)return this;0===r?i.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(i,r),1===i.length&&(n[t]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",t,s||e)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(t){var e,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var r,a=Object.keys(i);for(n=0;n<a.length;++n)"removeListener"!==(r=a[n])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},o.prototype.listeners=function(t){return f(this,t,!0)},o.prototype.rawListeners=function(t){return f(this,t,!1)},o.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):p.call(t,e)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},wN8F:function(t,e,i){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.ComponentSpec=n.lossless.ComponentSpec||function(){this.hSamp=0,this.quantTableSel=0,this.vSamp=0},"undefined"!==typeof t&&t.exports&&(t.exports=n.lossless.ComponentSpec)},wd9Z:function(t,e,i){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.ComponentSpec=n.lossless.ComponentSpec||i("wN8F"),n.lossless.DataStream=n.lossless.DataStream||i("NuSx"),n.lossless.FrameHeader=n.lossless.FrameHeader||function(){this.components=[],this.dimX=0,this.dimY=0,this.numComp=0,this.precision=0},n.lossless.FrameHeader.prototype.read=function(t){var e,i,r,a,s=0;for(e=t.get16(),s+=2,this.precision=t.get8(),s+=1,this.dimY=t.get16(),s+=2,this.dimX=t.get16(),s+=2,this.numComp=t.get8(),s+=1,i=1;i<=this.numComp;i+=1){if(s>e)throw new Error("ERROR: frame format error");if(r=t.get8(),(s+=1)>=e)throw new Error("ERROR: frame format error [c>=Lf]");a=t.get8(),s+=1,this.components[r]||(this.components[r]=new n.lossless.ComponentSpec),this.components[r].hSamp=a>>4,this.components[r].vSamp=15&a,this.components[r].quantTableSel=t.get8(),s+=1}if(s!==e)throw new Error("ERROR: frame format error [Lf!=count]");return 1},"undefined"!==typeof t&&t.exports&&(t.exports=n.lossless.FrameHeader)},"wg/6":function(t,e){var i={Unkown:0,Grayscale:1,AdobeRGB:2,RGB:3,CYMK:4},n=function(){"use strict";var t=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),e=4017,n=799,r=3406,a=2276,s=1567,o=3784,l=5793,h=2896;function c(){}function u(t,e){for(var i,n,r=0,a=[],s=16;s>0&&!t[s-1];)s--;a.push({children:[],index:0});var o,l=a[0];for(i=0;i<s;i++){for(n=0;n<t[i];n++){for((l=a.pop()).children[l.index]=e[r];l.index>0;)l=a.pop();for(l.index++,a.push(l);a.length<=i;)a.push(o={children:[],index:0}),l.children[l.index]=o.children,l=o;r++}i+1<s&&(a.push(o={children:[],index:0}),l.children[l.index]=o.children,l=o)}return a[0].children}function d(t,e,i){return 64*((t.blocksPerLine+1)*e+i)}function f(e,i,n,r,a,s,o,l,h){n.precision,n.samplesPerLine,n.scanLines;var c=n.mcusPerLine,u=n.progressive,f=(n.maxH,n.maxV,i),p=0,m=0;function g(){if(m>0)return p>>--m&1;if(255==(p=e[i++])){var t=e[i++];if(t)throw"unexpected marker: "+(p<<8|t).toString(16)}return m=7,p>>>7}function v(t){for(var e,i=t;null!==(e=g());){if("number"==typeof(i=i[e]))return i;if("object"!=typeof i)throw"invalid huffman sequence"}return null}function _(t){for(var e=0;t>0;){var i=g();if(null===i)return;e=e<<1|i,t--}return e}function y(t){var e=_(t);return e>=1<<t-1?e:e+(-1<<t)+1}var b=0;var x,w=0;function E(t,e,i,n,r){var a=i%c;e(t,d(t,(i/c|0)*t.v+n,a*t.h+r))}function S(t,e,i){e(t,d(t,i/t.blocksPerLine|0,i%t.blocksPerLine))}var T,M,A,I,C,P,R=r.length;P=u?0===s?0===l?function(t,e){var i=v(t.huffmanTableDC),n=0===i?0:y(i)<<h;t.blockData[e]=t.pred+=n}:function(t,e){t.blockData[e]|=g()<<h}:0===l?function(e,i){if(b>0)b--;else for(var n=s,r=o;n<=r;){var a=v(e.huffmanTableAC),l=15&a,c=a>>4;if(0!==l){var u=t[n+=c];e.blockData[i+u]=y(l)*(1<<h),n++}else{if(c<15){b=_(c)+(1<<c)-1;break}n+=16}}}:function(e,i){for(var n=s,r=o,a=0;n<=r;){var l=t[n];switch(w){case 0:var c=v(e.huffmanTableAC),u=15&c;if(a=c>>4,0===u)a<15?(b=_(a)+(1<<a),w=4):(a=16,w=1);else{if(1!==u)throw"invalid ACn encoding";x=y(u),w=a?2:3}continue;case 1:case 2:e.blockData[i+l]?e.blockData[i+l]+=g()<<h:0==--a&&(w=2==w?3:0);break;case 3:e.blockData[i+l]?e.blockData[i+l]+=g()<<h:(e.blockData[i+l]=x<<h,w=0);break;case 4:e.blockData[i+l]&&(e.blockData[i+l]+=g()<<h)}n++}4===w&&0==--b&&(w=0)}:function(e,i){var n=v(e.huffmanTableDC),r=0===n?0:y(n);e.blockData[i]=e.pred+=r;for(var a=1;a<64;){var s=v(e.huffmanTableAC),o=15&s,l=s>>4;if(0!==o){var h=t[a+=l];e.blockData[i+h]=y(o),a++}else{if(l<15)break;a+=16}}};var L,D,k,O,N=0;for(D=1==R?r[0].blocksPerLine*r[0].blocksPerColumn:c*n.mcusPerColumn,a||(a=D);N<D;){for(M=0;M<R;M++)r[M].pred=0;if(b=0,1==R)for(T=r[0],C=0;C<a;C++)S(T,P,N),N++;else for(C=0;C<a;C++){for(M=0;M<R;M++)for(k=(T=r[M]).h,O=T.v,A=0;A<O;A++)for(I=0;I<k;I++)E(T,P,N,A,I);N++}if(m=0,(L=e[i]<<8|e[i+1])<=65280)throw"marker was not found";if(!(L>=65488&&L<=65495))break;i+=2}return i-f}function p(t,i,c){var u,d,f,p,m,g,v,_,y,b,x=t.quantizationTable;for(b=0;b<64;b++)c[b]=t.blockData[i+b]*x[b];for(b=0;b<8;++b){var w=8*b;0!==c[1+w]||0!==c[2+w]||0!==c[3+w]||0!==c[4+w]||0!==c[5+w]||0!==c[6+w]||0!==c[7+w]?(u=l*c[0+w]+128>>8,d=l*c[4+w]+128>>8,f=c[2+w],p=c[6+w],m=h*(c[1+w]-c[7+w])+128>>8,_=h*(c[1+w]+c[7+w])+128>>8,g=c[3+w]<<4,v=c[5+w]<<4,y=u-d+1>>1,u=u+d+1>>1,d=y,y=f*o+p*s+128>>8,f=f*s-p*o+128>>8,p=y,y=m-v+1>>1,m=m+v+1>>1,v=y,y=_+g+1>>1,g=_-g+1>>1,_=y,y=u-p+1>>1,u=u+p+1>>1,p=y,y=d-f+1>>1,d=d+f+1>>1,f=y,y=m*a+_*r+2048>>12,m=m*r-_*a+2048>>12,_=y,y=g*n+v*e+2048>>12,g=g*e-v*n+2048>>12,v=y,c[0+w]=u+_,c[7+w]=u-_,c[1+w]=d+v,c[6+w]=d-v,c[2+w]=f+g,c[5+w]=f-g,c[3+w]=p+m,c[4+w]=p-m):(y=l*c[0+w]+512>>10,c[0+w]=y,c[1+w]=y,c[2+w]=y,c[3+w]=y,c[4+w]=y,c[5+w]=y,c[6+w]=y,c[7+w]=y)}for(b=0;b<8;++b){var E=b;0!==c[8+E]||0!==c[16+E]||0!==c[24+E]||0!==c[32+E]||0!==c[40+E]||0!==c[48+E]||0!==c[56+E]?(u=l*c[0+E]+2048>>12,d=l*c[32+E]+2048>>12,f=c[16+E],p=c[48+E],m=h*(c[8+E]-c[56+E])+2048>>12,_=h*(c[8+E]+c[56+E])+2048>>12,g=c[24+E],v=c[40+E],y=u-d+1>>1,u=u+d+1>>1,d=y,y=f*o+p*s+2048>>12,f=f*s-p*o+2048>>12,p=y,y=m-v+1>>1,m=m+v+1>>1,v=y,y=_+g+1>>1,g=_-g+1>>1,_=y,y=u-p+1>>1,u=u+p+1>>1,p=y,y=d-f+1>>1,d=d+f+1>>1,f=y,y=m*a+_*r+2048>>12,m=m*r-_*a+2048>>12,_=y,y=g*n+v*e+2048>>12,g=g*e-v*n+2048>>12,v=y,c[0+E]=u+_,c[56+E]=u-_,c[8+E]=d+v,c[48+E]=d-v,c[16+E]=f+g,c[40+E]=f-g,c[24+E]=p+m,c[32+E]=p-m):(y=l*c[b+0]+8192>>14,c[0+E]=y,c[8+E]=y,c[16+E]=y,c[24+E]=y,c[32+E]=y,c[40+E]=y,c[48+E]=y,c[56+E]=y)}for(b=0;b<64;++b){var S=i+b,T=c[b];T=T<=-2056/t.bitConversion?0:T>=2024/t.bitConversion?255/t.bitConversion:T+2056/t.bitConversion>>4,t.blockData[S]=T}}function m(t,e){for(var i=e.blocksPerLine,n=e.blocksPerColumn,r=new Int32Array(64),a=0;a<n;a++)for(var s=0;s<i;s++){p(e,d(e,a,s),r)}return e.blockData}function g(t){return t<=0?0:t>=255?255:0|t}return c.prototype={load:function(t){var e=function(t){this.parse(t),this.onload&&this.onload()}.bind(this);if(t.indexOf("data:")>-1){for(var i=t.indexOf("base64,")+7,n=atob(t.substring(i)),r=new Uint8Array(n.length),a=n.length-1;a>=0;a--)r[a]=n.charCodeAt(a);e(n)}else{var s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType="arraybuffer",s.onload=function(){var t=new Uint8Array(s.response);e(t)}.bind(this),s.send(null)}},parse:function(e){function n(){var t=e[l]<<8|e[l+1];return l+=2,t}function r(){var t=n(),i=e.subarray(l,l+t-2);return l+=i.length,i}function a(t){for(var e=Math.ceil(t.samplesPerLine/8/t.maxH),i=Math.ceil(t.scanLines/8/t.maxV),n=0;n<t.components.length;n++){W=t.components[n];var r=Math.ceil(Math.ceil(t.samplesPerLine/8)*W.h/t.maxH),a=Math.ceil(Math.ceil(t.scanLines/8)*W.v/t.maxV),s=e*W.h,o=64*(i*W.v)*(s+1);W.blockData=new Int16Array(o),W.blocksPerLine=r,W.blocksPerColumn=a}t.mcusPerLine=e,t.mcusPerColumn=i}var s,o,l=0,h=(e.length,null),c=null,d=[],p=[],g=[],v=n();if(65496!=v)throw"SOI not found";for(v=n();65497!=v;){var _,y;switch(v){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var b=r();65504===v&&74===b[0]&&70===b[1]&&73===b[2]&&70===b[3]&&0===b[4]&&(h={version:{major:b[5],minor:b[6]},densityUnits:b[7],xDensity:b[8]<<8|b[9],yDensity:b[10]<<8|b[11],thumbWidth:b[12],thumbHeight:b[13],thumbData:b.subarray(14,14+3*b[12]*b[13])}),65518===v&&65===b[0]&&100===b[1]&&111===b[2]&&98===b[3]&&101===b[4]&&0===b[5]&&(c={version:b[6],flags0:b[7]<<8|b[8],flags1:b[9]<<8|b[10],transformCode:b[11]});break;case 65499:for(var x=n()+l-2;l<x;){var w=e[l++],E=new Int32Array(64);if(w>>4==0)for(_=0;_<64;_++){E[t[_]]=e[l++]}else{if(w>>4!=1)throw"DQT: invalid table spec";for(_=0;_<64;_++){E[t[_]]=n()}}d[15&w]=E}break;case 65472:case 65473:case 65474:if(s)throw"Only single frame JPEGs supported";n(),(s={}).extended=65473===v,s.progressive=65474===v,s.precision=e[l++],s.scanLines=n(),s.samplesPerLine=n(),s.components=[],s.componentIds={};var S,T=e[l++],M=0,A=0;for(V=0;V<T;V++){S=e[l];var I=e[l+1]>>4,C=15&e[l+1];M<I&&(M=I),A<C&&(A=C);var P=e[l+2];y=s.components.push({h:I,v:C,quantizationTable:d[P],quantizationTableId:P,bitConversion:255/((1<<s.precision)-1)}),s.componentIds[S]=y-1,l+=3}s.maxH=M,s.maxV=A,a(s);break;case 65476:var R=n();for(V=2;V<R;){var L=e[l++],D=new Uint8Array(16),k=0;for(_=0;_<16;_++,l++)k+=D[_]=e[l];var O=new Uint8Array(k);for(_=0;_<k;_++,l++)O[_]=e[l];V+=17+k,(L>>4==0?g:p)[15&L]=u(D,O)}break;case 65501:n(),o=n();break;case 65498:n();var N=e[l++],U=[];for(V=0;V<N;V++){var F=s.componentIds[e[l++]];W=s.components[F];var B=e[l++];W.huffmanTableDC=g[B>>4],W.huffmanTableAC=p[15&B],U.push(W)}var z=e[l++],H=e[l++],G=e[l++],j=f(e,l,s,U,o,z,H,G>>4,15&G);l+=j;break;default:if(255==e[l-3]&&e[l-2]>=192&&e[l-2]<=254){l-=3;break}throw"unknown JPEG marker "+v.toString(16)}v=n()}switch(this.width=s.samplesPerLine,this.height=s.scanLines,this.jfif=h,this.adobe=c,this.components=[],s.components.length){case 1:this.colorspace=i.Grayscale;break;case 3:this.adobe?this.colorspace=i.AdobeRGB:this.colorspace=i.RGB;break;case 4:this.colorspace=i.CYMK;break;default:this.colorspace=i.Unknown}for(var V=0;V<s.components.length;V++){var W;(W=s.components[V]).quantizationTable||null===W.quantizationTableId||(W.quantizationTable=d[W.quantizationTableId]),this.components.push({output:m(0,W),scaleX:W.h/s.maxH,scaleY:W.v/s.maxV,blocksPerLine:W.blocksPerLine,blocksPerColumn:W.blocksPerColumn,bitConversion:W.bitConversion})}},getData16:function(t,e){if(1!==this.components.length)throw"Unsupported color mode";var i,n,r,a,s,o,l=this.width/t,h=this.height/e,c=0,u=this.components.length,f=new Uint16Array(t*e*u),p=new Uint16Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(o=0;o<u;o++){for(var m,g,v,_=(i=this.components[o]).blocksPerLine,y=i.blocksPerColumn,b=_<<3,x=0,w=0;w<y;w++)for(var E=w<<3,S=0;S<_;S++){var T=d(i,w,S),M=(c=0,S<<3);for(m=0;m<8;m++){x=(E+m)*b;for(g=0;g<8;g++)p[x+M+g]=i.output[T+c++]}}for(n=i.scaleX*l,r=i.scaleY*h,c=o,s=0;s<e;s++)for(a=0;a<t;a++)v=(0|s*r)*b+(0|a*n),f[c]=p[v],c+=u}return f},getData:function(t,e){var i,n,r,a,s,o,l,h,c,u,f,p,m,v,_,y=this.width/t,b=this.height/e,x=0,w=this.components.length,E=t*e*w,S=new Uint8Array(E),T=new Uint8Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(o=0;o<w;o++){for(var M,A,I,C=(i=this.components[o]).blocksPerLine,P=i.blocksPerColumn,R=C<<3,L=0,D=0;D<P;D++)for(var k=D<<3,O=0;O<C;O++){var N=d(i,D,O),U=(x=0,O<<3);for(M=0;M<8;M++){L=(k+M)*R;for(A=0;A<8;A++)T[L+U+A]=i.output[N+x++]*i.bitConversion}}for(n=i.scaleX*y,r=i.scaleY*b,x=o,s=0;s<e;s++)for(a=0;a<t;a++)I=(0|s*r)*R+(0|a*n),S[x]=T[I],x+=w}switch(w){case 1:case 2:break;case 3:if(_=!0,this.adobe&&this.adobe.transformCode?_=!0:void 0!==this.colorTransform&&(_=!!this.colorTransform),_)for(o=0;o<E;o+=w)l=S[o],h=S[o+1],p=g(l-179.456+1.402*(c=S[o+2])),m=g(l+135.459-.344*h-.714*c),v=g(l-226.816+1.772*h),S[o]=p,S[o+1]=m,S[o+2]=v;break;case 4:if(!this.adobe)throw"Unsupported color mode (4 components)";if(_=!1,this.adobe&&this.adobe.transformCode?_=!0:void 0!==this.colorTransform&&(_=!!this.colorTransform),_)for(o=0;o<E;o+=w)l=S[o],h=S[o+1],u=g(434.456-l-1.402*(c=S[o+2])),f=g(119.541-l+.344*h+.714*c),l=g(481.816-l-1.772*h),S[o]=u,S[o+1]=f,S[o+2]=l;break;default:throw"Unsupported color mode"}return S}},c}();"undefined"!==typeof t&&t.exports&&(t.exports=n)},"x+d4":function(t,e,i){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;e.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var r={arraySet:function(t,e,i,n,r){if(e.subarray&&t.subarray)t.set(e.subarray(i,i+n),r);else for(var a=0;a<n;a++)t[r+a]=e[i+a]},flattenChunks:function(t){var e,i,n,r,a,s;for(n=0,e=0,i=t.length;e<i;e++)n+=t[e].length;for(s=new Uint8Array(n),r=0,e=0,i=t.length;e<i;e++)a=t[e],s.set(a,r),r+=a.length;return s}},a={arraySet:function(t,e,i,n,r){for(var a=0;a<n;a++)t[r+a]=e[i+a]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,r)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,a))},e.setTyped(n)},x0Ha:function(t,e,i){"use strict";var n=i("ypnx");function r(t,e){t.emit("error",e)}t.exports={destroy:function(t,e){var i=this,a=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return a||s?(e?e(t):!t||this._writableState&&this._writableState.errorEmitted||n.nextTick(r,this,t),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!e&&t?(n.nextTick(r,i,t),i._writableState&&(i._writableState.errorEmitted=!0)):e&&e(t)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},xaZU:function(t,e,i){"use strict";var n=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,e,i,o){return e=e||"&",i=i||"=",null===t&&(t=void 0),"object"==typeof t?a(s(t),function(s){var o=encodeURIComponent(n(s))+i;return r(t[s])?a(t[s],function(t){return o+encodeURIComponent(n(t))}).join(e):o+encodeURIComponent(n(t[s]))}).join(e):o?encodeURIComponent(n(o))+i+encodeURIComponent(n(t)):""};var r=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function a(t,e){if(t.map)return t.map(e);for(var i=[],n=0;n<t.length;n++)i.push(e(t[n],n));return i}var s=Object.keys||function(t){var e=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.push(i);return e}},"xe4/":function(t,e,i){"use strict";var n={};(0,i("gt5T").assign)(n,i("tmYD"),i("LGU4"),i("0jOE")),t.exports=n},ypnx:function(t,e,i){"use strict";(function(e){void 0===e||!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports={nextTick:function(t,i,n,r){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var a,s,o=arguments.length;switch(o){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick(function(){t.call(null,i)});case 3:return e.nextTick(function(){t.call(null,i,n)});case 4:return e.nextTick(function(){t.call(null,i,n,r)});default:for(a=new Array(o-1),s=0;s<a.length;)a[s++]=arguments[s];return e.nextTick(function(){t.apply(null,a)})}}}:t.exports=e}).call(e,i("W2nU"))},zdxh:function(t,e,i){"use strict";var n=n||{};n.lossless=n.lossless||{},n.lossless.ScanComponent=n.lossless.ScanComponent||function(){this.acTabSel=0,this.dcTabSel=0,this.scanCompSel=0},"undefined"!==typeof t&&t.exports&&(t.exports=n.lossless.ScanComponent)}});
//# sourceMappingURL=2.6e0680a232b6e00a9876.js.map